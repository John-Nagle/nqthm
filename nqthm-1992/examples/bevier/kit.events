#|
 Copyright (C) 1987, 1994 by William R. Bevier.  All Rights Reserved.

 You may copy and distribute verbatim copies of this Nqthm-1992 event script as
 you receive it, in any medium, including embedding it verbatim in derivative
 works, provided that you conspicuously and appropriately publish on each copy
 a valid copyright notice "Copyright (C) 1987, 1994 by William R. Bevier.  All
 Rights Reserved."

 NO WARRANTY

 William R. Bevier PROVIDES ABSOLUTELY NO WARRANTY.  THE EVENT SCRIPT IS
 PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
 INCLUDING, BUT NOT LIMITED TO, ANY IMPLIED WARRANTIES OF MERCHANTABILITY AND
 FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND
 PERFORMANCE OF THE SCRIPT IS WITH YOU.  SHOULD THE SCRIPT PROVE DEFECTIVE, YOU
 ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.

 IN NO EVENT WILL William R. Bevier BE LIABLE TO YOU FOR ANY DAMAGES, ANY LOST
 PROFITS, LOST MONIES, OR OTHER SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
 ARISING OUT OF THE USE OR INABILITY TO USE THIS SCRIPT (INCLUDING BUT NOT
 LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED
 BY THIRD PARTIES), EVEN IF YOU HAVE ADVISED US OF THE POSSIBILITY OF SUCH
 DAMAGES, OR FOR ANY CLAIM BY ANY OTHER PARTY.''

|#

;
; Kit Script for NQTHM-1992
; Bill Bevier
; Computational Logic, Inc.
; bevier@cli.com
;
; This script is derived from the original Kit proof script. The
; original script contains the events entered by the author, and
; extends over some 62 files. The original runs on a version of NQTHM
; modified by the author to handle deftheory events and hints, and to
; handle opening up of constant functions in a certain way.
;
; This script was derived by replaying the original in PC-NQTHM, and
; simultaneously writing out a translation of each event that would
; allow the script to play in NQTHM-1992. The main differences between
; the events which appear here and those in the original are:
; 
;   1. Constant expressions are expanded in place here. The body of no
;      definition or lemma is modified from the original other than the
;      replacement of a constant expression by its value. 
;   2. A few extra deftheory events and enable-theory hints are
;      required in this script, primarily for controlling *1* functions.
;  


(BOOT-STRAP NQTHM)

(PROVE-LEMMA PLUS-RIGHT-ID2
             (REWRITE)
             (IMPLIES (NOT (NUMBERP Y))
                      (EQUAL (PLUS X Y) (FIX X)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-RIGHT-ID2)

(PROVE-LEMMA PLUS-ADD1
             (REWRITE)
             (EQUAL (PLUS X (ADD1 Y))
                    (IF (NUMBERP Y)
                        (ADD1 (PLUS X Y))
                        (ADD1 X)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-ADD1)

(PROVE-LEMMA COMMUTATIVITY2-OF-PLUS
             (REWRITE)
             (EQUAL (PLUS X (PLUS Y Z))
                    (PLUS Y (PLUS X Z)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE COMMUTATIVITY2-OF-PLUS)

(PROVE-LEMMA COMMUTATIVITY-OF-PLUS
             (REWRITE)
             (EQUAL (PLUS X Y) (PLUS Y X))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE COMMUTATIVITY-OF-PLUS)

(PROVE-LEMMA ASSOCIATIVITY-OF-PLUS
             (REWRITE)
             (EQUAL (PLUS (PLUS X Y) Z)
                    (PLUS X (PLUS Y Z)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ASSOCIATIVITY-OF-PLUS)

(PROVE-LEMMA PLUS-EQUAL-0
             (REWRITE)
             (EQUAL (EQUAL (PLUS A B) '0)
                    (AND (ZEROP A) (ZEROP B)))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-EQUAL-0)

(PROVE-LEMMA DIFFERENCE-X-X
             (REWRITE)
             (EQUAL (DIFFERENCE X X) '0)
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-X-X)

(PROVE-LEMMA DIFFERENCE-PLUS
             (REWRITE)
             (AND (EQUAL (DIFFERENCE (PLUS X Y) X)
                         (FIX Y))
                  (EQUAL (DIFFERENCE (PLUS Y X) X)
                         (FIX Y)))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS)

(PROVE-LEMMA PLUS-CANCELLATION
             (REWRITE)
             (EQUAL (EQUAL (PLUS A B) (PLUS A C))
                    (EQUAL (FIX B) (FIX C)))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-CANCELLATION)

(PROVE-LEMMA DIFFERENCE-0
             (REWRITE)
             (IMPLIES (NOT (LESSP Y X))
                      (EQUAL (DIFFERENCE X Y) '0))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-0)

(PROVE-LEMMA EQUAL-DIFFERENCE-0
             (REWRITE)
             (EQUAL (EQUAL '0 (DIFFERENCE X Y))
                    (NOT (LESSP Y X)))
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUAL-DIFFERENCE-0)

(PROVE-LEMMA DIFFERENCE-CANCELLATION-0
             (REWRITE)
             (EQUAL (EQUAL X (DIFFERENCE X Y))
                    (AND (NUMBERP X)
                         (OR (EQUAL X '0) (ZEROP Y))))
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-CANCELLATION-0)

(PROVE-LEMMA DIFFERENCE-CANCELLATION-1
             (REWRITE)
             (EQUAL (EQUAL (DIFFERENCE X Y)
                           (DIFFERENCE Z Y))
                    (IF (LESSP X Y)
                        (NOT (LESSP Y Z))
                        (IF (LESSP Z Y)
                            (NOT (LESSP Y X))
                            (EQUAL (FIX X) (FIX Z)))))
             ((ENABLE DIFFERENCE-0 EQUAL-DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-CANCELLATION-1)

(PROVE-LEMMA TIMES-ZERO2
             (REWRITE)
             (IMPLIES (NOT (NUMBERP Y))
                      (EQUAL (TIMES X Y) '0))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-ZERO2)

(PROVE-LEMMA DISTRIBUTIVITY-OF-TIMES-OVER-PLUS
             (REWRITE)
             (EQUAL (TIMES X (PLUS Y Z))
                    (PLUS (TIMES X Y) (TIMES X Z)))
             ((ENABLE COMMUTATIVITY2-OF-PLUS ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISTRIBUTIVITY-OF-TIMES-OVER-PLUS)

(PROVE-LEMMA TIMES-ADD1
             (REWRITE)
             (EQUAL (TIMES X (ADD1 Y))
                    (IF (NUMBERP Y)
                        (PLUS X (TIMES X Y))
                        (FIX X)))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-ADD1)

(PROVE-LEMMA COMMUTATIVITY-OF-TIMES
             (REWRITE)
             (EQUAL (TIMES X Y) (TIMES Y X))
             ((ENABLE TIMES-ZERO2 TIMES-ADD1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE COMMUTATIVITY-OF-TIMES)

(PROVE-LEMMA COMMUTATIVITY2-OF-TIMES
             (REWRITE)
             (EQUAL (TIMES X (TIMES Y Z))
                    (TIMES Y (TIMES X Z)))
             ((ENABLE DISTRIBUTIVITY-OF-TIMES-OVER-PLUS COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE COMMUTATIVITY2-OF-TIMES)

(PROVE-LEMMA ASSOCIATIVITY-OF-TIMES
             (REWRITE)
             (EQUAL (TIMES (TIMES X Y) Z)
                    (TIMES X (TIMES Y Z)))
             ((ENABLE COMMUTATIVITY-OF-TIMES COMMUTATIVITY2-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ASSOCIATIVITY-OF-TIMES)

(PROVE-LEMMA EQUAL-TIMES-0
             (REWRITE)
             (EQUAL (EQUAL (TIMES X Y) '0)
                    (OR (ZEROP X) (ZEROP Y)))
             ((ENABLE PLUS-EQUAL-0 TIMES-ZERO2 COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUAL-TIMES-0)

(DEFN EXP
      (I J)
      (IF (ZEROP J)
          '1
          (TIMES I (EXP I (SUB1 J))))
      NIL)

(PROVE-LEMMA EXP-PLUS
             (REWRITE)
             (EQUAL (EXP I (PLUS J K))
                    (TIMES (EXP I J) (EXP I K)))
             ((ENABLE COMMUTATIVITY-OF-TIMES ASSOCIATIVITY-OF-TIMES EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-PLUS)

(PROVE-LEMMA EQUAL-LESSP
             (REWRITE)
             (EQUAL (EQUAL (LESSP X Y) Z)
                    (IF (LESSP X Y)
                        (EQUAL '*1*TRUE Z)
                        (EQUAL '*1*FALSE Z)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUAL-LESSP)

(PROVE-LEMMA DIFFERENCE-ELIM
             (ELIM)
             (IMPLIES (AND (NUMBERP Y) (NOT (LESSP Y X)))
                      (EQUAL (PLUS X (DIFFERENCE Y X)) Y))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMAINDER-QUOTIENT
             (REWRITE)
             (EQUAL (PLUS (REMAINDER X Y)
                          (TIMES Y (QUOTIENT X Y)))
                    (FIX X))
             ((ENABLE COMMUTATIVITY2-OF-PLUS COMMUTATIVITY-OF-PLUS TIMES-ZERO2
                      TIMES-ADD1 COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-QUOTIENT)

(PROVE-LEMMA REMAINDER-WRT-1
             (REWRITE)
             (EQUAL (REMAINDER Y '1) '0)
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-WRT-1)

(PROVE-LEMMA REMAINDER-WRT-12
             (REWRITE)
             (IMPLIES (NOT (NUMBERP X))
                      (EQUAL (REMAINDER Y X) (FIX Y)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-WRT-12)

(PROVE-LEMMA LESSP-REMAINDER2
             (REWRITE GENERALIZE)
             (EQUAL (LESSP (REMAINDER X Y) Y)
                    (NOT (ZEROP Y)))
             ((ENABLE EQUAL-LESSP REMAINDER-WRT-12)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-REMAINDER2)

(PROVE-LEMMA REMAINDER-X-X
             (REWRITE)
             (EQUAL (REMAINDER X X) '0)
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-X-X)

(PROVE-LEMMA REMAINDER-QUOTIENT-ELIM
             (ELIM)
             (IMPLIES (AND (NOT (ZEROP Y)) (NUMBERP X))
                      (EQUAL (PLUS (REMAINDER X Y)
                                   (TIMES Y (QUOTIENT X Y)))
                             X))
             ((ENABLE REMAINDER-QUOTIENT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LESSP-TIMES-1
             (REWRITE)
             (IMPLIES (NOT (ZEROP I))
                      (NOT (LESSP (TIMES I J) J)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TIMES-1)

(PROVE-LEMMA LESSP-TIMES-2
             (REWRITE)
             (IMPLIES (NOT (ZEROP I))
                      (NOT (LESSP (TIMES J I) J)))
             ((ENABLE COMMUTATIVITY-OF-TIMES LESSP-TIMES-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TIMES-2)

(PROVE-LEMMA LESSP-QUOTIENT1
             (REWRITE)
             (EQUAL (LESSP (QUOTIENT I J) I)
                    (AND (NOT (ZEROP I))
                         (OR (ZEROP J) (NOT (EQUAL J '1)))))
             ((ENABLE PLUS-EQUAL-0 DIFFERENCE-0 EQUAL-DIFFERENCE-0
                      EQUAL-TIMES-0 EQUAL-LESSP LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM LESSP-TIMES-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QUOTIENT1)

(PROVE-LEMMA LESSP-REMAINDER1
             (REWRITE)
             (EQUAL (LESSP (REMAINDER X Y) X)
                    (AND (NOT (ZEROP Y))
                         (AND (NOT (ZEROP X))
                              (NOT (LESSP X Y)))))
             ((ENABLE PLUS-EQUAL-0 COMMUTATIVITY-OF-TIMES EQUAL-TIMES-0
                      EQUAL-LESSP REMAINDER-WRT-12 LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-REMAINDER1)

(PROVE-LEMMA DIFFERENCE-PLUS1
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS X Y) X)
                    (FIX Y))
             ((ENABLE DIFFERENCE-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS1)

(PROVE-LEMMA DIFFERENCE-PLUS2
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS Y X) X)
                    (FIX Y))
             ((ENABLE COMMUTATIVITY-OF-PLUS DIFFERENCE-PLUS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS2)

(PROVE-LEMMA DIFFERENCE-PLUS-CANCELATION
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS X Y) (PLUS X Z))
                    (DIFFERENCE Y Z))
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS-CANCELATION)

(PROVE-LEMMA TIMES-DIFFERENCE
             (REWRITE)
             (EQUAL (TIMES X (DIFFERENCE C W))
                    (DIFFERENCE (TIMES C X) (TIMES W X)))
             ((ENABLE PLUS-EQUAL-0 DIFFERENCE-0 EQUAL-DIFFERENCE-0
                      COMMUTATIVITY-OF-TIMES EQUAL-TIMES-0 DIFFERENCE-ELIM
                      DIFFERENCE-PLUS-CANCELATION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-DIFFERENCE)

(DEFN DIVIDES
      (X Y)
      (ZEROP (REMAINDER Y X))
      NIL)

(PROVE-LEMMA DIVIDES-TIMES
             (REWRITE)
             (EQUAL (REMAINDER (TIMES X Z) Z) '0)
             ((ENABLE COMMUTATIVITY-OF-TIMES EQUAL-TIMES-0 REMAINDER-WRT-12
                      DIFFERENCE-PLUS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-TIMES)

(PROVE-LEMMA DIFFERENCE-PLUS3
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS B (PLUS A C)) A)
                    (PLUS B C))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS3)

(PROVE-LEMMA DIFFERENCE-ADD1-CANCELLATION
             (REWRITE)
             (EQUAL (DIFFERENCE (ADD1 (PLUS Y Z)) Z)
                    (ADD1 Y))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-ADD1-CANCELLATION)

(PROVE-LEMMA REMAINDER-ADD1
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP Y))
                           (NOT (EQUAL Y '1)))
                      (NOT (EQUAL (REMAINDER (ADD1 (TIMES X Y)) Y)
                                  '0)))
             ((ENABLE COMMUTATIVITY-OF-PLUS DIFFERENCE-0
                      COMMUTATIVITY-OF-TIMES DIFFERENCE-ADD1-CANCELLATION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ADD1)

(PROVE-LEMMA DIVIDES-PLUS-REWRITE1
             (REWRITE)
             (IMPLIES (AND (EQUAL (REMAINDER X Z) '0)
                           (EQUAL (REMAINDER Y Z) '0))
                      (EQUAL (REMAINDER (PLUS X Y) Z) '0))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY2-OF-PLUS
                      COMMUTATIVITY-OF-PLUS ASSOCIATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES DIFFERENCE-ELIM REMAINDER-WRT-12
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM DIVIDES-TIMES
                      DIFFERENCE-PLUS3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-PLUS-REWRITE1)

(PROVE-LEMMA DIVIDES-PLUS-REWRITE2
             (REWRITE)
             (IMPLIES (AND (EQUAL (REMAINDER X Z) '0)
                           (NOT (EQUAL (REMAINDER Y Z) '0)))
                      (NOT (EQUAL (REMAINDER (PLUS X Y) Z) '0)))
             ((ENABLE COMMUTATIVITY2-OF-PLUS COMMUTATIVITY-OF-PLUS
                      ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      DIFFERENCE-ELIM REMAINDER-WRT-12 LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM DIFFERENCE-PLUS3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-PLUS-REWRITE2)

(PROVE-LEMMA DIVIDES-PLUS-REWRITE
             (REWRITE)
             (IMPLIES (EQUAL (REMAINDER X Z) '0)
                      (EQUAL (EQUAL (REMAINDER (PLUS X Y) Z) '0)
                             (EQUAL (REMAINDER Y Z) '0)))
             ((ENABLE DIVIDES-PLUS-REWRITE1 DIVIDES-PLUS-REWRITE2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-PLUS-REWRITE)

(PROVE-LEMMA LESSP-PLUS-CANCELATION
             (REWRITE)
             (EQUAL (LESSP (PLUS X Y) (PLUS X Z))
                    (LESSP Y Z))
             ((ENABLE EQUAL-LESSP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-CANCELATION)

(PROVE-LEMMA DIVIDES-PLUS-REWRITE-COMMUTED
             (REWRITE)
             (IMPLIES (EQUAL (REMAINDER X Z) '0)
                      (EQUAL (EQUAL (REMAINDER (PLUS Y X) Z) '0)
                             (EQUAL (REMAINDER Y Z) '0)))
             ((ENABLE COMMUTATIVITY-OF-PLUS DIVIDES-PLUS-REWRITE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-PLUS-REWRITE-COMMUTED)

(PROVE-LEMMA EUCLID
             (REWRITE)
             (IMPLIES (EQUAL (REMAINDER X Z) '0)
                      (EQUAL (EQUAL (REMAINDER (DIFFERENCE Y X) Z)
                                    '0)
                             (IF (LESSP X Y)
                                 (EQUAL (REMAINDER Y Z) '0)
                                 '*1*TRUE)))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY2-OF-PLUS
                      COMMUTATIVITY-OF-PLUS DIFFERENCE-0
                      COMMUTATIVITY-OF-TIMES DIFFERENCE-ELIM REMAINDER-WRT-12
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM DIVIDES-TIMES
                      DIVIDES-PLUS-REWRITE1 DIVIDES-PLUS-REWRITE-COMMUTED)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EUCLID)

(PROVE-LEMMA LESSP-TIMES-CANCELLATION
             (REWRITE)
             (EQUAL (LESSP (TIMES X Z) (TIMES Y Z))
                    (AND (NOT (ZEROP Z)) (LESSP X Y)))
             ((ENABLE TIMES-ZERO2 COMMUTATIVITY-OF-TIMES EQUAL-TIMES-0
                      EQUAL-LESSP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TIMES-CANCELLATION)

(PROVE-LEMMA LESSP-PLUS-CANCELLATION3
             (REWRITE)
             (EQUAL (LESSP Y (PLUS X Y))
                    (NOT (ZEROP X)))
             ((ENABLE EQUAL-LESSP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-CANCELLATION3)

(PROVE-LEMMA QUOTIENT-TIMES1
             (REWRITE)
             (IMPLIES (AND (NUMBERP Y)
                           (AND (NUMBERP X)
                                (AND (NOT (EQUAL X '0))
                                     (DIVIDES X Y))))
                      (EQUAL (TIMES X (QUOTIENT Y X)) Y))
             ((ENABLE LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-TIMES1)

(PROVE-LEMMA QUOTIENT-LESSP
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP X)) (LESSP X Y))
                      (NOT (EQUAL (QUOTIENT Y X) '0)))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-LESSP)

(PROVE-LEMMA TIMES-ID-IFF-1
             (REWRITE)
             (EQUAL (EQUAL Z (TIMES W Z))
                    (AND (NUMBERP Z)
                         (OR (EQUAL Z '0) (EQUAL W '1))))
             ((ENABLE COMMUTATIVITY-OF-PLUS TIMES-ZERO2 COMMUTATIVITY-OF-TIMES
                      LESSP-TIMES-2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-ID-IFF-1)

(PROVE-LEMMA DIVIDES-TIMES1
             (REWRITE)
             (IMPLIES (EQUAL A (TIMES Z Y))
                      (EQUAL (REMAINDER A Z) '0))
             ((ENABLE COMMUTATIVITY-OF-TIMES DIVIDES-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-TIMES1)

(PROVE-LEMMA TIMES-IDENTITY1
             (REWRITE)
             (IMPLIES (AND (NUMBERP Y)
                           (AND (NOT (EQUAL Y '1))
                                (AND (NOT (EQUAL Y '0))
                                     (NOT (EQUAL X '0)))))
                      (NOT (EQUAL X (TIMES X Y))))
             ((ENABLE LESSP-TIMES-2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-IDENTITY1)

(PROVE-LEMMA TIMES-IDENTITY
             (REWRITE)
             (EQUAL (EQUAL X (TIMES X Y))
                    (OR (EQUAL X '0)
                        (AND (NUMBERP X) (EQUAL Y '1))))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES LESSP-TIMES-2 TIMES-ID-IFF-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-IDENTITY)

(PROVE-LEMMA QUOTIENT-DIVIDES
             (REWRITE)
             (IMPLIES (AND (NUMBERP Y)
                           (NOT (EQUAL (TIMES X (QUOTIENT Y X)) Y)))
                      (NOT (EQUAL (REMAINDER Y X) '0)))
             ((ENABLE TIMES-ZERO2 COMMUTATIVITY-OF-TIMES REMAINDER-WRT-12
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-DIVIDES)

(PROVE-LEMMA REMAINDER-TIMES
             (REWRITE)
             (EQUAL (REMAINDER (TIMES Y X) Y) '0)
             ((ENABLE COMMUTATIVITY-OF-TIMES DIVIDES-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-TIMES)

(PROVE-LEMMA QUOTIENT-TIMES
             (REWRITE)
             (EQUAL (QUOTIENT (TIMES Y X) Y)
                    (IF (ZEROP Y) '0 (FIX X)))
             ((ENABLE TIMES-ZERO2 COMMUTATIVITY-OF-TIMES DIFFERENCE-PLUS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-TIMES)

(PROVE-LEMMA DISTRIBUTIVITY-OF-DIVIDES
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A)) (DIVIDES A W))
                      (EQUAL (TIMES C (QUOTIENT W A))
                             (QUOTIENT (TIMES C W) A)))
             ((ENABLE TIMES-ZERO2 COMMUTATIVITY-OF-TIMES
                      COMMUTATIVITY2-OF-TIMES LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM QUOTIENT-TIMES DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISTRIBUTIVITY-OF-DIVIDES)

(PROVE-LEMMA IF-TIMES-THEN-DIVIDES
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP C))
                           (NOT (DIVIDES C X)))
                      (NOT (EQUAL (TIMES C Y) X)))
             ((ENABLE REMAINDER-TIMES DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE IF-TIMES-THEN-DIVIDES)

(PROVE-LEMMA TIMES-EQUAL-1
             (REWRITE)
             (EQUAL (EQUAL (TIMES A B) '1)
                    (AND (NOT (EQUAL A '0))
                         (AND (NOT (EQUAL B '0))
                              (AND (NUMBERP A)
                                   (AND (NUMBERP B)
                                        (AND (EQUAL (SUB1 A) '0)
                                             (EQUAL (SUB1 B) '0)))))))
             ((ENABLE PLUS-RIGHT-ID2 COMMUTATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-EQUAL-1)

(PROVE-LEMMA DIVIDES-IMPLIES-TIMES
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A))
                           (AND (NUMBERP C)
                                (EQUAL (TIMES A C) B)))
                      (EQUAL (EQUAL C (QUOTIENT B A))
                             '*1*TRUE))
             ((ENABLE QUOTIENT-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-IMPLIES-TIMES)

(PROVE-LEMMA DIFFERENCE-1
             (REWRITE)
             (EQUAL (DIFFERENCE X '1) (SUB1 X))
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-1)

(PROVE-LEMMA DIFFERENCE-2
             (REWRITE)
             (EQUAL (DIFFERENCE (ADD1 (ADD1 X)) '2)
                    (FIX X))
             ((ENABLE DIFFERENCE-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-2)

(PROVE-LEMMA HALF-PLUS
             (REWRITE)
             (EQUAL (QUOTIENT (PLUS X (PLUS X Y)) '2)
                    (PLUS X (QUOTIENT Y '2)))
             ((ENABLE PLUS-RIGHT-ID2 PLUS-ADD1 COMMUTATIVITY2-OF-PLUS
                      COMMUTATIVITY-OF-PLUS LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM DIVIDES-IMPLIES-TIMES
                      DIFFERENCE-2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE HALF-PLUS)

(PROVE-LEMMA TIMES-1
             (REWRITE)
             (EQUAL (TIMES '1 X) (FIX X))
             ((ENABLE TIMES-ZERO2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-1)

(PROVE-LEMMA EXP-OF-0
             (REWRITE)
             (EQUAL (EXP '0 K)
                    (IF (ZEROP K) '1 '0))
             ((ENABLE EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-OF-0)

(PROVE-LEMMA EXP-OF-1
             (REWRITE)
             (EQUAL (EXP '1 K) '1)
             ((ENABLE EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-OF-1)

(PROVE-LEMMA EXP-BY-0
             (REWRITE)
             (EQUAL (EXP X '0) '1)
             ((ENABLE EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-BY-0)

(PROVE-LEMMA EXP-TIMES
             (REWRITE)
             (EQUAL (EXP (TIMES I J) K)
                    (TIMES (EXP I K) (EXP J K)))
             ((ENABLE COMMUTATIVITY2-OF-TIMES ASSOCIATIVITY-OF-TIMES EXP-BY-0
                      EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-TIMES)

(PROVE-LEMMA EXP-EXP
             (REWRITE)
             (EQUAL (EXP (EXP I J) K)
                    (EXP I (TIMES J K)))
             ((ENABLE EXP-PLUS EXP-OF-1 EXP-BY-0 EXP-TIMES EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-EXP)

(PROVE-LEMMA REMAINDER-PLUS-TIMES-1
             (REWRITE)
             (EQUAL (REMAINDER (PLUS X (TIMES I J)) J)
                    (REMAINDER X J))
             ((ENABLE COMMUTATIVITY2-OF-PLUS COMMUTATIVITY-OF-PLUS
                      ASSOCIATIVITY-OF-PLUS TIMES-ZERO2 COMMUTATIVITY-OF-TIMES
                      EQUAL-TIMES-0 REMAINDER-WRT-12 LESSP-REMAINDER2
                      REMAINDER-QUOTIENT-ELIM DIFFERENCE-PLUS1 DIVIDES-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS-TIMES-1)

(PROVE-LEMMA REMAINDER-PLUS-TIMES-2
             (REWRITE)
             (EQUAL (REMAINDER (PLUS X (TIMES J I)) J)
                    (REMAINDER X J))
             ((ENABLE COMMUTATIVITY-OF-TIMES REMAINDER-PLUS-TIMES-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS-TIMES-2)

(PROVE-LEMMA REMAINDER-TIMES-1
             (REWRITE)
             (EQUAL (REMAINDER (TIMES B (TIMES A C)) A)
                    '0)
             ((ENABLE COMMUTATIVITY2-OF-TIMES REMAINDER-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-TIMES-1)

(PROVE-LEMMA REMAINDER-OF-1
             (REWRITE)
             (EQUAL (REMAINDER '1 X)
                    (IF (EQUAL X '1) '0 '1))
             ((ENABLE DIFFERENCE-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-OF-1)

(PROVE-LEMMA REMAINDER-DIFFERENCE-TIMES
             (REWRITE)
             (EQUAL (REMAINDER (DIFFERENCE (TIMES P X) (TIMES P Y))
                               P)
                    '0)
             ((USE (DIVIDES-TIMES (X (DIFFERENCE X Y))
                                  (Z P)))
              (DISABLE DIVIDES-TIMES)
              (ENABLE COMMUTATIVITY-OF-TIMES TIMES-DIFFERENCE DIVIDES-TIMES
                      EUCLID REMAINDER-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-DIFFERENCE-TIMES)

(PROVE-LEMMA LESSP-REMAINDER-DIVISOR
             (REWRITE)
             (IMPLIES (NOT (ZEROP Y))
                      (LESSP (REMAINDER X Y) Y))
             ((ENABLE LESSP-REMAINDER2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-REMAINDER-DIVISOR)

(DEFTHEORY CL-ARITHMETIC
           (LESSP-REMAINDER-DIVISOR REMAINDER-DIFFERENCE-TIMES REMAINDER-OF-1
                                    REMAINDER-TIMES-1 REMAINDER-PLUS-TIMES-2
                                    REMAINDER-PLUS-TIMES-1 EXP-EXP EXP-TIMES
                                    EXP-BY-0 EXP-OF-1 EXP-OF-0 TIMES-1
                                    HALF-PLUS DIFFERENCE-2 DIFFERENCE-1
                                    DIVIDES-IMPLIES-TIMES TIMES-EQUAL-1
                                    IF-TIMES-THEN-DIVIDES
                                    DISTRIBUTIVITY-OF-DIVIDES QUOTIENT-TIMES
                                    REMAINDER-TIMES QUOTIENT-DIVIDES
                                    TIMES-IDENTITY TIMES-IDENTITY1
                                    DIVIDES-TIMES1 TIMES-ID-IFF-1
                                    QUOTIENT-LESSP QUOTIENT-TIMES1
                                    LESSP-PLUS-CANCELLATION3
                                    LESSP-TIMES-CANCELLATION EUCLID
                                    DIVIDES-PLUS-REWRITE-COMMUTED
                                    LESSP-PLUS-CANCELATION
                                    DIVIDES-PLUS-REWRITE DIVIDES-PLUS-REWRITE2
                                    DIVIDES-PLUS-REWRITE1 REMAINDER-ADD1
                                    DIFFERENCE-ADD1-CANCELLATION
                                    DIFFERENCE-PLUS3 DIVIDES-TIMES DIVIDES
                                    TIMES-DIFFERENCE
                                    DIFFERENCE-PLUS-CANCELATION
                                    DIFFERENCE-PLUS2 DIFFERENCE-PLUS1
                                    LESSP-REMAINDER1 LESSP-QUOTIENT1
                                    LESSP-TIMES-2 LESSP-TIMES-1
                                    REMAINDER-QUOTIENT-ELIM REMAINDER-X-X
                                    LESSP-REMAINDER2 REMAINDER-WRT-12
                                    REMAINDER-WRT-1 REMAINDER-QUOTIENT
                                    DIFFERENCE-ELIM EQUAL-LESSP EXP-PLUS
                                    EQUAL-TIMES-0 ASSOCIATIVITY-OF-TIMES
                                    COMMUTATIVITY2-OF-TIMES
                                    COMMUTATIVITY-OF-TIMES TIMES-ADD1
                                    DISTRIBUTIVITY-OF-TIMES-OVER-PLUS
                                    TIMES-ZERO2 DIFFERENCE-CANCELLATION-1
                                    DIFFERENCE-CANCELLATION-0
                                    EQUAL-DIFFERENCE-0 DIFFERENCE-0
                                    PLUS-CANCELLATION DIFFERENCE-PLUS
                                    DIFFERENCE-X-X PLUS-EQUAL-0
                                    ASSOCIATIVITY-OF-PLUS
                                    COMMUTATIVITY-OF-PLUS
                                    COMMUTATIVITY2-OF-PLUS PLUS-ADD1
                                    PLUS-RIGHT-ID2))

(DEFN NUMBER-AND-LIST-INDUCTION
      (N L)
      (IF (ZEROP N)
          '0
          (IF (LISTP L)
              (NUMBER-AND-LIST-INDUCTION (SUB1 N)
                                         (CDR L))
              '0))
      NIL)

(DEFN DOUBLE-NUMBER-INDUCTION
      (X Y)
      (IF (OR (ZEROP X) (ZEROP Y))
          '0
          (DOUBLE-NUMBER-INDUCTION (SUB1 X)
                                   (SUB1 Y)))
      NIL)

(DEFN DOUBLE-NUMBER-DOUBLE-LIST-INDUCTION
      (I J L1 L2)
      (IF (AND (LISTP L1) (LISTP L2))
          (IF (OR (ZEROP I) (ZEROP J))
              '0
              (DOUBLE-NUMBER-DOUBLE-LIST-INDUCTION (SUB1 I)
                                                   (SUB1 J)
                                                   (CDR L1)
                                                   (CDR L2)))
          '0)
      NIL)

(PROVE-LEMMA PLUS-0
             (REWRITE)
             (EQUAL (PLUS A '0) (FIX A))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-0)

(PROVE-LEMMA PLUS-1
             (REWRITE)
             (EQUAL (PLUS '1 X) (ADD1 X))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-1)

(PROVE-LEMMA PLUS-0-ARG1
             (REWRITE)
             (EQUAL (PLUS '0 X) (FIX X))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-0-ARG1)

(PROVE-LEMMA PLUS-DIFFERENCE-CANCELLATION
             (REWRITE)
             (IMPLIES (IF (LESSP B A) '*1*FALSE '*1*TRUE)
                      (EQUAL (PLUS A (DIFFERENCE B A))
                             (FIX B)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-DIFFERENCE-CANCELLATION)

(PROVE-LEMMA CANONICALIZE-PLUS-TERMS1
             (REWRITE)
             (EQUAL (ADD1 (PLUS (ADD1 A) B))
                    (PLUS (ADD1 (ADD1 A)) B))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CANONICALIZE-PLUS-TERMS1)

(PROVE-LEMMA CANONICALIZE-PLUS-TERMS2
             (REWRITE)
             (EQUAL (PLUS (ADD1 A) (PLUS (ADD1 B) C))
                    (PLUS (PLUS (ADD1 A) (ADD1 B)) C))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CANONICALIZE-PLUS-TERMS2)

(PROVE-LEMMA CANONICALIZE-PLUS-TERMS3
             (REWRITE)
             (EQUAL (PLUS (TIMES A B) (PLUS (ADD1 C) D))
                    (PLUS (ADD1 C) (PLUS D (TIMES A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CANONICALIZE-PLUS-TERMS3)

(PROVE-LEMMA PLUS-PLUS-DIFFERENCE
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (NUMBERP N)
                                (IF (LESSP N I)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (PLUS I (PLUS J (DIFFERENCE N I)))
                             (PLUS N J)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-PLUS-DIFFERENCE)

(PROVE-LEMMA PLUS-TIMES-REDUCTION
             (REWRITE)
             (EQUAL (PLUS A (TIMES B A))
                    (TIMES (ADD1 B) A))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TIMES-REDUCTION)

(PROVE-LEMMA PLUS-TIMES-SUB1-REDUCTION
             (REWRITE)
             (IMPLIES (NOT (ZEROP B))
                      (EQUAL (PLUS A (TIMES (SUB1 B) A))
                             (TIMES B A)))
             ((ENABLE PLUS-TIMES-REDUCTION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TIMES-SUB1-REDUCTION)

(PROVE-LEMMA PLUS-COMMUTATIVITY-ASSOCIATIVITY-CROCK
             (REWRITE)
             (EQUAL (PLUS B (PLUS A C))
                    (PLUS A (PLUS B C)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-COMMUTATIVITY-ASSOCIATIVITY-CROCK)

(PROVE-LEMMA DISTRIBUTIVITY-OF-TIMES-OVER-PLUS-BACKWARDS
             (REWRITE)
             (EQUAL (PLUS (TIMES A B) (TIMES A C))
                    (TIMES A (PLUS B C)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISTRIBUTIVITY-OF-TIMES-OVER-PLUS-BACKWARDS)

(PROVE-LEMMA DIFFERENCE-IS-ZERO
             (REWRITE)
             (IMPLIES (LESSP A B)
                      (EQUAL (DIFFERENCE A B) '0))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-IS-ZERO)

(PROVE-LEMMA DIFFERENCE-BY-LARGER-NUMBER
             (REWRITE)
             (EQUAL (DIFFERENCE (SUB1 X) X) '0)
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-BY-LARGER-NUMBER)

(PROVE-LEMMA DIFFERENCE-ADD1-ARG1
             (REWRITE)
             (IMPLIES (IF (LESSP A B) '*1*FALSE '*1*TRUE)
                      (EQUAL (DIFFERENCE (ADD1 A) B)
                             (ADD1 (DIFFERENCE A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-ADD1-ARG1)

(PROVE-LEMMA DIFFERENCE-ADD1-ARG2
             (REWRITE)
             (IMPLIES (LESSP B A)
                      (EQUAL (DIFFERENCE A (ADD1 B))
                             (SUB1 (DIFFERENCE A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-ADD1-ARG2)

(PROVE-LEMMA SUB1-DIFFERENCE
             (REWRITE)
             (EQUAL (SUB1 (DIFFERENCE A B))
                    (DIFFERENCE (SUB1 A) B))
             ((INDUCT (DOUBLE-NUMBER-INDUCTION A B))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SUB1-DIFFERENCE)

(PROVE-LEMMA DIFFERENCE-SUB1-ARG1
             (REWRITE)
             (IMPLIES (LESSP B A)
                      (EQUAL (DIFFERENCE (SUB1 A) B)
                             (SUB1 (DIFFERENCE A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-SUB1-ARG1)

(PROVE-LEMMA DIFFERENCE-SUB1-ARG2
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP B))
                           (IF (LESSP A B) '*1*FALSE '*1*TRUE))
                      (EQUAL (DIFFERENCE A (SUB1 B))
                             (ADD1 (DIFFERENCE A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-SUB1-ARG2)

(PROVE-LEMMA DIFFERENCE-PLUS-CANCELLATION2-INSTANCE
             (REWRITE)
             (IMPLIES (IF (LESSP A C) '*1*FALSE '*1*TRUE)
                      (EQUAL (DIFFERENCE (PLUS (ADD1 A) B)
                                         (ADD1 C))
                             (PLUS (DIFFERENCE A C) B)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS-CANCELLATION2-INSTANCE)

(PROVE-LEMMA DIFFERENCE-DIFFERENCE
             (REWRITE)
             (EQUAL (DIFFERENCE (DIFFERENCE A B) C)
                    (DIFFERENCE A (PLUS B C)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-DIFFERENCE)

(PROVE-LEMMA YET-ANOTHER-DIFFERENCE-PLUS-CROCK
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS N (PLUS B A)) A)
                    (PLUS N B))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE YET-ANOTHER-DIFFERENCE-PLUS-CROCK)

(PROVE-LEMMA NON-ZERO-DIFFERENCE
             (REWRITE)
             (IMPLIES (AND (NUMBERP A) (LESSP A B))
                      (NOT (EQUAL (DIFFERENCE B A) '0)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-DIFFERENCE)

(PROVE-LEMMA REWRITE-NON-ZERO-DIFFERENCE-AS-LESSP
             (REWRITE)
             (EQUAL (NOT (EQUAL (DIFFERENCE A B) '0))
                    (LESSP B A))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-NON-ZERO-DIFFERENCE-AS-LESSP)

(PROVE-LEMMA REWRITE-ZERO-DIFFERENCE-AS-EQUALITY
             (REWRITE)
             (IMPLIES (IF (LESSP A B) '*1*FALSE '*1*TRUE)
                      (EQUAL (EQUAL (DIFFERENCE A B) '0)
                             (EQUAL (FIX A) (FIX B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-ZERO-DIFFERENCE-AS-EQUALITY)

(PROVE-LEMMA REGROUP-FACT
             (REWRITE)
             (IMPLIES (AND (IF (LESSP A C) '*1*FALSE '*1*TRUE)
                           (IF (LESSP B D) '*1*FALSE '*1*TRUE))
                      (EQUAL (DIFFERENCE (PLUS A B) (PLUS C D))
                             (PLUS (DIFFERENCE A C)
                                   (DIFFERENCE B D))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REGROUP-FACT)

(PROVE-LEMMA DIFFERENCE-EQUALS-0
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (IF (LESSP A B)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (EQUAL (DIFFERENCE A B) '0)
                             (EQUAL A B)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-EQUALS-0)

(PROVE-LEMMA TIMES-ZERO3
             (REWRITE)
             (EQUAL (TIMES X '0) '0)
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-ZERO3)

(PROVE-LEMMA DISTRIBUTIVITY-OF-TIMES-OVER-DIFFERENCE
             (REWRITE)
             (EQUAL (DIFFERENCE (TIMES A B) (TIMES A C))
                    (TIMES A (DIFFERENCE B C)))
             ((ENABLE TIMES-DIFFERENCE COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISTRIBUTIVITY-OF-TIMES-OVER-DIFFERENCE)

(PROVE-LEMMA EXP-2-NEVER-0
             (REWRITE)
             (EQUAL (LESSP '0 (EXP '2 I))
                    '*1*TRUE)
             ((ENABLE EXP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-2-NEVER-0)

(PROVE-LEMMA EXP-2-NEVER-0-LINEAR
             (REWRITE)
             (LESSP '0 (EXP '2 I))
             ((ENABLE EXP-2-NEVER-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EXP-2-NEVER-0-LINEAR)

(PROVE-LEMMA REMAINDER-NOOP
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (LESSP A B) (NOT (ZEROP B))))
                      (EQUAL (REMAINDER A B) A))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-NOOP)

(PROVE-LEMMA REMAINDER-ADD1-CASESPLIT
             (REWRITE)
             (IMPLIES (LESSP A B)
                      (EQUAL (REMAINDER (ADD1 A) B)
                             (IF (EQUAL (ADD1 A) B) '0 (ADD1 A))))
             ((ENABLE REMAINDER REMAINDER-NOOP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ADD1-CASESPLIT)

(PROVE-LEMMA ZEROP-REMAINDER-DIFFERENCE
             (REWRITE)
             (IMPLIES (EQUAL (REMAINDER A B) '0)
                      (EQUAL (REMAINDER (DIFFERENCE A B) B)
                             '0))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ZEROP-REMAINDER-DIFFERENCE)

(PROVE-LEMMA QUOTIENT-X-X
             (REWRITE)
             (IMPLIES (NOT (ZEROP X))
                      (EQUAL (QUOTIENT X X) '1))
             ((ENABLE DIFFERENCE-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-X-X)

(PROVE-LEMMA REMAINDER-TIMES-OTHER-WAY
             (REWRITE)
             (EQUAL (REMAINDER (TIMES B A) A) '0)
             ((ENABLE REMAINDER-TIMES COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-TIMES-OTHER-WAY)

(PROVE-LEMMA QUOTIENT-TIMES-OTHER-WAY
             (REWRITE)
             (EQUAL (QUOTIENT (TIMES B A) A)
                    (IF (ZEROP A) '0 (FIX B)))
             ((ENABLE QUOTIENT-TIMES COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-TIMES-OTHER-WAY)

(PROVE-LEMMA QUOTIENT-DIFFERENCE
             (REWRITE)
             (IMPLIES (NOT (LESSP I J))
                      (EQUAL (QUOTIENT (DIFFERENCE I J) J)
                             (SUB1 (QUOTIENT I J))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-DIFFERENCE)

(PROVE-LEMMA QUOTIENT-PLUS
             (REWRITE)
             (IMPLIES (NOT (ZEROP A))
                      (EQUAL (QUOTIENT (PLUS A B) A)
                             (ADD1 (QUOTIENT B A))))
             ((EXPAND (QUOTIENT (PLUS A B) A))
              (ENABLE DIFFERENCE-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-PLUS)

(PROVE-LEMMA QUOTIENT-PLUS-TIMES
             (REWRITE)
             (IMPLIES (LESSP C B)
                      (EQUAL (QUOTIENT (PLUS C (TIMES B A)) B)
                             (FIX A)))
             ((ENABLE PLUS-0 COMMUTATIVITY2-OF-PLUS COMMUTATIVITY-OF-TIMES
                      QUOTIENT-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-PLUS-TIMES)

(PROVE-LEMMA LEQ-TIMES
             NIL
             (IMPLIES (AND (NOT (ZEROP A))
                           (IF (LESSP C B) '*1*FALSE '*1*TRUE))
                      (IF (LESSP (TIMES A C) (TIMES A B))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LESSP-REMAINDER-SUB1-CROCK NIL
             (IMPLIES (LESSP X N)
                      (LESSP (SUB1 X) N))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-PLUS NIL
             (IMPLIES (IF (LESSP C (PLUS A B))
                          '*1*FALSE
                          '*1*TRUE)
                      (IF (LESSP C A) '*1*FALSE '*1*TRUE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-PLUS1 NIL
             (IMPLIES (IF (LESSP C (PLUS A B))
                          '*1*FALSE
                          '*1*TRUE)
                      (AND (IF (LESSP C A) '*1*FALSE '*1*TRUE)
                           (IF (LESSP C B)
                               '*1*FALSE
                               '*1*TRUE)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-PLUS2 NIL
             (IMPLIES (IF (LESSP C (PLUS A B))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (LESSP C A) '*1*FALSE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-CASESPLIT NIL
             (IMPLIES (AND (NUMBERP A) (NUMBERP B))
                      (EQUAL (IF (LESSP B A) '*1*FALSE '*1*TRUE)
                             (OR (LESSP A B) (EQUAL A B))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA INTEGER-INEQUALITY-CASESPLIT NIL
             (IMPLIES (AND (NUMBERP I) (NUMBERP J))
                      (EQUAL (NOT (EQUAL I J))
                             (OR (LESSP I J) (LESSP J I))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA INTEGER-EQUALITY-CROCK NIL
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (AND (LESSP A '1) (LESSP B '1))))
                      (EQUAL A B))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LESSP-REMAINDER-REMAINDER
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP C))
                           (NOT (ZEROP (REMAINDER B C))))
                      (EQUAL (LESSP (REMAINDER A (REMAINDER B C))
                                    C)
                             '*1*TRUE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-REMAINDER-REMAINDER)

(PROVE-LEMMA LESSP-TIMES
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A)) (LESSP B C))
                      (LESSP (TIMES A B) (TIMES A C)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TIMES)

(PROVE-LEMMA LEQ-PLUS-TIMES
             NIL
             (IMPLIES (AND (LESSP B C) (NOT (ZEROP A)))
                      (IF (LESSP (TIMES A C)
                                 (PLUS A (TIMES A B)))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LESSP-DIFFERENCE NIL
             (IMPLIES (AND (NOT (ZEROP A)) (LESSP A B))
                      (LESSP (DIFFERENCE B A) B))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMAINDER-DIFFERENCE-NON-ZERO
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A))
                           (AND (NUMBERP B) (LESSP A B)))
                      (NOT (ZEROP (REMAINDER (DIFFERENCE B A) B))))
             ((ENABLE REMAINDER-NOOP)
              (DISABLE REMAINDER DIFFERENCE)
              (USE (LESSP-DIFFERENCE (A A) (B B)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-DIFFERENCE-NON-ZERO)

(PROVE-LEMMA SUM-ZERO-IMPLIES-ADDENDS-ZERO
             NIL
             (IMPLIES (EQUAL (PLUS A B) '0)
                      (AND (ZEROP A) (ZEROP B)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMAINDER-ZERO-IMPLIES-LEQ-FACT
             (REWRITE)
             (IMPLIES (AND (EQUAL (REMAINDER A B) '0)
                           (NOT (ZEROP A)))
                      (EQUAL (LESSP A B) '*1*FALSE))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ZERO-IMPLIES-LEQ-FACT)

(DEFN LESSP-QUOTIENT-INDUCTION
      (A B C)
      (IF (ZEROP B)
          '0
          (IF (ZEROP C)
              '0
              (IF (LESSP A C)
                  '0
                  (LESSP-QUOTIENT-INDUCTION (DIFFERENCE A C)
                                            (SUB1 B)
                                            C))))
      NIL)

(PROVE-LEMMA LESSP-QUOTIENT-REMAINDER-CROCK
             (REWRITE)
             (IMPLIES (AND (LESSP A (TIMES B C))
                           (AND (NOT (EQUAL B '0))
                                (AND (NUMBERP B)
                                     (AND (NOT (EQUAL C '0))
                                          (AND (NUMBERP C) (NUMBERP A))))))
                      (LESSP (QUOTIENT A C) B))
             ((INDUCT (LESSP-QUOTIENT-INDUCTION A B C))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QUOTIENT-REMAINDER-CROCK)

(PROVE-LEMMA LESSP-QUOTIENT-REMAINDER
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP B)) (NOT (ZEROP C)))
                      (LESSP (QUOTIENT (REMAINDER A (TIMES B C)) C)
                             (FIX B)))
             ((ENABLE DIVIDES LESSP-REMAINDER2 LESSP-QUOTIENT-REMAINDER-CROCK
                      EQUAL-TIMES-0 REWRITE-ZERO-DIFFERENCE-AS-EQUALITY
                      QUOTIENT-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QUOTIENT-REMAINDER)

(PROVE-LEMMA LESSP-QUOTIENT-TIMES
             (REWRITE)
             (IMPLIES (LESSP A (TIMES B C))
                      (EQUAL (LESSP (QUOTIENT A C) B)
                             '*1*TRUE))
             ((INDUCT (LESSP-QUOTIENT-INDUCTION A B C))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QUOTIENT-TIMES)

(DEFN MIN
      (A B)
      (IF (LESSP A B) A B)
      NIL)

(PROVE-LEMMA LESSP-TRANSITIVITY NIL
             (IMPLIES (AND (LESSP A B) (LESSP B C))
                      (LESSP A C))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMAINDER-PLUS
             (REWRITE)
             (EQUAL (REMAINDER (PLUS A N) A)
                    (REMAINDER N A))
             ((ENABLE REMAINDER-WRT-12 PLUS-RIGHT-ID2 DIFFERENCE-PLUS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS)

(PROVE-LEMMA REMAINDER-DIVIDES
             (REWRITE)
             (IMPLIES (AND (DIVIDES A U) (NUMBERP U))
                      (EQUAL (REMAINDER (PLUS U N) A)
                             (REMAINDER N A)))
             ((USE (QUOTIENT-DIVIDES (X A) (Y U)))
              (DISABLE REMAINDER PLUS TIMES)
              (ENABLE REMAINDER-PLUS-TIMES-2 PLUS-RIGHT-ID2 TIMES-ZERO2
                      COMMUTATIVITY-OF-TIMES REMAINDER-WRT-12 REMAINDER-PLUS
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM DIVIDES-TIMES1
                      COMMUTATIVITY-OF-PLUS DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-DIVIDES)

(PROVE-LEMMA REMAINDER-REMAINDER
             (REWRITE)
             (IMPLIES (DIVIDES A B)
                      (EQUAL (REMAINDER (REMAINDER N B) A)
                             (REMAINDER N A)))
             ((INDUCT (REMAINDER N B))
              (DISABLE DIVIDES)
              (ENABLE ASSOCIATIVITY-OF-PLUS REMAINDER-DIVIDES DIFFERENCE-ELIM
                      LESSP-REMAINDER2 REMAINDER-QUOTIENT-ELIM
                      REMAINDER-WRT-12)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-REMAINDER)

(PROVE-LEMMA LESSP-QUOTIENT
             NIL
             (IMPLIES (LESSP N (TIMES A B))
                      (LESSP (QUOTIENT N A) B))
             ((INDUCT (LESSP-QUOTIENT-INDUCTION N B A))
              (ENABLE TIMES-ADD1 TIMES-ZERO2 TIMES-ZERO3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN LESSP-QUOTIENT-QUOTIENT-INDUCTION
      (N A B)
      (IF (ZEROP N)
          '0
          (IF (LESSP A N)
              '0
              (IF (LESSP B N)
                  '0
                  (LESSP-QUOTIENT-QUOTIENT-INDUCTION N
                                                     (DIFFERENCE A N)
                                                     (DIFFERENCE B N)))))
      NIL)

(PROVE-LEMMA LESSP-QUOTIENT-QUOTIENT
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (EQUAL (REMAINDER B N) '0)
                                (LESSP A B)))
                      (EQUAL (LESSP (QUOTIENT A N) (QUOTIENT B N))
                             '*1*TRUE))
             ((ENABLE REMAINDER-QUOTIENT-ELIM LESSP-REMAINDER2
                      COMMUTATIVITY-OF-TIMES)
              (INDUCT (LESSP-QUOTIENT-QUOTIENT-INDUCTION N A B))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QUOTIENT-QUOTIENT)

(PROVE-LEMMA LESSP-TIMES-QUOTIENT
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (NUMBERP I)
                                (AND (LESSP I J)
                                     (EQUAL (REMAINDER J N) '0))))
                      (EQUAL (LESSP (TIMES N (QUOTIENT I N)) J)
                             '*1*TRUE))
             ((USE (LESSP-QUOTIENT-QUOTIENT (A I)
                                            (B J)
                                            (N N))
                   (QUOTIENT-TIMES1 (X N) (Y J)))
              (ENABLE DIVIDES LESSP-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TIMES-QUOTIENT)

(PROVE-LEMMA NOT-LESSP-TIMES-PLUS
             NIL
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP V)
                                (AND (LESSP V N)
                                     (AND (NUMBERP B)
                                          (AND (NOT (EQUAL N '0))
                                               (AND (NUMBERP N)
                                                    (LESSP (PLUS V (TIMES A N))
                                                           (TIMES B N))))))))
                      (NOT (LESSP (TIMES B N)
                                  (PLUS (TIMES A N) N))))
             ((INDUCT (DOUBLE-NUMBER-INDUCTION A B))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA NOT-LESSP-TIMES-PLUS-INSTANCE
      (REWRITE)
      (IMPLIES (AND (NUMBERP X)
                    (AND (NUMBERP V)
                         (AND (LESSP V N)
                              (AND (NUMBERP Z)
                                   (AND (NOT (EQUAL N '0))
                                        (AND (NUMBERP N)
                                             (LESSP (TIMES N Z)
                                                    (PLUS N (TIMES N X)))))))))
               (EQUAL (LESSP (PLUS V (TIMES N X))
                             (TIMES N Z))
                      '*1*FALSE))
      ((USE (NOT-LESSP-TIMES-PLUS (A X) (B Z)))
       (ENABLE COMMUTATIVITY-OF-TIMES COMMUTATIVITY-OF-PLUS)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE NOT-LESSP-TIMES-PLUS-INSTANCE)

(PROVE-LEMMA NOT-LESSP-PLUS-TIMES-QUOTIENT
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (NUMBERP I)
                                (AND (LESSP I J)
                                     (EQUAL (REMAINDER J N) '0))))
                      (EQUAL (LESSP J
                                    (PLUS (TIMES N (QUOTIENT I N)) N))
                             '*1*FALSE))
             ((ENABLE-THEORY CL-ARITHMETIC GROUND-ZERO)
              (ENABLE NOT-LESSP-TIMES-PLUS-INSTANCE)
              (DISABLE-THEORY T)))

(DISABLE NOT-LESSP-PLUS-TIMES-QUOTIENT)

(PROVE-LEMMA QUOTIENT-PLUS-TIMES-REMAINDER
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (QUOTIENT (PLUS (TIMES N A) (REMAINDER B N))
                                       N)
                             (FIX A)))
             ((USE (QUOTIENT-PLUS-TIMES (A A)
                                        (B N)
                                        (C (REMAINDER B N))))
              (ENABLE COMMUTATIVITY-OF-PLUS LESSP-REMAINDER2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-PLUS-TIMES-REMAINDER)

(PROVE-LEMMA REMAINDER-PLUS-TIMES-REMAINDER
             (REWRITE)
             (EQUAL (REMAINDER (PLUS (TIMES N A) (REMAINDER B N))
                               N)
                    (REMAINDER B N))
             ((USE (REMAINDER-PLUS-TIMES-2 (J N)
                                           (I A)
                                           (X (REMAINDER B N))))
              (ENABLE COMMUTATIVITY-OF-PLUS REMAINDER-REMAINDER DIVIDES
                      REMAINDER-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS-TIMES-REMAINDER)

(PROVE-LEMMA REMAINDER-NON-ZERO
             NIL
             (IMPLIES (AND (NOT (ZEROP N)) (LESSP N M))
                      (LESSP '0 (REMAINDER N M)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PLUS-NOT-EQUAL
             (REWRITE)
             (IMPLIES (NOT (EQUAL (FIX B) (FIX C)))
                      (NOT (EQUAL (PLUS A B) (PLUS A C))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-NOT-EQUAL)

(PROVE-LEMMA DIFFERENCE-PLUS4
             (REWRITE)
             (EQUAL (DIFFERENCE (PLUS A (PLUS B C))
                                (PLUS B C))
                    (FIX A))
             ((USE (DIFFERENCE-PLUS (Y A)
                                    (X (PLUS B C))))
              (ENABLE ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-PLUS4)

(PROVE-LEMMA REMAINDER-REMAINDER-INVERSE
             NIL
             (IMPLIES (DIVIDES A B)
                      (EQUAL (REMAINDER N A)
                             (REMAINDER (REMAINDER N B) A)))
             ((ENABLE REMAINDER-REMAINDER)
              (DISABLE REMAINDER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA ASSOCIATIVITY-OF-PLUS-INVERSE
             NIL
             (EQUAL (PLUS A (PLUS B C))
                    (PLUS (PLUS A B) C))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN LENGTH
      (L)
      (IF (LISTP L)
          (ADD1 (LENGTH (CDR L)))
          '0)
      NIL)

(DEFN INSERT
      (I L)
      (IF (LISTP L)
          (IF (LESSP I (CAR L))
              (CONS I L)
              (CONS (CAR L) (INSERT I (CDR L))))
          (CONS I L))
      NIL)

(DEFN OCCURRENCES
      (X L)
      (IF (LISTP L)
          (IF (EQUAL X (CAR L))
              (ADD1 (OCCURRENCES X (CDR L)))
              (OCCURRENCES X (CDR L)))
          '0)
      NIL)

(DEFN REMOVE
      (X L)
      (IF (LISTP L)
          (IF (EQUAL X (CAR L))
              (CDR L)
              (CONS (CAR L) (REMOVE X (CDR L))))
          L)
      NIL)

(DEFN PERMUTATION
      (A B)
      (IF (LISTP A)
          (AND (MEMBER (CAR A) B)
               (PERMUTATION (CDR A)
                            (REMOVE (CAR A) B)))
          (NLISTP B))
      NIL)

(DEFN PLISTP
      (L)
      (IF (LISTP L)
          (PLISTP (CDR L))
          (EQUAL L 'NIL))
      NIL)

(DEFN SETP
      (L)
      (IF (LISTP L)
          (AND (NOT (MEMBER (CAR L) (CDR L)))
               (SETP (CDR L)))
          (EQUAL L 'NIL))
      NIL)

(DEFN SORTED
      (L)
      (IF (LISTP L)
          (IF (LISTP (CDR L))
              (IF (LESSP (CAR (CDR L)) (CAR L))
                  '*1*FALSE
                  (SORTED (CDR L)))
              '*1*TRUE)
          '*1*TRUE)
      NIL)

(PROVE-LEMMA NOT-LISTP-REMOVE
             (REWRITE)
             (IMPLIES (NOT (LISTP L))
                      (NOT (LISTP (REMOVE X (CONS X L)))))
             ((ENABLE REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-LISTP-REMOVE)

(PROVE-LEMMA LENGTH-INSERT
             (REWRITE)
             (EQUAL (LENGTH (INSERT I L))
                    (ADD1 (LENGTH L)))
             ((ENABLE INSERT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-INSERT)

(PROVE-LEMMA LENGTH-REMOVE
             (REWRITE)
             (EQUAL (LENGTH (REMOVE X L))
                    (IF (MEMBER X L)
                        (SUB1 (LENGTH L))
                        (LENGTH L)))
             ((ENABLE REMOVE MEMBER LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-REMOVE)

(PROVE-LEMMA LENGTH-PERMUTATION
             NIL
             (IMPLIES (PERMUTATION A B)
                      (EQUAL (LENGTH A) (LENGTH B)))
             ((ENABLE PERMUTATION LENGTH LENGTH-REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA NUMBER-OF-OCCURRENCES-OF-SET-MEMBER-IS-1
             NIL
             (IMPLIES (AND (SETP L) (MEMBER X L))
                      (EQUAL (OCCURRENCES X L) '1))
             ((ENABLE SETP MEMBER OCCURRENCES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PLISTP-REMOVE
             (REWRITE)
             (EQUAL (PLISTP (REMOVE X L))
                    (PLISTP L))
             ((ENABLE PLISTP REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-REMOVE)

(PROVE-LEMMA PLISTP-SET
             (REWRITE)
             (IMPLIES (SETP L) (PLISTP L))
             ((ENABLE SETP PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-SET)

(PROVE-LEMMA INSERT-REMOVE
             (REWRITE)
             (IMPLIES (AND (SORTED L) (NOT (EQUAL X Y)))
                      (EQUAL (INSERT X (REMOVE Y L))
                             (REMOVE Y (INSERT X L))))
             ((ENABLE INSERT REMOVE SORTED)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE INSERT-REMOVE)

(PROVE-LEMMA MEMBER-INSERT
             (REWRITE)
             (IMPLIES (MEMBER X L)
                      (MEMBER X (INSERT I L)))
             ((ENABLE MEMBER INSERT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MEMBER-INSERT)

(PROVE-LEMMA NOT-MEMBER-INSERT
             (REWRITE)
             (IMPLIES (AND (NOT (MEMBER X L))
                           (NOT (EQUAL I X)))
                      (NOT (MEMBER X (INSERT I L))))
             ((ENABLE MEMBER INSERT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-MEMBER-INSERT)

(PROVE-LEMMA MEMBER-REMOVE1
             NIL
             (IMPLIES (MEMBER X (REMOVE Y L))
                      (MEMBER X L))
             ((ENABLE MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA MEMBER-REMOVE2
             (REWRITE)
             (IMPLIES (AND (MEMBER X L) (NOT (EQUAL X Y)))
                      (MEMBER X (REMOVE Y L)))
             ((ENABLE MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MEMBER-REMOVE2)

(PROVE-LEMMA NOT-MEMBER-REMOVE1
             (REWRITE)
             (IMPLIES (SETP L)
                      (NOT (MEMBER X (REMOVE X L))))
             ((ENABLE SETP MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-MEMBER-REMOVE1)

(PROVE-LEMMA NOT-MEMBER-REMOVE2
             (REWRITE)
             (IMPLIES (NOT (MEMBER X L))
                      (NOT (MEMBER X (REMOVE Y L))))
             ((ENABLE MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-MEMBER-REMOVE2)

(PROVE-LEMMA NOT-MEMBER-PERMUTATION
             NIL
             (IMPLIES (AND (PERMUTATION A B)
                           (NOT (MEMBER X B)))
                      (NOT (MEMBER X A)))
             ((ENABLE PERMUTATION MEMBER NOT-MEMBER-REMOVE2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA MEMBER-PERMUTATION NIL
             (IMPLIES (AND (PERMUTATION A B) (MEMBER X B))
                      (MEMBER X A))
             ((ENABLE PERMUTATION MEMBER MEMBER-REMOVE2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMOVE-REMOVE
             (REWRITE)
             (IMPLIES (NOT (EQUAL X Y))
                      (EQUAL (REMOVE Y (REMOVE X L))
                             (REMOVE X (REMOVE Y L))))
             ((ENABLE REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMOVE-REMOVE)

(PROVE-LEMMA SORTED-INSERT
             (REWRITE)
             (IMPLIES (AND (SORTED L) (NOT (MEMBER I L)))
                      (SORTED (INSERT I L)))
             ((ENABLE SORTED INSERT MEMBER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SORTED-INSERT)

(PROVE-LEMMA SORTED-REMOVE
             (REWRITE)
             (IMPLIES (SORTED L)
                      (SORTED (REMOVE X L)))
             ((ENABLE SORTED REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SORTED-REMOVE)

(PROVE-LEMMA NOT-PERMUTATION
             (REWRITE)
             (IMPLIES (AND (LISTP B)
                           (NOT (MEMBER (CAR B) A)))
                      (NOT (PERMUTATION A B)))
             ((ENABLE PERMUTATION MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-PERMUTATION)

(PROVE-LEMMA PERMUTATION-RIGHT-CONS1
             (REWRITE)
             (IMPLIES (AND (LISTP B) (MEMBER (CAR B) A))
                      (EQUAL (PERMUTATION A B)
                             (PERMUTATION (REMOVE (CAR B) A)
                                          (CDR B))))
             ((ENABLE PERMUTATION MEMBER REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-RIGHT-CONS1)

(PROVE-LEMMA PERMUTATION-RIGHT-CONS
             (REWRITE)
             (EQUAL (PERMUTATION A (CONS X B))
                    (IF (MEMBER X A)
                        (PERMUTATION (REMOVE X A) B)
                        '*1*FALSE))
             ((ENABLE NOT-PERMUTATION PERMUTATION-RIGHT-CONS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-RIGHT-CONS)

(PROVE-LEMMA COMMUTATIVITY-OF-PERMUTATION
             (REWRITE)
             (EQUAL (PERMUTATION B A)
                    (PERMUTATION A B))
             ((ENABLE PERMUTATION PERMUTATION-RIGHT-CONS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE COMMUTATIVITY-OF-PERMUTATION)

(PROVE-LEMMA MEMBER-PERMUTATION2
             NIL
             (IMPLIES (AND (PERMUTATION B A) (MEMBER X B))
                      (MEMBER X A))
             ((USE (COMMUTATIVITY-OF-PERMUTATION (A A)
                                                 (B B))
                   (MEMBER-PERMUTATION (X X)
                                       (A A)
                                       (B B)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PERMUTATION-REFLEXIVITY
             (REWRITE)
             (PERMUTATION L L)
             ((ENABLE PERMUTATION REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-REFLEXIVITY)

(PROVE-LEMMA PERMUTATION-APPEND-CAR
             (REWRITE)
             (PERMUTATION (APPEND L (CONS X 'NIL))
                          (CONS X L))
             ((ENABLE PERMUTATION APPEND REMOVE MEMBER)
              (INDUCT (LENGTH L))
              (EXPAND (APPEND L (LIST X)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-APPEND-CAR)

(PROVE-LEMMA PERMUTATION-APPEND-INSERT
             (REWRITE)
             (IMPLIES (AND (PERMUTATION A B)
                           (AND (SORTED B)
                                (AND (NOT (MEMBER X A))
                                     (NOT (MEMBER X B)))))
                      (PERMUTATION (APPEND A (CONS X 'NIL))
                                   (INSERT X B)))
             ((ENABLE APPEND INSERT PERMUTATION SORTED INSERT-REMOVE
                      MEMBER-INSERT NOT-LISTP-REMOVE NOT-MEMBER-REMOVE2
                      SORTED-REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-APPEND-INSERT)

(PROVE-LEMMA PERMUTATION-REMOVE-REMOVE
             (REWRITE)
             (IMPLIES (AND (PERMUTATION A B)
                           (AND (MEMBER X A) (MEMBER X B)))
                      (PERMUTATION (REMOVE X A)
                                   (REMOVE X B)))
             ((ENABLE PERMUTATION MEMBER REMOVE MEMBER-REMOVE2 REMOVE-REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-REMOVE-REMOVE)

(DEFN TRANSITIVITY-OF-PERMUTATION-INDUCTION
      (A B C)
      (IF (LISTP A)
          (TRANSITIVITY-OF-PERMUTATION-INDUCTION (CDR A)
                                                 (REMOVE (CAR A) B)
                                                 (REMOVE (CAR A) C))
          '0)
      NIL)

(PROVE-LEMMA TRANSITIVITY-OF-PERMUTATION-BASE-CASE NIL
             (IMPLIES (AND (NLISTP A)
                           (AND (PERMUTATION A B)
                                (PERMUTATION B C)))
                      (PERMUTATION A C))
             ((EXPAND (PERMUTATION A B)
                      (PERMUTATION B C)
                      (PERMUTATION A C))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA TRANSITIVITY-OF-PERMUTATION-INDUCTION-STEP
             NIL
             (IMPLIES (AND (LISTP A)
                           (AND (IMPLIES (AND (PERMUTATION (CDR A)
                                                           (REMOVE (CAR A) B))
                                              (PERMUTATION (REMOVE (CAR A) B)
                                                           (REMOVE (CAR A) C)))
                                         (PERMUTATION (CDR A)
                                                      (REMOVE (CAR A) C)))
                                (AND (PERMUTATION A B)
                                     (PERMUTATION B C))))
                      (PERMUTATION A C))
             ((EXPAND (PERMUTATION A B)
                      (PERMUTATION A C))
              (USE (MEMBER-PERMUTATION2 (X (CAR A))
                                        (B B)
                                        (A C)))
              (ENABLE PERMUTATION-REMOVE-REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA TRANSITIVITY-OF-PERMUTATION NIL
             (IMPLIES (AND (PERMUTATION A B)
                           (PERMUTATION B C))
                      (PERMUTATION A C))
             ((INDUCT (TRANSITIVITY-OF-PERMUTATION-INDUCTION A B C))
              (USE (TRANSITIVITY-OF-PERMUTATION-BASE-CASE (A A)
                                                          (B B)
                                                          (C C))
                   (TRANSITIVITY-OF-PERMUTATION-INDUCTION-STEP (A A)
                                                               (B B)
                                                               (C C)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA SETP-REMOVE
             (REWRITE)
             (IMPLIES (SETP A) (SETP (REMOVE X A)))
             ((ENABLE SETP REMOVE NOT-MEMBER-REMOVE2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SETP-REMOVE)

(DEFN SETP-PERMUTATION-INDUCTION
      (A B)
      (IF (LISTP A)
          (SETP-PERMUTATION-INDUCTION (CDR A)
                                      (REMOVE (CAR A) B))
          '0)
      NIL)

(PROVE-LEMMA SETP-PERMUTATION-BASE-CASE NIL
             (IMPLIES (AND (NOT (LISTP A)) (PLISTP A))
                      (SETP A))
             ((ENABLE SETP PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA SETP-PERMUTATION-INDUCTION-STEP
 NIL
 (IMPLIES
      (AND (LISTP A)
           (AND (SETP B)
                (AND (PLISTP A)
                     (AND (PERMUTATION A B)
                          (IMPLIES (AND (SETP (REMOVE (CAR A) B))
                                        (AND (PLISTP (CDR A))
                                             (PERMUTATION (CDR A)
                                                          (REMOVE (CAR A) B))))
                                   (SETP (CDR A)))))))
      (SETP A))
 ((ENABLE SETP PERMUTATION REMOVE MEMBER PLISTP NOT-MEMBER-REMOVE1 SETP-REMOVE)
  (USE (NOT-MEMBER-PERMUTATION (X (CAR A))
                               (A (CDR A))
                               (B (REMOVE (CAR A) B))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA SETP-PERMUTATION NIL
             (IMPLIES (AND (SETP B)
                           (AND (PLISTP A) (PERMUTATION A B)))
                      (SETP A))
             ((INDUCT (SETP-PERMUTATION-INDUCTION A B))
              (USE (SETP-PERMUTATION-BASE-CASE (A A))
                   (SETP-PERMUTATION-INDUCTION-STEP (A A)
                                                    (B B)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA SETP-INSERT
             (REWRITE)
             (IMPLIES (AND (SETP L) (NOT (MEMBER I L)))
                      (SETP (INSERT I L)))
             ((ENABLE SETP INSERT MEMBER NOT-MEMBER-INSERT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SETP-INSERT)

(DEFN GETNTH
      (N L)
      (IF (LISTP L)
          (IF (ZEROP N)
              (CAR L)
              (GETNTH (SUB1 N) (CDR L)))
          '0)
      NIL)

(DEFN PUTNTH
      (V N L)
      (IF (LISTP L)
          (IF (ZEROP N)
              (CONS V (CDR L))
              (CONS (CAR L)
                    (PUTNTH V (SUB1 N) (CDR L))))
          L)
      NIL)

(DEFN GETSEG
      (N K L)
      (IF (ZEROP K)
          'NIL
          (CONS (GETNTH N L)
                (GETSEG (ADD1 N) (SUB1 K) L)))
      NIL)

(DEFN PUTSEG
      (S N L)
      (IF (LISTP S)
          (PUTNTH (CAR S)
                  N
                  (PUTSEG (CDR S) (ADD1 N) L))
          L)
      NIL)

(DEFN FIXLENGTH
      (N L DEFAULT)
      (IF (LISTP L)
          (IF (ZEROP N)
              'NIL
              (CONS (CAR L)
                    (FIXLENGTH (SUB1 N) (CDR L) DEFAULT)))
          (IF (ZEROP N)
              'NIL
              (CONS DEFAULT
                    (FIXLENGTH (SUB1 N) L DEFAULT))))
      NIL)

(DEFN FIRSTN
      (N L)
      (IF (LISTP L)
          (IF (ZEROP N)
              'NIL
              (CONS (CAR L)
                    (FIRSTN (SUB1 N) (CDR L))))
          'NIL)
      NIL)

(DEFN NTHCDR
      (N L)
      (IF (LISTP L)
          (IF (ZEROP N)
              L
              (NTHCDR (SUB1 N) (CDR L)))
          L)
      NIL)

(PROVE-LEMMA NON-ZERO-LENGTH-IMPLIES-LISTP
             (REWRITE)
             (IMPLIES (NOT (ZEROP (LENGTH L)))
                      (LISTP L))
             ((ENABLE LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LENGTH-IMPLIES-LISTP)

(PROVE-LEMMA LISTP-IMPLIES-NON-ZERO-LENGTH
             (REWRITE)
             (IMPLIES (LISTP L)
                      (NOT (EQUAL (LENGTH L) '0)))
             ((ENABLE LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-IMPLIES-NON-ZERO-LENGTH)

(PROVE-LEMMA PLIST-OF-NON-ZERO-LENGTH-IS-A-LIST
             (REWRITE)
             (IMPLIES (AND (PLISTP A)
                           (NOT (EQUAL (LENGTH A) '0)))
                      (LISTP A))
             ((ENABLE PLISTP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLIST-OF-NON-ZERO-LENGTH-IS-A-LIST)

(PROVE-LEMMA LISTP-APPEND
             (REWRITE)
             (EQUAL (LISTP (APPEND A B))
                    (OR (LISTP A) (LISTP B)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-APPEND)

(PROVE-LEMMA LISTP-APPEND-LEFT
             (REWRITE)
             (IMPLIES (LISTP A)
                      (LISTP (APPEND A B)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-APPEND-LEFT)

(PROVE-LEMMA LISTP-GETSEG
             (REWRITE)
             (IMPLIES (NOT (ZEROP K))
                      (LISTP (GETSEG N K L)))
             ((ENABLE NON-ZERO-LENGTH-IMPLIES-LISTP GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-GETSEG)

(PROVE-LEMMA LISTP-PUTNTH
             (REWRITE)
             (EQUAL (LISTP (PUTNTH V N L))
                    (LISTP L))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-PUTNTH)

(PROVE-LEMMA LISTP-PUTSEG
             (REWRITE)
             (EQUAL (LISTP (PUTSEG S N L))
                    (LISTP L))
             ((ENABLE PUTSEG LISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-PUTSEG)

(PROVE-LEMMA REWRITE-CAR-TO-GETNTH-0
             (REWRITE)
             (EQUAL (CAR L) (GETNTH '0 L))
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-CAR-TO-GETNTH-0)

(PROVE-LEMMA CAR-APPEND-CASESPLIT
             (REWRITE)
             (EQUAL (CAR (APPEND A B))
                    (IF (LISTP A) (CAR A) (CAR B)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-APPEND-CASESPLIT)

(PROVE-LEMMA CAR-APPEND
             (REWRITE)
             (IMPLIES (LISTP A)
                      (EQUAL (CAR (APPEND A B)) (CAR A)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-APPEND)

(PROVE-LEMMA CAR-GETSEG
             (REWRITE)
             (IMPLIES (NOT (ZEROP K))
                      (EQUAL (CAR (GETSEG N K L))
                             (GETNTH N L)))
             ((ENABLE GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-GETSEG)

(PROVE-LEMMA CAR-PUTNTH-ZERO
             (REWRITE)
             (IMPLIES (AND (LISTP L) (ZEROP N))
                      (EQUAL (CAR (PUTNTH V N L)) V))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-PUTNTH-ZERO)

(PROVE-LEMMA CAR-PUTSEG-ZERO
             (REWRITE)
             (IMPLIES (AND (ZEROP N)
                           (AND (LISTP S) (LISTP L)))
                      (EQUAL (CAR (PUTSEG S N L)) (CAR S)))
             ((ENABLE CAR-PUTNTH-ZERO PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-PUTSEG-ZERO)

(PROVE-LEMMA CDR-APPEND
             (REWRITE)
             (EQUAL (CDR (APPEND A B))
                    (IF (LISTP A)
                        (APPEND (CDR A) B)
                        (CDR B)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CDR-APPEND)

(PROVE-LEMMA CDR-GETSEG
             (REWRITE)
             (IMPLIES (NOT (ZEROP K))
                      (EQUAL (CDR (GETSEG N K L))
                             (GETSEG (ADD1 N) (SUB1 K) L)))
             ((ENABLE GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CDR-GETSEG)

(PROVE-LEMMA CDR-IS-NIL-WHEN-LENGTH-IS-1
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (EQUAL (LENGTH L) '1))
                      (EQUAL (EQUAL (CDR L) 'NIL)
                             '*1*TRUE))
             ((ENABLE PLISTP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CDR-IS-NIL-WHEN-LENGTH-IS-1)

(PROVE-LEMMA PLIST-OF-LENGTH-0
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (EQUAL (LENGTH L) '0))
                      (EQUAL (EQUAL L 'NIL) '*1*TRUE))
             ((ENABLE PLISTP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLIST-OF-LENGTH-0)

(PROVE-LEMMA PLISTP-APPEND
             (REWRITE)
             (IMPLIES (PLISTP B)
                      (PLISTP (APPEND A B)))
             ((ENABLE PLISTP APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-APPEND)

(PROVE-LEMMA PLISTP-LIST1
             (REWRITE)
             (PLISTP (CONS X 'NIL))
             ((ENABLE PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-LIST1)

(PROVE-LEMMA PLISTP-LIST2
             (REWRITE)
             (PLISTP (CONS X (CONS Y 'NIL)))
             ((ENABLE PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-LIST2)

(PROVE-LEMMA PLISTP-PUTNTH
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (PLISTP (PUTNTH V I L)))
             ((ENABLE PLISTP PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-PUTNTH)

(PROVE-LEMMA PLISTP-GETSEG
             (REWRITE)
             (PLISTP (GETSEG N K L))
             ((ENABLE PLISTP GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GETSEG)

(PROVE-LEMMA PLISTP-PUTSEG
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (PLISTP (PUTSEG S N L)))
             ((ENABLE PLISTP PUTSEG PLISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-PUTSEG)

(PROVE-LEMMA PLISTP-FIXLENGTH
             (REWRITE)
             (PLISTP (FIXLENGTH N L V))
             ((ENABLE PLISTP FIXLENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FIXLENGTH)

(PROVE-LEMMA LENGTH-APPEND
             (REWRITE)
             (EQUAL (LENGTH (APPEND A B))
                    (PLUS (LENGTH A) (LENGTH B)))
             ((ENABLE APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-APPEND)

(PROVE-LEMMA LENGTH-PUTNTH
             (REWRITE)
             (EQUAL (LENGTH (PUTNTH N V L))
                    (LENGTH L))
             ((ENABLE PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-PUTNTH)

(PROVE-LEMMA LENGTH-GETSEG
             (REWRITE)
             (EQUAL (LENGTH (GETSEG N K L))
                    (FIX K))
             ((ENABLE GETSEG LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-GETSEG)

(PROVE-LEMMA LENGTH-PUTSEG
             (REWRITE)
             (EQUAL (LENGTH (PUTSEG S N L))
                    (LENGTH L))
             ((ENABLE LENGTH-PUTNTH PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-PUTSEG)

(PROVE-LEMMA LENGTH-FIXLENGTH
             (REWRITE)
             (EQUAL (LENGTH (FIXLENGTH N L DEFAULT))
                    (FIX N))
             ((ENABLE FIXLENGTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FIXLENGTH)

(PROVE-LEMMA APPEND-NON-LIST-LEFT
             (REWRITE)
             (IMPLIES (NOT (LISTP A))
                      (EQUAL (APPEND A B) B))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-NON-LIST-LEFT)

(PROVE-LEMMA APPEND-NON-LIST-LEFT-COROLLARY
             (REWRITE)
             (IMPLIES (EQUAL (LENGTH A) '0)
                      (EQUAL (APPEND A B) B))
             ((ENABLE APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-NON-LIST-LEFT-COROLLARY)

(PROVE-LEMMA APPEND-NIL-ON-RIGHT
             (REWRITE)
             (IMPLIES (PLISTP A)
                      (EQUAL (APPEND A 'NIL) A))
             ((ENABLE APPEND PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-NIL-ON-RIGHT)

(PROVE-LEMMA APPEND-CDR
             (REWRITE)
             (IMPLIES (LISTP A)
                      (EQUAL (APPEND (CDR A) B)
                             (CDR (APPEND A B))))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-CDR)

(PROVE-LEMMA APPEND-CROCK
             (REWRITE)
             (EQUAL (APPEND (CONS A 'NIL) (APPEND B C))
                    (APPEND (CONS A B) C))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-CROCK)

(PROVE-LEMMA ASSOCIATIVITY-OF-APPEND
             (REWRITE)
             (EQUAL (APPEND (APPEND A B) C)
                    (APPEND A (APPEND B C)))
             ((ENABLE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ASSOCIATIVITY-OF-APPEND)

(PROVE-LEMMA APPEND-FIXLENGTH
             (REWRITE)
             (EQUAL (APPEND (FIXLENGTH A 'NIL DEFAULT)
                            (FIXLENGTH B 'NIL DEFAULT))
                    (FIXLENGTH (PLUS A B) 'NIL DEFAULT))
             ((ENABLE FIXLENGTH APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-FIXLENGTH)

(PROVE-LEMMA GETNTH-0-2
             (REWRITE)
             (EQUAL (GETNTH '0 (CONS A (CONS B 'NIL)))
                    A)
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-0-2)

(PROVE-LEMMA GETNTH-1-2
             (REWRITE)
             (EQUAL (GETNTH '1 (CONS A (CONS B 'NIL)))
                    B)
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-1-2)

(PROVE-LEMMA LIST-GETNTH-0
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (EQUAL (LENGTH L) '1))
                      (EQUAL (CONS (GETNTH '0 L) 'NIL) L))
             ((ENABLE PLISTP GETNTH LENGTH PLIST-OF-LENGTH-0
                      NON-ZERO-LENGTH-IMPLIES-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LIST-GETNTH-0)

(PROVE-LEMMA OPEN-UP-GETNTH
             (REWRITE)
             (EQUAL (GETNTH (ADD1 N) (CONS A B))
                    (GETNTH N B))
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-GETNTH)

(PROVE-LEMMA OPEN-UP-GETNTH1
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (GETNTH N (CONS A B))
                             (GETNTH (SUB1 N) B)))
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-GETNTH1)

(PROVE-LEMMA OPEN-UP-GETNTH-ON-ZERO
             (REWRITE)
             (EQUAL (GETNTH '0 (CONS A B)) A)
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-GETNTH-ON-ZERO)

(PROVE-LEMMA GETNTH-WITH-NON-NUMBER-INDEX
             (REWRITE)
             (IMPLIES (NOT (NUMBERP N))
                      (EQUAL (GETNTH N L) (GETNTH '0 L)))
             ((ENABLE GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-WITH-NON-NUMBER-INDEX)

(PROVE-LEMMA GETNTH-APPEND-FOR-LENGTH-LEFT
             (REWRITE)
             (EQUAL (GETNTH (LENGTH A) (APPEND A B))
                    (IF (LISTP B) (CAR B) '0))
             ((ENABLE GETNTH APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-APPEND-FOR-LENGTH-LEFT)

(PROVE-LEMMA GETNTH-APPEND-CASESPLIT
             (REWRITE)
             (EQUAL (GETNTH N (APPEND A B))
                    (IF (LESSP N (LENGTH A))
                        (GETNTH N A)
                        (GETNTH (DIFFERENCE N (LENGTH A)) B)))
             ((ENABLE GETNTH APPEND CAR-APPEND APPEND-NON-LIST-LEFT LENGTH)
              (INDUCT (GETNTH N A))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-APPEND-CASESPLIT)

(PROVE-LEMMA GETNTH-APPEND-RIGHT
             (REWRITE)
             (IMPLIES (IF (LESSP N (LENGTH A))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETNTH N (APPEND A B))
                             (GETNTH (DIFFERENCE N (LENGTH A)) B)))
             ((ENABLE GETNTH-APPEND-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-APPEND-RIGHT)

(PROVE-LEMMA GETNTH-APPEND-LEFT
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH A))
                      (EQUAL (GETNTH N (APPEND A B))
                             (GETNTH N A)))
             ((ENABLE GETNTH-APPEND-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-APPEND-LEFT)

(PROVE-LEMMA GETNTH-PUTNTH-CASESPLIT
             (REWRITE)
             (EQUAL (GETNTH I (PUTNTH V J L))
                    (IF (LESSP I (LENGTH L))
                        (IF (EQUAL (FIX I) (FIX J))
                            V
                            (GETNTH I L))
                        (GETNTH I L)))
             ((ENABLE GETNTH PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PUTNTH-CASESPLIT)

(PROVE-LEMMA GETNTH-PUTNTH-COINCIDENCE
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH L))
                      (EQUAL (GETNTH N (PUTNTH V N L)) V))
             ((ENABLE GETNTH-PUTNTH-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PUTNTH-COINCIDENCE)

(PROVE-LEMMA GETNTH-PUTNTH-NON-INTERFERENCE
             (REWRITE)
             (IMPLIES (NOT (EQUAL (FIX I) (FIX J)))
                      (EQUAL (GETNTH I (PUTNTH V J L))
                             (GETNTH I L)))
             ((ENABLE GETNTH-PUTNTH-CASESPLIT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PUTNTH-NON-INTERFERENCE)

(PROVE-LEMMA GETNTH-GETSEG-ZERO-INDEX
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP K)) (ZEROP I))
                      (EQUAL (GETNTH I (GETSEG N K L))
                             (GETNTH N L)))
             ((ENABLE GETNTH GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-GETSEG-ZERO-INDEX)

(DEFN GETNTH-GETSEG-INDUCTION
      (I N K)
      (IF (OR (ZEROP I) (ZEROP K))
          '0
          (GETNTH-GETSEG-INDUCTION (SUB1 I)
                                   (ADD1 N)
                                   (SUB1 K)))
      NIL)

(PROVE-LEMMA GETNTH-GETSEG
             (REWRITE)
             (IMPLIES (LESSP I K)
                      (EQUAL (GETNTH I (GETSEG N K L))
                             (GETNTH (PLUS N I) L)))
             ((ENABLE GETSEG GETNTH GETNTH-GETSEG-ZERO-INDEX PLUS-0 PLUS-ADD1
                      PLUS-RIGHT-ID2)
              (INDUCT (GETNTH-GETSEG-INDUCTION I N K))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-GETSEG)

(PROVE-LEMMA GETNTH-GETSEG-INVERSE
             (REWRITE)
             (IMPLIES (LESSP I K)
                      (EQUAL (GETNTH (PLUS N I) L)
                             (GETNTH I (GETSEG N K L))))
             ((ENABLE GETNTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-GETSEG-INVERSE)

(PROVE-LEMMA GETNTH-AFTER-PUTSEG
             (REWRITE)
             (IMPLIES (IF (LESSP I (PLUS N (LENGTH S)))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETNTH I (PUTSEG S N L))
                             (GETNTH I L)))
             ((ENABLE PUTSEG GETNTH GETNTH-PUTNTH-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-AFTER-PUTSEG)

(PROVE-LEMMA GETNTH-BEFORE-PUTSEG
             (REWRITE)
             (IMPLIES (LESSP I N)
                      (EQUAL (GETNTH I (PUTSEG S N L))
                             (GETNTH I L)))
             ((ENABLE PUTSEG GETNTH GETNTH-PUTNTH-CASESPLIT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-BEFORE-PUTSEG)

(PROVE-LEMMA GETNTH-PUTSEG-COINCIDENCE
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (AND (LESSP (DIFFERENCE I N) (LENGTH S))
                                (LESSP I (LENGTH L))))
                      (EQUAL (GETNTH I (PUTSEG S N L))
                             (GETNTH (DIFFERENCE I N) S)))
             ((ENABLE PUTSEG GETNTH LENGTH CAR-PUTSEG-ZERO DIFFERENCE-X-X
                      DIFFERENCE-SUB1-ARG1 GETNTH-PUTNTH-CASESPLIT
                      LENGTH-PUTSEG LISTP-PUTSEG NON-ZERO-LENGTH-IMPLIES-LISTP)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PUTSEG-COINCIDENCE)

(PROVE-LEMMA OPEN-PUTNTH-CASESPLIT
             (REWRITE)
             (EQUAL (PUTNTH V N (CONS A B))
                    (IF (ZEROP N)
                        (CONS V B)
                        (CONS A (PUTNTH V (SUB1 N) B))))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-PUTNTH-CASESPLIT)

(PROVE-LEMMA OPEN-UP-PUTNTH1
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (PUTNTH V N (CONS A B))
                             (CONS A (PUTNTH V (SUB1 N) B))))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-PUTNTH1)

(PROVE-LEMMA PUTNTH-INTO-NIL
             (REWRITE)
             (EQUAL (PUTNTH V I 'NIL) 'NIL)
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-INTO-NIL)

(PROVE-LEMMA OPEN-UP-PUTNTH-ON-ZERO
             (REWRITE)
             (EQUAL (PUTNTH VAL '0 (CONS A B))
                    (CONS VAL B))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-PUTNTH-ON-ZERO)

(PROVE-LEMMA PUTNTH-WITH-NON-NUMBER-INDEX
             (REWRITE)
             (IMPLIES (NOT (NUMBERP I))
                      (EQUAL (PUTNTH V I L)
                             (PUTNTH V '0 L)))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-WITH-NON-NUMBER-INDEX)

(PROVE-LEMMA PUTNTH-HAS-NO-EFFECT
             (REWRITE)
             (IMPLIES (NOT (LESSP N (LENGTH L)))
                      (EQUAL (PUTNTH V N L) L))
             ((ENABLE PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-HAS-NO-EFFECT)

(PROVE-LEMMA PUTNTH-CONS1
             (REWRITE)
             (IMPLIES (ZEROP N)
                      (EQUAL (PUTNTH V N (CONS A B))
                             (CONS V B)))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-CONS1)

(PROVE-LEMMA PUTNTH-CONS2
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (PUTNTH V N (CONS A B))
                             (CONS A (PUTNTH V (SUB1 N) B))))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-CONS2)

(PROVE-LEMMA PUTNTH-SHIFT
             (REWRITE)
             (IMPLIES (LESSP I (LENGTH L))
                      (EQUAL (PUTNTH V I L)
                             (APPEND (FIRSTN I L)
                                     (CONS V (NTHCDR (ADD1 I) L)))))
             ((ENABLE PUTNTH APPEND FIRSTN NTHCDR LENGTH)
              (INDUCT (NUMBER-AND-LIST-INDUCTION I L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-SHIFT)

(PROVE-LEMMA PUTNTH-APPEND-CASESPLIT
             (REWRITE)
             (EQUAL (PUTNTH V N (APPEND A B))
                    (IF (LESSP N (LENGTH A))
                        (APPEND (PUTNTH V N A) B)
                        (APPEND A
                                (PUTNTH V
                                        (DIFFERENCE N (LENGTH A))
                                        B))))
             ((ENABLE PUTNTH APPEND LENGTH)
              (INDUCT (PUTNTH V N A))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-APPEND-CASESPLIT)

(PROVE-LEMMA PUTNTH-APPEND-RIGHT
             (REWRITE)
             (IMPLIES (IF (LESSP N (LENGTH A))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (PUTNTH V N (APPEND A B))
                             (APPEND A
                                     (PUTNTH V
                                             (DIFFERENCE N (LENGTH A))
                                             B))))
             ((ENABLE PUTNTH-APPEND-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-APPEND-RIGHT)

(PROVE-LEMMA PUTNTH-APPEND-LEFT
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH A))
                      (EQUAL (PUTNTH V N (APPEND A B))
                             (APPEND (PUTNTH V N A) B)))
             ((ENABLE PUTNTH-APPEND-CASESPLIT LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-APPEND-LEFT)

(PROVE-LEMMA PUTNTH-GETNTH-COINCIDENCE
             (REWRITE)
             (EQUAL (PUTNTH (GETNTH I L) I L) L)
             ((ENABLE GETNTH PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-GETNTH-COINCIDENCE)

(PROVE-LEMMA PUTNTH-GETNTH-COINCIDENCE1
             (REWRITE)
             (IMPLIES (EQUAL (GETNTH I L1) (GETNTH I L2))
                      (EQUAL (PUTNTH (GETNTH I L1)
                                     I
                                     (PUTNTH V I L2))
                             L2))
             ((ENABLE PUTNTH GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-GETNTH-COINCIDENCE1)

(PROVE-LEMMA PUTNTH-PUTNTH-CASESPLIT
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (NUMBERP J)
                                (IF (LESSP J I)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (PUTNTH B J (PUTNTH A I L))
                             (IF (EQUAL I J)
                                 (PUTNTH B J L)
                                 (PUTNTH A I (PUTNTH B J L)))))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-PUTNTH-CASESPLIT)

(PROVE-LEMMA PUTNTH-COINCIDENCE
             (REWRITE)
             (IMPLIES (EQUAL (FIX I) (FIX J))
                      (EQUAL (PUTNTH B J (PUTNTH A I L))
                             (PUTNTH B J L)))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-COINCIDENCE)

(PROVE-LEMMA PUTNTH-NON-INTERFERENCE
             NIL
             (IMPLIES (NOT (EQUAL (FIX I) (FIX J)))
                      (EQUAL (PUTNTH B J (PUTNTH A I L))
                             (PUTNTH A I (PUTNTH B J L))))
             ((ENABLE PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PUTNTH-NON-INTERFERENCE-COROLLARY1
             (REWRITE)
             (IMPLIES (LESSP (FIX I) (ADD1 J))
                      (EQUAL (PUTNTH B (ADD1 J) (PUTNTH A I L))
                             (PUTNTH A I (PUTNTH B (ADD1 J) L))))
             ((USE (PUTNTH-NON-INTERFERENCE (I I)
                                            (J (ADD1 J))
                                            (A A)
                                            (B B)
                                            (L L)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-NON-INTERFERENCE-COROLLARY1)

(PROVE-LEMMA PUTNTH-NON-INTERFERENCE-COROLLARY2
             (REWRITE)
             (IMPLIES (LESSP (FIX I) (PLUS J K))
                      (EQUAL (PUTNTH B (PLUS J K) (PUTNTH A I L))
                             (PUTNTH A I (PUTNTH B (PLUS J K) L))))
             ((USE (PUTNTH-NON-INTERFERENCE (I I)
                                            (J (PLUS J K))
                                            (A A)
                                            (B B)
                                            (L L)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-NON-INTERFERENCE-COROLLARY2)

(PROVE-LEMMA PUTNTH-PUTSEG-COINCIDENCE-PROOF
             (REWRITE)
             (IMPLIES (AND (NUMBERP N)
                           (AND (NUMBERP I)
                                (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                                     (LESSP (DIFFERENCE I N) (LENGTH S)))))
                      (EQUAL (PUTNTH V I (PUTSEG S N L))
                             (PUTSEG (PUTNTH V (DIFFERENCE I N) S)
                                     N L)))
             ((ENABLE PUTSEG PUTNTH LENGTH DIFFERENCE-X-X DIFFERENCE-SUB1-ARG1
                      LISTP-PUTSEG NON-ZERO-LENGTH-IMPLIES-LISTP
                      PUTNTH-PUTNTH-CASESPLIT)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-PUTSEG-COINCIDENCE-PROOF)

(PROVE-LEMMA PUTSEG-WITH-NON-NUMBER-INDEX
             (REWRITE)
             (IMPLIES (NOT (NUMBERP N))
                      (EQUAL (PUTSEG S N L)
                             (PUTSEG S '0 L)))
             ((ENABLE PUTSEG PUTNTH-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-WITH-NON-NUMBER-INDEX)

(PROVE-LEMMA PUTNTH-PUTSEG-COINCIDENCE
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (LESSP (DIFFERENCE I N) (LENGTH S)))
                      (EQUAL (PUTNTH V I (PUTSEG S N L))
                             (PUTSEG (PUTNTH V (DIFFERENCE I N) S)
                                     N L)))
             ((ENABLE PUTNTH-PUTSEG-COINCIDENCE-PROOF
                      PUTNTH-WITH-NON-NUMBER-INDEX
                      PUTSEG-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-PUTSEG-COINCIDENCE)

(PROVE-LEMMA PUTNTH-PUTSEG-COINCIDENCE-INVERSE
             (REWRITE)
             (IMPLIES (AND (LESSP I (LENGTH S)) (NUMBERP I))
                      (EQUAL (PUTSEG (PUTNTH V I S) N L)
                             (PUTNTH V (PLUS I N) (PUTSEG S N L))))
             ((USE (PUTNTH-PUTSEG-COINCIDENCE (N N)
                                              (I (PLUS I N))
                                              (V V)
                                              (S S)
                                              (L L)))
              (ENABLE DIFFERENCE-PLUS2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-PUTSEG-COINCIDENCE-INVERSE)

(PROVE-LEMMA PUTNTH-AFTER-PUTSEG-PROOF
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (NUMBERP N)
                                (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                                     (IF (LESSP (DIFFERENCE I N) (LENGTH S))
                                         '*1*FALSE
                                         '*1*TRUE))))
                      (EQUAL (PUTNTH V I (PUTSEG S N L))
                             (PUTSEG S N (PUTNTH V I L))))
             ((ENABLE PUTNTH PUTSEG LENGTH PUTNTH-PUTNTH-CASESPLIT)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-AFTER-PUTSEG-PROOF)

(PROVE-LEMMA PUTNTH-AFTER-PUTSEG
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (IF (LESSP (DIFFERENCE I N) (LENGTH S))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (PUTNTH V I (PUTSEG S N L))
                             (PUTSEG S N (PUTNTH V I L))))
             ((ENABLE PUTNTH-AFTER-PUTSEG-PROOF PUTNTH-WITH-NON-NUMBER-INDEX
                      PUTSEG-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-AFTER-PUTSEG)

(PROVE-LEMMA GETSEG-OF-LENGTH-ZERO
             (REWRITE)
             (IMPLIES (ZEROP K)
                      (EQUAL (GETSEG N K L) 'NIL))
             ((ENABLE GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-OF-LENGTH-ZERO)

(PROVE-LEMMA GETSEG-ADD1-LENGTH
             (REWRITE)
             (EQUAL (GETSEG N (ADD1 K) L)
                    (APPEND (GETSEG N K L)
                            (CONS (GETNTH (PLUS N K) L) 'NIL)))
             ((ENABLE APPEND GETSEG PLUS-0 PLUS-RIGHT-ID2
                      GETNTH-WITH-NON-NUMBER-INDEX PLUS-ADD1)
              (INDUCT (GETSEG N K L))
              (EXPAND (GETSEG N 1 L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-ADD1-LENGTH)

(PROVE-LEMMA GETSEG-WITH-NON-NUMBER-INDEX
             (REWRITE)
             (IMPLIES (NOT (NUMBERP N))
                      (EQUAL (GETSEG N K L)
                             (GETSEG '0 K L)))
             ((ENABLE GETSEG GETNTH-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-WITH-NON-NUMBER-INDEX)

(PROVE-LEMMA GETSEG-ADD1-CONS
             (REWRITE)
             (EQUAL (GETSEG (ADD1 N) K (CONS A B))
                    (GETSEG N K B))
             ((ENABLE GETSEG GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-ADD1-CONS)

(PROVE-LEMMA GETSEG-LENGTH-1
             NIL
             (EQUAL (GETSEG N '1 L)
                    (CONS (GETNTH N L) 'NIL))
             ((ENABLE GETSEG)
              (EXPAND (GETSEG N 1 L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GETSEG-LENGTH-1-RULE
             (REWRITE)
             (IMPLIES (EQUAL K '1)
                      (EQUAL (GETSEG N K L)
                             (CONS (GETNTH N L) 'NIL)))
             ((USE (GETSEG-LENGTH-1 (N N) (K '1) (L L)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-LENGTH-1-RULE)

(PROVE-LEMMA GETSEG-ADD1-LENGTH2
             (REWRITE)
             (IMPLIES (AND (NUMBERP N)
                           (IF (LESSP (LENGTH L) (ADD1 N))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (GETSEG N (ADD1 K) L)
                             (CONS (GETNTH N L)
                                   (GETSEG (ADD1 N) K L))))
             ((ENABLE GETNTH GETSEG LENGTH NON-ZERO-LENGTH-IMPLIES-LISTP)
              (INDUCT (NUMBER-AND-LIST-INDUCTION N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-ADD1-LENGTH2)

(PROVE-LEMMA GETSEG-APPEND-RIGHT
             (REWRITE)
             (IMPLIES (IF (LESSP N (LENGTH A))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG N K (APPEND A B))
                             (GETSEG (DIFFERENCE N (LENGTH A))
                                     K B)))
             ((ENABLE GETSEG LENGTH GETNTH-APPEND-RIGHT DIFFERENCE-SUB1-ARG2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-APPEND-RIGHT)

(PROVE-LEMMA
         GETSEG-ACROSS-APPEND
         (REWRITE)
         (IMPLIES (AND (NUMBERP N)
                       (AND (IF (LESSP (LENGTH A) N)
                                '*1*FALSE
                                '*1*TRUE)
                            (IF (LESSP (PLUS N K) (LENGTH A))
                                '*1*FALSE
                                '*1*TRUE)))
                  (EQUAL (GETSEG N K (APPEND A B))
                         (APPEND (GETSEG N (DIFFERENCE (LENGTH A) N) A)
                                 (GETSEG '0
                                         (DIFFERENCE K
                                                     (DIFFERENCE (LENGTH A) N))
                                         B))))
         ((ENABLE GETSEG APPEND GETNTH LENGTH APPEND-NIL-ON-RIGHT
                  APPEND-NON-LIST-LEFT-COROLLARY DIFFERENCE-X-X
                  DIFFERENCE-SUB1-ARG2 GETNTH-APPEND-FOR-LENGTH-LEFT
                  GETNTH-APPEND-LEFT GETSEG-ADD1-CONS GETSEG-APPEND-RIGHT
                  GETSEG-OF-LENGTH-ZERO PLISTP-GETSEG PLUS-0 PLUS-ADD1
                  PLUS-RIGHT-ID2 REWRITE-ZERO-DIFFERENCE-AS-EQUALITY)
          (INDUCT (NUMBER-AND-LIST-INDUCTION K A))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GETSEG-ACROSS-APPEND)

(PROVE-LEMMA GETSEG-APPEND-LEFT
             (REWRITE)
             (IMPLIES (IF (LESSP (LENGTH A) (PLUS N K))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG N K (APPEND A B))
                             (GETSEG N K A)))
             ((ENABLE GETSEG LENGTH GETNTH-APPEND-LEFT)
              (DISABLE APPEND)
              (INDUCT (NUMBER-AND-LIST-INDUCTION K A))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-APPEND-LEFT)

(PROVE-LEMMA GETSEG-AFTER-PUTNTH
             (REWRITE)
             (IMPLIES (LESSP N I)
                      (EQUAL (GETSEG I K (PUTNTH V N L))
                             (GETSEG I K L)))
             ((ENABLE GETSEG GETNTH-PUTNTH-CASESPLIT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-AFTER-PUTNTH)

(PROVE-LEMMA GETSEG-BEFORE-PUTNTH
             (REWRITE)
             (IMPLIES (IF (LESSP N (PLUS I K))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG I K (PUTNTH V N L))
                             (GETSEG I K L)))
             ((ENABLE GETSEG GETNTH-PUTNTH-CASESPLIT)
              (INDUCT (GETSEG I K L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-BEFORE-PUTNTH)

(PROVE-LEMMA GETSEG-PUTNTH-COINCIDENCE
             (REWRITE)
             (IMPLIES (AND (IF (LESSP N I) '*1*FALSE '*1*TRUE)
                           (AND (LESSP (DIFFERENCE N I) K)
                                (LESSP N (LENGTH L))))
                      (EQUAL (GETSEG I K (PUTNTH V N L))
                             (PUTNTH V
                                     (DIFFERENCE N I)
                                     (GETSEG I K L))))
             ((ENABLE GETSEG LENGTH DIFFERENCE-SUB1-ARG1
                      GETNTH-PUTNTH-CASESPLIT GETSEG-OF-LENGTH-ZERO
                      GETSEG-AFTER-PUTNTH OPEN-PUTNTH-CASESPLIT
                      PUTNTH-WITH-NON-NUMBER-INDEX)
              (INDUCT (GETSEG I K L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-PUTNTH-COINCIDENCE)

(DEFN INTEGER-INDUCTION-INSTANCE
      (N K)
      (IF (ZEROP K)
          '0
          (INTEGER-INDUCTION-INSTANCE (ADD1 N)
                                      (SUB1 K)))
      NIL)

(PROVE-LEMMA GETSEG-GETSEG
             (REWRITE)
             (IMPLIES (IF (LESSP K (PLUS I J))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG I J (GETSEG N K L))
                             (GETSEG (PLUS N I) J L)))
             ((ENABLE GETSEG GETNTH-GETSEG PLUS-ADD1 PLUS-RIGHT-ID2 PLUS-0
                      GETNTH-WITH-NON-NUMBER-INDEX
                      GETSEG-WITH-NON-NUMBER-INDEX)
              (INDUCT (INTEGER-INDUCTION-INSTANCE I J))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-GETSEG)

(PROVE-LEMMA GETSEG-AFTER-PUTSEG
             (REWRITE)
             (IMPLIES (IF (LESSP I (PLUS N (LENGTH S)))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG I K (PUTSEG S N L))
                             (GETSEG I K L)))
             ((ENABLE GETSEG PUTSEG LENGTH PLUS-ADD1 GETNTH-AFTER-PUTSEG)
              (INDUCT (INTEGER-INDUCTION-INSTANCE I K))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-AFTER-PUTSEG)

(PROVE-LEMMA GETSEG-BEFORE-PUTSEG
             (REWRITE)
             (IMPLIES (IF (LESSP N (PLUS I K))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (GETSEG I K (PUTSEG S N L))
                             (GETSEG I K L)))
             ((ENABLE GETSEG PUTSEG PLUS-ADD1 GETNTH-BEFORE-PUTSEG)
              (INDUCT (INTEGER-INDUCTION-INSTANCE I K))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-BEFORE-PUTSEG)

(PROVE-LEMMA GETSEG-WITHIN-PUTSEG
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (AND (IF (LESSP (LENGTH L) (PLUS N (LENGTH S)))
                                    '*1*FALSE
                                    '*1*TRUE)
                                (IF (LESSP (PLUS N (LENGTH S)) (PLUS I K))
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (GETSEG I K (PUTSEG S N L))
                             (GETSEG (DIFFERENCE I N) K S)))
             ((ENABLE GETSEG PUTSEG LENGTH PLUS-ADD1 GETNTH-PUTSEG-COINCIDENCE
                      DIFFERENCE-SUB1-ARG1 DIFFERENCE-SUB1-ARG2)
              (INDUCT (INTEGER-INDUCTION-INSTANCE I K))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-WITHIN-PUTSEG)

(DEFN GETSEG-PUTSEG-INDUCTION
      (I K S N)
      (IF (ZEROP K)
          '0
          (IF (LISTP S)
              (GETSEG-PUTSEG-INDUCTION (ADD1 I)
                                       (SUB1 K)
                                       (CDR S)
                                       (ADD1 N))
              '0))
      NIL)

(PROVE-LEMMA PUTSEG-HAS-NO-EFFECT
             (REWRITE)
             (IMPLIES (NOT (LESSP N (LENGTH L)))
                      (EQUAL (PUTSEG S N L) L))
             ((ENABLE PUTSEG LENGTH PUTNTH-HAS-NO-EFFECT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-HAS-NO-EFFECT)

(PROVE-LEMMA PUTSEG-CONS2
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (PUTSEG S N (CONS A B))
                             (CONS A (PUTSEG S (SUB1 N) B))))
             ((ENABLE PUTSEG PUTNTH-CONS2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-CONS2)

(PROVE-LEMMA
        GETSEG-AROUND-PUTSEG-PROOF
        (REWRITE)
        (IMPLIES (AND (NUMBERP I)
                      (AND (NUMBERP N)
                           (AND (IF (LESSP N I) '*1*FALSE '*1*TRUE)
                                (AND (IF (LESSP (LENGTH L) (PLUS N (LENGTH S)))
                                         '*1*FALSE
                                         '*1*TRUE)
                                     (IF (LESSP (PLUS I K) (PLUS N (LENGTH S)))
                                         '*1*FALSE
                                         '*1*TRUE)))))
                 (EQUAL (GETSEG I K (PUTSEG S N L))
                        (PUTSEG S
                                (DIFFERENCE N I)
                                (GETSEG I K L))))
        ((ENABLE GETSEG PUTSEG LENGTH GETNTH-BEFORE-PUTSEG
                 GETSEG-OF-LENGTH-ZERO GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTSEG
                 PLUS-ADD1 PUTSEG-CONS2 PUTSEG-HAS-NO-EFFECT)
         (INDUCT (GETSEG-PUTSEG-INDUCTION I K S N))
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE GETSEG-AROUND-PUTSEG-PROOF)

(PROVE-LEMMA NUMBERP-CASESPLIT
             NIL
             (OR (NUMBERP A) (NOT (NUMBERP A)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GETSEG-AROUND-PUTSEG
             (REWRITE)
             (IMPLIES (AND (IF (LESSP N I) '*1*FALSE '*1*TRUE)
                           (AND (IF (LESSP (LENGTH L) (PLUS N (LENGTH S)))
                                    '*1*FALSE
                                    '*1*TRUE)
                                (IF (LESSP (PLUS I K) (PLUS N (LENGTH S)))
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (GETSEG I K (PUTSEG S N L))
                             (PUTSEG S
                                     (DIFFERENCE N I)
                                     (GETSEG I K L))))
             ((USE (NUMBERP-CASESPLIT (A I))
                   (NUMBERP-CASESPLIT (A N))
                   (GETSEG-AROUND-PUTSEG-PROOF (I I)
                                               (N N)
                                               (K K)
                                               (S S)
                                               (L L))
                   (GETSEG-AROUND-PUTSEG-PROOF (I '0)
                                               (N N)
                                               (K K)
                                               (S S)
                                               (L L))
                   (GETSEG-AROUND-PUTSEG-PROOF (I I)
                                               (N '0)
                                               (K K)
                                               (S S)
                                               (L L))
                   (GETSEG-AROUND-PUTSEG-PROOF (I '0)
                                               (N '0)
                                               (K K)
                                               (S S)
                                               (L L)))
              (ENABLE GETSEG-WITH-NON-NUMBER-INDEX
                      PUTSEG-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-AROUND-PUTSEG)

(PROVE-LEMMA PUTSEG-NIL-SEGMENT
             (REWRITE)
             (EQUAL (PUTSEG 'NIL N L) L)
             ((ENABLE PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-NIL-SEGMENT)

(PROVE-LEMMA PUTSEG-NON-LIST-SEGMENT
             (REWRITE)
             (IMPLIES (NOT (LISTP S))
                      (EQUAL (PUTSEG S N L) L))
             ((ENABLE PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-NON-LIST-SEGMENT)

(PROVE-LEMMA OPEN-UP-PUTSEG-ON-SEGMENT-CONS
             (REWRITE)
             (IMPLIES (AND (NUMBERP N)
                           (IF (LESSP (LENGTH L)
                                      (PLUS N (LENGTH (CONS A B))))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (PUTSEG (CONS A B) N L)
                             (PUTNTH A N
                                     (PUTSEG B (PLUS '1 N) L))))
             ((ENABLE PUTSEG LENGTH PLUS-ADD1 PLUS-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-PUTSEG-ON-SEGMENT-CONS)

(PROVE-LEMMA PUTSEG-CONS1
             (REWRITE)
             (IMPLIES (AND (ZEROP N) (LISTP S))
                      (EQUAL (PUTSEG S N (CONS A B))
                             (CONS (CAR S) (PUTSEG (CDR S) N B))))
             ((ENABLE PUTSEG PUTNTH-CONS1 PUTSEG-CONS2
                      PUTSEG-WITH-NON-NUMBER-INDEX)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-CONS1)

(PROVE-LEMMA PUTSEG-GETSEG-COINCIDENCE
             (REWRITE)
             (IMPLIES (EQUAL I N)
                      (EQUAL (PUTSEG (GETSEG N K L) I L) L))
             ((ENABLE PUTSEG GETSEG PUTNTH-GETNTH-COINCIDENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-GETSEG-COINCIDENCE)

(PROVE-LEMMA EQUALITY-OF-GETNTH-BACKCHAIN-PROOF
             NIL
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (AND (LESSP (DIFFERENCE I N) K)
                                (EQUAL (GETSEG N K L1)
                                       (GETSEG N K L2))))
                      (EQUAL (GETNTH I L1) (GETNTH I L2)))
             ((ENABLE GETSEG GETNTH GETNTH-GETSEG DIFFERENCE-X-X
                      PLUS-RIGHT-ID2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN NESTED-INTERVALS
      (N1 K1 N2 K2)
      (AND (IF (LESSP N2 N1)
               '*1*FALSE
               '*1*TRUE)
           (IF (LESSP (PLUS N1 K1) (PLUS N2 K2))
               '*1*FALSE
               '*1*TRUE))
      NIL)

(DEFN STRANGE-INDUCTION
      (A B C D)
      (IF (OR (ZEROP A) (ZEROP B))
          '0
          (STRANGE-INDUCTION (SUB1 A)
                             (SUB1 B)
                             (ADD1 C)
                             (ADD1 D)))
      NIL)

(PROVE-LEMMA PLUS-ARG2-MUST-BE-ZERO
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (IF (LESSP N (PLUS I J))
                               '*1*FALSE
                               '*1*TRUE))
                      (ZEROP J))
             ((ENABLE PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-ARG2-MUST-BE-ZERO)

(PROVE-LEMMA GETSEG-MUST-BE-NIL
             (REWRITE)
             (IMPLIES (AND (IF (LESSP I N) '*1*FALSE '*1*TRUE)
                           (IF (LESSP N (PLUS I J))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (GETSEG I J L) 'NIL))
             ((USE (PLUS-ARG2-MUST-BE-ZERO (I I)
                                           (J J)
                                           (N N)))
              (ENABLE GETSEG-OF-LENGTH-ZERO)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-MUST-BE-NIL)

(PROVE-LEMMA EQUALITY-OF-GETSEG-BACKCHAIN-BASE-CASE
             NIL
             (IMPLIES (AND (OR (ZEROP J) (ZEROP K))
                           (AND (NUMBERP I)
                                (AND (NUMBERP N)
                                     (AND (NESTED-INTERVALS N K I J)
                                          (EQUAL (GETSEG N K L1)
                                                 (GETSEG N K L2))))))
                      (EQUAL (GETSEG I J L1)
                             (GETSEG I J L2)))
             ((ENABLE NESTED-INTERVALS GETSEG-OF-LENGTH-ZERO
                      GETSEG-OF-LENGTH-ZERO PLUS-0 PLUS-RIGHT-ID2
                      GETSEG-MUST-BE-NIL)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA
 EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP-CASE1 NIL
 (IMPLIES
  (AND (NUMBERP I)
       (AND (NUMBERP N)
            (AND (NOT (ZEROP J))
                 (AND (NOT (ZEROP K))
                      (AND (IMPLIES (AND (NESTED-INTERVALS (ADD1 N)
                                                           (SUB1 K)
                                                           (ADD1 I)
                                                           (SUB1 J))
                                         (EQUAL (GETSEG (ADD1 N) (SUB1 K) L1)
                                                (GETSEG (ADD1 N) (SUB1 K) L2)))
                                    (EQUAL (GETSEG (ADD1 I) (SUB1 J) L1)
                                           (GETSEG (ADD1 I) (SUB1 J) L2)))
                           (AND (NESTED-INTERVALS N K I J)
                                (AND (EQUAL (GETSEG N K L1)
                                            (GETSEG N K L2))
                                     (EQUAL I N))))))))
  (EQUAL (GETSEG I J L1)
         (GETSEG I J L2)))
 ((ENABLE GETSEG NESTED-INTERVALS)
  (EXPAND (GETSEG N K L1)
          (GETSEG N K L2)
          (GETSEG I J L1)
          (GETSEG I J L2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA
 EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP-CASE2 NIL
 (IMPLIES
  (AND (NUMBERP I)
       (AND (NUMBERP N)
            (AND (NOT (ZEROP J))
                 (AND (NOT (ZEROP K))
                      (AND (IMPLIES (AND (NESTED-INTERVALS (ADD1 N)
                                                           (SUB1 K)
                                                           (ADD1 I)
                                                           (SUB1 J))
                                         (EQUAL (GETSEG (ADD1 N) (SUB1 K) L1)
                                                (GETSEG (ADD1 N) (SUB1 K) L2)))
                                    (EQUAL (GETSEG (ADD1 I) (SUB1 J) L1)
                                           (GETSEG (ADD1 I) (SUB1 J) L2)))
                           (AND (NESTED-INTERVALS N K I J)
                                (AND (EQUAL (GETSEG N K L1)
                                            (GETSEG N K L2))
                                     (LESSP N I))))))))
  (EQUAL (GETSEG I J L1)
         (GETSEG I J L2)))
 ((ENABLE GETSEG NESTED-INTERVALS)
  (EXPAND (GETSEG N K L1)
          (GETSEG N K L2)
          (GETSEG I J L1)
          (GETSEG I J L2))
  (USE (EQUALITY-OF-GETNTH-BACKCHAIN-PROOF (I I)
                                           (N (ADD1 N))
                                           (K (SUB1 K))
                                           (L1 L1)
                                           (L2 L2)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP
 NIL
 (IMPLIES
  (AND (NUMBERP I)
       (AND (NUMBERP N)
            (AND (NOT (ZEROP J))
                 (AND (NOT (ZEROP K))
                      (AND (IMPLIES (AND (NESTED-INTERVALS (ADD1 N)
                                                           (SUB1 K)
                                                           (ADD1 I)
                                                           (SUB1 J))
                                         (EQUAL (GETSEG (ADD1 N) (SUB1 K) L1)
                                                (GETSEG (ADD1 N) (SUB1 K) L2)))
                                    (EQUAL (GETSEG (ADD1 I) (SUB1 J) L1)
                                           (GETSEG (ADD1 I) (SUB1 J) L2)))
                           (AND (NESTED-INTERVALS N K I J)
                                (EQUAL (GETSEG N K L1)
                                       (GETSEG N K L2))))))))
  (EQUAL (GETSEG I J L1)
         (GETSEG I J L2)))
 ((ENABLE NESTED-INTERVALS)
  (USE (LEQ-CASESPLIT (A I) (B N))
       (EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP-CASE1)
       (EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA EQUALITY-OF-GETSEG-BACKCHAIN-PROOF NIL
             (IMPLIES (AND (NUMBERP I)
                           (AND (NUMBERP N)
                                (AND (NESTED-INTERVALS N K I J)
                                     (EQUAL (GETSEG N K L1)
                                            (GETSEG N K L2)))))
                      (EQUAL (GETSEG I J L1)
                             (GETSEG I J L2)))
             ((USE (EQUALITY-OF-GETSEG-BACKCHAIN-BASE-CASE)
                   (EQUALITY-OF-GETSEG-BACKCHAIN-INDUCTION-STEP))
              (INDUCT (STRANGE-INDUCTION J K I N))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA EQUALITY-OF-GETSEG-BACKCHAIN NIL
             (IMPLIES (AND (NESTED-INTERVALS N K I J)
                           (EQUAL (GETSEG N K L1)
                                  (GETSEG N K L2)))
                      (EQUAL (GETSEG I J L1)
                             (GETSEG I J L2)))
             ((ENABLE GETSEG-WITH-NON-NUMBER-INDEX NESTED-INTERVALS)
              (USE (NUMBERP-CASESPLIT (A I))
                   (NUMBERP-CASESPLIT (A N))
                   (EQUALITY-OF-GETSEG-BACKCHAIN-PROOF (I I)
                                                       (J J)
                                                       (K K)
                                                       (N N))
                   (EQUALITY-OF-GETSEG-BACKCHAIN-PROOF (I '0)
                                                       (J J)
                                                       (K K)
                                                       (N N))
                   (EQUALITY-OF-GETSEG-BACKCHAIN-PROOF (I I)
                                                       (J J)
                                                       (K K)
                                                       (N '0))
                   (EQUALITY-OF-GETSEG-BACKCHAIN-PROOF (I '0)
                                                       (J J)
                                                       (K K)
                                                       (N '0)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN GETNTH2
      (I J L)
      (GETNTH J (GETNTH I L))
      NIL)

(DEFN PUTNTH2
      (V I J L)
      (PUTNTH (PUTNTH V J (GETNTH I L)) I L)
      NIL)

(PROVE-LEMMA PLISTP-PUTNTH2
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (PLISTP (PUTNTH2 V I J L)))
             ((ENABLE PUTNTH2 PLISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-PUTNTH2)

(PROVE-LEMMA LENGTH-PUTNTH2
             (REWRITE)
             (EQUAL (LENGTH (PUTNTH2 V I J L))
                    (LENGTH L))
             ((ENABLE PUTNTH2 LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-PUTNTH2)

(PROVE-LEMMA GETNTH-PUTNTH-COINCIDENCE1
             (REWRITE)
             (IMPLIES (AND (EQUAL (FIX I) (FIX J))
                           (LESSP I (LENGTH L)))
                      (EQUAL (GETNTH I (PUTNTH V J L)) V))
             ((ENABLE GETNTH PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PUTNTH-COINCIDENCE1)

(PROVE-LEMMA GETNTH2-PUTNTH2-COINCIDENCE
             (REWRITE)
             (IMPLIES (AND (LESSP I (LENGTH L))
                           (LESSP J (LENGTH (GETNTH I L))))
                      (EQUAL (GETNTH2 I J (PUTNTH2 V I J L))
                             V))
             ((ENABLE GETNTH2 PUTNTH2 LENGTH GETNTH-PUTNTH-COINCIDENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH2-PUTNTH2-COINCIDENCE)

(PROVE-LEMMA GETNTH2-PUTNTH2-NON-INTERFERENCE1
             (REWRITE)
             (IMPLIES (NOT (EQUAL (FIX I) (FIX X)))
                      (EQUAL (GETNTH2 I J (PUTNTH2 V X Y L))
                             (GETNTH2 I J L)))
             ((ENABLE GETNTH2 PUTNTH2 GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH2-PUTNTH2-NON-INTERFERENCE1)

(PROVE-LEMMA GETNTH2-PUTNTH2-NON-INTERFERENCE2
             (REWRITE)
             (IMPLIES (AND (EQUAL (FIX I) (FIX X))
                           (AND (LESSP I (LENGTH L))
                                (NOT (EQUAL (FIX J) (FIX Y)))))
                      (EQUAL (GETNTH2 I J (PUTNTH2 V X Y L))
                             (GETNTH2 I J L)))
             ((ENABLE GETNTH2 PUTNTH2 LENGTH GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-WITH-NON-NUMBER-INDEX
                      GETNTH-WITH-NON-NUMBER-INDEX GETNTH-PUTNTH-COINCIDENCE1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH2-PUTNTH2-NON-INTERFERENCE2)

(PROVE-LEMMA FIXLENGTH-OF-LENGTH-0
             (REWRITE)
             (IMPLIES (ZEROP N)
                      (EQUAL (FIXLENGTH N L X) 'NIL))
             ((ENABLE FIXLENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIXLENGTH-OF-LENGTH-0)

(PROVE-LEMMA FIXLENGTH-IDEMPOTENCE
             (REWRITE)
             (EQUAL (FIXLENGTH N (FIXLENGTH N L A) B)
                    (FIXLENGTH N L A))
             ((ENABLE FIXLENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIXLENGTH-IDEMPOTENCE)

(PROVE-LEMMA FIXLENGTH-NOOP
             (REWRITE)
             (IMPLIES (AND (PLISTP L) (EQUAL N (LENGTH L)))
                      (EQUAL (FIXLENGTH N L DEFAULT) L))
             ((ENABLE PLISTP FIXLENGTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIXLENGTH-NOOP)

(DEFN REVERSE
      (L)
      (IF (LISTP L)
          (APPEND (REVERSE (CDR L))
                  (CONS (CAR L) 'NIL))
          'NIL)
      NIL)

(PROVE-LEMMA PLISTP-REVERSE
             (REWRITE)
             (PLISTP (REVERSE A))
             ((ENABLE PLISTP REVERSE PLISTP-APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-REVERSE)

(PROVE-LEMMA REVERSE-APPEND
             (REWRITE)
             (EQUAL (REVERSE (APPEND A B))
                    (APPEND (REVERSE B) (REVERSE A)))
             ((ENABLE APPEND REVERSE ASSOCIATIVITY-OF-APPEND PLISTP-REVERSE
                      APPEND-NIL-ON-RIGHT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REVERSE-APPEND)

(PROVE-LEMMA REVERSE-LIST1
             (REWRITE)
             (EQUAL (REVERSE (CONS A 'NIL))
                    (CONS A 'NIL))
             ((ENABLE REVERSE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REVERSE-LIST1)

(PROVE-LEMMA REVERSE-LIST2
             (REWRITE)
             (EQUAL (REVERSE (CONS A (CONS A 'NIL)))
                    (CONS A (CONS A 'NIL)))
             ((ENABLE REVERSE APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REVERSE-LIST2)

(PROVE-LEMMA REVERSE-REVERSE
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (EQUAL (REVERSE (REVERSE L)) L))
             ((ENABLE PLISTP APPEND REVERSE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REVERSE-REVERSE)

(DEFN FINITE-NUMBERP
      (N LUB)
      (AND (NUMBERP N) (LESSP N LUB))
      NIL)

(DEFN NUMBER-LISTP
      (L)
      (IF (LISTP L)
          (AND (NUMBERP (CAR L))
               (NUMBER-LISTP (CDR L)))
          '*1*TRUE)
      NIL)

(DEFN FINITE-NUMBER-LISTP
      (L LUB)
      (IF (LISTP L)
          (AND (FINITE-NUMBERP (CAR L) LUB)
               (FINITE-NUMBER-LISTP (CDR L) LUB))
          '*1*TRUE)
      NIL)

(DEFN NON-ZERO-LISTP
      (L)
      (IF (LISTP L)
          (AND (NOT (ZEROP (CAR L)))
               (NON-ZERO-LISTP (CDR L)))
          '*1*TRUE)
      NIL)

(PROVE-LEMMA NON-1-FINITE-NUMBER-IS-ZERO NIL
             (IMPLIES (AND (FINITE-NUMBERP A '2)
                           (NOT (EQUAL A '1)))
                      (EQUAL A '0))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-MEMBER
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP B LUB)
                           (MEMBER X B))
                      (FINITE-NUMBERP X LUB))
             ((ENABLE FINITE-NUMBER-LISTP MEMBER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MEMBER)

(PROVE-LEMMA A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP N LUB)
                      (EQUAL (LESSP N LUB) '*1*TRUE))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)

(PROVE-LEMMA A-FINITE-NUMBER-IS-A-NUMBER
             NIL
             (IMPLIES (FINITE-NUMBERP N LUB)
                      (NUMBERP N))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-FROM-SMALLER-LUB
             NIL
             (IMPLIES (AND (FINITE-NUMBERP N I) (LESSP I J))
                      (FINITE-NUMBERP N J))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBER-SUB1
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP A B)
                      (FINITE-NUMBERP (SUB1 A) B))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-SUB1)

(PROVE-LEMMA FINITE-NUMBERP-REMAINDER
             (REWRITE)
             (IMPLIES (NOT (ZEROP B))
                      (FINITE-NUMBERP (REMAINDER A B) B))
             ((ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-REMAINDER)

(PROVE-LEMMA A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST
             NIL
             (IMPLIES (FINITE-NUMBER-LISTP L LUB)
                      (NUMBER-LISTP L))
             ((ENABLE FINITE-NUMBER-LISTP NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (LESSP I (LENGTH L)))
                      (FINITE-NUMBERP (GETNTH I L) LUB))
             ((ENABLE GETNTH LENGTH FINITE-NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-GETNTH)

(PROVE-LEMMA NUMBERP-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (LESSP I (LENGTH L)))
                      (NUMBERP (GETNTH I L)))
             ((ENABLE GETNTH LENGTH FINITE-NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-GETNTH)

(PROVE-LEMMA LESSP-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (LESSP I (LENGTH L)))
                      (EQUAL (LESSP (GETNTH I L) LUB)
                             '*1*TRUE))
             ((ENABLE GETNTH LENGTH FINITE-NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-GETNTH)

(PROVE-LEMMA LESSP-GETNTH-LINEAR
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (LESSP I (LENGTH L)))
                      (LESSP (GETNTH I L) LUB))
             ((ENABLE GETNTH LENGTH FINITE-NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-GETNTH-LINEAR)

(PROVE-LEMMA ELEMENT-OF-NON-ZERO-LIST-IS-A-NUMBER
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (LESSP I (LENGTH L)))
                      (NUMBERP (GETNTH I L)))
             ((ENABLE GETNTH LENGTH NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ELEMENT-OF-NON-ZERO-LIST-IS-A-NUMBER)

(PROVE-LEMMA ELEMENT-OF-NON-ZERO-LIST-IS-NON-ZERO
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (LESSP I (LENGTH L)))
                      (NOT (EQUAL (GETNTH I L) '0)))
             ((ENABLE GETNTH LENGTH NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ELEMENT-OF-NON-ZERO-LIST-IS-NON-ZERO)

(PROVE-LEMMA FINITE-NUMBER-LISTP-LIST
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP N LUB)
                      (FINITE-NUMBER-LISTP (CONS N 'NIL)
                                           LUB))
             ((ENABLE FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-LIST)

(PROVE-LEMMA FINITE-NUMBER-LISTP-APPEND
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP A LUB)
                           (FINITE-NUMBER-LISTP B LUB))
                      (FINITE-NUMBER-LISTP (APPEND A B)
                                           LUB))
             ((ENABLE APPEND FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-APPEND)

(PROVE-LEMMA FINITE-NUMBER-LISTP-REMOVE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-LISTP L LUB)
                      (FINITE-NUMBER-LISTP (REMOVE X L)
                                           LUB))
             ((ENABLE FINITE-NUMBER-LISTP REMOVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-REMOVE)

(PROVE-LEMMA FINITE-NUMBER-LISTP-PERMUTATION
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP B LUB)
                           (PERMUTATION A B))
                      (FINITE-NUMBER-LISTP A LUB))
             ((ENABLE PERMUTATION FINITE-NUMBER-LISTP-REMOVE
                      FINITE-NUMBERP-MEMBER FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-PERMUTATION)

(PROVE-LEMMA FINITE-NUMBER-LISTP-PUTNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (FINITE-NUMBERP V LUB))
                      (FINITE-NUMBER-LISTP (PUTNTH V N L)
                                           LUB))
             ((ENABLE PUTNTH FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-PUTNTH)

(PROVE-LEMMA FINITE-NUMBER-LISTP-GETSEG
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (IF (LESSP (LENGTH L) (PLUS N K))
                               '*1*FALSE
                               '*1*TRUE))
                      (FINITE-NUMBER-LISTP (GETSEG N K L)
                                           LUB))
             ((ENABLE GETSEG LENGTH FINITE-NUMBER-LISTP FINITE-NUMBERP-GETNTH)
              (INDUCT (GETSEG N K L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-GETSEG)

(PROVE-LEMMA FINITE-NUMBER-LISTP-PUTSEG
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (FINITE-NUMBER-LISTP S LUB))
                      (FINITE-NUMBER-LISTP (PUTSEG S N L)
                                           LUB))
             ((ENABLE PUTSEG FINITE-NUMBER-LISTP FINITE-NUMBER-LISTP-PUTNTH)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-PUTSEG)

(PROVE-LEMMA FINITE-NUMBER-LISTP-FIXLENGTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP L LUB)
                           (FINITE-NUMBERP DEFAULT LUB))
                      (FINITE-NUMBER-LISTP (FIXLENGTH N L DEFAULT)
                                           LUB))
             ((ENABLE FIXLENGTH FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-FIXLENGTH)

(PROVE-LEMMA FINITE-NUMBER-LISTP-FOR-ZERO-LIST
             (REWRITE)
             (IMPLIES (NOT (ZEROP LUB))
                      (FINITE-NUMBER-LISTP (FIXLENGTH N 'NIL '0)
                                           LUB))
             ((ENABLE FINITE-NUMBER-LISTP-FIXLENGTH FINITE-NUMBERP
                      FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-FOR-ZERO-LIST)

(PROVE-LEMMA FINITE-NUMBER-LISTP-FROM-SMALLER-LUB
             NIL
             (IMPLIES (AND (FINITE-NUMBER-LISTP L I)
                           (LESSP I J))
                      (FINITE-NUMBER-LISTP L J))
             ((ENABLE FINITE-NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA NON-ZERO-LISTP-LIST
             (REWRITE)
             (IMPLIES (NOT (ZEROP A))
                      (NON-ZERO-LISTP (CONS A 'NIL)))
             ((ENABLE NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-LIST)

(PROVE-LEMMA NON-ZERO-LISTP-APPEND
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP A)
                           (NON-ZERO-LISTP B))
                      (NON-ZERO-LISTP (APPEND A B)))
             ((ENABLE APPEND NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-APPEND)

(PROVE-LEMMA NON-ZERO-LISTP-PUTNTH
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (NOT (ZEROP V)))
                      (NON-ZERO-LISTP (PUTNTH V N L)))
             ((ENABLE PUTNTH NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-PUTNTH)

(PROVE-LEMMA NON-ZERO-LISTP-GETSEG
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (IF (LESSP (LENGTH L) (PLUS N K))
                               '*1*FALSE
                               '*1*TRUE))
                      (NON-ZERO-LISTP (GETSEG N K L)))
             ((ENABLE GETSEG LENGTH NON-ZERO-LISTP
                      ELEMENT-OF-NON-ZERO-LIST-IS-NON-ZERO
                      ELEMENT-OF-NON-ZERO-LIST-IS-A-NUMBER)
              (INDUCT (GETSEG N K L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-GETSEG)

(PROVE-LEMMA NON-ZERO-LISTP-PUTSEG
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (NON-ZERO-LISTP S))
                      (NON-ZERO-LISTP (PUTSEG S N L)))
             ((ENABLE PUTSEG NON-ZERO-LISTP NON-ZERO-LISTP-PUTNTH)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-PUTSEG)

(PROVE-LEMMA NON-ZERO-LISTP-FIXLENGTH
             (REWRITE)
             (IMPLIES (AND (NON-ZERO-LISTP L)
                           (NOT (ZEROP DEFAULT)))
                      (NON-ZERO-LISTP (FIXLENGTH N L DEFAULT)))
             ((ENABLE FIXLENGTH NON-ZERO-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-ZERO-LISTP-FIXLENGTH)

(PROVE-LEMMA CAR-NTHCDR
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH L))
                      (EQUAL (CAR (NTHCDR N L))
                             (GETNTH N L)))
             ((ENABLE GETNTH NTHCDR LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CAR-NTHCDR)

(PROVE-LEMMA CDR-NTHCDR
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH L))
                      (EQUAL (CDR (NTHCDR N L))
                             (NTHCDR (ADD1 N) L)))
             ((ENABLE NTHCDR LENGTH)
              (INDUCT (NTHCDR N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CDR-NTHCDR)

(PROVE-LEMMA LISTP-NTHCDR
             (REWRITE)
             (IMPLIES (LESSP N (LENGTH L))
                      (LISTP (NTHCDR N L)))
             ((ENABLE NTHCDR LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-NTHCDR)

(PROVE-LEMMA PLISTP-FIRSTN
             (REWRITE)
             (PLISTP (FIRSTN N L))
             ((ENABLE PLISTP FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FIRSTN)

(PROVE-LEMMA PLISTP-NTHCDR
             (REWRITE)
             (EQUAL (PLISTP (NTHCDR N L))
                    (PLISTP L))
             ((ENABLE NTHCDR PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-NTHCDR)

(PROVE-LEMMA LENGTH-FIRSTN
             (REWRITE)
             (IMPLIES (IF (LESSP (LENGTH L) N)
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (LENGTH (FIRSTN N L)) (FIX N)))
             ((ENABLE FIRSTN LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FIRSTN)

(PROVE-LEMMA LENGTH-NTHCDR
             (REWRITE)
             (EQUAL (LENGTH (NTHCDR N L))
                    (DIFFERENCE (LENGTH L) N))
             ((ENABLE NTHCDR LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-NTHCDR)

(PROVE-LEMMA FIRSTN-ZERO
             (REWRITE)
             (IMPLIES (ZEROP K)
                      (EQUAL (FIRSTN K L) 'NIL))
             ((ENABLE FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIRSTN-ZERO)

(PROVE-LEMMA NTHCDR-ZERO
             (REWRITE)
             (IMPLIES (ZEROP N)
                      (EQUAL (NTHCDR N L) L))
             ((ENABLE NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-ZERO)

(PROVE-LEMMA NTHCDR-WITH-LARGE-N
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (IF (LESSP N (LENGTH L))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (NTHCDR N L) 'NIL))
             ((ENABLE PLISTP NTHCDR LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-WITH-LARGE-N)

(PROVE-LEMMA FIRSTN-FOR-LENGTH
             (REWRITE)
             (IMPLIES (AND (PLISTP L) (EQUAL N (LENGTH L)))
                      (EQUAL (FIRSTN N L) L))
             ((ENABLE PLISTP FIRSTN LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIRSTN-FOR-LENGTH)

(PROVE-LEMMA APPEND-FIRSTN-NTHCDR
             (REWRITE)
             (EQUAL (APPEND (FIRSTN I L) (NTHCDR I L))
                    L)
             ((ENABLE APPEND FIRSTN NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE APPEND-FIRSTN-NTHCDR)

(PROVE-LEMMA FIRSTN-FIRSTN
             (REWRITE)
             (IMPLIES (LESSP I N)
                      (EQUAL (FIRSTN I (FIRSTN N L))
                             (FIRSTN I L)))
             ((ENABLE FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIRSTN-FIRSTN)

(PROVE-LEMMA FIRSTN-NTHCDR
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (EQUAL (FIRSTN (DIFFERENCE (LENGTH L) K)
                                     (NTHCDR K L))
                             (NTHCDR K L)))
             ((ENABLE LENGTH LENGTH-NTHCDR PLISTP-NTHCDR FIRSTN-FOR-LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIRSTN-NTHCDR)

(PROVE-LEMMA NTHCDR-APPEND-RIGHT
             (REWRITE)
             (IMPLIES (IF (LESSP N (LENGTH A))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (NTHCDR N (APPEND A B))
                             (NTHCDR (DIFFERENCE N (LENGTH A)) B)))
             ((INDUCT (NUMBER-AND-LIST-INDUCTION N A))
              (ENABLE NTHCDR APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-APPEND-RIGHT)

(PROVE-LEMMA NTHCDR-APPEND-LEFT
             (REWRITE)
             (IMPLIES (IF (LESSP (LENGTH A) N)
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (NTHCDR N (APPEND A B))
                             (APPEND (NTHCDR N A) B)))
             ((ENABLE NTHCDR APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-APPEND-LEFT)

(DEFN TABLEP
      (N L)
      (IF (LISTP L)
          (AND (PLISTP (CAR L))
               (AND (EQUAL (LENGTH (CAR L)) N)
                    (TABLEP N (CDR L))))
          (EQUAL L 'NIL))
      NIL)

(PROVE-LEMMA LENGTH-OF-NTHCDR-GOES-DOWN
             (REWRITE)
             (IMPLIES (AND (LISTP L) (NOT (ZEROP N)))
                      (EQUAL (LESSP (LENGTH (NTHCDR N L))
                                    (LENGTH L))
                             '*1*TRUE))
             ((ENABLE NTHCDR LENGTH SUB1-DIFFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OF-NTHCDR-GOES-DOWN)

(ENABLE LENGTH-OF-NTHCDR-GOES-DOWN)

(DEFN TABLE
      (N L)
      (IF (ZEROP N)
          L
          (IF (LISTP L)
              (CONS (GETSEG '0 N L)
                    (TABLE N (NTHCDR N L)))
              'NIL))
      ((LESSP (LENGTH L))))

(DISABLE LENGTH-OF-NTHCDR-GOES-DOWN)

(DEFN FLATTEN
      (TABLE)
      (IF (LISTP TABLE)
          (APPEND (CAR TABLE)
                  (FLATTEN (CDR TABLE)))
          'NIL)
      NIL)

(PROVE-LEMMA PLISTP-TABLE
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (PLISTP (TABLE N L)))
             ((ENABLE PLISTP TABLE PLISTP-NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TABLE)

(PROVE-LEMMA LENGTH-TABLE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (EQUAL (REMAINDER (LENGTH L) N) '0))
                      (EQUAL (LENGTH (TABLE N L))
                             (QUOTIENT (LENGTH L) N)))
             ((ENABLE TABLE LENGTH LENGTH-NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TABLE)

(PROVE-LEMMA TABLEP-TABLE
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (TABLEP N (TABLE N L)))
             ((ENABLE PLISTP-GETSEG LENGTH-GETSEG TABLE TABLEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLEP-TABLE)

(PROVE-LEMMA LENGTH-GETNTH-FROM-TABLE
             NIL
             (IMPLIES (AND (TABLEP N L)
                           (LESSP I (LENGTH L)))
                      (EQUAL (LENGTH (GETNTH I L)) N))
             ((ENABLE GETNTH LENGTH TABLEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PLISTP-GETNTH-FROM-TABLE NIL
             (IMPLIES (AND (TABLEP N L)
                           (LESSP I (LENGTH L)))
                      (PLISTP (GETNTH I L)))
             ((ENABLE GETNTH LENGTH TABLEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LENGTH-GETNTH-TABLE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (EQUAL (REMAINDER (LENGTH L) N) '0)
                                (LESSP I (QUOTIENT (LENGTH L) N))))
                      (EQUAL (LENGTH (GETNTH I (TABLE N L)))
                             N))
             ((ENABLE LENGTH TABLEP-TABLE LENGTH-TABLE)
              (USE (LENGTH-GETNTH-FROM-TABLE (I I)
                                             (N N)
                                             (L (TABLE N L))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-GETNTH-TABLE)

(PROVE-LEMMA PLISTP-GETNTH-TABLE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (EQUAL (REMAINDER (LENGTH L) N) '0)
                                (LESSP I (QUOTIENT (LENGTH L) N))))
                      (PLISTP (GETNTH I (TABLE N L))))
             ((ENABLE LENGTH TABLEP-TABLE LENGTH-TABLE)
              (USE (PLISTP-GETNTH-FROM-TABLE (I I)
                                             (N N)
                                             (L (TABLE N L))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GETNTH-TABLE)

(PROVE-LEMMA GETSEG-EQUALS-FIRSTN-NTHCDR
             (REWRITE)
             (IMPLIES (AND (IF (LESSP (LENGTH L) N)
                               '*1*FALSE
                               '*1*TRUE)
                           (IF (LESSP (DIFFERENCE (LENGTH L) N) K)
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (GETSEG N K L)
                             (FIRSTN K (NTHCDR N L))))
             ((ENABLE GETSEG GETNTH FIRSTN NTHCDR LENGTH CAR-NTHCDR CDR-NTHCDR
                      LISTP-NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-EQUALS-FIRSTN-NTHCDR)

(PROVE-LEMMA GETSEG-FOR-LENGTH
             (REWRITE)
             (IMPLIES (AND (PLISTP L) (EQUAL K (LENGTH L)))
                      (EQUAL (GETSEG '0 K L) L))
             ((ENABLE LENGTH GETSEG-EQUALS-FIRSTN-NTHCDR NTHCDR-ZERO
                      FIRSTN-FOR-LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-FOR-LENGTH)

(PROVE-LEMMA PLISTP-FLATTEN
             (REWRITE)
             (PLISTP (FLATTEN TABLE))
             ((ENABLE PLISTP FLATTEN PLISTP-APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FLATTEN)

(PROVE-LEMMA LENGTH-FLATTEN
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N)) (TABLEP N L))
                      (EQUAL (LENGTH (FLATTEN L))
                             (TIMES (LENGTH L) N)))
             ((ENABLE LENGTH TABLEP FLATTEN LENGTH-APPEND TIMES-ADD1
                      PLUS-TIMES-SUB1-REDUCTION COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FLATTEN)

(PROVE-LEMMA TABLE-APPEND
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (EQUAL (REMAINDER (LENGTH A) N) '0))
                      (EQUAL (TABLE N (APPEND A B))
                             (APPEND (TABLE N A) (TABLE N B))))
             ((ENABLE TABLE APPEND LENGTH GETSEG-APPEND-LEFT LENGTH-NTHCDR
                      LISTP-APPEND-LEFT LISTP-IMPLIES-NON-ZERO-LENGTH
                      NTHCDR-APPEND-LEFT)
              (EXPAND (TABLE N (APPEND A B)))
              (INDUCT (TABLE N A))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-APPEND)

(PROVE-LEMMA NTHCDR-FOR-LENGTH
             (REWRITE)
             (IMPLIES (PLISTP L)
                      (EQUAL (NTHCDR (LENGTH L) L) 'NIL))
             ((ENABLE PLISTP NTHCDR LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-FOR-LENGTH)

(PROVE-LEMMA TABLE-FOR-LENGTH
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (NOT (ZEROP (LENGTH L))))
                      (EQUAL (TABLE (LENGTH L) L)
                             (CONS L 'NIL)))
             ((ENABLE LENGTH TABLE GETSEG-FOR-LENGTH NTHCDR-FOR-LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-FOR-LENGTH)

(PROVE-LEMMA TABLE-FLATTEN
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N)) (TABLEP N TABLE))
                      (EQUAL (TABLE N (FLATTEN TABLE))
                             TABLE))
             ((ENABLE TABLEP TABLE FLATTEN APPEND PLISTP-FLATTEN
                      TABLE-FOR-LENGTH REMAINDER-X-X TABLE-APPEND)
              (INDUCT (TABLEP N TABLE))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-FLATTEN)

(PROVE-LEMMA LISTP-TABLE
             (REWRITE)
             (IMPLIES (NOT (ZEROP N))
                      (EQUAL (LISTP (TABLE N L)) (LISTP L)))
             ((ENABLE TABLE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LISTP-TABLE)

(DEFN INTEGER-NTHCDR-INDUCTION
      (I N L)
      (IF (ZEROP N)
          '0
          (IF (LISTP L)
              (IF (ZEROP I)
                  '0
                  (INTEGER-NTHCDR-INDUCTION (SUB1 I)
                                            N
                                            (NTHCDR N L)))
              '0))
      NIL)

(PROVE-LEMMA GETNTH-NTHCDR
             (REWRITE)
             (EQUAL (GETNTH I (NTHCDR N L))
                    (GETNTH (PLUS N I) L))
             ((ENABLE GETNTH NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-NTHCDR)

(PROVE-LEMMA GETSEG-NTHCDR-PROOF
             (REWRITE)
             (IMPLIES (NUMBERP I)
                      (EQUAL (GETSEG I K (NTHCDR N L))
                             (GETSEG (PLUS N I) K L)))
             ((ENABLE GETSEG GETNTH-NTHCDR PLUS-ADD1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-NTHCDR-PROOF)

(PROVE-LEMMA GETSEG-NTHCDR
             (REWRITE)
             (EQUAL (GETSEG I K (NTHCDR N L))
                    (GETSEG (PLUS N I) K L))
             ((USE (NUMBERP-CASESPLIT (A I))
                   (GETSEG-NTHCDR-PROOF (I I)
                                        (K K)
                                        (N N)
                                        (L L))
                   (GETSEG-NTHCDR-PROOF (I '0)
                                        (K K)
                                        (N N)
                                        (L L)))
              (ENABLE GETSEG-WITH-NON-NUMBER-INDEX PLUS-RIGHT-ID2 PLUS-0)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-NTHCDR)

(PROVE-LEMMA GETNTH-TABLE
             (REWRITE)
             (IMPLIES (AND (LESSP (TIMES I N) (LENGTH L))
                           (NOT (ZEROP N)))
                      (EQUAL (GETNTH I (TABLE N L))
                             (GETSEG (TIMES I N) N L)))
             ((ENABLE TABLE GETNTH LENGTH GETSEG-NTHCDR LENGTH-NTHCDR
                      LENGTH-OF-NTHCDR-GOES-DOWN LISTP-TABLE
                      NON-ZERO-LENGTH-IMPLIES-LISTP)
              (INDUCT (INTEGER-NTHCDR-INDUCTION I N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-TABLE)

(PROVE-LEMMA GETNTH-TABLE-INVERSE
             (REWRITE)
             (IMPLIES (AND (LESSP (TIMES I N) (LENGTH L))
                           (NOT (ZEROP N)))
                      (EQUAL (GETSEG (TIMES I N) N L)
                             (GETNTH I (TABLE N L))))
             ((ENABLE LENGTH GETNTH-TABLE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-TABLE-INVERSE)

(PROVE-LEMMA REWRITE-GETNTH-FROM-TABLE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (LESSP I N)
                                (IF (LESSP (LENGTH L)
                                           (PLUS N (TIMES N J)))
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (GETNTH (PLUS I (TIMES N J)) L)
                             (GETNTH I (GETNTH J (TABLE N L)))))
             ((ENABLE GETNTH TABLE LENGTH COMMUTATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES GETNTH-GETSEG GETNTH-NTHCDR
                      GETNTH-WITH-NON-NUMBER-INDEX LENGTH-NTHCDR
                      NON-ZERO-LENGTH-IMPLIES-LISTP OPEN-UP-GETNTH-ON-ZERO
                      PLUS-COMMUTATIVITY-ASSOCIATIVITY-CROCK)
              (EXPAND (TABLE N L))
              (INDUCT (INTEGER-NTHCDR-INDUCTION J N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-GETNTH-FROM-TABLE)

(PROVE-LEMMA REWRITE-GETNTH-FROM-TABLE0
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (IF (LESSP (LENGTH L)
                                      (PLUS N (TIMES N J)))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (GETNTH (TIMES N J) L)
                             (GETNTH '0 (GETNTH J (TABLE N L)))))
             ((ENABLE LENGTH)
              (USE (REWRITE-GETNTH-FROM-TABLE (I '0)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-GETNTH-FROM-TABLE0)

(PROVE-LEMMA NTHCDR-NTHCDR
             (REWRITE)
             (EQUAL (NTHCDR I (NTHCDR J L))
                    (NTHCDR (PLUS J I) L))
             ((DISABLE COMMUTATIVITY-OF-PLUS)
              (ENABLE NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-NTHCDR)

(PROVE-LEMMA PUTNTH-NTHCDR
             (REWRITE)
             (EQUAL (PUTNTH V I (NTHCDR N L))
                    (NTHCDR N (PUTNTH V (PLUS N I) L)))
             ((ENABLE PUTNTH NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTNTH-NTHCDR)

(PROVE-LEMMA PUTSEG-NTHCDR-PROOF
             (REWRITE)
             (IMPLIES (NUMBERP I)
                      (EQUAL (PUTSEG S I (NTHCDR N L))
                             (NTHCDR N (PUTSEG S (PLUS N I) L))))
             ((ENABLE PUTSEG PUTNTH-NTHCDR PLUS-ADD1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-NTHCDR-PROOF)

(PROVE-LEMMA PUTSEG-NTHCDR
             (REWRITE)
             (EQUAL (PUTSEG S I (NTHCDR N L))
                    (NTHCDR N (PUTSEG S (PLUS N I) L)))
             ((USE (NUMBERP-CASESPLIT (A I))
                   (PUTSEG-NTHCDR-PROOF (I I)
                                        (S S)
                                        (N N)
                                        (L L))
                   (PUTSEG-NTHCDR-PROOF (I '0)
                                        (S S)
                                        (N N)
                                        (L L)))
              (ENABLE PUTSEG-WITH-NON-NUMBER-INDEX PLUS-0 PLUS-RIGHT-ID2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PUTSEG-NTHCDR)

(PROVE-LEMMA NTHCDR-PUTNTH
             (REWRITE)
             (IMPLIES (LESSP N I)
                      (EQUAL (NTHCDR I (PUTNTH V N L))
                             (NTHCDR I L)))
             ((ENABLE NTHCDR PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-PUTNTH)

(PROVE-LEMMA NTHCDR-PUTSEG
             (REWRITE)
             (IMPLIES (IF (LESSP I (PLUS N (LENGTH S)))
                          '*1*FALSE
                          '*1*TRUE)
                      (EQUAL (NTHCDR I (PUTSEG S N L))
                             (NTHCDR I L)))
             ((ENABLE LENGTH PUTSEG NTHCDR-PUTNTH)
              (INDUCT (PUTSEG S N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NTHCDR-PUTSEG)

(PROVE-LEMMA TABLE-PUTSEG-SUBCASE
             (REWRITE)
             (IMPLIES (AND (PLISTP S)
                           (AND (NOT (ZEROP (LENGTH S)))
                                (IF (LESSP (LENGTH L) (LENGTH S))
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (TABLE (LENGTH S) (PUTSEG S '0 L))
                             (CONS S
                                   (TABLE (LENGTH S)
                                          (NTHCDR (LENGTH S) L)))))
             ((ENABLE LISTP-PUTSEG TABLE LENGTH GETSEG-WITHIN-PUTSEG
                      GETSEG-FOR-LENGTH NTHCDR-PUTSEG)
              (EXPAND (TABLE (LENGTH S) (PUTSEG S 0 L)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-PUTSEG-SUBCASE)

(PROVE-LEMMA TABLE-PUTSEG
             (REWRITE)
             (IMPLIES (AND (PLISTP S)
                           (AND (EQUAL (LENGTH S) N)
                                (AND (NOT (ZEROP N))
                                     (IF (LESSP (LENGTH L)
                                                (PLUS (TIMES N I) (LENGTH S)))
                                         '*1*FALSE
                                         '*1*TRUE))))
                      (EQUAL (TABLE N (PUTSEG S (TIMES N I) L))
                             (PUTNTH S I (TABLE N L))))
             ((INDUCT (INTEGER-NTHCDR-INDUCTION I N L))
              (ENABLE TABLE PUTSEG PUTNTH LENGTH ASSOCIATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETSEG-BEFORE-PUTSEG LENGTH-NTHCDR LISTP-PUTSEG
                      LISTP-TABLE NON-ZERO-LENGTH-IMPLIES-LISTP PUTSEG-NTHCDR
                      TABLE-PUTSEG-SUBCASE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-PUTSEG)

(PROVE-LEMMA TABLE-PUTSEG-INVERSE
             (REWRITE)
             (IMPLIES (AND (PLISTP S)
                           (AND (EQUAL (LENGTH S) N)
                                (AND (NOT (ZEROP N))
                                     (IF (LESSP (LENGTH L)
                                                (PLUS (TIMES N I) (LENGTH S)))
                                         '*1*FALSE
                                         '*1*TRUE))))
                      (EQUAL (PUTNTH S I (TABLE N L))
                             (TABLE N (PUTSEG S (TIMES N I) L))))
             ((ENABLE TABLE-PUTSEG LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TABLE-PUTSEG-INVERSE)

(PROVE-LEMMA
           TABLE-PUTNTH
           (REWRITE)
           (IMPLIES (AND (NOT (ZEROP N))
                         (AND (NUMBERP I)
                              (AND (LESSP I (LENGTH L))
                                   (EQUAL (REMAINDER (LENGTH L) N)
                                          '0))))
                    (EQUAL (TABLE N (PUTNTH V I L))
                           (PUTNTH (PUTNTH V
                                           (REMAINDER I N)
                                           (GETNTH (QUOTIENT I N) (TABLE N L)))
                                   (QUOTIENT I N)
                                   (TABLE N L))))
           ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-GETSEG
                    LENGTH-PUTNTH LESSP-REMAINDER2 LESSP-TIMES-QUOTIENT
                    NOT-LESSP-PLUS-TIMES-QUOTIENT PLISTP-GETSEG PLISTP-PUTNTH
                    PUTNTH-PUTSEG-COINCIDENCE-INVERSE
                    PUTSEG-GETSEG-COINCIDENCE REMAINDER-QUOTIENT
                    TABLE-PUTSEG-INVERSE)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TABLE-PUTNTH)

(DEFN FINITE-NUMBER-TABLEP
      (N L LUB)
      (IF (LISTP L)
          (AND (PLISTP (CAR L))
               (AND (FINITE-NUMBER-LISTP (CAR L) LUB)
                    (AND (EQUAL (LENGTH (CAR L)) N)
                         (FINITE-NUMBER-TABLEP N
                                               (CDR L)
                                               LUB))))
          (EQUAL L 'NIL))
      NIL)

(PROVE-LEMMA A-FINITE-NUMBER-TABLE-IS-A-TABLE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-TABLEP N L LUB)
                      (TABLEP N L))
             ((ENABLE FINITE-NUMBER-TABLEP TABLEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE A-FINITE-NUMBER-TABLE-IS-A-TABLE)

(PROVE-LEMMA FINITE-NUMBER-LISTP-NIL
             (REWRITE)
             (FINITE-NUMBER-LISTP 'NIL LUB)
             ((ENABLE FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-NIL)

(PROVE-LEMMA FINITE-NUMBER-LISTP-FLATTEN
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (FINITE-NUMBER-TABLEP N L LUB))
                      (FINITE-NUMBER-LISTP (FLATTEN L) LUB))
             ((ENABLE FINITE-NUMBER-TABLEP FLATTEN FINITE-NUMBER-LISTP-NIL
                      FINITE-NUMBER-LISTP-APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-FLATTEN)

(PROVE-LEMMA FINITE-NUMBER-TABLEP-LIST
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (AND (EQUAL (LENGTH L) N)
                                (FINITE-NUMBER-LISTP L LUB)))
                      (FINITE-NUMBER-TABLEP N
                                            (CONS L 'NIL)
                                            LUB))
             ((ENABLE LENGTH FINITE-NUMBER-TABLEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-TABLEP-LIST)

(PROVE-LEMMA FINITE-NUMBER-TABLEP-APPEND
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-TABLEP N L1 LUB)
                           (FINITE-NUMBER-TABLEP N L2 LUB))
                      (FINITE-NUMBER-TABLEP N
                                            (APPEND L1 L2)
                                            LUB))
             ((ENABLE FINITE-NUMBER-TABLEP APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-TABLEP-APPEND)

(PROVE-LEMMA GETNTH-PLUS-1-IS-CADR-NTHCDR
             (REWRITE)
             (EQUAL (GETNTH (PLUS '1 N) L)
                    (CAR (CDR (NTHCDR N L))))
             ((ENABLE GETNTH NTHCDR PLUS-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PLUS-1-IS-CADR-NTHCDR)

(PROVE-LEMMA CADR-FIRSTN
             (REWRITE)
             (IMPLIES (LESSP '1 N)
                      (EQUAL (CAR (CDR (FIRSTN N L)))
                             (CAR (CDR L))))
             ((ENABLE FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CADR-FIRSTN)

(PROVE-LEMMA GETNTH-PLUS-1-IS-CADR-GETSEG
             NIL
             (IMPLIES (AND (LESSP '1 K)
                           (AND (IF (LESSP (LENGTH L) N)
                                    '*1*FALSE
                                    '*1*TRUE)
                                (IF (LESSP (DIFFERENCE (LENGTH L) N) K)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (GETNTH (PLUS '1 N) L)
                             (CAR (CDR (GETSEG N K L)))))
             ((ENABLE GETSEG-EQUALS-FIRSTN-NTHCDR CADR-FIRSTN
                      GETNTH-PLUS-1-IS-CADR-NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GETNTH-PLUS-1-IS-CADR-GETSEG-INVERSE
             (REWRITE)
             (IMPLIES (AND (LESSP '1 K)
                           (AND (IF (LESSP (LENGTH L) N)
                                    '*1*FALSE
                                    '*1*TRUE)
                                (IF (LESSP (DIFFERENCE (LENGTH L) N) K)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (EQUAL (CAR (CDR (GETSEG N K L)))
                             (GETNTH (PLUS '1 N) L)))
             ((USE (GETNTH-PLUS-1-IS-CADR-GETSEG))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-PLUS-1-IS-CADR-GETSEG-INVERSE)

(PROVE-LEMMA FIRSTN-FIXLENGTH
             (REWRITE)
             (IMPLIES (AND (IF (LESSP N I) '*1*FALSE '*1*TRUE)
                           (IF (LESSP (LENGTH L) I)
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (FIRSTN I (FIXLENGTH N L DEFAULT))
                             (FIRSTN I L)))
             ((ENABLE FIRSTN FIXLENGTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FIRSTN-FIXLENGTH)

(PROVE-LEMMA GETSEG-FIXLENGTH
             (REWRITE)
             (IMPLIES (AND (PLISTP L)
                           (AND (NOT (ZEROP N))
                                (LESSP (LENGTH L) N)))
                      (EQUAL (GETSEG '0
                                     (LENGTH L)
                                     (FIXLENGTH N L DEFAULT))
                             (GETSEG '0 (LENGTH L) L)))
             ((ENABLE LENGTH FIRSTN-FIXLENGTH FIRSTN-FOR-LENGTH
                      GETSEG-EQUALS-FIRSTN-NTHCDR GETSEG-FOR-LENGTH
                      LENGTH-FIXLENGTH NTHCDR-ZERO)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETSEG-FIXLENGTH)

(PROVE-LEMMA NUMBER-LISTP-FINITE-NUMBER-LISTP
             NIL
             (IMPLIES (FINITE-NUMBER-LISTP L LUB)
                      (NUMBER-LISTP L))
             ((ENABLE FINITE-NUMBER-LISTP NUMBER-LISTP FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN NONLAST
      (L)
      (GETSEG '0 (SUB1 (LENGTH L)) L)
      NIL)

(PROVE-LEMMA LENGTH-NONLAST
             (REWRITE)
             (EQUAL (LENGTH (NONLAST L))
                    (SUB1 (LENGTH L)))
             ((ENABLE NONLAST LENGTH LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-NONLAST)

(PROVE-LEMMA PLISTP-NONLAST
             (REWRITE)
             (PLISTP (NONLAST L))
             ((ENABLE PLISTP-GETSEG NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-NONLAST)

(PROVE-LEMMA FINITE-NUMBER-LISTP-NONLAST
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-LISTP L LUB)
                      (FINITE-NUMBER-LISTP (NONLAST L) LUB))
             ((ENABLE FINITE-NUMBER-LISTP-GETSEG NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-NONLAST)

(PROVE-LEMMA DIFFERENCE-SUB1-PLUS-CROCK
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A)) (NOT (ZEROP B)))
                      (EQUAL (DIFFERENCE (SUB1 (PLUS A B)) A)
                             (SUB1 B)))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-SUB1-PLUS-CROCK)

(PROVE-LEMMA NONLAST-APPEND
             (REWRITE)
             (IMPLIES (PLISTP A)
                      (EQUAL (NONLAST (APPEND A B))
                             (IF (EQUAL (LENGTH B) '0)
                                 (NONLAST A)
                                 (APPEND A (NONLAST B)))))
             ((ENABLE NONLAST LENGTH LENGTH-APPEND PLUS-0-ARG1 PLUS-0
                      GETSEG-APPEND-LEFT DIFFERENCE-SUB1-PLUS-CROCK
                      GETSEG-FOR-LENGTH APPEND-NON-LIST-LEFT
                      GETSEG-OF-LENGTH-ZERO GETSEG-ACROSS-APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NONLAST-APPEND)

(DEFN INCR-MOD
      (N LUB)
      (IF (LESSP (ADD1 N) LUB) (ADD1 N) '0)
      NIL)

(DEFN DECR-MOD
      (N LUB)
      (IF (ZEROP N) (SUB1 LUB) (SUB1 N))
      NIL)

(PROVE-LEMMA DECR-MOD-SIZE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N)) (LESSP A N))
                      (LESSP (DECR-MOD A N) N))
             ((ENABLE DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DECR-MOD-SIZE)

(PROVE-LEMMA INCR-MOD-EQUALS-REMAINDER-ADD1
             (REWRITE)
             (IMPLIES (LESSP N LUB)
                      (EQUAL (INCR-MOD N LUB)
                             (REMAINDER (ADD1 N) LUB)))
             ((ENABLE INCR-MOD REMAINDER-NOOP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE INCR-MOD-EQUALS-REMAINDER-ADD1)

(PROVE-LEMMA INCR-MOD-DECR-MOD
             (REWRITE)
             (IMPLIES (LESSP N LUB)
                      (EQUAL (INCR-MOD (DECR-MOD N LUB) LUB)
                             (FIX N)))
             ((ENABLE INCR-MOD DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE INCR-MOD-DECR-MOD)

(PROVE-LEMMA LESSP-INCR-MOD
             (REWRITE)
             (IMPLIES (LESSP N LUB)
                      (LESSP (INCR-MOD N LUB) LUB))
             ((ENABLE INCR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-INCR-MOD)

(DEFN QFIRST (TABLE) (CAR TABLE) NIL)

(DEFN ENQ
      (ITEM TABLE)
      (APPEND TABLE (CONS ITEM 'NIL))
      NIL)

(DEFN DEQ (TABLE) (CDR TABLE) NIL)

(DEFN QEMPTYP
      (TABLE)
      (EQUAL (LENGTH TABLE) '0)
      NIL)

(DEFN QFULLP
      (TABLE MAX)
      (NOT (LESSP (LENGTH TABLE) MAX))
      NIL)

(DEFN QREPLACE
      (ITEM QUEUE)
      (ENQ ITEM (NONLAST QUEUE))
      NIL)

(PROVE-LEMMA PLISTP-ENQ
             (REWRITE)
             (PLISTP (ENQ ITEM L))
             ((ENABLE ENQ PLISTP-APPEND PLISTP-LIST1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ENQ)

(PROVE-LEMMA PLISTP-DEQ
             (REWRITE)
             (IMPLIES (AND (PLISTP QUEUE)
                           (NOT (QEMPTYP QUEUE)))
                      (PLISTP (DEQ QUEUE)))
             ((ENABLE PLISTP QEMPTYP DEQ LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-DEQ)

(PROVE-LEMMA PLISTP-QREPLACE
             (REWRITE)
             (PLISTP (QREPLACE ITEM QUEUE))
             ((ENABLE QREPLACE PLISTP-ENQ PLISTP-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-QREPLACE)

(PROVE-LEMMA LENGTH-ENQ
             (REWRITE)
             (EQUAL (LENGTH (ENQ ITEM QUEUE))
                    (ADD1 (LENGTH QUEUE)))
             ((ENABLE ENQ LENGTH LENGTH-APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ENQ)

(PROVE-LEMMA LENGTH-NON-EMPTY-QUEUE
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (NOT (EQUAL (LENGTH QUEUE) '0)))
             ((ENABLE QEMPTYP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-NON-EMPTY-QUEUE)

(PROVE-LEMMA LENGTH-DEQ
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (EQUAL (LENGTH (DEQ QUEUE))
                             (SUB1 (LENGTH QUEUE))))
             ((ENABLE QEMPTYP DEQ LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-DEQ)

(PROVE-LEMMA LENGTH-QREPLACE
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (EQUAL (LENGTH (QREPLACE ITEM QUEUE))
                             (LENGTH QUEUE)))
             ((ENABLE LENGTH LENGTH-NONLAST QREPLACE QEMPTYP
                      NON-ZERO-LENGTH-IMPLIES-LISTP LENGTH-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-QREPLACE)

(PROVE-LEMMA NOT-QEMPTYP-ENQ
             (REWRITE)
             (NOT (QEMPTYP (ENQ ITEM QUEUE)))
             ((ENABLE ENQ QEMPTYP LENGTH-APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-QEMPTYP-ENQ)

(PROVE-LEMMA NOT-QFULLP-DEQ
             (REWRITE)
             (IMPLIES (AND (IF (LESSP N (LENGTH QUEUE))
                               '*1*FALSE
                               '*1*TRUE)
                           (NOT (QEMPTYP QUEUE)))
                      (NOT (QFULLP (DEQ QUEUE) N)))
             ((ENABLE QFULLP DEQ QEMPTYP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-QFULLP-DEQ)

(PROVE-LEMMA QFIRST-ENQ
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (EQUAL (QFIRST (ENQ X QUEUE))
                             (QFIRST QUEUE)))
             ((ENABLE QFIRST QEMPTYP ENQ CAR-APPEND LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QFIRST-ENQ)

(PROVE-LEMMA FINITE-NUMBER-LISTP-ENQ
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP QUEUE LUB)
                           (FINITE-NUMBERP ITEM LUB))
                      (FINITE-NUMBER-LISTP (ENQ ITEM QUEUE)
                                           LUB))
             ((ENABLE ENQ FINITE-NUMBER-LISTP-APPEND FINITE-NUMBER-LISTP-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-ENQ)

(PROVE-LEMMA FINITE-NUMBER-LISTP-DEQ
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP QUEUE LUB)
                           (NOT (QEMPTYP QUEUE)))
                      (FINITE-NUMBER-LISTP (DEQ QUEUE) LUB))
             ((ENABLE DEQ FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-DEQ)

(PROVE-LEMMA FINITE-NUMBER-LISTP-QREPLACE
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP QUEUE LUB)
                           (FINITE-NUMBERP ITEM LUB))
                      (FINITE-NUMBER-LISTP (QREPLACE ITEM QUEUE)
                                           LUB))
             ((ENABLE QREPLACE FINITE-NUMBER-LISTP-NONLAST
                      FINITE-NUMBER-LISTP-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-QREPLACE)

(PROVE-LEMMA FINITE-NUMBERP-QFIRST
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP QUEUE LUB)
                           (NOT (QEMPTYP QUEUE)))
                      (FINITE-NUMBERP (QFIRST QUEUE) LUB))
             ((ENABLE LENGTH FINITE-NUMBER-LISTP QEMPTYP QFIRST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-QFIRST)

(PROVE-LEMMA NUMBERP-QFIRST
             (REWRITE)
             (IMPLIES (AND (NOT (QEMPTYP QUEUE))
                           (NUMBER-LISTP QUEUE))
                      (NUMBERP (QFIRST QUEUE)))
             ((ENABLE QEMPTYP NUMBER-LISTP QFIRST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-QFIRST)

(PROVE-LEMMA DEQ-IS-REMOVE
             (REWRITE)
             (IMPLIES (AND (SETP L) (LESSP '0 (LENGTH L)))
                      (EQUAL (DEQ L) (REMOVE (QFIRST L) L)))
             ((ENABLE SETP DEQ REMOVE QFIRST LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DEQ-IS-REMOVE)

(PROVE-LEMMA MEMBER-QFIRST-QUEUE
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (MEMBER (QFIRST QUEUE) QUEUE))
             ((ENABLE QEMPTYP QFIRST MEMBER LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MEMBER-QFIRST-QUEUE)

(PROVE-LEMMA PERMUTATION-ENQ-DEQ
             (REWRITE)
             (IMPLIES (NOT (QEMPTYP QUEUE))
                      (PERMUTATION (ENQ (QFIRST QUEUE) (DEQ QUEUE))
                                   QUEUE))
             ((ENABLE QEMPTYP QFIRST ENQ DEQ LENGTH PERMUTATION-APPEND-CAR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-ENQ-DEQ)

(DEFN QHEAD-FIELD NIL '0 NIL)

(DEFN QTAIL-FIELD NIL '1 NIL)

(DEFN QCURRLENGTH-FIELD NIL '2 NIL)

(DEFN QMAXLENGTH-FIELD NIL '3 NIL)

(DEFN QARRAY-FIELD NIL '4 NIL)

(DEFN DELTA
      (A B MAX)
      (IF (IF (LESSP A B) '*1*FALSE '*1*TRUE)
          (PLUS (DIFFERENCE MAX A) B)
          (DIFFERENCE B A))
      NIL)

(PROVE-LEMMA DELTA-A-A
             (REWRITE)
             (IMPLIES (LESSP A MAX)
                      (EQUAL (DELTA A A MAX) MAX))
             ((ENABLE DELTA DIFFERENCE-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-A-A)

(PROVE-LEMMA DELTA-INCR-MOD-A
             (REWRITE)
             (IMPLIES (AND (LESSP A MAX) (LESSP B MAX))
                      (EQUAL (DELTA (INCR-MOD A MAX) B MAX)
                             (IF (EQUAL (DELTA A B MAX) '1)
                                 MAX
                                 (SUB1 (DELTA A B MAX)))))
             ((ENABLE DELTA INCR-MOD DIFFERENCE-PLUS2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-INCR-MOD-A)

(PROVE-LEMMA DELTA-INCR-MOD-B
             (REWRITE)
             (IMPLIES (AND (LESSP A MAX) (LESSP B MAX))
                      (EQUAL (DELTA A (INCR-MOD B MAX) MAX)
                             (IF (EQUAL (FIX A) (FIX B))
                                 '1
                                 (ADD1 (DELTA A B MAX)))))
             ((ENABLE DELTA INCR-MOD COMMUTATIVITY-OF-PLUS DIFFERENCE-PLUS2
                      DIFFERENCE-DIFFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-INCR-MOD-B)

(PROVE-LEMMA DELTA-EQUALS-MAX-IFF-A-EQUALS-B
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (AND (LESSP A MAX) (LESSP B MAX))))
                      (EQUAL (EQUAL (DELTA A B MAX) MAX)
                             (EQUAL A B)))
             ((ENABLE DELTA)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-EQUALS-MAX-IFF-A-EQUALS-B)

(PROVE-LEMMA LEQ-DELTA
             NIL
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (AND (LESSP A MAX) (LESSP B MAX))))
                      (IF (LESSP MAX (DELTA A B MAX))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE DELTA)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN ARRAY-QINDEX-RELATION
      (QUEUE)
      (EQUAL (DELTA (GETNTH '0 QUEUE)
                    (GETNTH '1 QUEUE)
                    (GETNTH '3 QUEUE))
             (IF (ZEROP (GETNTH '2 QUEUE))
                 (GETNTH '3 QUEUE)
                 (GETNTH '2 QUEUE)))
      NIL)

(DEFN ARRAY-QUEUEP
 (QUEUE)
 (AND
  (PLISTP QUEUE)
  (AND
      (EQUAL (LENGTH QUEUE)
             (PLUS '4 (GETNTH '3 QUEUE)))
      (AND (NUMBERP (GETNTH '0 QUEUE))
           (AND (NUMBERP (GETNTH '1 QUEUE))
                (AND (NUMBERP (GETNTH '2 QUEUE))
                     (AND (NOT (ZEROP (GETNTH '3 QUEUE)))
                          (AND (LESSP (GETNTH '0 QUEUE)
                                      (GETNTH '3 QUEUE))
                               (AND (LESSP (GETNTH '1 QUEUE)
                                           (GETNTH '3 QUEUE))
                                    (AND (LESSP (GETNTH '2 QUEUE)
                                                (ADD1 (GETNTH '3 QUEUE)))
                                         (ARRAY-QINDEX-RELATION QUEUE))))))))))
 NIL)

(PROVE-LEMMA PLISTP-ARRAY-QUEUE
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (PLISTP QUEUE))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-QUEUE)

(PROVE-LEMMA LENGTH-ARRAY-QUEUE
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (LENGTH QUEUE)
                             (PLUS '4 (GETNTH '3 QUEUE))))
             ((ENABLE ARRAY-QUEUEP LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-QUEUE)

(PROVE-LEMMA NUMBERP-QHEAD
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NUMBERP (GETNTH '0 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-QHEAD)

(PROVE-LEMMA NUMBERP-QTAIL
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NUMBERP (GETNTH '1 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-QTAIL)

(PROVE-LEMMA NUMBERP-QCURRLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NUMBERP (GETNTH '2 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-QCURRLENGTH)

(PROVE-LEMMA NUMBERP-QMAXLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NUMBERP (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-QMAXLENGTH)

(PROVE-LEMMA QMAXLENGTH-NON-ZERO
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NOT (EQUAL (GETNTH '3 QUEUE) '0)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QMAXLENGTH-NON-ZERO)

(PROVE-LEMMA QMAXLENGTH-GREATER-THAN-ZERO
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (LESSP '0 (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QMAXLENGTH-GREATER-THAN-ZERO)

(PROVE-LEMMA LESSP-QHEAD-QMAXLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (LESSP (GETNTH '0 QUEUE)
                             (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QHEAD-QMAXLENGTH)

(PROVE-LEMMA LESSP-QTAIL-QMAXLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (LESSP (GETNTH '1 QUEUE)
                             (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QTAIL-QMAXLENGTH)

(PROVE-LEMMA LESSP-QCURRLENGTH-ADD1-QMAXLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (LESSP (GETNTH '2 QUEUE)
                             (ADD1 (GETNTH '3 QUEUE))))
             ((ENABLE ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QCURRLENGTH-ADD1-QMAXLENGTH)

(PROVE-LEMMA PLISTP-ARRAY-QARRAY
             (REWRITE)
             (PLISTP (GETSEG '4
                             (DIFFERENCE (LENGTH QUEUE) '4)
                             QUEUE))
             ((ENABLE ARRAY-QUEUEP PLISTP-GETSEG LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-QARRAY)

(PROVE-LEMMA LENGTH-ARRAY-QARRAY
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (LENGTH (GETSEG '4
                                             (DIFFERENCE (LENGTH QUEUE) '4)
                                             QUEUE))
                             (GETNTH '3 QUEUE)))
             ((ENABLE LENGTH ARRAY-QUEUEP LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-QARRAY)

(DEFN ARRAY-ENQ
      (ITEM QUEUE)
      (PUTNTH (INCR-MOD (GETNTH '1 QUEUE)
                        (GETNTH '3 QUEUE))
              '1
              (PUTNTH (ADD1 (GETNTH '2 QUEUE))
                      '2
                      (PUTNTH ITEM
                              (PLUS '4 (GETNTH '1 QUEUE))
                              QUEUE)))
      NIL)

(DEFN ARRAY-DEQ
      (QUEUE)
      (PUTNTH (INCR-MOD (GETNTH '0 QUEUE)
                        (GETNTH '3 QUEUE))
              '0
              (PUTNTH (SUB1 (GETNTH '2 QUEUE))
                      '2
                      QUEUE))
      NIL)

(DEFN ARRAY-QFIRST
      (QUEUE)
      (GETNTH (PLUS '4 (GETNTH '0 QUEUE))
              QUEUE)
      NIL)

(DEFN ARRAY-QFULLP
      (QUEUE)
      (EQUAL (GETNTH '2 QUEUE)
             (GETNTH '3 QUEUE))
      NIL)

(DEFN ARRAY-QEMPTYP
      (QUEUE)
      (ZEROP (GETNTH '2 QUEUE))
      NIL)

(PROVE-LEMMA LENGTH-ARRAY-ENQ
             (REWRITE)
             (EQUAL (LENGTH (ARRAY-ENQ ITEM QUEUE))
                    (LENGTH QUEUE))
             ((ENABLE LENGTH ARRAY-ENQ LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-ENQ)

(PROVE-LEMMA PLISTP-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (PLISTP QUEUE)
                      (PLISTP (ARRAY-ENQ ITEM QUEUE)))
             ((ENABLE ARRAY-ENQ PLISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QHEAD-ARRAY-ENQ
             (REWRITE)
             (EQUAL (GETNTH '0 (ARRAY-ENQ ITEM QUEUE))
                    (GETNTH '0 QUEUE))
             ((ENABLE ARRAY-ENQ GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QTAIL-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETNTH '1 (ARRAY-ENQ ITEM QUEUE))
                             (INCR-MOD (GETNTH '1 QUEUE)
                                       (GETNTH '3 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-ENQ GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QTAIL-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QCURRLENGTH-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETNTH '2 (ARRAY-ENQ ITEM QUEUE))
                             (ADD1 (GETNTH '2 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-ENQ GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QMAXLENGTH-ARRAY-ENQ
             (REWRITE)
             (EQUAL (GETNTH '3 (ARRAY-ENQ ITEM QUEUE))
                    (GETNTH '3 QUEUE))
             ((ENABLE ARRAY-ENQ GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QMAXLENGTH-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QARRAY-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETSEG '4
                                     (GETNTH '3 QUEUE)
                                     (ARRAY-ENQ ITEM QUEUE))
                             (PUTNTH ITEM
                                     (GETNTH '1 QUEUE)
                                     (GETSEG '4
                                             (GETNTH '3 QUEUE)
                                             QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-ENQ DIFFERENCE-PLUS1
                      GETSEG-AFTER-PUTNTH GETSEG-PUTNTH-COINCIDENCE)
              (DISABLE PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QARRAY-ARRAY-ENQ)

(PROVE-LEMMA ARRAY-QUEUEP-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QFULLP QUEUE)))
                      (ARRAY-QUEUEP (ARRAY-ENQ ITEM QUEUE)))
             ((ENABLE ARRAY-QFULLP ARRAY-QUEUEP ARRAY-QINDEX-RELATION
                      DELTA-A-A DELTA-INCR-MOD-B
                      DELTA-EQUALS-MAX-IFF-A-EQUALS-B LENGTH-ARRAY-ENQ
                      LESSP-INCR-MOD PLISTP-ARRAY-ENQ
                      ARRAY-QCURRLENGTH-ARRAY-ENQ ARRAY-QHEAD-ARRAY-ENQ
                      ARRAY-QMAXLENGTH-ARRAY-ENQ ARRAY-QTAIL-ARRAY-ENQ)
              (DISABLE PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-ENQ)

(PROVE-LEMMA LENGTH-ARRAY-DEQ
             (REWRITE)
             (EQUAL (LENGTH (ARRAY-DEQ QUEUE))
                    (LENGTH QUEUE))
             ((ENABLE LENGTH ARRAY-DEQ LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-DEQ)

(PROVE-LEMMA PLISTP-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (PLISTP QUEUE)
                      (PLISTP (ARRAY-DEQ QUEUE)))
             ((ENABLE ARRAY-DEQ PLISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QHEAD-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETNTH '0 (ARRAY-DEQ QUEUE))
                             (INCR-MOD (GETNTH '0 QUEUE)
                                       (GETNTH '3 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-DEQ LENGTH-PUTNTH
                      GETNTH-PUTNTH-COINCIDENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QTAIL-ARRAY-DEQ
             (REWRITE)
             (EQUAL (GETNTH '1 (ARRAY-DEQ QUEUE))
                    (GETNTH '1 QUEUE))
             ((ENABLE ARRAY-DEQ GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QTAIL-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QCURRLENGTH-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (GETNTH '2 (ARRAY-DEQ QUEUE))
                             (SUB1 (GETNTH '2 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-DEQ ARRAY-QEMPTYP
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QMAXLENGTH-ARRAY-DEQ
             (REWRITE)
             (EQUAL (GETNTH '3 (ARRAY-DEQ QUEUE))
                    (GETNTH '3 QUEUE))
             ((ENABLE ARRAY-DEQ GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QMAXLENGTH-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QARRAY-ARRAY-DEQ
             (REWRITE)
             (EQUAL (GETSEG '4
                            (GETNTH '3 QUEUE)
                            (ARRAY-DEQ QUEUE))
                    (GETSEG '4 (GETNTH '3 QUEUE) QUEUE))
             ((ENABLE ARRAY-DEQ GETSEG-AFTER-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QARRAY-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QUEUEP-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (ARRAY-QUEUEP (ARRAY-DEQ QUEUE)))
             ((ENABLE ARRAY-QUEUEP ARRAY-QINDEX-RELATION ARRAY-QEMPTYP
                      DELTA-INCR-MOD-A LENGTH-ARRAY-DEQ LESSP-INCR-MOD
                      PLISTP-ARRAY-DEQ ARRAY-QCURRLENGTH-ARRAY-DEQ
                      ARRAY-QHEAD-ARRAY-DEQ ARRAY-QMAXLENGTH-ARRAY-DEQ
                      ARRAY-QTAIL-ARRAY-DEQ)
              (DISABLE REMAINDER PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-DEQ)

(PROVE-LEMMA NOT-ARRAY-QEMPTYP-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NOT (ARRAY-QEMPTYP (ARRAY-ENQ ITEM QUEUE))))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QCURRLENGTH-ARRAY-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-ARRAY-QEMPTYP-ARRAY-ENQ)

(PROVE-LEMMA NOT-ARRAY-QFULLP-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NOT (ARRAY-QFULLP (ARRAY-DEQ QUEUE))))
             ((ENABLE ARRAY-QFULLP ARRAY-QUEUEP ARRAY-DEQ
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-ARRAY-QFULLP-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QCURRLENGTH-IN-A-FULL-QUEUE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (ARRAY-QFULLP QUEUE))
                      (EQUAL (GETNTH '2 QUEUE)
                             (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QFULLP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-IN-A-FULL-QUEUE)

(PROVE-LEMMA ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QFULLP QUEUE)))
                      (LESSP (GETNTH '2 QUEUE)
                             (GETNTH '3 QUEUE)))
             ((ENABLE ARRAY-QFULLP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE)

(PROVE-LEMMA ARRAY-QCURRLENGTH-IN-AN-EMPTY-QUEUE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (ARRAY-QEMPTYP QUEUE))
                      (EQUAL (GETNTH '2 QUEUE) '0))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-IN-AN-EMPTY-QUEUE)

(PROVE-LEMMA ARRAY-QCURRLENGTH-IN-A-NON-EMPTY-QUEUE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (NOT (EQUAL (GETNTH '2 QUEUE) '0)))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-IN-A-NON-EMPTY-QUEUE)

(DEFN ARRAY-NONLAST
      (QUEUE)
      (PUTNTH (DECR-MOD (GETNTH '1 QUEUE)
                        (GETNTH '3 QUEUE))
              '1
              (PUTNTH (SUB1 (GETNTH '2 QUEUE))
                      '2
                      QUEUE))
      NIL)

(PROVE-LEMMA LENGTH-ARRAY-NONLAST
             (REWRITE)
             (EQUAL (LENGTH (ARRAY-NONLAST QUEUE))
                    (LENGTH QUEUE))
             ((ENABLE LENGTH ARRAY-NONLAST LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-NONLAST)

(PROVE-LEMMA PLISTP-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (PLISTP QUEUE)
                      (PLISTP (ARRAY-NONLAST QUEUE)))
             ((ENABLE ARRAY-NONLAST PLISTP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QHEAD-ARRAY-NONLAST
             (REWRITE)
             (EQUAL (GETNTH '0 (ARRAY-NONLAST QUEUE))
                    (GETNTH '0 QUEUE))
             ((ENABLE ARRAY-NONLAST GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QTAIL-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETNTH '1 (ARRAY-NONLAST QUEUE))
                             (DECR-MOD (GETNTH '1 QUEUE)
                                       (GETNTH '3 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-NONLAST GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QTAIL-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QCURRLENGTH-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (GETNTH '2 (ARRAY-NONLAST QUEUE))
                             (SUB1 (GETNTH '2 QUEUE))))
             ((ENABLE ARRAY-QUEUEP ARRAY-NONLAST GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QMAXLENGTH-ARRAY-NONLAST
             (REWRITE)
             (EQUAL (GETNTH '3 (ARRAY-NONLAST QUEUE))
                    (GETNTH '3 QUEUE))
             ((ENABLE ARRAY-NONLAST GETNTH-PUTNTH-NON-INTERFERENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QMAXLENGTH-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QARRAY-ARRAY-NONLAST
             (REWRITE)
             (EQUAL (GETSEG '4
                            (GETNTH '3 QUEUE)
                            (ARRAY-NONLAST QUEUE))
                    (GETSEG '4 (GETNTH '3 QUEUE) QUEUE))
             ((ENABLE ARRAY-NONLAST GETSEG-AFTER-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QARRAY-ARRAY-NONLAST)

(PROVE-LEMMA
           DELTA-SUB1-B-CASE1
           (REWRITE)
           (IMPLIES (AND (NUMBERP A)
                         (AND (NUMBERP B)
                              (AND (NOT (EQUAL B '0))
                                   (AND (LESSP A MAX)
                                        (AND (LESSP B MAX)
                                             (NOT (EQUAL (SUB1 (DELTA A B MAX))
                                                         '0)))))))
                    (EQUAL (DELTA A (SUB1 B) MAX)
                           (SUB1 (DELTA A B MAX))))
           ((ENABLE DELTA)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE DELTA-SUB1-B-CASE1)

(PROVE-LEMMA DELTA-SUB1-B-CASE2
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (LESSP A MAX)
                                (NOT (EQUAL (SUB1 (DELTA A '0 MAX))
                                            '0))))
                      (EQUAL (DELTA A (SUB1 MAX) MAX)
                             (SUB1 (DELTA A '0 MAX))))
             ((ENABLE DELTA)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-SUB1-B-CASE2)

(PROVE-LEMMA
 ARRAY-QUEUEP-ARRAY-NONLAST-CROCK1
 (REWRITE)
 (IMPLIES
  (AND
   (PLISTP QUEUE)
   (AND
    (EQUAL (LENGTH QUEUE)
           (PLUS '4 (GETNTH '3 QUEUE)))
    (AND
     (NUMBERP (GETNTH '0 QUEUE))
     (AND
      (NUMBERP (GETNTH '1 QUEUE))
      (AND
       (NOT (EQUAL (GETNTH '3 QUEUE) '0))
       (AND (NUMBERP (GETNTH '3 QUEUE))
            (AND (LESSP (GETNTH '0 QUEUE)
                        (GETNTH '3 QUEUE))
                 (AND (LESSP (GETNTH '1 QUEUE)
                             (GETNTH '3 QUEUE))
                      (AND (LESSP (SUB1 (GETNTH '2 QUEUE))
                                  (GETNTH '3 QUEUE))
                           (AND (EQUAL (DELTA (GETNTH '0 QUEUE)
                                              (GETNTH '1 QUEUE)
                                              (GETNTH '3 QUEUE))
                                       (GETNTH '2 QUEUE))
                                (AND (NOT (EQUAL (GETNTH '2 QUEUE) '0))
                                     (AND (EQUAL (SUB1 (GETNTH '2 QUEUE)) '0)
                                          (NOT (EQUAL (GETNTH '1 QUEUE)
                                                      '0))))))))))))))
  (EQUAL (GETNTH '0 QUEUE)
         (SUB1 (GETNTH '1 QUEUE))))
 ((ENABLE DELTA)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-NONLAST-CROCK1)

(PROVE-LEMMA
 ARRAY-QUEUEP-ARRAY-NONLAST-CROCK2
 (REWRITE)
 (IMPLIES
  (AND
   (PLISTP QUEUE)
   (AND
    (EQUAL (LENGTH QUEUE)
           (PLUS '4 (GETNTH '3 QUEUE)))
    (AND
     (NUMBERP (GETNTH '0 QUEUE))
     (AND
      (NUMBERP (GETNTH '1 QUEUE))
      (AND
       (NOT (EQUAL (GETNTH '3 QUEUE) '0))
       (AND (NUMBERP (GETNTH '3 QUEUE))
            (AND (LESSP (GETNTH '0 QUEUE)
                        (GETNTH '3 QUEUE))
                 (AND (LESSP (GETNTH '1 QUEUE)
                             (GETNTH '3 QUEUE))
                      (AND (LESSP (SUB1 (GETNTH '2 QUEUE))
                                  (GETNTH '3 QUEUE))
                           (AND (EQUAL (DELTA (GETNTH '0 QUEUE)
                                              (GETNTH '1 QUEUE)
                                              (GETNTH '3 QUEUE))
                                       (GETNTH '2 QUEUE))
                                (AND (NOT (EQUAL (GETNTH '2 QUEUE) '0))
                                     (AND (EQUAL (SUB1 (GETNTH '2 QUEUE)) '0)
                                          (EQUAL (GETNTH '1 QUEUE)
                                                 '0)))))))))))))
  (EQUAL (GETNTH '0 QUEUE)
         (SUB1 (GETNTH '3 QUEUE))))
 ((ENABLE LENGTH DELTA)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-NONLAST-CROCK2)

(PROVE-LEMMA ARRAY-QUEUEP-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (ARRAY-QUEUEP (ARRAY-NONLAST QUEUE)))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QUEUEP ARRAY-QINDEX-RELATION
                      DELTA-SUB1-B-CASE1 DELTA-SUB1-B-CASE2 DECR-MOD
                      ARRAY-QUEUEP-ARRAY-NONLAST-CROCK1
                      ARRAY-QUEUEP-ARRAY-NONLAST-CROCK2
                      DELTA-EQUALS-MAX-IFF-A-EQUALS-B LENGTH-ARRAY-NONLAST
                      PLISTP-ARRAY-NONLAST ARRAY-QCURRLENGTH-ARRAY-NONLAST
                      ARRAY-QHEAD-ARRAY-NONLAST ARRAY-QMAXLENGTH-ARRAY-NONLAST
                      ARRAY-QTAIL-ARRAY-NONLAST)
              (DISABLE PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-NONLAST)

(DEFN ARRAY-QREPLACE
      (ITEM QUEUE)
      (ARRAY-ENQ ITEM (ARRAY-NONLAST QUEUE))
      NIL)

(PROVE-LEMMA LENGTH-ARRAY-QREPLACE
             (REWRITE)
             (EQUAL (LENGTH (ARRAY-QREPLACE ITEM QUEUE))
                    (LENGTH QUEUE))
             ((ENABLE LENGTH ARRAY-QREPLACE LENGTH-ARRAY-ENQ
                      LENGTH-ARRAY-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ARRAY-QREPLACE)

(PROVE-LEMMA PLISTP-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (PLISTP QUEUE)
                      (PLISTP (ARRAY-QREPLACE ITEM QUEUE)))
             ((ENABLE ARRAY-QREPLACE PLISTP-ARRAY-ENQ PLISTP-ARRAY-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ARRAY-QREPLACE)

(PROVE-LEMMA ARRAY-QHEAD-ARRAY-QREPLACE
             (REWRITE)
             (EQUAL (GETNTH '0
                            (ARRAY-QREPLACE ITEM QUEUE))
                    (GETNTH '0 QUEUE))
             ((ENABLE ARRAY-QREPLACE ARRAY-QHEAD-ARRAY-ENQ
                      ARRAY-QHEAD-ARRAY-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-ARRAY-QREPLACE)

(PROVE-LEMMA ARRAY-QTAIL-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (GETNTH '1
                                     (ARRAY-QREPLACE ITEM QUEUE))
                             (GETNTH '1 QUEUE)))
             ((ENABLE ARRAY-QREPLACE NUMBERP-QTAIL LESSP-QTAIL-QMAXLENGTH
                      ARRAY-QUEUEP-ARRAY-NONLAST
                      ARRAY-QMAXLENGTH-ARRAY-NONLAST ARRAY-QTAIL-ARRAY-ENQ
                      ARRAY-QTAIL-ARRAY-NONLAST INCR-MOD-DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QTAIL-ARRAY-QREPLACE)

(PROVE-LEMMA ARRAY-QCURRLENGTH-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (GETNTH '2
                                     (ARRAY-QREPLACE ITEM QUEUE))
                             (GETNTH '2 QUEUE)))
             ((ENABLE ARRAY-QREPLACE ARRAY-QEMPTYP ARRAY-QUEUEP-ARRAY-NONLAST
                      ARRAY-QCURRLENGTH-ARRAY-NONLAST
                      ARRAY-QCURRLENGTH-ARRAY-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QCURRLENGTH-ARRAY-QREPLACE)

(PROVE-LEMMA ARRAY-QMAXLENGTH-ARRAY-QREPLACE
             (REWRITE)
             (EQUAL (GETNTH '3
                            (ARRAY-QREPLACE ITEM QUEUE))
                    (GETNTH '3 QUEUE))
             ((ENABLE ARRAY-QREPLACE ARRAY-QMAXLENGTH-ARRAY-NONLAST
                      ARRAY-QMAXLENGTH-ARRAY-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QMAXLENGTH-ARRAY-QREPLACE)

(PROVE-LEMMA ARRAY-QARRAY-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (GETSEG '4
                                     (GETNTH '3 QUEUE)
                                     (ARRAY-QREPLACE ITEM QUEUE))
                             (PUTNTH ITEM
                                     (DECR-MOD (GETNTH '1 QUEUE)
                                               (GETNTH '3 QUEUE))
                                     (GETSEG '4
                                             (GETNTH '3 QUEUE)
                                             QUEUE))))
             ((ENABLE ARRAY-QREPLACE ARRAY-QUEUEP-ARRAY-NONLAST
                      ARRAY-QARRAY-ARRAY-NONLAST
                      ARRAY-QMAXLENGTH-ARRAY-NONLAST ARRAY-QTAIL-ARRAY-NONLAST
                      ARRAY-QTAIL-ARRAY-ENQ)
              (USE (ARRAY-QARRAY-ARRAY-ENQ (ITEM ITEM)
                                           (QUEUE (ARRAY-NONLAST QUEUE))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QARRAY-ARRAY-QREPLACE)

(PROVE-LEMMA NOT-ARRAY-QFULLP-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (NOT (ARRAY-QFULLP (ARRAY-NONLAST QUEUE))))
             ((ENABLE ARRAY-QFULLP ARRAY-QUEUEP
                      ARRAY-QCURRLENGTH-ARRAY-NONLAST
                      ARRAY-QMAXLENGTH-ARRAY-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-ARRAY-QFULLP-ARRAY-NONLAST)

(PROVE-LEMMA ARRAY-QUEUEP-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (ARRAY-QUEUEP (ARRAY-QREPLACE ITEM QUEUE)))
             ((ENABLE ARRAY-QREPLACE NOT-ARRAY-QFULLP-ARRAY-NONLAST
                      ARRAY-QUEUEP-ARRAY-NONLAST ARRAY-QUEUEP-ARRAY-ENQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-ARRAY-QREPLACE)

(DEFTHEORY
    ARRAY-QUEUE-FACTS
    (ARRAY-QCURRLENGTH-IN-AN-EMPTY-QUEUE ARRAY-QCURRLENGTH-IN-A-NON-EMPTY-QUEUE
                                         ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
                                         ARRAY-QCURRLENGTH-IN-A-FULL-QUEUE
                                         NOT-ARRAY-QFULLP-ARRAY-DEQ
                                         NOT-ARRAY-QEMPTYP-ARRAY-ENQ
                                         ARRAY-QUEUEP-ARRAY-QREPLACE
                                         ARRAY-QMAXLENGTH-ARRAY-QREPLACE
                                         ARRAY-QCURRLENGTH-ARRAY-QREPLACE
                                         ARRAY-QTAIL-ARRAY-QREPLACE
                                         ARRAY-QHEAD-ARRAY-QREPLACE
                                         PLISTP-ARRAY-QREPLACE
                                         LENGTH-ARRAY-QREPLACE
                                         ARRAY-QUEUEP-ARRAY-DEQ
                                         ARRAY-QMAXLENGTH-ARRAY-DEQ
                                         ARRAY-QCURRLENGTH-ARRAY-DEQ
                                         ARRAY-QTAIL-ARRAY-DEQ
                                         ARRAY-QHEAD-ARRAY-DEQ
                                         PLISTP-ARRAY-DEQ LENGTH-ARRAY-DEQ
                                         ARRAY-QUEUEP-ARRAY-ENQ
                                         ARRAY-QMAXLENGTH-ARRAY-ENQ
                                         ARRAY-QCURRLENGTH-ARRAY-ENQ
                                         ARRAY-QTAIL-ARRAY-ENQ
                                         ARRAY-QHEAD-ARRAY-ENQ
                                         PLISTP-ARRAY-ENQ LENGTH-ARRAY-ENQ
                                         LENGTH-ARRAY-QARRAY
                                         PLISTP-ARRAY-QARRAY
                                         LESSP-QCURRLENGTH-ADD1-QMAXLENGTH
                                         LESSP-QTAIL-QMAXLENGTH
                                         LESSP-QHEAD-QMAXLENGTH
                                         QMAXLENGTH-GREATER-THAN-ZERO
                                         QMAXLENGTH-NON-ZERO
                                         NUMBERP-QMAXLENGTH
                                         NUMBERP-QCURRLENGTH NUMBERP-QTAIL
                                         NUMBERP-QHEAD))

(PROVE-LEMMA ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
             NIL
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (ARRAY-QFULLP QUEUE))
                      (NOT (ARRAY-QEMPTYP QUEUE)))
             ((ENABLE ARRAY-QUEUEP ARRAY-QFULLP ARRAY-QEMPTYP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IN-AN-EMPTY-QUEUE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (ARRAY-QEMPTYP QUEUE))
                      (EQUAL (GETNTH '0 QUEUE)
                             (GETNTH '1 QUEUE)))
             ((ENABLE DELTA-EQUALS-MAX-IFF-A-EQUALS-B ARRAY-QUEUEP
                      ARRAY-QEMPTYP ARRAY-QINDEX-RELATION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IN-AN-EMPTY-QUEUE)

(PROVE-LEMMA ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (EQUAL (GETNTH '0 QUEUE)
                                    (GETNTH '1 QUEUE))
                             (OR (ARRAY-QFULLP QUEUE)
                                 (ARRAY-QEMPTYP QUEUE))))
             ((ENABLE DELTA ARRAY-QUEUEP ARRAY-QFULLP ARRAY-QEMPTYP
                      ARRAY-QINDEX-RELATION COMMUTATIVITY-OF-TIMES
                      COMMUTATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY)

(DEFN DELTA-SEGMENT
      (A B S)
      (IF (IF (LESSP A B) '*1*FALSE '*1*TRUE)
          (APPEND (GETSEG A (DIFFERENCE (LENGTH S) A) S)
                  (GETSEG '0 B S))
          (GETSEG A (DIFFERENCE B A) S))
      NIL)

(PROVE-LEMMA DELTA-EQUALS-LENGTH-DELTA-SEGMENT
             (REWRITE)
             (IMPLIES (AND (LESSP A (LENGTH S))
                           (LESSP B (LENGTH S)))
                      (EQUAL (LENGTH (DELTA-SEGMENT A B S))
                             (DELTA A B (LENGTH S))))
             ((ENABLE LENGTH DELTA-SEGMENT DELTA COMMUTATIVITY-OF-PLUS
                      LENGTH-APPEND LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-EQUALS-LENGTH-DELTA-SEGMENT)

(PROVE-LEMMA PLISTP-DELTA-SEGMENT
             (REWRITE)
             (PLISTP (DELTA-SEGMENT A B S))
             ((ENABLE DELTA-SEGMENT PLISTP-APPEND PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-DELTA-SEGMENT)

(PROVE-LEMMA FINITE-NUMBER-LISTP-DELTA-SEGMENT
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-LISTP S LUB)
                           (AND (NUMBERP B)
                                (AND (IF (LESSP (LENGTH S) B)
                                         '*1*FALSE
                                         '*1*TRUE)
                                     (AND (NUMBERP A)
                                          (IF (LESSP (LENGTH S) A)
                                              '*1*FALSE
                                              '*1*TRUE)))))
                      (FINITE-NUMBER-LISTP (DELTA-SEGMENT A B S)
                                           LUB))
             ((ENABLE LENGTH DELTA-SEGMENT FINITE-NUMBER-LISTP-APPEND
                      FINITE-NUMBER-LISTP-GETSEG FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-DELTA-SEGMENT)

(PROVE-LEMMA LENGTH-DELTA-SEGMENT
             NIL
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (AND (LESSP A (LENGTH S))
                                     (LESSP B (LENGTH S)))))
                      (IF (LESSP (LENGTH S)
                                 (LENGTH (DELTA-SEGMENT A B S)))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE LENGTH DELTA-EQUALS-LENGTH-DELTA-SEGMENT)
              (USE (LEQ-DELTA (A A)
                              (B B)
                              (MAX (LENGTH S))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN MAPUP-QUEUE
      (QUEUE)
      (IF (ARRAY-QEMPTYP QUEUE)
          'NIL
          (DELTA-SEGMENT (GETNTH '0 QUEUE)
                         (GETNTH '1 QUEUE)
                         (GETSEG '4
                                 (GETNTH '3 QUEUE)
                                 QUEUE)))
      NIL)

(PROVE-LEMMA FINITE-NUMBER-LISTP-MAPUP-QUEUE
       (REWRITE)
       (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                     (FINITE-NUMBER-LISTP (GETSEG '4 (GETNTH '3 QUEUE) QUEUE)
                                          LUB))
                (FINITE-NUMBER-LISTP (MAPUP-QUEUE QUEUE)
                                     LUB))
       ((ENABLE ARRAY-QUEUEP FINITE-NUMBER-LISTP-DELTA-SEGMENT LENGTH-GETSEG
                MAPUP-QUEUE FINITE-NUMBER-LISTP)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-MAPUP-QUEUE)

(PROVE-LEMMA PLISTP-MAPUP-QUEUE
             (REWRITE)
             (PLISTP (MAPUP-QUEUE QUEUE))
             ((ENABLE MAPUP-QUEUE PLISTP-DELTA-SEGMENT PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-MAPUP-QUEUE)

(PROVE-LEMMA LENGTH-MAPUP-QUEUE
             NIL
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (IF (LESSP (GETNTH '3 QUEUE)
                                 (LENGTH (MAPUP-QUEUE QUEUE)))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE LENGTH ARRAY-QUEUEP MAPUP-QUEUE LENGTH-GETSEG)
              (USE (LENGTH-DELTA-SEGMENT (A (GETNTH '0 QUEUE))
                                         (B (GETNTH '1 QUEUE))
                                         (S (GETSEG '4
                                                    (GETNTH '3 QUEUE)
                                                    QUEUE))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA DELTA-SEGMENT-INCR-MOD-B
             (REWRITE)
             (IMPLIES (AND (PLISTP S)
                           (AND (NUMBERP A)
                                (AND (NUMBERP B)
                                     (AND (LESSP A N)
                                          (AND (LESSP B N)
                                               (EQUAL N (LENGTH S)))))))
                      (EQUAL (DELTA-SEGMENT A (INCR-MOD B N) S)
                             (IF (EQUAL A B)
                                 (CONS (GETNTH A S) 'NIL)
                                 (APPEND (DELTA-SEGMENT A B S)
                                         (CONS (GETNTH B S) 'NIL)))))
             ((ENABLE LENGTH DELTA-SEGMENT INCR-MOD APPEND-NIL-ON-RIGHT
                      APPEND-NON-LIST-LEFT ASSOCIATIVITY-OF-APPEND
                      COMMUTATIVITY-OF-PLUS DIFFERENCE-X-X
                      DIFFERENCE-SUB1-ARG2 GETSEG-ADD1-LENGTH
                      GETSEG-OF-LENGTH-ZERO LENGTH-GETSEG LIST-GETNTH-0
                      PLISTP-GETSEG PLISTP-LIST1 PLUS-1
                      PLUS-DIFFERENCE-CANCELLATION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-SEGMENT-INCR-MOD-B)

(PROVE-LEMMA DELTA-SEGMENT-PUTNTH-NON-INTERFERENCE
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (NUMBERP B)
                                (AND (LESSP A (LENGTH S))
                                     (AND (LESSP B (LENGTH S))
                                          (NOT (EQUAL A B))))))
                      (EQUAL (DELTA-SEGMENT A B (PUTNTH V B S))
                             (DELTA-SEGMENT A B S)))
             ((ENABLE DELTA-SEGMENT LENGTH GETSEG-AFTER-PUTNTH
                      GETSEG-BEFORE-PUTNTH LENGTH-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-SEGMENT-PUTNTH-NON-INTERFERENCE)

(PROVE-LEMMA
      CORRECTNESS-OF-ARRAY-ENQ
      (REWRITE)
      (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                    (NOT (ARRAY-QFULLP QUEUE)))
               (EQUAL (MAPUP-QUEUE (ARRAY-ENQ ITEM QUEUE))
                      (ENQ ITEM (MAPUP-QUEUE QUEUE))))
      ((USE (QMAXLENGTH-NON-ZERO (QUEUE QUEUE))
            (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY (QUEUE QUEUE)))
       (ENABLE MAPUP-QUEUE ENQ APPEND-NON-LIST-LEFT DELTA-SEGMENT-INCR-MOD-B
               DELTA-SEGMENT-PUTNTH-NON-INTERFERENCE GETNTH-PUTNTH-COINCIDENCE
               LENGTH-GETSEG LENGTH-PUTNTH PLISTP-GETSEG PLISTP-PUTNTH
               ARRAY-QARRAY-ARRAY-ENQ)
       (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-ENQ)

(PROVE-LEMMA DELTA-SEGMENT-INCR-MOD-A
             (REWRITE)
             (IMPLIES (AND (PLISTP S)
                           (AND (NUMBERP A)
                                (AND (NUMBERP B)
                                     (AND (LESSP A N)
                                          (AND (LESSP B N)
                                               (EQUAL N (LENGTH S)))))))
                      (EQUAL (DELTA-SEGMENT (INCR-MOD A N) B S)
                             (IF (EQUAL (DELTA A B N) '1)
                                 (DELTA-SEGMENT B B S)
                                 (CDR (DELTA-SEGMENT A B S)))))
             ((ENABLE DELTA-SEGMENT DELTA LENGTH INCR-MOD APPEND-NON-LIST-LEFT
                      CDR-APPEND CDR-GETSEG DIFFERENCE-ADD1-ARG1
                      DIFFERENCE-ADD1-ARG2 DIFFERENCE-X-X
                      GETSEG-OF-LENGTH-ZERO LISTP-GETSEG PLUS-1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DELTA-SEGMENT-INCR-MOD-A)

(PROVE-LEMMA ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (AND (NOT (ARRAY-QEMPTYP QUEUE))
                                (EQUAL (DELTA (GETNTH '0 QUEUE)
                                              (GETNTH '1 QUEUE)
                                              (GETNTH '3 QUEUE))
                                       '1)))
                      (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE)))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QUEUEP ARRAY-QINDEX-RELATION
                      ARRAY-QCURRLENGTH-ARRAY-DEQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1)

(PROVE-LEMMA ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1-ALTERNATIVE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (AND (NOT (ARRAY-QEMPTYP QUEUE))
                                (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE))))
                      (EQUAL (DELTA (GETNTH '0 QUEUE)
                                    (GETNTH '1 QUEUE)
                                    (GETNTH '3 QUEUE))
                             '1))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QUEUEP ARRAY-QINDEX-RELATION
                      ARRAY-QCURRLENGTH-ARRAY-DEQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1-ALTERNATIVE)

(PROVE-LEMMA
      CORRECTNESS-OF-ARRAY-DEQ-CASE-3
      (REWRITE)
      (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                    (AND (NOT (ARRAY-QEMPTYP QUEUE))
                         (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE))))
               (EQUAL (CDR (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                          (GETNTH '1 QUEUE)
                                          (GETSEG '4
                                                  (GETNTH '3 QUEUE)
                                                  QUEUE)))
                      'NIL))
      ((USE (ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1-ALTERNATIVE (QUEUE QUEUE))
            (QMAXLENGTH-NON-ZERO (QUEUE QUEUE)))
       (ENABLE CDR-IS-NIL-WHEN-LENGTH-IS-1 DELTA-EQUALS-LENGTH-DELTA-SEGMENT
               LENGTH-GETSEG PLISTP-DELTA-SEGMENT)
       (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-DEQ-CASE-3)

(PROVE-LEMMA ARRAY-QMAXLENGTH-MUST-BE-1
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (AND (ARRAY-QFULLP QUEUE)
                                (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE))))
                      (EQUAL (GETNTH '3 QUEUE) '1))
             ((ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (USE (ARRAY-QCURRLENGTH-IN-A-FULL-QUEUE (QUEUE QUEUE))
                   (ARRAY-QCURRLENGTH-IN-AN-EMPTY-QUEUE (QUEUE QUEUE))
                   (ARRAY-QCURRLENGTH-ARRAY-DEQ (QUEUE QUEUE)))
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QMAXLENGTH-MUST-BE-1)

(PROVE-LEMMA
      LENGTH-DELTA-SEGMENT-A-A
      (REWRITE)
      (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                    (AND (ARRAY-QFULLP QUEUE)
                         (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE))))
               (EQUAL (LENGTH (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                             (GETNTH '0 QUEUE)
                                             (GETSEG '4
                                                     (GETNTH '3 QUEUE)
                                                     QUEUE)))
                      '1))
      ((USE (ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1-ALTERNATIVE (QUEUE QUEUE))
            (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP (QUEUE QUEUE))
            (ARRAY-QMAXLENGTH-MUST-BE-1 (QUEUE QUEUE))
            (NUMBERP-QMAXLENGTH (QUEUE QUEUE))
            (QMAXLENGTH-NON-ZERO (QUEUE QUEUE))
            (INTEGER-EQUALITY-CROCK (A (GETNTH '0 QUEUE))
                                    (B (GETNTH '1 QUEUE))))
       (ENABLE DELTA-A-A LENGTH DELTA-EQUALS-LENGTH-DELTA-SEGMENT
               LENGTH-GETSEG LENGTH-ARRAY-QARRAY LESSP-QHEAD-QMAXLENGTH
               LESSP-QTAIL-QMAXLENGTH NUMBERP-QHEAD NUMBERP-QTAIL PLUS-0)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE LENGTH-DELTA-SEGMENT-A-A)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-DEQ-CASE-1
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (AND (ARRAY-QFULLP QUEUE)
                                (ARRAY-QEMPTYP (ARRAY-DEQ QUEUE))))
                      (EQUAL (CDR (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                                 (GETNTH '0 QUEUE)
                                                 (GETSEG '4
                                                         (GETNTH '3 QUEUE)
                                                         QUEUE)))
                             'NIL))
             ((ENABLE CDR-IS-NIL-WHEN-LENGTH-IS-1 LENGTH-DELTA-SEGMENT-A-A
                      PLISTP-DELTA-SEGMENT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-DEQ-CASE-1)

(PROVE-LEMMA
      CORRECTNESS-OF-ARRAY-DEQ
      (REWRITE)
      (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                    (NOT (ARRAY-QEMPTYP QUEUE)))
               (EQUAL (MAPUP-QUEUE (ARRAY-DEQ QUEUE))
                      (DEQ (MAPUP-QUEUE QUEUE))))
      ((USE (QMAXLENGTH-NON-ZERO (QUEUE QUEUE))
            (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY (QUEUE QUEUE)))
       (ENABLE MAPUP-QUEUE DEQ CORRECTNESS-OF-ARRAY-DEQ-CASE-1
               CORRECTNESS-OF-ARRAY-DEQ-CASE-3 DELTA-SEGMENT-INCR-MOD-A
               LENGTH-GETSEG LENGTH-ARRAY-DEQ LENGTH-ARRAY-QARRAY
               LESSP-QHEAD-QMAXLENGTH LESSP-QTAIL-QMAXLENGTH
               NOT-ARRAY-QFULLP-ARRAY-DEQ NUMBERP-QCURRLENGTH NUMBERP-QHEAD
               NUMBERP-QMAXLENGTH NUMBERP-QTAIL PLISTP-GETSEG
               PLISTP-ARRAY-QARRAY ARRAY-QARRAY-ARRAY-DEQ
               ARRAY-QCURRLENGTH-ARRAY-DEQ
               ARRAY-QEMTPYP-ARRAY-DEQ-WHEN-DELTA-IS-1 ARRAY-QHEAD-ARRAY-DEQ
               ARRAY-QMAXLENGTH-ARRAY-DEQ ARRAY-QTAIL-ARRAY-DEQ)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-DEQ)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QFIRST
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (ARRAY-QFIRST QUEUE)
                             (QFIRST (MAPUP-QUEUE QUEUE))))
             ((ENABLE DELTA-SEGMENT QFIRST ARRAY-QFIRST MAPUP-QUEUE
                      GETNTH-APPEND-LEFT GETNTH-GETSEG LENGTH-GETSEG
                      LESSP-QHEAD-QMAXLENGTH NUMBERP-QHEAD PLUS-0
                      REWRITE-CAR-TO-GETNTH-0)
              (USE (NUMBERP-QMAXLENGTH (QUEUE QUEUE))
                   (QMAXLENGTH-NON-ZERO (QUEUE QUEUE)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QFIRST)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QEMPTYP
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (ARRAY-QEMPTYP QUEUE)
                             (QEMPTYP (MAPUP-QUEUE QUEUE))))
             ((ENABLE LENGTH MAPUP-QUEUE ARRAY-QUEUEP ARRAY-QEMPTYP QEMPTYP
                      ARRAY-QINDEX-RELATION DELTA-EQUALS-LENGTH-DELTA-SEGMENT
                      LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QEMPTYP)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QFULLP
             NIL
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (EQUAL MAX (GETNTH '3 QUEUE)))
                      (EQUAL (ARRAY-QFULLP QUEUE)
                             (QFULLP (MAPUP-QUEUE QUEUE) MAX)))
             ((ENABLE LENGTH MAPUP-QUEUE ARRAY-QEMPTYP ARRAY-QUEUEP
                      ARRAY-QFULLP QFULLP ARRAY-QINDEX-RELATION
                      DELTA-EQUALS-LENGTH-DELTA-SEGMENT LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LENGTH-DELTA-SEGMENT-DECR-MOD-ARG1
             (REWRITE)
             (IMPLIES (AND (NUMBERP A)
                           (AND (EQUAL B (LENGTH S))
                                (LESSP A (LENGTH S))))
                      (EQUAL (LENGTH (DELTA-SEGMENT (DECR-MOD A B) A S))
                             '1))
             ((ENABLE DELTA-SEGMENT LENGTH LENGTH-GETSEG LENGTH-APPEND
                      DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-DELTA-SEGMENT-DECR-MOD-ARG1)

(PROVE-LEMMA NONLAST-OF-LENGTH-1
             (REWRITE)
             (IMPLIES (EQUAL (LENGTH L) '1)
                      (EQUAL (NONLAST L) 'NIL))
             ((ENABLE NONLAST LENGTH GETSEG-OF-LENGTH-ZERO)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NONLAST-OF-LENGTH-1)

(PROVE-LEMMA
 CORRECTNESS-OF-ARRAY-NONLAST-CASE1
 (REWRITE)
 (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
               (AND (NOT (ARRAY-QEMPTYP QUEUE))
                    (ARRAY-QEMPTYP (ARRAY-NONLAST QUEUE))))
          (EQUAL (NONLAST (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                         (GETNTH '1 QUEUE)
                                         (GETSEG '4
                                                 (GETNTH '3 QUEUE)
                                                 QUEUE)))
                 'NIL))
 ((ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
  (ENABLE ARRAY-QHEAD-ARRAY-NONLAST ARRAY-QTAIL-ARRAY-NONLAST
          ARRAY-QCURRLENGTH-ARRAY-NONLAST ARRAY-QMAXLENGTH-ARRAY-NONLAST
          ARRAY-QARRAY-ARRAY-NONLAST ARRAY-QUEUEP-ARRAY-NONLAST LENGTH-GETSEG
          NONLAST-OF-LENGTH-1)
  (USE
   (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IN-AN-EMPTY-QUEUE
                                                 (QUEUE (ARRAY-NONLAST QUEUE)))
   (LENGTH-DELTA-SEGMENT-DECR-MOD-ARG1 (A (GETNTH '1 QUEUE))
                                       (B (GETNTH '3 QUEUE))
                                       (S (GETSEG '4
                                                  (GETNTH '3 QUEUE)
                                                  QUEUE))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-NONLAST-CASE1)

(PROVE-LEMMA
       DELTA-SEGMENT-DECR-MOD-ARG2
       (REWRITE)
       (IMPLIES (AND (NUMBERP A)
                     (AND (LESSP A (LENGTH S))
                          (AND (NUMBERP B)
                               (AND (LESSP B (LENGTH S))
                                    (NOT (EQUAL A (DECR-MOD B (LENGTH S))))))))
                (EQUAL (DELTA-SEGMENT A
                                      (DECR-MOD B (LENGTH S))
                                      S)
                       (NONLAST (DELTA-SEGMENT A B S))))
       ((ENABLE APPEND-NIL-ON-RIGHT LENGTH DECR-MOD DELTA-SEGMENT
                DIFFERENCE-PLUS2 DIFFERENCE-SUB1-ARG1
                DIFFERENCE-SUB1-PLUS-CROCK GETSEG-ACROSS-APPEND GETSEG-GETSEG
                GETSEG-OF-LENGTH-ZERO LENGTH-APPEND LENGTH-GETSEG NONLAST
                PLISTP-GETSEG PLUS-0 PLUS-1)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE DELTA-SEGMENT-DECR-MOD-ARG2)

(PROVE-LEMMA
 CORRECTNESS-OF-ARRAY-NONLAST-CASE2
 (REWRITE)
 (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
               (AND (NOT (ARRAY-QEMPTYP QUEUE))
                    (NOT (ARRAY-QEMPTYP (ARRAY-NONLAST QUEUE)))))
          (EQUAL (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                (DECR-MOD (GETNTH '1 QUEUE)
                                          (GETNTH '3 QUEUE))
                                (GETSEG '4 (GETNTH '3 QUEUE) QUEUE))
                 (NONLAST (DELTA-SEGMENT (GETNTH '0 QUEUE)
                                         (GETNTH '1 QUEUE)
                                         (GETSEG '4
                                                 (GETNTH '3 QUEUE)
                                                 QUEUE)))))
 ((ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
  (ENABLE ARRAY-QHEAD-ARRAY-NONLAST ARRAY-QTAIL-ARRAY-NONLAST
          ARRAY-QCURRLENGTH-ARRAY-NONLAST ARRAY-QMAXLENGTH-ARRAY-NONLAST
          ARRAY-QARRAY-ARRAY-NONLAST ARRAY-QUEUEP-ARRAY-NONLAST LENGTH-GETSEG
          NOT-ARRAY-QFULLP-ARRAY-NONLAST)
  (USE
   (DELTA-SEGMENT-DECR-MOD-ARG2 (A (GETNTH '0 QUEUE))
                                (B (GETNTH '1 QUEUE))
                                (S (GETSEG '4
                                           (GETNTH '3 QUEUE)
                                           QUEUE)))
   (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY
                                                (QUEUE (ARRAY-NONLAST QUEUE))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-NONLAST-CASE2)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-NONLAST
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (MAPUP-QUEUE (ARRAY-NONLAST QUEUE))
                             (NONLAST (MAPUP-QUEUE QUEUE))))
             ((ENABLE MAPUP-QUEUE CORRECTNESS-OF-ARRAY-NONLAST-CASE2
                      CORRECTNESS-OF-ARRAY-NONLAST-CASE1
                      ARRAY-QHEAD-ARRAY-NONLAST ARRAY-QTAIL-ARRAY-NONLAST
                      ARRAY-QCURRLENGTH-ARRAY-NONLAST
                      ARRAY-QMAXLENGTH-ARRAY-NONLAST
                      ARRAY-QARRAY-ARRAY-NONLAST)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-NONLAST)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (MAPUP-QUEUE (ARRAY-QREPLACE ITEM QUEUE))
                             (QREPLACE ITEM (MAPUP-QUEUE QUEUE))))
             ((ENABLE ARRAY-QREPLACE QREPLACE ARRAY-QUEUEP-ARRAY-NONLAST
                      NOT-ARRAY-QFULLP-ARRAY-NONLAST CORRECTNESS-OF-ARRAY-ENQ
                      CORRECTNESS-OF-ARRAY-NONLAST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QREPLACE)

(PROVE-LEMMA LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH
             (REWRITE)
             (IMPLIES (ARRAY-QUEUEP QUEUE)
                      (EQUAL (LENGTH (MAPUP-QUEUE QUEUE))
                             (GETNTH '2 QUEUE)))
             ((ENABLE LENGTH ARRAY-QUEUEP MAPUP-QUEUE LENGTH-GETSEG
                      ARRAY-QINDEX-RELATION ARRAY-QEMPTYP
                      DELTA-EQUALS-LENGTH-DELTA-SEGMENT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH)

(DEFN QFIRST2
      (I J QTABLE)
      (QFIRST (GETNTH2 I J QTABLE))
      NIL)

(DEFN ENQ2
      (MSG I J QTABLE)
      (PUTNTH2 (ENQ MSG (GETNTH2 I J QTABLE))
               I J QTABLE)
      NIL)

(DEFN DEQ2
      (I J QTABLE)
      (PUTNTH2 (DEQ (GETNTH2 I J QTABLE))
               I J QTABLE)
      NIL)

(DEFN QFULLP2
      (I J QTABLE MAX)
      (QFULLP (GETNTH2 I J QTABLE) MAX)
      NIL)

(DEFN QEMPTYP2
      (I J QTABLE)
      (QEMPTYP (GETNTH2 I J QTABLE))
      NIL)

(PROVE-LEMMA ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP NIL
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (ARRAY-QEMPTYP QUEUE))
                      (NOT (ARRAY-QFULLP QUEUE)))
             ((ENABLE ARRAY-QEMPTYP ARRAY-QFULLP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA ARRAY-QFIRST-ARRAY-ENQ
      (REWRITE)
      (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                    (AND (NOT (ARRAY-QEMPTYP QUEUE))
                         (NOT (ARRAY-QFULLP QUEUE))))
               (EQUAL (ARRAY-QFIRST (ARRAY-ENQ ITEM QUEUE))
                      (ARRAY-QFIRST QUEUE)))
      ((ENABLE ARRAY-QEMPTYP ARRAY-QFULLP ARRAY-QFIRST ARRAY-ENQ ARRAY-QUEUEP
               PLUS-NOT-EQUAL GETNTH-PUTNTH-NON-INTERFERENCE)
       (USE (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IFF-QFULL-OR-QEMPTY (QUEUE QUEUE)))
       (DISABLE PLUS)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-ARRAY-ENQ)

(PROVE-LEMMA
        ARRAY-QFIRST-ARRAY-ENQ1
        (REWRITE)
        (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                      (ARRAY-QEMPTYP QUEUE))
                 (EQUAL (ARRAY-QFIRST (ARRAY-ENQ ITEM QUEUE))
                        ITEM))
        ((ENABLE ARRAY-ENQ ARRAY-QFIRST ARRAY-QUEUEP GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE)
         (USE (ARRAY-QHEAD-EQUALS-ARRAY-QTAIL-IN-AN-EMPTY-QUEUE (QUEUE QUEUE)))
         (DISABLE PLUS)
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-ARRAY-ENQ1)

(DEFN TM-WORDSIZE NIL '16 NIL)

(DEFN TM-WORDLUB NIL '65536 NIL)

(DEFN ALU-RESULT
      (VALUE CARRY)
      (CONS VALUE (CONS CARRY 'NIL))
      NIL)

(DEFN ALU-VALUE
      (ALU-RESULT)
      (CAR ALU-RESULT)
      NIL)

(DEFN ALU-CARRY
      (ALU-RESULT)
      (CAR (CDR ALU-RESULT))
      NIL)

(DEFN TM-ALU-DECR
      (A)
      (IF (ZEROP A)
          '(65535 *1*TRUE)
          (ALU-RESULT (REMAINDER (SUB1 A) '65536)
                      '*1*FALSE))
      NIL)

(DEFN TM-ALU-DECR-MOD
      (A B)
      (ALU-RESULT (DECR-MOD (REMAINDER A '65536)
                            (REMAINDER B '65536))
                  '*1*FALSE)
      NIL)

(DEFN TM-ALU-DIFFERENCE
      (A B)
      (IF (LESSP B A)
          (ALU-RESULT (REMAINDER (DIFFERENCE '65536 (DIFFERENCE A B))
                                 '65536)
                      '*1*TRUE)
          (ALU-RESULT (REMAINDER (DIFFERENCE B A) '65536)
                      '*1*FALSE))
      NIL)

(DEFN TM-ALU-INCR
      (A)
      (IF (LESSP (ADD1 A) '65536)
          (ALU-RESULT (ADD1 A) '*1*FALSE)
          '(0 *1*TRUE))
      NIL)

(DEFN TM-ALU-INCR-MOD
      (A B)
      (ALU-RESULT (INCR-MOD (REMAINDER A '65536)
                            (REMAINDER B '65536))
                  '*1*FALSE)
      NIL)

(DEFN TM-ALU-MOD
      (A B)
      (IF (ZEROP (REMAINDER B '65536))
          (ALU-RESULT (REMAINDER A '65536)
                      '*1*FALSE)
          (ALU-RESULT (REMAINDER A (REMAINDER B '65536))
                      '*1*FALSE))
      NIL)

(DEFN TM-ALU-MULT
      (A B)
      (IF (LESSP (TIMES A B) '65536)
          (ALU-RESULT (TIMES A B) '*1*FALSE)
          (ALU-RESULT (REMAINDER (TIMES A B) '65536)
                      '*1*TRUE))
      NIL)

(DEFN TM-ALU-PLUS
      (A B)
      (IF (LESSP (PLUS A B) '65536)
          (ALU-RESULT (PLUS A B) '*1*FALSE)
          (ALU-RESULT (REMAINDER (PLUS A B) '65536)
                      '*1*TRUE))
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-DECR A))
                             '65536)
             ((ENABLE FINITE-NUMBERP LESSP-REMAINDER2 ALU-RESULT ALU-VALUE
                      ALU-CARRY TM-ALU-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-DECR A))
                           '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-DECR A))
                    '65536)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-DECR
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-DECR A)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-DECR)

(PROVE-LEMMA TM-ALU-DECR-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP A))
                           (LESSP A '65536))
                      (EQUAL (ALU-VALUE (TM-ALU-DECR A))
                             (SUB1 A)))
             ((USE (LESSP-REMAINDER-SUB1-CROCK (X A)
                                               (N '65536)))
              (ENABLE REMAINDER-NOOP ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-DECR-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-DECR-MOD A B))
                             '65536)
             ((ENABLE FINITE-NUMBERP ALU-RESULT ALU-VALUE ALU-CARRY DECR-MOD
                      TM-ALU-DECR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-DECR-MOD A B))
                           '65536)
                    '*1*TRUE)
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY DECR-MOD TM-ALU-DECR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-DECR-MOD A B))
                    '65536)
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY DECR-MOD TM-ALU-DECR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-DECR-MOD A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD)

(PROVE-LEMMA TM-ALU-DECR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (AND (LESSP A '65536)
                           (LESSP B '65536))
                      (EQUAL (ALU-VALUE (TM-ALU-DECR-MOD A B))
                             (DECR-MOD A B)))
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY DECR-MOD
                      TM-ALU-DECR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-DECR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-INCR A))
                             '65536)
             ((ENABLE FINITE-NUMBERP LESSP-REMAINDER2 ALU-RESULT ALU-VALUE
                      ALU-CARRY TM-ALU-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-INCR A))
                           '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-INCR A))
                    '65536)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-INCR
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-INCR A)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-INCR)

(PROVE-LEMMA TM-ALU-INCR-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (LESSP (ADD1 A) '65536)
                      (EQUAL (ALU-VALUE (TM-ALU-INCR A))
                             (ADD1 A)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-INCR-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-INCR-MOD A B))
                             '65536)
             ((ENABLE FINITE-NUMBERP ALU-RESULT ALU-VALUE ALU-CARRY INCR-MOD
                      TM-ALU-INCR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-INCR-MOD A B))
                           '65536)
                    '*1*TRUE)
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY INCR-MOD TM-ALU-INCR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-INCR-MOD A B))
                    '65536)
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY INCR-MOD TM-ALU-INCR-MOD)
              (USE (LESSP-REMAINDER2 (X A) (Y '65536))
                   (LESSP-REMAINDER2 (X B) (Y '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-INCR-MOD A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-INCR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD)

(PROVE-LEMMA TM-ALU-INCR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (AND (LESSP A '65536)
                           (LESSP B '65536))
                      (EQUAL (ALU-VALUE (TM-ALU-INCR-MOD A B))
                             (INCR-MOD A B)))
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY INCR-MOD
                      TM-ALU-INCR-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-INCR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-MOD A B))
                             '65536)
             ((ENABLE FINITE-NUMBERP LESSP-REMAINDER2 ALU-RESULT ALU-VALUE
                      ALU-CARRY TM-ALU-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-MOD A B))
                           '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-MOD A B))
                    '65536)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-MOD
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-MOD A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-MOD)

(PROVE-LEMMA TM-ALU-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP B))
                           (LESSP B '65536))
                      (EQUAL (ALU-VALUE (TM-ALU-MOD A B))
                             (REMAINDER A B)))
             ((ENABLE REMAINDER-NOOP ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-MOD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-MULT A B))
                             '65536)
             ((ENABLE FINITE-NUMBERP LESSP-REMAINDER2 ALU-RESULT ALU-VALUE
                      ALU-CARRY TM-ALU-MULT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-MULT A B))
                           '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-MULT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-MULT A B))
                    '65536)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-MULT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-MULT
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-MULT A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-MULT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-MULT)

(PROVE-LEMMA TM-ALU-MULT-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (LESSP (TIMES A B) '65536)
                      (EQUAL (ALU-VALUE (TM-ALU-MULT A B))
                             (TIMES A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-MULT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-MULT-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(PROVE-LEMMA FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS
             (REWRITE)
             (FINITE-NUMBERP (ALU-VALUE (TM-ALU-PLUS A B))
                             '65536)
             ((ENABLE FINITE-NUMBERP LESSP-REMAINDER2 ALU-RESULT ALU-VALUE
                      ALU-CARRY TM-ALU-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE
             (REWRITE)
             (EQUAL (LESSP (ALU-VALUE (TM-ALU-PLUS A B))
                           '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE)

(PROVE-LEMMA LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE-LINEAR
             (REWRITE)
             (LESSP (ALU-VALUE (TM-ALU-PLUS A B))
                    '65536)
             ((ENABLE LESSP-REMAINDER2 ALU-RESULT ALU-VALUE ALU-CARRY
                      TM-ALU-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE-LINEAR)

(PROVE-LEMMA NUMBERP-ALU-VALUE-TM-ALU-PLUS
             (REWRITE)
             (NUMBERP (ALU-VALUE (TM-ALU-PLUS A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-ALU-VALUE-TM-ALU-PLUS)

(PROVE-LEMMA TM-ALU-PLUS-VALUE-IDENTICAL-TO-IDEAL-RESULT
             (REWRITE)
             (IMPLIES (LESSP (PLUS A B) '65536)
                      (EQUAL (ALU-VALUE (TM-ALU-PLUS A B))
                             (PLUS A B)))
             ((ENABLE ALU-RESULT ALU-VALUE ALU-CARRY TM-ALU-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ALU-PLUS-VALUE-IDENTICAL-TO-IDEAL-RESULT)

(DEFTHEORY
 TM-ALU-ARITHMETIC
 (TM-ALU-PLUS-VALUE-IDENTICAL-TO-IDEAL-RESULT NUMBERP-ALU-VALUE-TM-ALU-PLUS
                                LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-PLUS-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS
                                TM-ALU-MULT-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-MULT
                                LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-MULT-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT
                                TM-ALU-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-MOD
                                LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-MOD-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD
                                TM-ALU-INCR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
                                LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-INCR-MOD-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
                                TM-ALU-INCR-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-INCR
                                LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-INCR-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR
                                TM-ALU-DECR-MOD-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
                                LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-DECR-MOD-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
                                TM-ALU-DECR-VALUE-IDENTICAL-TO-IDEAL-RESULT
                                NUMBERP-ALU-VALUE-TM-ALU-DECR
                                LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE-LINEAR
                                LESSP-ALU-VALUE-TM-ALU-DECR-WORDSIZE
                                FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR))

(DEFN TM-INCR
      (A)
      (REMAINDER (ADD1 A) '65536)
      NIL)

(DEFN TM-INCRN
      (N A)
      (IF (ZEROP N)
          A
          (TM-INCR (TM-INCRN (SUB1 N) A)))
      NIL)

(DEFN TM-DECR
      (A)
      (IF (ZEROP A) '65535 (SUB1 A))
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-TM-INCR
             (REWRITE)
             (FINITE-NUMBERP (TM-INCR A) '65536)
             ((ENABLE FINITE-NUMBERP-REMAINDER TM-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INCR)

(PROVE-LEMMA FINITE-NUMBERP-TM-INCRN
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP A '65536)
                      (FINITE-NUMBERP (TM-INCRN N A)
                                      '65536))
             ((ENABLE TM-INCRN FINITE-NUMBERP-TM-INCR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INCRN)

(PROVE-LEMMA FINITE-NUMBERP-TM-DECR
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP A '65536)
                      (FINITE-NUMBERP (TM-DECR A) '65536))
             ((ENABLE FINITE-NUMBERP TM-DECR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-DECR)

(ADD-SHELL TM
           NIL TM-SHELLP
           ((TM-MEMORY (NONE-OF) ZERO)
            (TM-REGS (NONE-OF) ZERO)
            (TM-CC (NONE-OF) ZERO)
            (TM-ERROR (NONE-OF) ZERO)
            (TM-SVCFLAG (NONE-OF) ZERO)
            (TM-SVCID (NONE-OF) ZERO)
            (TM-BASE (NONE-OF) ZERO)
            (TM-LIMIT (NONE-OF) ZERO)
            (TM-SLIMIT (NONE-OF) ZERO)
            (TM-SVMODE (NONE-OF) ZERO)
            (TM-RWSTATE (NONE-OF) ZERO)
            (TM-CLOCK (NONE-OF) ZERO)
            (TM-IPORTS (NONE-OF) ZERO)
            (TM-OPORTS (NONE-OF) ZERO)))

(DEFN TM-REGSIZE NIL '3 NIL)

(DEFN TM-CHARSIZE NIL '8 NIL)

(DEFN TM-CCSIZE NIL '2 NIL)

(DEFN TM-ERRORSIZE NIL '6 NIL)

(DEFN TM-SVCFLAGSIZE NIL '1 NIL)

(DEFN TM-SVCIDSIZE NIL '7 NIL)

(DEFN TM-CCLUB NIL '4 NIL)

(DEFN TM-ERRORLUB NIL '64 NIL)

(DEFN TM-SVCFLAGLUB NIL '2 NIL)

(DEFN TM-SVCIDLUB NIL '128 NIL)

(DEFN TM-REGLENGTH NIL '8 NIL)

(DEFN TM-MEMLENGTH NIL '65536 NIL)

(DEFN TM-CHARLUB NIL '256 NIL)

(DEFN TM-PORT-LENGTH NIL '16 NIL)

(DEFN TM-PC-ADDRESS NIL '0 NIL)

(DEFN TM-SP-ADDRESS NIL '1 NIL)

(DEFN TM-SET-MEMORY
      (MEMORY TM)
      (TM MEMORY
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-REGS
      (REGS TM)
      (TM (TM-MEMORY TM)
          REGS
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-CC
      (CC TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          CC
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-ERROR
      (ERROR TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          ERROR
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-SVCFLAG
      (SVCFLAG TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          SVCFLAG
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-SVCID
      (SVCID TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          SVCID
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-BASE
      (BASE TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          BASE
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-LIMIT
      (LIMIT TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          LIMIT
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-SLIMIT
      (SLIMIT TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          SLIMIT
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-SVMODE
      (SVMODE TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          SVMODE
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-RWSTATE
      (RWSTATE TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          RWSTATE
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-CLOCK
      (CLOCK TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          CLOCK
          (TM-IPORTS TM)
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-IPORTS
      (IPORTS TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          IPORTS
          (TM-OPORTS TM))
      NIL)

(DEFN TM-SET-OPORTS
      (OPORTS TM)
      (TM (TM-MEMORY TM)
          (TM-REGS TM)
          (TM-CC TM)
          (TM-ERROR TM)
          (TM-SVCFLAG TM)
          (TM-SVCID TM)
          (TM-BASE TM)
          (TM-LIMIT TM)
          (TM-SLIMIT TM)
          (TM-SVMODE TM)
          (TM-RWSTATE TM)
          (TM-CLOCK TM)
          (TM-IPORTS TM)
          OPORTS)
      NIL)

(DEFN TM-PC
      (TM)
      (GETNTH '0 (TM-REGS TM))
      NIL)

(DEFN TM-SET-PC
      (PC TM)
      (TM-SET-REGS (PUTNTH PC '0 (TM-REGS TM))
                   TM)
      NIL)

(DEFN TM-SP
      (TM)
      (GETNTH '1 (TM-REGS TM))
      NIL)

(DEFN TM-SET-SP
      (SP TM)
      (TM-SET-REGS (PUTNTH SP '1 (TM-REGS TM))
                   TM)
      NIL)

(DEFN TM-NON-ZERO-NO-CARRY-CONDITION NIL '0
      NIL)

(DEFN TM-ZERO-NO-CARRY-CONDITION NIL '1
      NIL)

(DEFN TM-NON-ZERO-CARRY-CONDITION NIL '2
      NIL)

(DEFN TM-ZERO-CARRY-CONDITION NIL '3
      NIL)

(DEFN TM-CC-VALUE
      (ALU-RESULT)
      (IF (ZEROP (ALU-VALUE ALU-RESULT))
          (IF (FALSEP (ALU-CARRY ALU-RESULT))
              '1
              '3)
          (IF (FALSEP (ALU-CARRY ALU-RESULT))
              '0
              '2))
      NIL)

(DEFN TM-CC-DIVISOR NIL '4 NIL)

(DEFN TM-ERROR-DIVISOR NIL '256 NIL)

(DEFN TM-SVCFLAG-DIVISOR
      NIL '512
      NIL)

(DEFN TM-PACK-PSW
      (CC ERROR SVCFLAG SVCID)
      (PLUS CC
            (PLUS (TIMES ERROR '4)
                  (PLUS (TIMES SVCFLAG '256)
                        (TIMES SVCID '512))))
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-TM-PACK-PSW1
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBERP CC '4)
                           (AND (FINITE-NUMBERP ERROR '64)
                                (AND (FINITE-NUMBERP SVCFLAG '2)
                                     (FINITE-NUMBERP SVCID '128))))
                      (FINITE-NUMBERP (TM-PACK-PSW CC ERROR SVCFLAG SVCID)
                                      '65536))
             ((ENABLE TM-PACK-PSW FINITE-NUMBERP COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-PACK-PSW1)

(DEFN TM-UNPACK-CC
      (PSW)
      (REMAINDER PSW '4)
      NIL)

(DEFN TM-UNPACK-ERROR
      (PSW)
      (QUOTIENT (REMAINDER PSW '256) '4)
      NIL)

(DEFN TM-UNPACK-SVCFLAG
      (PSW)
      (QUOTIENT (REMAINDER PSW '512) '256)
      NIL)

(DEFN TM-UNPACK-SVCID
      (PSW)
      (QUOTIENT PSW '512)
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-TM-UNPACK-CC
             (REWRITE)
             (FINITE-NUMBERP (TM-UNPACK-CC PSW)
                             '4)
             ((ENABLE TM-UNPACK-CC FINITE-NUMBERP LESSP-REMAINDER2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-UNPACK-CC)

(PROVE-LEMMA FINITE-NUMBERP-TM-UNPACK-ERROR
             (REWRITE)
             (FINITE-NUMBERP (TM-UNPACK-ERROR PSW)
                             '64)
             ((ENABLE TM-UNPACK-ERROR FINITE-NUMBERP LESSP-REMAINDER2)
              (USE (LESSP-QUOTIENT-REMAINDER (A PSW)
                                             (B '64)
                                             (C '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-UNPACK-ERROR)

(PROVE-LEMMA FINITE-NUMBERP-TM-UNPACK-SVCFLAG
             (REWRITE)
             (FINITE-NUMBERP (TM-UNPACK-SVCFLAG PSW)
                             '2)
             ((ENABLE TM-UNPACK-SVCFLAG FINITE-NUMBERP LESSP-REMAINDER2)
              (USE (LESSP-QUOTIENT-REMAINDER (A PSW)
                                             (B '2)
                                             (C '256)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-UNPACK-SVCFLAG)

(PROVE-LEMMA FINITE-NUMBERP-TM-UNPACK-SVCID
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP PSW '65536)
                      (FINITE-NUMBERP (TM-UNPACK-SVCID PSW)
                                      '128))
             ((ENABLE TM-UNPACK-SVCID FINITE-NUMBERP LESSP-QUOTIENT-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-UNPACK-SVCID)

(DEFN TM-REGISTER-SAVE-AREA-ADDR
      NIL '0
      NIL)

(DEFN TM-CLOCK-NEW-PC-ADDR NIL '3
      NIL)

(DEFN TM-ERROR-NEW-PC-ADDR NIL '4
      NIL)

(DEFN TM-SVC-NEW-PC-ADDR NIL '5 NIL)

(DEFN TM-INPUT-NEW-PC-ADDR NIL
      '6
      NIL)

(DEFN TM-OUTPUT-NEW-PC-ADDR NIL '7
      NIL)

(DEFN TM-SVCID-ADDR NIL '8 NIL)

(DEFN TM-INPUT-DEVID-ADDR NIL '8 NIL)

(DEFN TM-INPUT-CHAR-ADDR NIL '9 NIL)

(DEFN TM-OUTPUT-DEVID-ADDR
      NIL '9
      NIL)

(DEFN TM-NO-ERROR NIL '0 NIL)

(DEFN TM-HALT-STATUS NIL '1 NIL)

(DEFN TM-OPCODE-ERROR NIL '2 NIL)

(DEFN TM-PRIVILEGE-ERROR NIL '3 NIL)

(DEFN TM-STACK-OVERFLOW-ERROR
      NIL '4
      NIL)

(DEFN TM-STACK-UNDERFLOW-ERROR NIL '5
      NIL)

(DEFN TM-ADDRESS-ERROR NIL '6 NIL)

(DEFN TM-PC-ADDRESS-ERROR NIL '7 NIL)

(DEFN TM-SUPERVISOR-MODE NIL '1 NIL)

(DEFN TM-USER-MODE NIL '0 NIL)

(DEFN TM-IN-SUPERVISOR-MODE
      (TM)
      (EQUAL (TM-SVMODE TM) '1)
      NIL)

(DEFN TM-WAIT-STATE NIL '1 NIL)

(DEFN TM-RUN-STATE NIL '0 NIL)

(DEFN TM-WAITING
      (TM)
      (EQUAL (TM-RWSTATE TM) '1)
      NIL)

(DEFN TM-SVC NIL '1 NIL)

(DEFN TM-NO-SVC NIL '0 NIL)

(DEFN TM-CLEARED-SVCFLAG NIL '0 NIL)

(ADD-SHELL TM-IPORT
           NIL TM-IPORTP
           ((TM-IINTERRUPT-FLAG (NONE-OF) ZERO)
            (TM-IERROR-FLAG (NONE-OF) ZERO)
            (TM-ICHAR (NONE-OF) ZERO)))

(ADD-SHELL TM-OPORT NIL TM-OPORTP
           ((TM-OINTERRUPT-FLAG (NONE-OF) ZERO)
            (TM-OBUSY-FLAG (NONE-OF) ZERO)
            (TM-OCHAR (NONE-OF) ZERO)))

(DEFN TM-IPORT-ERRORP
      (ID PORTS)
      (EQUAL (TM-IERROR-FLAG (GETNTH ID PORTS))
             '1)
      NIL)

(DEFN TM-CLEAR-INPUT-INTERRUPT
      (ID PORTS)
      (PUTNTH (TM-IPORT '0
                        (TM-IERROR-FLAG (GETNTH ID PORTS))
                        (TM-ICHAR (GETNTH ID PORTS)))
              ID PORTS)
      NIL)

(DEFN TM-POST-INPUT-INTERRUPT
      (CHAR ID PORTS)
      (PUTNTH (TM-IPORT '1
                        (TM-IINTERRUPT-FLAG (GETNTH ID PORTS))
                        CHAR)
              ID PORTS)
      NIL)

(DEFN TM-OPORT-IDLEP
      (ID PORTS)
      (EQUAL (TM-OBUSY-FLAG (GETNTH ID PORTS))
             '0)
      NIL)

(DEFN TM-START-OUTPUT
      (CHAR ID PORTS)
      (PUTNTH (TM-OPORT '0
                        '1
                        (REMAINDER CHAR '256))
              ID PORTS)
      NIL)

(DEFN TM-POST-OUTPUT-INTERRUPT
      (ID PORTS)
      (PUTNTH '(*1*QUOTE TM-OPORT 1 0 0)
              ID PORTS)
      NIL)

(DEFN TM-CLEAR-OUTPUT-INTERRUPT
      (ID PORTS)
      (PUTNTH (TM-OPORT '0
                        (TM-OBUSY-FLAG (GETNTH ID PORTS))
                        (TM-OCHAR (GETNTH ID PORTS)))
              ID PORTS)
      NIL)

(DEFN REAL-ADDR
      (SOURCE NUM)
      (CONS SOURCE (CONS NUM 'NIL))
      NIL)

(DEFN REAL-ADDR-SOURCE
      (REAL-ADDR)
      (CAR REAL-ADDR)
      NIL)

(DEFN REAL-ADDR-NUM
      (REAL-ADDR)
      (CAR (CDR REAL-ADDR))
      NIL)

(DEFN TM-ARG-MODE (X) (CAR X) NIL)

(DEFN TM-ARG-DATUM
      (X)
      (CAR (CDR X))
      NIL)

(DEFN TM-ARG-INDEX
      (X)
      (CAR (CDR (CDR X)))
      NIL)

(DEFN TM-FIX-WORD
      (N)
      (REMAINDER N '65536)
      NIL)

(DEFN TM-FIX-REG-ADDRESS
      (N)
      (REMAINDER N '8)
      NIL)

(DEFN TM-COMPUTE-ADDRESS
 (ARG TM)
 (IF
  (ZEROP (TM-ARG-MODE ARG))
  (REAL-ADDR '0
             (TM-FIX-WORD (PLUS (TM-ARG-DATUM ARG)
                                (TM-ARG-INDEX ARG))))
  (IF
   (EQUAL (TM-ARG-MODE ARG) '1)
   (REAL-ADDR '1
              (TM-FIX-REG-ADDRESS (TM-ARG-DATUM ARG)))
   (IF
    (EQUAL (TM-ARG-MODE ARG) '2)
    (REAL-ADDR '2
               (TM-FIX-WORD (PLUS (TM-ARG-DATUM ARG)
                                  (TM-ARG-INDEX ARG))))
    (REAL-ADDR '2
             (TM-FIX-WORD (PLUS (GETNTH (TM-FIX-REG-ADDRESS (TM-ARG-DATUM ARG))
                                        (TM-REGS TM))
                                (TM-ARG-INDEX ARG)))))))
 NIL)

(DEFN TM-GOOD-ADDRESS
      (ADDR TM)
      (IF (ZEROP (REAL-ADDR-SOURCE ADDR))
          (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                          '65536)
          (IF (EQUAL (REAL-ADDR-SOURCE ADDR) '1)
              (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                              '8)
              (IF (TM-IN-SUPERVISOR-MODE TM)
                  (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                                  '65536)
                  (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                                  (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                       (TM-LIMIT TM))))))
      NIL)

(DEFN TM-INCR-ADDRESS
      (ADDR)
      (IF (ZEROP (REAL-ADDR-SOURCE ADDR))
          (REAL-ADDR (REAL-ADDR-SOURCE ADDR)
                     (TM-INCR (REAL-ADDR-NUM ADDR)))
          (IF (EQUAL (REAL-ADDR-SOURCE ADDR) '1)
              (REAL-ADDR (REAL-ADDR-SOURCE ADDR)
                         (REMAINDER (ADD1 (REAL-ADDR-NUM ADDR))
                                    '8))
              (REAL-ADDR (REAL-ADDR-SOURCE ADDR)
                         (TM-INCR (REAL-ADDR-NUM ADDR)))))
      NIL)

(DEFN TM-INCRN-ADDRESS
      (N A)
      (IF (ZEROP N)
          A
          (TM-INCR-ADDRESS (TM-INCRN-ADDRESS (SUB1 N) A)))
      NIL)

(DEFN TM-FETCH-FROM-MEMORY
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (GETNTH ADDR (TM-MEMORY TM))
          (GETNTH (PLUS (TM-BASE TM) ADDR)
                  (TM-MEMORY TM)))
      NIL)

(DEFN TM-STORE-IN-MEMORY
      (VALUE ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-MEMORY (PUTNTH VALUE ADDR (TM-MEMORY TM))
                         TM)
          (TM-SET-MEMORY (PUTNTH VALUE
                                 (PLUS (TM-BASE TM) ADDR)
                                 (TM-MEMORY TM))
                         TM))
      NIL)

(DEFN TM-FETCH-FROM-REGMEM
      (ADDR TM)
      (GETNTH ADDR (TM-REGS TM))
      NIL)

(DEFN TM-STORE-IN-REGMEM
      (VALUE ADDR TM)
      (TM-SET-REGS (PUTNTH VALUE ADDR (TM-REGS TM))
                   TM)
      NIL)

(DEFN TM-FETCH
      (ADDR TM)
      (IF (ZEROP (REAL-ADDR-SOURCE ADDR))
          (REAL-ADDR-NUM ADDR)
          (IF (EQUAL (REAL-ADDR-SOURCE ADDR) '1)
              (TM-FETCH-FROM-REGMEM (REAL-ADDR-NUM ADDR)
                                    TM)
              (TM-FETCH-FROM-MEMORY (REAL-ADDR-NUM ADDR)
                                    TM)))
      NIL)

(DEFN TM-STORE
      (VALUE ADDR TM)
      (IF (ZEROP (REAL-ADDR-SOURCE ADDR))
          TM
          (IF (EQUAL (REAL-ADDR-SOURCE ADDR) '1)
              (TM-STORE-IN-REGMEM VALUE
                                  (REAL-ADDR-NUM ADDR)
                                  TM)
              (TM-STORE-IN-MEMORY VALUE
                                  (REAL-ADDR-NUM ADDR)
                                  TM)))
      NIL)

(DEFN TM-STACK-OVERFLOWP
      (TM)
      (ZEROP (TM-SP TM))
      NIL)

(DEFN TM-STACK-UNDERFLOWP
      (TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (NOT (LESSP (ADD1 (TM-SP TM))
                      (TM-SLIMIT TM)))
          (NOT (LESSP (ADD1 (TM-SP TM))
                      (MIN (DIFFERENCE '65536 (TM-BASE TM))
                           (TM-LIMIT TM)))))
      NIL)

(PROVE-LEMMA TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS
             (REWRITE)
             (IMPLIES (AND (NOT (TM-STACK-UNDERFLOWP TM))
                           (FINITE-NUMBERP (TM-SLIMIT TM)
                                           '65536))
                      (TM-GOOD-ADDRESS (REAL-ADDR '2 (ADD1 (TM-SP TM)))
                                       TM))
             ((ENABLE TM-STACK-UNDERFLOWP TM-GOOD-ADDRESS MIN FINITE-NUMBERP
                      REAL-ADDR REAL-ADDR-NUM REAL-ADDR-SOURCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS)

(DEFN TM-EXECUTE-ADD
      (ADDR1 ADDR2 TM)
      (TM-STORE (ALU-VALUE (TM-ALU-PLUS (TM-FETCH ADDR1 TM)
                                        (TM-FETCH ADDR2 TM)))
                ADDR1
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-PLUS (TM-FETCH ADDR1 TM)
                                                     (TM-FETCH ADDR2 TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-BRANCH
      (ADDR TM)
      (TM-SET-PC (TM-FETCH ADDR TM) TM)
      NIL)

(DEFN TM-EXECUTE-BRANCH-ON-ZERO
      (ADDR TM)
      (IF (EQUAL (TM-CC TM) '1)
          (TM-SET-PC (TM-FETCH ADDR TM) TM)
          TM)
      NIL)

(DEFN TM-EXECUTE-BRANCH-NOT-ZERO
      (ADDR TM)
      (IF (EQUAL (TM-CC TM) '1)
          TM
          (TM-SET-PC (TM-FETCH ADDR TM) TM))
      NIL)

(DEFN TM-EXECUTE-CALL
      (ADDR TM)
      (IF (TM-STACK-OVERFLOWP TM)
          (TM-SET-ERROR '4 TM)
          (IF (TM-GOOD-ADDRESS (REAL-ADDR '2 (TM-SP TM))
                               TM)
              (TM-STORE (TM-PC TM)
                        (REAL-ADDR '2 (TM-SP TM))
                        (TM-SET-PC (TM-FETCH ADDR TM)
                                   (TM-SET-SP (TM-DECR (TM-SP TM)) TM)))
              (TM-SET-ERROR '6 TM)))
      NIL)

(DEFN TM-EXECUTE-COMPARE
      (ADDR1 ADDR2 TM)
      (TM-SET-CC (TM-CC-VALUE (TM-ALU-DIFFERENCE (TM-FETCH ADDR1 TM)
                                                 (TM-FETCH ADDR2 TM)))
                 TM)
      NIL)

(DEFN TM-EXECUTE-DECR
      (ADDR TM)
      (TM-STORE (ALU-VALUE (TM-ALU-DECR (TM-FETCH ADDR TM)))
                ADDR
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-DECR (TM-FETCH ADDR TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-DECR-MOD
      (ADDR1 ADDR2 TM)
      (TM-STORE (ALU-VALUE (TM-ALU-DECR-MOD (TM-FETCH ADDR1 TM)
                                            (TM-FETCH ADDR2 TM)))
                ADDR1
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-DECR-MOD (TM-FETCH ADDR1 TM)
                                                         (TM-FETCH ADDR2 TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-INCR
      (ADDR TM)
      (TM-STORE (ALU-VALUE (TM-ALU-INCR (TM-FETCH ADDR TM)))
                ADDR
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-INCR (TM-FETCH ADDR TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-INCR-MOD
      (ADDR1 ADDR2 TM)
      (TM-STORE (ALU-VALUE (TM-ALU-INCR-MOD (TM-FETCH ADDR1 TM)
                                            (TM-FETCH ADDR2 TM)))
                ADDR1
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-INCR-MOD (TM-FETCH ADDR1 TM)
                                                         (TM-FETCH ADDR2 TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-LOAD-BASE
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-BASE (TM-FETCH ADDR TM) TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-LOAD-LIMIT
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-LIMIT (TM-FETCH ADDR TM) TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-LOAD-PSW
 (ADDR TM)
 (IF
  (TM-IN-SUPERVISOR-MODE TM)
  (TM-SET-SVMODE '0
   (TM-SET-PC
    (TM-FETCH ADDR TM)
    (TM-SET-SP
     (TM-FETCH (TM-INCRN-ADDRESS '1 ADDR)
               TM)
     (TM-SET-CC
      (TM-UNPACK-CC (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                              TM))
      (TM-SET-ERROR
       (TM-UNPACK-ERROR (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                                  TM))
       (TM-SET-SVCFLAG
           (TM-UNPACK-SVCFLAG (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                                        TM))
           (TM-SET-SVCID (TM-UNPACK-SVCID (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                                                    TM))
                         TM)))))))
  (TM-SET-ERROR '3 TM))
 NIL)

(DEFN TM-EXECUTE-MOD
      (ADDR1 ADDR2 TM)
      (TM-STORE (ALU-VALUE (TM-ALU-MOD (TM-FETCH ADDR1 TM)
                                       (TM-FETCH ADDR2 TM)))
                ADDR1
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-MOD (TM-FETCH ADDR1 TM)
                                                    (TM-FETCH ADDR2 TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-MOVE
      (ADDR1 ADDR2 TM)
      (TM-STORE (TM-FETCH ADDR2 TM)
                ADDR1 TM)
      NIL)

(DEFN TM-EXECUTE-MULTIPLY
      (ADDR1 ADDR2 TM)
      (TM-STORE (ALU-VALUE (TM-ALU-MULT (TM-FETCH ADDR1 TM)
                                        (TM-FETCH ADDR2 TM)))
                ADDR1
                (TM-SET-CC (TM-CC-VALUE (TM-ALU-MULT (TM-FETCH ADDR1 TM)
                                                     (TM-FETCH ADDR2 TM)))
                           TM))
      NIL)

(DEFN TM-EXECUTE-POST-OUTPUT-INTERRUPT
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-OPORTS (TM-POST-OUTPUT-INTERRUPT (TM-FETCH ADDR TM)
                                                   (TM-OPORTS TM))
                         TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-RETURN
      (TM)
      (IF (TM-STACK-UNDERFLOWP TM)
          (TM-SET-ERROR '5 TM)
          (TM-SET-PC (TM-FETCH (REAL-ADDR '2 (TM-INCR (TM-SP TM)))
                               TM)
                     (TM-SET-SP (TM-INCR (TM-SP TM)) TM)))
      NIL)

(DEFN TM-EXECUTE-RUN
      (TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-RWSTATE '0 TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-SET-CLOCK
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-CLOCK (TM-FETCH ADDR TM) TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-START-OUTPUT
      (ADDR1 ADDR2 TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-OPORTS (TM-START-OUTPUT (TM-FETCH ADDR2 TM)
                                          (TM-FETCH ADDR1 TM)
                                          (TM-OPORTS TM))
                         TM)
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-SVC
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          TM
          (TM-SET-SVCFLAG '1
                          (TM-SET-SVCID (REMAINDER (TM-FETCH ADDR TM) '128)
                                        TM)))
      NIL)

(DEFN TM-EXECUTE-SVC-RETURN
 (ADDR TM)
 (IF
  (TM-IN-SUPERVISOR-MODE TM)
  (TM-SET-SVMODE '0
   (TM-SET-PC
    (TM-FETCH ADDR TM)
    (TM-SET-SP
     (TM-FETCH (TM-INCRN-ADDRESS '1 ADDR)
               TM)
     (TM-SET-CC
      (TM-UNPACK-CC (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                              TM))
      (TM-SET-ERROR
       (TM-UNPACK-ERROR (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                                  TM))
       (TM-SET-SVCFLAG '0
           (TM-SET-SVCID (TM-UNPACK-SVCID (TM-FETCH (TM-INCRN-ADDRESS '2 ADDR)
                                                    TM))
                         TM)))))))
  (TM-SET-ERROR '3 TM))
 NIL)

(DEFN TM-EXECUTE-TEST-IPORT
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (IF (TM-IPORT-ERRORP (REMAINDER (TM-FETCH ADDR TM) '16)
                               (TM-IPORTS TM))
              (TM-SET-CC '1 TM)
              (TM-SET-CC '0 TM))
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-TEST-OPORT
      (ADDR TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (IF (TM-OPORT-IDLEP (REMAINDER (TM-FETCH ADDR TM) '16)
                              (TM-OPORTS TM))
              (TM-SET-CC '1 TM)
              (TM-SET-CC '0 TM))
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-EXECUTE-WAIT
      (TM)
      (IF (TM-IN-SUPERVISOR-MODE TM)
          (TM-SET-RWSTATE '1
                          (TM-SET-SVMODE '0 TM))
          (TM-SET-ERROR '3 TM))
      NIL)

(DEFN TM-OPCODE-SIZE NIL '6 NIL)

(DEFN TM-MODE-SIZE NIL '2 NIL)

(DEFN TM-INDEX-SIZE NIL '3 NIL)

(DEFN TM-OPCODE-DIVISOR NIL '64 NIL)

(DEFN TM-MODE1-DIVISOR NIL '256 NIL)

(DEFN TM-INDEX1-DIVISOR
      NIL '2048
      NIL)

(DEFN TM-MODE2-DIVISOR NIL '8192 NIL)

(DEFN TM-OPCODE
      (INSTRUCTION)
      (REMAINDER INSTRUCTION '64)
      NIL)

(DEFN TM-MODE1
      (INSTRUCTION)
      (QUOTIENT (REMAINDER INSTRUCTION '256)
                '64)
      NIL)

(DEFN TM-INDEX1
      (INSTRUCTION)
      (QUOTIENT (REMAINDER INSTRUCTION '2048)
                '256)
      NIL)

(DEFN TM-MODE2
      (INSTRUCTION)
      (QUOTIENT (REMAINDER INSTRUCTION '8192)
                '2048)
      NIL)

(DEFN TM-INDEX2
      (INSTRUCTION)
      (QUOTIENT INSTRUCTION '8192)
      NIL)

(DEFN TM-NULLARY-INSTRUCTIONP
      (INSTRUCTION)
      (EQUAL (REMAINDER (TM-OPCODE INSTRUCTION)
                        '4)
             '0)
      NIL)

(DEFN TM-UNARY-INSTRUCTIONP
      (INSTRUCTION)
      (EQUAL (REMAINDER (TM-OPCODE INSTRUCTION)
                        '2)
             '0)
      NIL)

(DEFN TM-DATUM1
      (INSTRUCTION-LIST)
      (CAR (CDR INSTRUCTION-LIST))
      NIL)

(DEFN TM-DATUM2
      (INSTRUCTION-LIST)
      (CAR (CDR (CDR INSTRUCTION-LIST)))
      NIL)

(DEFN TM-ARG1
      (INSTRUCTION-LIST)
      (CONS (TM-MODE1 (CAR INSTRUCTION-LIST))
            (CONS (TM-DATUM1 INSTRUCTION-LIST)
                  (CONS (TM-INDEX1 (CAR INSTRUCTION-LIST))
                        'NIL)))
      NIL)

(DEFN TM-ARG2
      (INSTRUCTION-LIST)
      (CONS (TM-MODE2 (CAR INSTRUCTION-LIST))
            (CONS (TM-DATUM2 INSTRUCTION-LIST)
                  (CONS (TM-INDEX2 (CAR INSTRUCTION-LIST))
                        'NIL)))
      NIL)

(DEFN TM-RETURN-OPCODE NIL '0 NIL)

(DEFN TM-WAIT-OPCODE NIL '4 NIL)

(DEFN TM-RUN-OPCODE NIL '8 NIL)

(DEFN TM-EXECUTE-NULLARY
      (OPCODE TM)
      (IF (EQUAL OPCODE '0)
          (TM-EXECUTE-RETURN TM)
          (IF (EQUAL OPCODE '8)
              (TM-EXECUTE-RUN TM)
              (IF (EQUAL OPCODE '4)
                  (TM-EXECUTE-WAIT TM)
                  (TM-SET-ERROR '2 TM))))
      NIL)

(DEFN TM-BR-OPCODE NIL '2 NIL)

(DEFN TM-BRNZ-OPCODE NIL '6 NIL)

(DEFN TM-BRZ-OPCODE NIL '10 NIL)

(DEFN TM-CALL-OPCODE NIL '14 NIL)

(DEFN TM-DECR-OPCODE NIL '18 NIL)

(DEFN TM-INCR-OPCODE NIL '22 NIL)

(DEFN TM-LBASE-OPCODE NIL '26 NIL)

(DEFN TM-LLIMIT-OPCODE NIL '30 NIL)

(DEFN TM-LPSW-OPCODE NIL '34 NIL)

(DEFN TM-POST-OPCODE NIL '38 NIL)

(DEFN TM-SVC-OPCODE NIL '42 NIL)

(DEFN TM-SVC-RETURN-OPCODE
      NIL '46
      NIL)

(DEFN TM-TESTI-OPCODE NIL '50 NIL)

(DEFN TM-TESTO-OPCODE NIL '54 NIL)

(DEFN TM-TIME-OPCODE NIL '58 NIL)

(DEFN
 TM-EXECUTE-UNARY
 (OPCODE ADDR TM)
 (IF
  (NOT (TM-GOOD-ADDRESS ADDR TM))
  (TM-SET-ERROR '6 TM)
  (IF
   (EQUAL OPCODE '2)
   (TM-EXECUTE-BRANCH ADDR TM)
   (IF
    (EQUAL OPCODE '10)
    (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM)
    (IF
     (EQUAL OPCODE '6)
     (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM)
     (IF
      (EQUAL OPCODE '14)
      (TM-EXECUTE-CALL ADDR TM)
      (IF
       (EQUAL OPCODE '18)
       (TM-EXECUTE-DECR ADDR TM)
       (IF
        (EQUAL OPCODE '22)
        (TM-EXECUTE-INCR ADDR TM)
        (IF
         (EQUAL OPCODE '26)
         (TM-EXECUTE-LOAD-BASE ADDR TM)
         (IF (EQUAL OPCODE '30)
             (TM-EXECUTE-LOAD-LIMIT ADDR TM)
             (IF (EQUAL OPCODE '34)
                 (TM-EXECUTE-LOAD-PSW ADDR TM)
                 (IF (EQUAL OPCODE '58)
                     (TM-EXECUTE-SET-CLOCK ADDR TM)
                     (IF (EQUAL OPCODE '50)
                         (TM-EXECUTE-TEST-IPORT ADDR TM)
                         (IF (EQUAL OPCODE '54)
                             (TM-EXECUTE-TEST-OPORT ADDR TM)
                             (IF (EQUAL OPCODE '42)
                                 (TM-EXECUTE-SVC ADDR TM)
                                 (IF (EQUAL OPCODE '46)
                                     (TM-EXECUTE-SVC-RETURN ADDR TM)
                                     (IF (EQUAL OPCODE '38)
                                         (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                           TM)
                                         (TM-SET-ERROR '2 TM)))))))))))))))))
 NIL)

(DEFN TM-ADD-OPCODE NIL '1 NIL)

(DEFN TM-COMPARE-OPCODE NIL '3 NIL)

(DEFN TM-DECR-MOD-OPCODE NIL '5 NIL)

(DEFN TM-INCR-MOD-OPCODE NIL '7 NIL)

(DEFN TM-MOD-OPCODE NIL '9 NIL)

(DEFN TM-MOVE-OPCODE NIL '11 NIL)

(DEFN TM-MULT-OPCODE NIL '13 NIL)

(DEFN TM-STOUT-OPCODE NIL '15 NIL)

(DEFN TM-EXECUTE-BINARY
      (OPCODE ADDR1 ADDR2 TM)
      (IF (OR (NOT (TM-GOOD-ADDRESS ADDR1 TM))
              (NOT (TM-GOOD-ADDRESS ADDR2 TM)))
          (TM-SET-ERROR '6 TM)
          (IF (EQUAL OPCODE '1)
              (TM-EXECUTE-ADD ADDR1 ADDR2 TM)
              (IF (EQUAL OPCODE '3)
                  (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM)
                  (IF (EQUAL OPCODE '5)
                      (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM)
                      (IF (EQUAL OPCODE '7)
                          (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM)
                          (IF (EQUAL OPCODE '9)
                              (TM-EXECUTE-MOD ADDR1 ADDR2 TM)
                              (IF (EQUAL OPCODE '11)
                                  (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)
                                  (IF (EQUAL OPCODE '13)
                                      (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM)
                                      (IF (EQUAL OPCODE '15)
                                          (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2
                                                                   TM)
                                          (TM-SET-ERROR '2 TM))))))))))
      NIL)

(DEFN TM-EXECUTE-INSTRUCTION
      (INSTRUCTION TM)
      (IF (EQUAL (LENGTH INSTRUCTION) '1)
          (TM-EXECUTE-NULLARY (TM-OPCODE (CAR INSTRUCTION))
                              TM)
          (IF (EQUAL (LENGTH INSTRUCTION) '2)
              (TM-EXECUTE-UNARY (TM-OPCODE (CAR INSTRUCTION))
                                (TM-COMPUTE-ADDRESS (TM-ARG1 INSTRUCTION)
                                                    TM)
                                TM)
              (IF (EQUAL (LENGTH INSTRUCTION) '3)
                  (TM-EXECUTE-BINARY (TM-OPCODE (CAR INSTRUCTION))
                                     (TM-COMPUTE-ADDRESS (TM-ARG1 INSTRUCTION)
                                                         TM)
                                     (TM-COMPUTE-ADDRESS (TM-ARG2 INSTRUCTION)
                                                         TM)
                                     TM)
                  (TM-SET-ERROR '2 TM))))
      NIL)

(DEFN TM-FETCH-OPCODE
      (TM)
      (TM-FETCH (REAL-ADDR '2 (TM-PC TM))
                TM)
      NIL)

(DEFN TM-FETCH-ARG1
      (TM)
      (TM-FETCH (REAL-ADDR '2
                           (TM-INCRN '1 (TM-PC TM)))
                TM)
      NIL)

(DEFN TM-FETCH-ARG2
      (TM)
      (TM-FETCH (REAL-ADDR '2
                           (TM-INCRN '2 (TM-PC TM)))
                TM)
      NIL)

(DEFN TM-EXECUTE
 (OPCODE TM)
 (IF
  (TM-NULLARY-INSTRUCTIONP OPCODE)
  (TM-EXECUTE-INSTRUCTION (CONS OPCODE 'NIL)
                          (TM-SET-PC (TM-INCRN '1 (TM-PC TM))
                                     TM))
  (IF
   (TM-GOOD-ADDRESS (REAL-ADDR '2
                               (TM-INCRN '1 (TM-PC TM)))
                    TM)
   (IF
      (TM-UNARY-INSTRUCTIONP OPCODE)
      (TM-EXECUTE-INSTRUCTION (CONS OPCODE
                                    (CONS (TM-FETCH-ARG1 TM) 'NIL))
                              (TM-SET-PC (TM-INCRN '2 (TM-PC TM))
                                         TM))
      (IF (TM-GOOD-ADDRESS (REAL-ADDR '2
                                      (TM-INCRN '2 (TM-PC TM)))
                           TM)
          (TM-EXECUTE-INSTRUCTION (CONS OPCODE
                                        (CONS (TM-FETCH-ARG1 TM)
                                              (CONS (TM-FETCH-ARG2 TM) 'NIL)))
                                  (TM-SET-PC (TM-INCRN '3 (TM-PC TM))
                                             TM))
          (TM-SET-ERROR '7 TM)))
   (TM-SET-ERROR '7 TM)))
 NIL)

(DEFN TM-DECREMENT-CLOCK
      (TM)
      (IF (ZEROP (TM-CLOCK TM))
          TM
          (IF (NOT (TM-IN-SUPERVISOR-MODE TM))
              (TM-SET-CLOCK (TM-DECR (TM-CLOCK TM))
                            TM)
              TM))
      NIL)

(DEFN TM-GOOD-PC-ADDRESS
      (TM)
      (TM-GOOD-ADDRESS (REAL-ADDR '2 (TM-PC TM))
                       TM)
      NIL)

(DEFN TM-FETCH-EXECUTE
      (TM)
      (IF (TM-GOOD-PC-ADDRESS TM)
          (TM-EXECUTE (TM-FETCH-OPCODE TM)
                      (TM-DECREMENT-CLOCK TM))
          (TM-SET-ERROR '7
                        (TM-DECREMENT-CLOCK TM)))
      NIL)

(DEFN TM-FETCH-NEW-PC-ON-INTERRUPT
      (ADDR TM)
      (TM-SET-PC (TM-FETCH-FROM-MEMORY ADDR TM)
                 TM)
      NIL)

(DEFN TM-STORE-OLD-PSW-ON-INTERRUPT
      (ADDR TM)
      (TM-STORE (TM-PC TM)
                (REAL-ADDR '2 ADDR)
                (TM-STORE (TM-SP TM)
                          (TM-INCRN-ADDRESS '1
                                            (REAL-ADDR '2 ADDR))
                          (TM-STORE (TM-PACK-PSW (TM-CC TM)
                                                 (TM-ERROR TM)
                                                 (TM-SVCFLAG TM)
                                                 (TM-SVCID TM))
                                    (TM-INCRN-ADDRESS '2
                                                      (REAL-ADDR '2 ADDR))
                                    TM)))
      NIL)

(DEFN TM-CLOCK-INTERRUPTP
      (TM)
      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
           (ZEROP (TM-CLOCK TM)))
      NIL)

(DEFN TM-EXECUTE-CLOCK-INTERRUPT
 (TM)
 (TM-SET-SP
  (TM-DECR (TM-SLIMIT TM))
  (TM-FETCH-NEW-PC-ON-INTERRUPT '3
                       (TM-STORE-OLD-PSW-ON-INTERRUPT '0
                                                      (TM-SET-SVMODE '1 TM))))
 NIL)

(DEFN TM-ERRORP
      (TM)
      (NOT (EQUAL (TM-ERROR TM) '0))
      NIL)

(DEFN TM-EXECUTE-ERROR-INTERRUPT
 (TM)
 (TM-SET-SP
  (TM-DECR (TM-SLIMIT TM))
  (TM-SET-ERROR '0
   (TM-FETCH-NEW-PC-ON-INTERRUPT '4
                      (TM-STORE-OLD-PSW-ON-INTERRUPT '0
                                                     (TM-SET-SVMODE '1 TM)))))
 NIL)

(DEFN TM-SVC-INTERRUPTP
      (TM)
      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
           (EQUAL (TM-SVCFLAG TM) '1))
      NIL)

(DEFN TM-STORE-SVCID-ON-INTERRUPT
      (TM)
      (TM-STORE (TM-SVCID TM) '(2 8) TM)
      NIL)

(DEFN TM-EXECUTE-SVC-INTERRUPT
 (TM)
 (TM-SET-SP
  (TM-DECR (TM-SLIMIT TM))
  (TM-FETCH-NEW-PC-ON-INTERRUPT '5
   (TM-STORE-SVCID-ON-INTERRUPT
                      (TM-STORE-OLD-PSW-ON-INTERRUPT '0
                                                     (TM-SET-SVMODE '1 TM)))))
 NIL)

(DEFN TM-OVERFLOW-CHAR
      (CHAR)
      (PLUS '256 CHAR)
      NIL)

(DEFN TM-SOME-INPUT-INTERRUPTP
      (PORTS)
      (IF (LISTP PORTS)
          (OR (EQUAL (TM-IINTERRUPT-FLAG (CAR PORTS))
                     '1)
              (TM-SOME-INPUT-INTERRUPTP (CDR PORTS)))
          '*1*FALSE)
      NIL)

(DEFN TM-INPUT-INTERRUPTP
      (TM)
      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
           (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS TM)))
      NIL)

(DEFN TM-INTERRUPTING-INPUT-PORT
      (PORTS)
      (IF (LISTP PORTS)
          (IF (EQUAL (TM-IINTERRUPT-FLAG (CAR PORTS))
                     '1)
              '0
              (ADD1 (TM-INTERRUPTING-INPUT-PORT (CDR PORTS))))
          '0)
      NIL)

(DEFN TM-STORE-INTERRUPTING-INPUT-DEVICE
      (ID TM)
      (TM-STORE ID
                '(2 8)
                (TM-STORE (TM-ICHAR (GETNTH ID (TM-IPORTS TM)))
                          '(2 9)
                          TM))
      NIL)

(DEFN TM-EXECUTE-INPUT-INTERRUPT
 (TM)
 (TM-SET-SP
  (TM-DECR (TM-SLIMIT TM))
  (TM-SET-ERROR '0
   (TM-FETCH-NEW-PC-ON-INTERRUPT '6
    (TM-SET-IPORTS
     (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
                               (TM-IPORTS TM))
     (TM-STORE-INTERRUPTING-INPUT-DEVICE
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
      (TM-STORE-OLD-PSW-ON-INTERRUPT '0
                                  (TM-SET-SVMODE '1
                                                 (TM-SET-RWSTATE '0 TM))))))))
 NIL)

(DEFN TM-SOME-OUTPUT-INTERRUPTP
      (PORTS)
      (IF (LISTP PORTS)
          (OR (EQUAL (TM-OINTERRUPT-FLAG (CAR PORTS))
                     '1)
              (TM-SOME-OUTPUT-INTERRUPTP (CDR PORTS)))
          '*1*FALSE)
      NIL)

(DEFN TM-OUTPUT-INTERRUPTP
      (TM)
      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
           (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS TM)))
      NIL)

(DEFN TM-INTERRUPTING-OUTPUT-PORT
      (PORTS)
      (IF (LISTP PORTS)
          (IF (EQUAL (TM-OINTERRUPT-FLAG (CAR PORTS))
                     '1)
              '0
              (ADD1 (TM-INTERRUPTING-OUTPUT-PORT (CDR PORTS))))
          '0)
      NIL)

(DEFN TM-STORE-INTERRUPTING-OUTPUT-DEVICE
      (ID TM)
      (TM-STORE ID '(2 9) TM)
      NIL)

(DEFN TM-EXECUTE-OUTPUT-INTERRUPT
 (TM)
 (TM-SET-SP
  (TM-DECR (TM-SLIMIT TM))
  (TM-SET-ERROR '0
   (TM-FETCH-NEW-PC-ON-INTERRUPT '7
    (TM-SET-OPORTS
     (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
                                (TM-OPORTS TM))
     (TM-STORE-INTERRUPTING-OUTPUT-DEVICE
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
      (TM-STORE-OLD-PSW-ON-INTERRUPT '0
                                  (TM-SET-SVMODE '1
                                                 (TM-SET-RWSTATE '0 TM))))))))
 NIL)

(ADD-SHELL TM-DEVICE-INPUT-EVENT NIL TM-DEVICE-INPUT-EVENTP
           ((TM-IDEVID (NONE-OF) ZERO)
            (TM-IDATUM (NONE-OF) ZERO)))

(ADD-SHELL TM-DEVICE-OUTPUT-EVENT NIL
           TM-DEVICE-OUTPUT-EVENTP
           ((TM-ODEVID (NONE-OF) ZERO)))

(DEFN TM-POST-INTERRUPT
 (EVENT TM)
 (IF
  (TM-DEVICE-INPUT-EVENTP EVENT)
  (TM-SET-IPORTS (TM-POST-INPUT-INTERRUPT (REMAINDER (TM-IDATUM EVENT) '256)
                                          (REMAINDER (TM-IDEVID EVENT) '16)
                                          (TM-IPORTS TM))
                 TM)
  (IF
    (TM-DEVICE-OUTPUT-EVENTP EVENT)
    (TM-SET-OPORTS (TM-POST-OUTPUT-INTERRUPT (REMAINDER (TM-ODEVID EVENT) '16)
                                             (TM-OPORTS TM))
                   TM)
    TM))
 NIL)

(DEFN TM-STEP
      (TM)
      (IF (TM-INPUT-INTERRUPTP TM)
          (TM-EXECUTE-INPUT-INTERRUPT TM)
          (IF (TM-OUTPUT-INTERRUPTP TM)
              (TM-EXECUTE-OUTPUT-INTERRUPT TM)
              (IF (TM-WAITING TM)
                  TM
                  (IF (TM-ERRORP TM)
                      (TM-EXECUTE-ERROR-INTERRUPT TM)
                      (IF (TM-CLOCK-INTERRUPTP TM)
                          (TM-EXECUTE-CLOCK-INTERRUPT TM)
                          (IF (TM-SVC-INTERRUPTP TM)
                              (TM-EXECUTE-SVC-INTERRUPT TM)
                              (TM-FETCH-EXECUTE TM)))))))
      NIL)

(DEFN TM-PROCESSOR
      (TM ORACLE)
      (IF (LISTP ORACLE)
          (TM-PROCESSOR (TM-STEP (TM-POST-INTERRUPT (CAR ORACLE) TM))
                        (CDR ORACLE))
          TM)
      NIL)

(PROVE-LEMMA TM-PROCESSOR-WITH-NULL-ORACLE
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM 'NIL) TM)
             ((ENABLE TM-PROCESSOR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PROCESSOR-WITH-NULL-ORACLE)

(PROVE-LEMMA OPEN-UP-TM-PROCESSOR
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM (CONS A B))
                    (TM-PROCESSOR (TM-STEP (TM-POST-INTERRUPT A TM))
                                  B))
             ((ENABLE TM-PROCESSOR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-TM-PROCESSOR)

(PROVE-LEMMA TM-PROCESSOR-APPEND-ORACLE
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM (APPEND A B))
                    (TM-PROCESSOR (TM-PROCESSOR TM A) B))
             ((ENABLE TM-PROCESSOR APPEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PROCESSOR-APPEND-ORACLE)

(PROVE-LEMMA FINITE-NUMBERP-TM-CC-VALUE
             (REWRITE)
             (FINITE-NUMBERP (TM-CC-VALUE X) '4)
             ((ENABLE TM-CC-VALUE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-CC-VALUE)

(PROVE-LEMMA LESSP-TM-CC-VALUE-TM-CCLUB
             (REWRITE)
             (EQUAL (LESSP (TM-CC-VALUE X) '4)
                    '*1*TRUE)
             ((ENABLE TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TM-CC-VALUE-TM-CCLUB)

(PROVE-LEMMA LESSP-TM-CC-VALUE-TM-CCLUB-LINEAR
             (REWRITE)
             (LESSP (TM-CC-VALUE X) '4)
             ((ENABLE TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-TM-CC-VALUE-TM-CCLUB-LINEAR)

(PROVE-LEMMA TM-CC-VALUE-ON-COMPARE-EQUAL
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBERP A '65536)
                           (AND (FINITE-NUMBERP B '65536)
                                (EQUAL A B)))
                      (EQUAL (TM-CC-VALUE (TM-ALU-DIFFERENCE A B))
                             '1))
             ((ENABLE FINITE-NUMBERP TM-ALU-DIFFERENCE TM-CC-VALUE ALU-RESULT
                      ALU-VALUE ALU-CARRY DIFFERENCE-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-VALUE-ON-COMPARE-EQUAL)

(PROVE-LEMMA TM-CC-VALUE-ON-COMPARE-GREATERP
             (REWRITE)
             (IMPLIES (AND (LESSP B A) (LESSP A '65536))
                      (EQUAL (TM-CC-VALUE (TM-ALU-DIFFERENCE A B))
                             '2))
             ((ENABLE TM-CC-VALUE TM-ALU-DIFFERENCE ALU-RESULT ALU-VALUE
                      ALU-CARRY NON-ZERO-DIFFERENCE)
              (USE (LESSP-DIFFERENCE (A (DIFFERENCE A B))
                                     (B '65536))
                   (REMAINDER-DIFFERENCE-NON-ZERO (A (DIFFERENCE A B))
                                                  (B '65536)))
              (DISABLE REMAINDER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-VALUE-ON-COMPARE-GREATERP)

(PROVE-LEMMA TM-CC-VALUE-ON-COMPARE-LESSP
             (REWRITE)
             (IMPLIES (AND (LESSP A B) (LESSP B '65536))
                      (EQUAL (TM-CC-VALUE (TM-ALU-DIFFERENCE A B))
                             '0))
             ((ENABLE TM-CC-VALUE TM-ALU-DIFFERENCE ALU-RESULT ALU-VALUE
                      ALU-CARRY NON-ZERO-DIFFERENCE REMAINDER-NOOP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-VALUE-ON-COMPARE-LESSP)

(PROVE-LEMMA TM-CC-VALUE-ON-COMPARE-NOT-EQUAL
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBERP A '65536)
                           (AND (FINITE-NUMBERP B '65536)
                                (NOT (EQUAL A B))))
                      (EQUAL (EQUAL (TM-CC-VALUE (TM-ALU-DIFFERENCE A B))
                                    '1)
                             '*1*FALSE))
             ((ENABLE FINITE-NUMBERP TM-ALU-DIFFERENCE TM-CC-VALUE ALU-RESULT
                      ALU-VALUE ALU-CARRY DIFFERENCE-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-VALUE-ON-COMPARE-NOT-EQUAL)

(PROVE-LEMMA TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBERP A '65536)
                           (NOT (EQUAL A '0)))
                      (EQUAL (TM-CC-VALUE (TM-ALU-DIFFERENCE A '0))
                             '2))
             ((ENABLE FINITE-NUMBERP TM-ALU-DIFFERENCE TM-CC-VALUE ALU-RESULT
                      ALU-VALUE ALU-CARRY NON-ZERO-DIFFERENCE)
              (USE (REMAINDER-NON-ZERO (N (DIFFERENCE '65536 A))
                                       (M '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO)

(PROVE-LEMMA NUMBERP-TM-FIX-WORD
             (REWRITE)
             (NUMBERP (TM-FIX-WORD N))
             ((ENABLE TM-FIX-WORD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-TM-FIX-WORD)

(PROVE-LEMMA TM-FIX-WORD-SIZE
             (REWRITE)
             (EQUAL (LESSP (TM-FIX-WORD N) '65536)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 TM-FIX-WORD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-WORD-SIZE)

(PROVE-LEMMA TM-FIX-WORD-SIZE-LINEAR
             (REWRITE)
             (LESSP (TM-FIX-WORD N) '65536)
             ((ENABLE LESSP-REMAINDER2 TM-FIX-WORD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-WORD-SIZE-LINEAR)

(PROVE-LEMMA TM-FIX-WORD-NOOP
             (REWRITE)
             (IMPLIES (LESSP N '65536)
                      (EQUAL (TM-FIX-WORD N) (FIX N)))
             ((ENABLE TM-FIX-WORD)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-WORD-NOOP)

(PROVE-LEMMA NUMBERP-TM-FIX-REG-ADDRESS
             (REWRITE)
             (NUMBERP (TM-FIX-REG-ADDRESS N))
             ((ENABLE TM-FIX-REG-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-TM-FIX-REG-ADDRESS)

(PROVE-LEMMA TM-FIX-REG-ADDRESS-SIZE
             (REWRITE)
             (EQUAL (LESSP (TM-FIX-REG-ADDRESS N) '8)
                    '*1*TRUE)
             ((ENABLE LESSP-REMAINDER2 TM-FIX-REG-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-REG-ADDRESS-SIZE)

(PROVE-LEMMA TM-FIX-REG-ADDRESS-SIZE-LINEAR
             (REWRITE)
             (LESSP (TM-FIX-REG-ADDRESS N) '8)
             ((ENABLE LESSP-REMAINDER2 TM-FIX-REG-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-REG-ADDRESS-SIZE-LINEAR)

(PROVE-LEMMA TM-FIX-REG-ADDRESS-NOOP
             (REWRITE)
             (IMPLIES (LESSP N '8)
                      (EQUAL (TM-FIX-REG-ADDRESS N)
                             (FIX N)))
             ((ENABLE TM-FIX-REG-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FIX-REG-ADDRESS-NOOP)

(DEFN GOOD-TM-IPORT
      (X)
      (AND (TM-IPORTP X)
           (AND (FINITE-NUMBERP (TM-IINTERRUPT-FLAG X)
                                '2)
                (AND (FINITE-NUMBERP (TM-IERROR-FLAG X)
                                     '2)
                     (FINITE-NUMBERP (TM-ICHAR X) '256))))
      NIL)

(DEFN GOOD-TM-IPORT-ARRAY
      (L)
      (IF (LISTP L)
          (AND (GOOD-TM-IPORT (CAR L))
               (GOOD-TM-IPORT-ARRAY (CDR L)))
          '*1*TRUE)
      NIL)

(DEFN GOOD-TM-OPORT
      (X)
      (AND (TM-OPORTP X)
           (AND (FINITE-NUMBERP (TM-OINTERRUPT-FLAG X)
                                '2)
                (AND (FINITE-NUMBERP (TM-OBUSY-FLAG X) '2)
                     (FINITE-NUMBERP (TM-OCHAR X) '256))))
      NIL)

(DEFN GOOD-TM-OPORT-ARRAY
      (L)
      (IF (LISTP L)
          (AND (GOOD-TM-OPORT (CAR L))
               (GOOD-TM-OPORT-ARRAY (CDR L)))
          '*1*TRUE)
      NIL)

(DEFN GOOD-TM
 (TM)
 (AND
  (TM-SHELLP TM)
  (AND
   (PLISTP (TM-MEMORY TM))
   (AND
    (EQUAL (LENGTH (TM-MEMORY TM))
           '65536)
    (AND
     (FINITE-NUMBER-LISTP (TM-MEMORY TM)
                          '65536)
     (AND
      (PLISTP (TM-REGS TM))
      (AND
       (EQUAL (LENGTH (TM-REGS TM)) '8)
       (AND
        (FINITE-NUMBER-LISTP (TM-REGS TM)
                             '65536)
        (AND
         (FINITE-NUMBERP (TM-CC TM) '4)
         (AND
          (FINITE-NUMBERP (TM-ERROR TM) '64)
          (AND
           (FINITE-NUMBERP (TM-SVCFLAG TM) '2)
           (AND
            (FINITE-NUMBERP (TM-SVCID TM) '128)
            (AND
             (FINITE-NUMBERP (TM-BASE TM) '65536)
             (AND
              (FINITE-NUMBERP (TM-LIMIT TM) '65536)
              (AND
               (FINITE-NUMBERP (TM-SLIMIT TM)
                               '65536)
               (AND
                (FINITE-NUMBERP (TM-SVMODE TM) '2)
                (AND
                 (FINITE-NUMBERP (TM-RWSTATE TM) '2)
                 (AND
                  (FINITE-NUMBERP (TM-CLOCK TM) '65536)
                  (AND
                   (PLISTP (TM-IPORTS TM))
                   (AND
                    (EQUAL (LENGTH (TM-IPORTS TM)) '16)
                    (AND
                     (GOOD-TM-IPORT-ARRAY (TM-IPORTS TM))
                     (AND
                      (PLISTP (TM-OPORTS TM))
                      (AND
                       (EQUAL (LENGTH (TM-OPORTS TM)) '16)
                       (GOOD-TM-OPORT-ARRAY
                                          (TM-OPORTS TM))))))))))))))))))))))))
 NIL)

(PROVE-LEMMA TM-SHELLP-TM
             (REWRITE)
             (IMPLIES (GOOD-TM TM) (TM-SHELLP TM))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SHELLP-TM)

(PROVE-LEMMA PLISTP-TM-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (PLISTP (TM-MEMORY TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TM-MEMORY)

(PROVE-LEMMA LENGTH-TM-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (LENGTH (TM-MEMORY TM))
                             '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY)

(PROVE-LEMMA FINITE-NUMBER-LISTP-TM-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBER-LISTP (TM-MEMORY TM)
                                           '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-TM-MEMORY)

(PROVE-LEMMA NUMBERP-GETNTH-FROM-TM-MEMORY
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM) (LESSP I '65536))
                      (NUMBERP (GETNTH I (TM-MEMORY TM))))
             ((ENABLE GOOD-TM)
              (USE (NUMBERP-GETNTH (I I)
                                   (L (TM-MEMORY TM))
                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-GETNTH-FROM-TM-MEMORY)

(PROVE-LEMMA PLISTP-TM-REGS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (PLISTP (TM-REGS TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TM-REGS)

(PROVE-LEMMA LENGTH-TM-REGS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (LENGTH (TM-REGS TM)) '8))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-REGS)

(PROVE-LEMMA FINITE-NUMBER-LISTP-TM-REGS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBER-LISTP (TM-REGS TM)
                                           '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-TM-REGS)

(PROVE-LEMMA NUMBERP-GETNTH-FROM-TM-REGS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM) (LESSP I '8))
                      (NUMBERP (GETNTH I (TM-REGS TM))))
             ((ENABLE GOOD-TM)
              (USE (NUMBERP-GETNTH (I I)
                                   (L (TM-REGS TM))
                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-GETNTH-FROM-TM-REGS)

(PROVE-LEMMA FINITE-NUMBERP-TM-CC
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-CC TM) '4))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-CC)

(PROVE-LEMMA FINITE-NUMBERP-TM-ERROR
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-ERROR TM) '64))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-ERROR)

(PROVE-LEMMA FINITE-NUMBERP-TM-BASE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-BASE TM) '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-BASE)

(PROVE-LEMMA FINITE-NUMBERP-TM-LIMIT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-LIMIT TM)
                                      '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-LIMIT)

(PROVE-LEMMA FINITE-NUMBERP-TM-SLIMIT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-SLIMIT TM)
                                      '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-SLIMIT)

(PROVE-LEMMA FINITE-NUMBERP-TM-SVMODE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-SVMODE TM) '2))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-SVMODE)

(PROVE-LEMMA FINITE-NUMBERP-TM-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-CLOCK TM)
                                      '65536))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-CLOCK)

(PROVE-LEMMA FINITE-NUMBERP-TM-PC
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-PC TM) '65536))
             ((ENABLE FINITE-NUMBER-LISTP-TM-REGS FINITE-NUMBERP-GETNTH
                      LENGTH-TM-REGS TM-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-PC)

(PROVE-LEMMA FINITE-NUMBERP-TM-SP
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-SP TM) '65536))
             ((ENABLE FINITE-NUMBER-LISTP-TM-REGS FINITE-NUMBERP-GETNTH
                      LENGTH-TM-REGS TM-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-SP)

(PROVE-LEMMA FINITE-NUMBERP-TM-PACK-PSW
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-PACK-PSW (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM))
                                      '65536))
             ((ENABLE GOOD-TM FINITE-NUMBERP-TM-PACK-PSW1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-PACK-PSW)

(PROVE-LEMMA FINITE-NUMBERP-TM-SVCFLAG
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-SVCFLAG TM) '2))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-SVCFLAG)

(PROVE-LEMMA FINITE-NUMBERP-TM-SVCID
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-SVCID TM) '128))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-SVCID)

(PROVE-LEMMA FINITE-NUMBERP-TM-RWSTATE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (TM-RWSTATE TM) '2))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-RWSTATE)

(PROVE-LEMMA PLISTP-TM-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (PLISTP (TM-IPORTS TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TM-IPORTS)

(PROVE-LEMMA LENGTH-TM-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (LENGTH (TM-IPORTS TM)) '16))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-IPORTS)

(PROVE-LEMMA GOOD-TM-IPORT-ARRAY-TM-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM-IPORT-ARRAY (TM-IPORTS TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-ARRAY-TM-IPORTS)

(PROVE-LEMMA PLISTP-TM-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (PLISTP (TM-OPORTS TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TM-OPORTS)

(PROVE-LEMMA LENGTH-TM-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (LENGTH (TM-OPORTS TM)) '16))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-OPORTS)

(PROVE-LEMMA GOOD-TM-OPORT-ARRAY-TM-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM-OPORT-ARRAY (TM-OPORTS TM)))
             ((ENABLE GOOD-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-ARRAY-TM-OPORTS)

(PROVE-LEMMA GOOD-TM-IPORT-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM-IPORT-ARRAY L)
                           (LESSP I (LENGTH L)))
                      (GOOD-TM-IPORT (GETNTH I L)))
             ((ENABLE GOOD-TM-IPORT-ARRAY GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-GETNTH)

(PROVE-LEMMA GOOD-TM-IPORT-ARRAY-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM-IPORT-ARRAY L)
                           (GOOD-TM-IPORT IPORT))
                      (GOOD-TM-IPORT-ARRAY (PUTNTH IPORT N L)))
             ((ENABLE GOOD-TM-IPORT-ARRAY PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-ARRAY-PUTNTH)

(PROVE-LEMMA GOOD-TM-IPORT-GETNTH-FROM-TM-IPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP ID '16))
                      (GOOD-TM-IPORT (GETNTH ID (TM-IPORTS TM))))
             ((ENABLE GOOD-TM A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                      GOOD-TM-IPORT-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-GETNTH-FROM-TM-IPORTS)

(PROVE-LEMMA GOOD-TM-IPORT-ARRAY-PUTNTH-INTO-TM-IPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (GOOD-TM-IPORT IPORT))
                      (GOOD-TM-IPORT-ARRAY (PUTNTH IPORT N (TM-IPORTS TM))))
             ((ENABLE GOOD-TM GOOD-TM-IPORT-ARRAY-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-ARRAY-PUTNTH-INTO-TM-IPORTS)

(PROVE-LEMMA GOOD-TM-OPORT-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM-OPORT-ARRAY L)
                           (LESSP I (LENGTH L)))
                      (GOOD-TM-OPORT (GETNTH I L)))
             ((ENABLE GOOD-TM-OPORT-ARRAY GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-GETNTH)

(PROVE-LEMMA GOOD-TM-OPORT-ARRAY-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM-OPORT-ARRAY L)
                           (GOOD-TM-OPORT OPORT))
                      (GOOD-TM-OPORT-ARRAY (PUTNTH OPORT N L)))
             ((ENABLE GOOD-TM-OPORT-ARRAY PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-ARRAY-PUTNTH)

(PROVE-LEMMA GOOD-TM-OPORT-GETNTH-FROM-TM-OPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP ID '16))
                      (GOOD-TM-OPORT (GETNTH ID (TM-OPORTS TM))))
             ((ENABLE GOOD-TM A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                      GOOD-TM-OPORT-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-GETNTH-FROM-TM-OPORTS)

(PROVE-LEMMA GOOD-TM-OPORT-ARRAY-PUTNTH-INTO-TM-OPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (GOOD-TM-OPORT OPORT))
                      (GOOD-TM-OPORT-ARRAY (PUTNTH OPORT N (TM-OPORTS TM))))
             ((ENABLE GOOD-TM GOOD-TM-OPORT-ARRAY-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-ARRAY-PUTNTH-INTO-TM-OPORTS)

(PROVE-LEMMA SIZE-OF-TM-INTERRUPTING-INPUT-PORT
             (REWRITE)
             (IMPLIES (TM-SOME-INPUT-INTERRUPTP L)
                      (LESSP (TM-INTERRUPTING-INPUT-PORT L)
                             (LENGTH L)))
             ((ENABLE LENGTH TM-INTERRUPTING-INPUT-PORT
                      TM-SOME-INPUT-INTERRUPTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SIZE-OF-TM-INTERRUPTING-INPUT-PORT)

(PROVE-LEMMA
           FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT
           (REWRITE)
           (IMPLIES (AND (GOOD-TM TM)
                         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS TM)))
                    (FINITE-NUMBERP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
                                    '16))
           ((ENABLE FINITE-NUMBERP SIZE-OF-TM-INTERRUPTING-INPUT-PORT
                    LENGTH-TM-IPORTS)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT)

(PROVE-LEMMA
 FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-TM-WORDLUB
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS TM)))
          (FINITE-NUMBERP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
                          '65536))
 ((ENABLE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT)
  (USE
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                                (N (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM)))
                                (I '16)
                                (J '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-TM-WORDLUB)

(PROVE-LEMMA
 GOOD-TM-IPORT-GETNTH-PROPERTIES
 (REWRITE)
 (IMPLIES
     (AND (GOOD-TM TM)
          (FINITE-NUMBERP ID '16))
     (AND (TM-IPORTP (GETNTH ID (TM-IPORTS TM)))
          (AND (FINITE-NUMBERP (TM-IINTERRUPT-FLAG (GETNTH ID (TM-IPORTS TM)))
                               '2)
               (AND (FINITE-NUMBERP (TM-IERROR-FLAG (GETNTH ID (TM-IPORTS TM)))
                                    '2)
                    (FINITE-NUMBERP (TM-ICHAR (GETNTH ID (TM-IPORTS TM)))
                                    '256)))))
 ((USE (GOOD-TM-IPORT-GETNTH-FROM-TM-IPORTS (ID ID)
                                            (TM TM)))
  (ENABLE GOOD-TM-IPORT)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-GETNTH-PROPERTIES)

(PROVE-LEMMA SIZE-OF-TM-INTERRUPTING-OUTPUT-PORT
             (REWRITE)
             (IMPLIES (TM-SOME-OUTPUT-INTERRUPTP L)
                      (LESSP (TM-INTERRUPTING-OUTPUT-PORT L)
                             (LENGTH L)))
             ((ENABLE LENGTH TM-INTERRUPTING-OUTPUT-PORT
                      TM-SOME-OUTPUT-INTERRUPTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SIZE-OF-TM-INTERRUPTING-OUTPUT-PORT)

(PROVE-LEMMA
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT
          (REWRITE)
          (IMPLIES (AND (GOOD-TM TM)
                        (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS TM)))
                   (FINITE-NUMBERP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
                                   '16))
          ((ENABLE FINITE-NUMBERP SIZE-OF-TM-INTERRUPTING-OUTPUT-PORT
                   LENGTH-TM-OPORTS)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT)

(PROVE-LEMMA
 FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-TM-WORDLUB
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS TM)))
          (FINITE-NUMBERP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
                          '65536))
 ((ENABLE FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT)
  (USE
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                               (N (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM)))
                               (I '16)
                               (J '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-TM-WORDLUB)

(PROVE-LEMMA
 GOOD-TM-OPORT-GETNTH-PROPERTIES
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (FINITE-NUMBERP ID '16))
      (AND (TM-OPORTP (GETNTH ID (TM-OPORTS TM)))
           (AND (FINITE-NUMBERP (TM-OINTERRUPT-FLAG (GETNTH ID (TM-OPORTS TM)))
                                '2)
                (AND (FINITE-NUMBERP (TM-OBUSY-FLAG (GETNTH ID (TM-OPORTS TM)))
                                     '2)
                     (FINITE-NUMBERP (TM-OCHAR (GETNTH ID (TM-OPORTS TM)))
                                     '256)))))
 ((USE (GOOD-TM-OPORT-GETNTH-FROM-TM-OPORTS (ID ID)
                                            (TM TM)))
  (ENABLE GOOD-TM-OPORT)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-GETNTH-PROPERTIES)

(DEFTHEORY TM-SHELLS
           (TM-DEVICE-OUTPUT-EVENT TM-DEVICE-INPUT-EVENT TM-OPORT TM-IPORT TM))

(PROVE-LEMMA
 GOOD-TM-IPORTS-TM-CLEAR-INPUT-INTERRUPT
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (FINITE-NUMBERP ID '16))
   (AND (PLISTP (TM-CLEAR-INPUT-INTERRUPT ID
                                          (TM-IPORTS TM)))
        (AND (EQUAL (LENGTH (TM-CLEAR-INPUT-INTERRUPT ID
                                                      (TM-IPORTS TM)))
                    '16)
             (GOOD-TM-IPORT-ARRAY (TM-CLEAR-INPUT-INTERRUPT ID
                                                            (TM-IPORTS TM))))))
 ((ENABLE LENGTH TM-CLEAR-INPUT-INTERRUPT FINITE-NUMBERP PLISTP-TM-IPORTS
          LENGTH-TM-IPORTS GOOD-TM-IPORT GOOD-TM-IPORT-ARRAY-TM-IPORTS
          PLISTP-PUTNTH LENGTH-PUTNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH-INTO-TM-IPORTS)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (USE (GOOD-TM-IPORT-GETNTH-PROPERTIES (TM TM)
                                        (ID ID)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORTS-TM-CLEAR-INPUT-INTERRUPT)

(PROVE-LEMMA
 GOOD-TM-OPORTS-TM-CLEAR-OUTPUT-INTERRUPT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (FINITE-NUMBERP ID '16))
  (AND (PLISTP (TM-CLEAR-OUTPUT-INTERRUPT ID
                                          (TM-OPORTS TM)))
       (AND (EQUAL (LENGTH (TM-CLEAR-OUTPUT-INTERRUPT ID
                                                      (TM-OPORTS TM)))
                   '16)
            (GOOD-TM-OPORT-ARRAY (TM-CLEAR-OUTPUT-INTERRUPT ID
                                                            (TM-OPORTS TM))))))
 ((ENABLE LENGTH TM-CLEAR-OUTPUT-INTERRUPT FINITE-NUMBERP PLISTP-TM-OPORTS
          LENGTH-TM-OPORTS GOOD-TM-OPORT GOOD-TM-OPORT-ARRAY-TM-OPORTS
          PLISTP-PUTNTH LENGTH-PUTNTH
          GOOD-TM-OPORT-ARRAY-PUTNTH-INTO-TM-OPORTS)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (USE (GOOD-TM-OPORT-GETNTH-PROPERTIES (TM TM)
                                        (ID ID)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORTS-TM-CLEAR-OUTPUT-INTERRUPT)

(PROVE-LEMMA
 FINITE-NUMBERP-TM-ICHAR-GETNTH-CROCK
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (FINITE-NUMBERP ID '16))
          (FINITE-NUMBERP (TM-ICHAR (GETNTH ID (TM-IPORTS TM)))
                          '65536))
 ((ENABLE GOOD-TM-IPORT-GETNTH-PROPERTIES)
  (USE
     (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-ICHAR (GETNTH ID (TM-IPORTS TM))))
                                      (I '256)
                                      (J '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-ICHAR-GETNTH-CROCK)

(PROVE-LEMMA FINITE-NUMBERP-TM-OVERFLOW-CHAR
             NIL
             (IMPLIES (FINITE-NUMBERP CHAR '256)
                      (FINITE-NUMBERP (TM-OVERFLOW-CHAR CHAR)
                                      '512))
             ((ENABLE FINITE-NUMBERP TM-OVERFLOW-CHAR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-TM-OVERFLOW-CHAR-TM-WORDLUB
             (REWRITE)
             (IMPLIES (FINITE-NUMBERP CHAR '256)
                      (FINITE-NUMBERP (TM-OVERFLOW-CHAR CHAR)
                                      '65536))
             ((USE (FINITE-NUMBERP-TM-OVERFLOW-CHAR (CHAR CHAR))
                   (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-OVERFLOW-CHAR CHAR))
                                                    (I '512)
                                                    (J '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-OVERFLOW-CHAR-TM-WORDLUB)

(PROVE-LEMMA TM-IPORT-ERROR-FLAG-IS-ZERO
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (NUMBERP ID)
                                (AND (LESSP ID '16)
                                     (NOT (TM-IPORT-ERRORP ID
                                                           (TM-IPORTS TM))))))
                      (EQUAL (TM-IERROR-FLAG (GETNTH ID (TM-IPORTS TM)))
                             '0))
             ((ENABLE FINITE-NUMBERP TM-IPORT-ERRORP)
              (USE (GOOD-TM-IPORT-GETNTH-PROPERTIES (ID ID)
                                                    (TM TM)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORT-ERROR-FLAG-IS-ZERO)

(PROVE-LEMMA
            FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
            (REWRITE)
            (IMPLIES (AND (GOOD-TM OS)
                          (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
                     (AND (NUMBERP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (LESSP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                 '16)))
            ((ENABLE FINITE-NUMBERP)
             (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK)

(PROVE-LEMMA
 TM-ICHAR-FACTS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (EQUAL
     (LESSP (PLUS '256
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
            '65536)
     '*1*TRUE))
 ((ENABLE FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK)
  (USE
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-ICHAR-FACTS)

(PROVE-LEMMA
           FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
           (REWRITE)
           (IMPLIES (AND (GOOD-TM OS)
                         (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
                    (AND (NUMBERP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                         (LESSP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                '16)))
           ((ENABLE FINITE-NUMBERP)
            (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK)

(DEFN TM-CPU-LENGTH NIL '9 NIL)

(DEFN TM-R0
      (TM)
      (GETNTH '0 (TM-REGS TM))
      NIL)

(DEFN TM-R1
      (TM)
      (GETNTH '1 (TM-REGS TM))
      NIL)

(DEFN TM-R2
      (TM)
      (GETNTH '2 (TM-REGS TM))
      NIL)

(DEFN TM-R3
      (TM)
      (GETNTH '3 (TM-REGS TM))
      NIL)

(DEFN TM-R4
      (TM)
      (GETNTH '4 (TM-REGS TM))
      NIL)

(DEFN TM-R5
      (TM)
      (GETNTH '5 (TM-REGS TM))
      NIL)

(DEFN TM-R6
      (TM)
      (GETNTH '6 (TM-REGS TM))
      NIL)

(DEFN TM-R7
      (TM)
      (GETNTH '7 (TM-REGS TM))
      NIL)

(DEFN TM-CPU
 (TM)
 (CONS
   (TM-R0 TM)
   (CONS (TM-R1 TM)
         (CONS (TM-R2 TM)
               (CONS (TM-R3 TM)
                     (CONS (TM-R4 TM)
                           (CONS (TM-R5 TM)
                                 (CONS (TM-R6 TM)
                                       (CONS (TM-R7 TM)
                                             (CONS (TM-PACK-PSW (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM))
                                                   'NIL)))))))))
 NIL)

(DEFN GOOD-CPU
      (CPU)
      (AND (PLISTP CPU)
           (AND (EQUAL (LENGTH CPU) '9)
                (FINITE-NUMBER-LISTP CPU '65536)))
      NIL)

(DEFN GOOD-CPU-LIST
      (L)
      (IF (LISTP L)
          (AND (GOOD-CPU (CAR L))
               (GOOD-CPU-LIST (CDR L)))
          '*1*TRUE)
      NIL)

(PROVE-LEMMA OPEN-UP-FINITE-NUMBER-LISTP
             (REWRITE)
             (EQUAL (FINITE-NUMBER-LISTP (CONS A B) LUB)
                    (AND (FINITE-NUMBERP A LUB)
                         (FINITE-NUMBER-LISTP B LUB)))
             ((ENABLE FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OPEN-UP-FINITE-NUMBER-LISTP)

(PROVE-LEMMA FINITE-NUMBER-LISTP-ON-NON-LIST
             (REWRITE)
             (IMPLIES (NOT (LISTP X))
                      (EQUAL (FINITE-NUMBER-LISTP X LUB)
                             '*1*TRUE))
             ((ENABLE FINITE-NUMBER-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-ON-NON-LIST)

(PROVE-LEMMA LENGTH-TM-CPU
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (LENGTH (TM-CPU TM)) '9))
             ((ENABLE TM-CPU LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-CPU)

(PROVE-LEMMA PLISTP-TM-CPU
             (REWRITE)
             (PLISTP (TM-CPU TM))
             ((ENABLE PLISTP TM-CPU)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-TM-CPU)

(PROVE-LEMMA FINITE-NUMBER-LISTP-TM-CPU
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBER-LISTP (TM-CPU TM)
                                           '65536))
             ((ENABLE TM-CPU FINITE-NUMBER-LISTP GOOD-TM TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 FINITE-NUMBERP-TM-PACK-PSW
                      FINITE-NUMBERP-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-TM-CPU)

(PROVE-LEMMA GOOD-CPU-TM-CPU
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-CPU (TM-CPU TM)))
             ((ENABLE GOOD-CPU TM-CPU GOOD-TM PLISTP LENGTH TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 FINITE-NUMBERP-GETNTH
                      OPEN-UP-FINITE-NUMBER-LISTP FINITE-NUMBERP-TM-PACK-PSW
                      FINITE-NUMBER-LISTP-ON-NON-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-TM-CPU)

(PROVE-LEMMA GOOD-CPU-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-CPU-LIST L)
                           (LESSP N (LENGTH L)))
                      (GOOD-CPU (GETNTH N L)))
             ((ENABLE GOOD-CPU-LIST GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-GETNTH)

(PROVE-LEMMA GOOD-CPU-LIST-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-CPU-LIST L) (GOOD-CPU CPU))
                      (GOOD-CPU-LIST (PUTNTH CPU I L)))
             ((ENABLE GOOD-CPU-LIST PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-LIST-PUTNTH)

(PROVE-LEMMA
 LIST-OF-GETNTHS8
 (REWRITE)
 (IMPLIES
  (AND (PLISTP L)
       (EQUAL (LENGTH L) '8))
  (EQUAL
   (CONS (GETNTH '0 L)
         (CONS (GETNTH '1 L)
               (CONS (GETNTH '2 L)
                     (CONS (GETNTH '3 L)
                           (CONS (GETNTH '4 L)
                                 (CONS (GETNTH '5 L)
                                       (CONS (GETNTH '6 L)
                                             (CONS (GETNTH '7 L) 'NIL))))))))
   L))
 ((ENABLE PLISTP GETNTH LENGTH)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LIST-OF-GETNTHS8)

(PROVE-LEMMA CPU-REGS-SEGMENT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (GETSEG '0 '8 (TM-CPU TM))
                             (TM-REGS TM)))
             ((ENABLE TM-CPU FIRSTN LENGTH TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5
                      TM-R6 TM-R7 GETSEG-EQUALS-FIRSTN-NTHCDR LIST-OF-GETNTHS8
                      LENGTH-TM-REGS NTHCDR-ZERO PLISTP-TM-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CPU-REGS-SEGMENT)

(DEFTHEORY
        GOOD-TM-PROPERTIES
        (CPU-REGS-SEGMENT GOOD-CPU-LIST-PUTNTH GOOD-CPU-GETNTH GOOD-CPU-TM-CPU
                          FINITE-NUMBERP-TM-PACK-PSW
                          FINITE-NUMBER-LISTP-TM-CPU
                          NUMBERP-GETNTH-FROM-TM-REGS
                          NUMBERP-GETNTH-FROM-TM-MEMORY FINITE-NUMBERP-TM-PC
                          FINITE-NUMBERP-TM-SP FINITE-NUMBERP-TM-CC
                          FINITE-NUMBERP-TM-ERROR FINITE-NUMBERP-TM-SVCFLAG
                          FINITE-NUMBERP-TM-SVCID FINITE-NUMBERP-TM-RWSTATE
                          PLISTP-TM-IPORTS LENGTH-TM-IPORTS
                          GOOD-TM-IPORT-ARRAY-TM-IPORTS PLISTP-TM-OPORTS
                          LENGTH-TM-OPORTS GOOD-TM-OPORT-ARRAY-TM-OPORTS
                          GOOD-TM-IPORT-GETNTH-FROM-TM-IPORTS
                          GOOD-TM-IPORT-ARRAY-PUTNTH-INTO-TM-IPORTS
                          GOOD-TM-OPORT-GETNTH-FROM-TM-OPORTS
                          GOOD-TM-OPORT-ARRAY-PUTNTH-INTO-TM-OPORTS
                          FINITE-NUMBERP-TM-CLOCK FINITE-NUMBERP-TM-SVMODE
                          FINITE-NUMBERP-TM-SLIMIT FINITE-NUMBERP-TM-LIMIT
                          FINITE-NUMBERP-TM-BASE FINITE-NUMBER-LISTP-TM-REGS
                          LENGTH-TM-REGS PLISTP-TM-REGS
                          FINITE-NUMBER-LISTP-TM-MEMORY LENGTH-TM-MEMORY
                          PLISTP-TM-MEMORY TM-SHELLP-TM
                          TM-FIX-REG-ADDRESS-NOOP
                          TM-FIX-REG-ADDRESS-SIZE-LINEAR
                          TM-FIX-REG-ADDRESS-SIZE NUMBERP-TM-FIX-REG-ADDRESS
                          TM-FIX-WORD-NOOP TM-FIX-WORD-SIZE-LINEAR
                          TM-FIX-WORD-SIZE NUMBERP-TM-FIX-WORD
                          TM-CC-VALUE-ON-COMPARE-LESSP
                          TM-CC-VALUE-ON-COMPARE-GREATERP
                          FINITE-NUMBERP-TM-PACK-PSW
                          FINITE-NUMBERP-TM-OVERFLOW-CHAR-TM-WORDLUB
                          FINITE-NUMBERP-TM-ICHAR-GETNTH-CROCK
                          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT
                          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-TM-WORDLUB
                          GOOD-TM-IPORT-GETNTH-PROPERTIES
                          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT
                          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-TM-WORDLUB
                          GOOD-TM-OPORT-GETNTH-PROPERTIES))

(DEFTHEORY TM-DEFINITION
           (TM-PROCESSOR TM-STEP TM-POST-INTERRUPT TM-EXECUTE-OUTPUT-INTERRUPT
                         TM-STORE-INTERRUPTING-OUTPUT-DEVICE
                         TM-OUTPUT-INTERRUPTP TM-EXECUTE-INPUT-INTERRUPT
                         TM-STORE-INTERRUPTING-INPUT-DEVICE
                         TM-INPUT-INTERRUPTP TM-OVERFLOW-CHAR
                         TM-EXECUTE-SVC-INTERRUPT TM-STORE-SVCID-ON-INTERRUPT
                         TM-SVC-INTERRUPTP TM-EXECUTE-ERROR-INTERRUPT
                         TM-ERRORP TM-EXECUTE-CLOCK-INTERRUPT
                         TM-CLOCK-INTERRUPTP TM-STORE-OLD-PSW-ON-INTERRUPT
                         TM-FETCH-NEW-PC-ON-INTERRUPT TM-FETCH-EXECUTE
                         TM-GOOD-PC-ADDRESS TM-DECREMENT-CLOCK TM-EXECUTE
                         TM-FETCH-ARG2 TM-FETCH-ARG1 TM-FETCH-OPCODE
                         TM-EXECUTE-INSTRUCTION TM-EXECUTE-BINARY
                         TM-EXECUTE-UNARY TM-EXECUTE-NULLARY TM-ARG2 TM-ARG1
                         TM-DATUM2 TM-DATUM1 TM-UNARY-INSTRUCTIONP
                         TM-NULLARY-INSTRUCTIONP TM-INDEX2 TM-MODE2 TM-INDEX1
                         TM-MODE1 TM-OPCODE TM-EXECUTE-SVC-RETURN
                         TM-EXECUTE-SVC TM-EXECUTE-START-OUTPUT
                         TM-EXECUTE-TEST-IPORT TM-EXECUTE-TEST-OPORT
                         TM-EXECUTE-POST-OUTPUT-INTERRUPT TM-EXECUTE-WAIT
                         TM-EXECUTE-SET-CLOCK TM-EXECUTE-RUN TM-EXECUTE-RETURN
                         TM-EXECUTE-MULTIPLY TM-EXECUTE-MOVE TM-EXECUTE-MOD
                         TM-EXECUTE-LOAD-PSW TM-EXECUTE-LOAD-LIMIT
                         TM-EXECUTE-LOAD-BASE TM-EXECUTE-INCR-MOD
                         TM-EXECUTE-INCR TM-EXECUTE-DECR-MOD TM-EXECUTE-DECR
                         TM-EXECUTE-COMPARE TM-EXECUTE-CALL
                         TM-EXECUTE-BRANCH-NOT-ZERO TM-EXECUTE-BRANCH-ON-ZERO
                         TM-EXECUTE-BRANCH TM-EXECUTE-ADD TM-STACK-UNDERFLOWP
                         TM-STACK-OVERFLOWP TM-STORE TM-FETCH
                         TM-STORE-IN-REGMEM TM-FETCH-FROM-REGMEM
                         TM-STORE-IN-MEMORY TM-FETCH-FROM-MEMORY
                         TM-INCRN-ADDRESS TM-INCR-ADDRESS TM-GOOD-ADDRESS
                         TM-COMPUTE-ADDRESS TM-ARG-INDEX TM-ARG-DATUM
                         TM-ARG-MODE REAL-ADDR-NUM REAL-ADDR-SOURCE REAL-ADDR
                         TM-CLEAR-OUTPUT-INTERRUPT TM-POST-OUTPUT-INTERRUPT
                         TM-START-OUTPUT TM-OPORT-IDLEP
                         TM-POST-INPUT-INTERRUPT TM-CLEAR-INPUT-INTERRUPT
                         TM-IPORT-ERRORP TM-NO-SVC TM-SVC TM-WAITING
                         TM-IN-SUPERVISOR-MODE TM-USER-MODE TM-SUPERVISOR-MODE
                         TM-PC-ADDRESS-ERROR TM-ADDRESS-ERROR
                         TM-STACK-UNDERFLOW-ERROR TM-STACK-OVERFLOW-ERROR
                         TM-PRIVILEGE-ERROR TM-OPCODE-ERROR TM-HALT-STATUS
                         TM-NO-ERROR TM-UNPACK-SVCID TM-UNPACK-SVCFLAG
                         TM-UNPACK-ERROR TM-UNPACK-CC TM-PACK-PSW
                         TM-ZERO-CARRY-CONDITION TM-NON-ZERO-CARRY-CONDITION
                         TM-ZERO-NO-CARRY-CONDITION
                         TM-NON-ZERO-NO-CARRY-CONDITION TM-SET-SP TM-SP
                         TM-SET-PC TM-PC TM-SET-OPORTS TM-SET-IPORTS
                         TM-SET-CLOCK TM-SET-RWSTATE TM-SET-SVMODE
                         TM-SET-SLIMIT TM-SET-LIMIT TM-SET-BASE TM-SET-SVCID
                         TM-SET-SVCFLAG TM-SET-ERROR TM-SET-CC TM-SET-REGS
                         TM-SET-MEMORY TM-DECR TM-INCRN TM-INCR TM-R0 TM-R1
                         TM-R2 TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 TM-SHELLS))

(PROVE-LEMMA FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (TM-IN-SUPERVISOR-MODE TM)
                                (FINITE-NUMBERP N '65536)))
                      (FINITE-NUMBERP (TM-FETCH-FROM-MEMORY N TM)
                                      '65536))
             ((ENABLE TM-FETCH-FROM-MEMORY FINITE-NUMBERP-GETNTH
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE)

(PROVE-LEMMA FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (FINITE-NUMBERP (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                           (TM-LIMIT TM))
                                      '65536))
             ((ENABLE GOOD-TM FINITE-NUMBERP MIN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT)

(PROVE-LEMMA LESSP-PLUS-BASE-ADDR-MEMLENGTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                                (AND (NOT (EQUAL (REAL-ADDR-SOURCE ADDR) '1))
                                     (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                                          (TM-GOOD-ADDRESS ADDR TM)))))
                      (LESSP (PLUS (TM-BASE TM)
                                   (REAL-ADDR-NUM ADDR))
                             '65536))
             ((ENABLE TM-GOOD-ADDRESS FINITE-NUMBERP MIN)
              (USE (FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT (TM TM))
                   (FINITE-NUMBERP-TM-LIMIT (TM TM))
                   (FINITE-NUMBERP-TM-BASE (TM TM)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-BASE-ADDR-MEMLENGTH)

(PROVE-LEMMA
 FINITE-NUMBERP-TM-FETCH
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (TM-GOOD-ADDRESS ADDR TM))
          (FINITE-NUMBERP (TM-FETCH ADDR TM)
                          '65536))
 ((ENABLE TM-GOOD-ADDRESS TM-FETCH TM-FETCH-FROM-REGMEM
          LESSP-PLUS-BASE-ADDR-MEMLENGTH FINITE-NUMBERP-GETNTH FINITE-NUMBERP
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB TM-FETCH-FROM-MEMORY)
  (USE
     (FINITE-NUMBERP-FROM-SMALLER-LUB (N (REAL-ADDR-NUM ADDR))
                                      (I (TM-SLIMIT TM))
                                      (J '65536))
     (FINITE-NUMBERP-FROM-SMALLER-LUB (N (REAL-ADDR-NUM ADDR))
                                      (I (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                              (TM-LIMIT TM)))
                                      (J '65536))
     (FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT (TM TM)))
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-FETCH)

(PROVE-LEMMA
 TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
 (REWRITE)
 (AND
  (EQUAL (TM-CC (TM-STORE VALUE ADDR TM))
         (TM-CC TM))
  (AND
   (EQUAL (TM-ERROR (TM-STORE VALUE ADDR TM))
          (TM-ERROR TM))
   (AND
    (EQUAL (TM-BASE (TM-STORE VALUE ADDR TM))
           (TM-BASE TM))
    (AND
     (EQUAL (TM-LIMIT (TM-STORE VALUE ADDR TM))
            (TM-LIMIT TM))
     (AND
      (EQUAL (TM-SLIMIT (TM-STORE VALUE ADDR TM))
             (TM-SLIMIT TM))
      (AND (EQUAL (TM-SVMODE (TM-STORE VALUE ADDR TM))
                  (TM-SVMODE TM))
           (AND (EQUAL (TM-SVCFLAG (TM-STORE VALUE ADDR TM))
                       (TM-SVCFLAG TM))
                (AND (EQUAL (TM-SVCID (TM-STORE VALUE ADDR TM))
                            (TM-SVCID TM))
                     (AND (EQUAL (TM-RWSTATE (TM-STORE VALUE ADDR TM))
                                 (TM-RWSTATE TM))
                          (AND (EQUAL (TM-CLOCK (TM-STORE VALUE ADDR TM))
                                      (TM-CLOCK TM))
                               (AND (EQUAL (TM-IPORTS (TM-STORE VALUE ADDR TM))
                                           (TM-IPORTS TM))
                                    (EQUAL (TM-OPORTS (TM-STORE VALUE ADDR TM))
                                           (TM-OPORTS TM)))))))))))))
 ((ENABLE TM-STORE-IN-MEMORY TM-STORE-IN-REGMEM TM-SET-REGS TM-SET-MEMORY
          TM-STORE)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS)

(PROVE-LEMMA
   TM-GOOD-MEMORY-TM-STORE
   (REWRITE)
   (IMPLIES (AND (GOOD-TM TM)
                 (FINITE-NUMBERP VALUE '65536))
            (AND (PLISTP (TM-MEMORY (TM-STORE VALUE ADDR TM)))
                 (AND (EQUAL (LENGTH (TM-MEMORY (TM-STORE VALUE ADDR TM)))
                             '65536)
                      (FINITE-NUMBER-LISTP (TM-MEMORY (TM-STORE VALUE ADDR TM))
                                           '65536))))
   ((ENABLE TM-STORE TM-STORE-IN-REGMEM TM-STORE-IN-MEMORY LENGTH
            TM-SET-MEMORY TM-SET-REGS PLISTP-PUTNTH LENGTH-PUTNTH
            FINITE-NUMBER-LISTP-PUTNTH)
    (ENABLE-THEORY GOOD-TM-PROPERTIES TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-GOOD-MEMORY-TM-STORE)

(PROVE-LEMMA
     TM-GOOD-REGS-TM-STORE
     (REWRITE)
     (IMPLIES (AND (GOOD-TM TM)
                   (FINITE-NUMBERP VALUE '65536))
              (AND (PLISTP (TM-REGS (TM-STORE VALUE ADDR TM)))
                   (AND (EQUAL (LENGTH (TM-REGS (TM-STORE VALUE ADDR TM)))
                               '8)
                        (FINITE-NUMBER-LISTP (TM-REGS (TM-STORE VALUE ADDR TM))
                                             '65536))))
     ((ENABLE TM-STORE TM-STORE-IN-REGMEM TM-STORE-IN-MEMORY LENGTH
              TM-SET-MEMORY TM-SET-REGS PLISTP-PUTNTH LENGTH-PUTNTH
              FINITE-NUMBER-LISTP-PUTNTH)
      (ENABLE-THEORY TM-SHELLS GOOD-TM-PROPERTIES GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE TM-GOOD-REGS-TM-STORE)

(PROVE-LEMMA GOOD-TM-TM-STORE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP VALUE '65536))
                      (GOOD-TM (TM-STORE VALUE ADDR TM)))
             ((ENABLE GOOD-TM)
              (USE (TM-GOOD-REGS-TM-STORE (VALUE VALUE)
                                          (ADDR ADDR)
                                          (TM TM))
                   (TM-GOOD-MEMORY-TM-STORE (VALUE VALUE)
                                            (ADDR ADDR)
                                            (TM TM))
                   (TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS (VALUE VALUE)
                                                               (ADDR ADDR)
                                                               (TM TM)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-STORE)

(PROVE-LEMMA GOOD-TM-TM-SET-REGS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (FINITE-NUMBER-LISTP REGS '65536)
                                (AND (PLISTP REGS)
                                     (EQUAL (LENGTH REGS) '8))))
                      (GOOD-TM (TM-SET-REGS REGS TM)))
             ((ENABLE GOOD-TM TM-SET-REGS LENGTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-REGS)

(PROVE-LEMMA
 ACCESS-TM-SET-REGS
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-REGS REGS TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-REGS REGS TM))
          REGS)
   (AND
    (EQUAL (TM-CC (TM-SET-REGS REGS TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-REGS REGS TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-REGS REGS TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-REGS REGS TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-REGS REGS TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-REGS REGS TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-REGS REGS TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-REGS REGS TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-REGS REGS TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-REGS REGS TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-REGS REGS TM))
                                    (TM-IPORTS TM))
                             (AND (EQUAL (TM-OPORTS (TM-SET-REGS REGS TM))
                                         (TM-OPORTS TM))
                                  (AND (EQUAL (TM-PC (TM-SET-REGS REGS TM))
                                              (GETNTH '0 REGS))
                                       (EQUAL (TM-SP (TM-SET-REGS REGS TM))
                                              (GETNTH '1 REGS)))))))))))))))))
 ((ENABLE TM-SET-REGS TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-REGS)

(PROVE-LEMMA GOOD-TM-TM-SET-MEMORY
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (FINITE-NUMBER-LISTP MEMORY '65536)
                                (AND (PLISTP MEMORY)
                                     (EQUAL (LENGTH MEMORY) '65536))))
                      (GOOD-TM (TM-SET-MEMORY MEMORY TM)))
             ((ENABLE GOOD-TM TM-SET-MEMORY LENGTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-MEMORY)

(PROVE-LEMMA
 ACCESS-TM-SET-MEMORY
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-MEMORY MEMORY TM))
         MEMORY)
  (AND
   (EQUAL (TM-REGS (TM-SET-MEMORY MEMORY TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-MEMORY MEMORY TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-MEMORY MEMORY TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-MEMORY MEMORY TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-MEMORY MEMORY TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-MEMORY MEMORY TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-MEMORY MEMORY TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-MEMORY MEMORY TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-MEMORY MEMORY TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-MEMORY MEMORY TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-MEMORY MEMORY TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-MEMORY MEMORY TM))
                                    (TM-IPORTS TM))
                             (AND (EQUAL (TM-OPORTS (TM-SET-MEMORY MEMORY TM))
                                         (TM-OPORTS TM))
                                  (AND (EQUAL (TM-PC (TM-SET-MEMORY MEMORY TM))
                                              (TM-PC TM))
                                       (EQUAL (TM-SP (TM-SET-MEMORY MEMORY TM))
                                              (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-MEMORY TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-MEMORY)

(PROVE-LEMMA GOOD-TM-TM-SET-CC
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP CC '4))
                      (GOOD-TM (TM-SET-CC CC TM)))
             ((ENABLE GOOD-TM TM-SET-CC)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-CC)

(PROVE-LEMMA
 ACCESS-TM-SET-CC
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-CC CC TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-CC CC TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-CC CC TM)) CC)
    (AND
     (EQUAL (TM-ERROR (TM-SET-CC CC TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-CC CC TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-CC CC TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-CC CC TM))
               (TM-SLIMIT TM))
        (AND
           (EQUAL (TM-SVMODE (TM-SET-CC CC TM))
                  (TM-SVMODE TM))
           (AND (EQUAL (TM-SVCFLAG (TM-SET-CC CC TM))
                       (TM-SVCFLAG TM))
                (AND (EQUAL (TM-SVCID (TM-SET-CC CC TM))
                            (TM-SVCID TM))
                     (AND (EQUAL (TM-RWSTATE (TM-SET-CC CC TM))
                                 (TM-RWSTATE TM))
                          (AND (EQUAL (TM-CLOCK (TM-SET-CC CC TM))
                                      (TM-CLOCK TM))
                               (AND (EQUAL (TM-IPORTS (TM-SET-CC CC TM))
                                           (TM-IPORTS TM))
                                    (AND (EQUAL (TM-OPORTS (TM-SET-CC CC TM))
                                                (TM-OPORTS TM))
                                         (AND (EQUAL (TM-PC (TM-SET-CC CC TM))
                                                     (TM-PC TM))
                                              (EQUAL (TM-SP (TM-SET-CC CC TM))
                                                     (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-CC TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-CC)

(PROVE-LEMMA GOOD-TM-TM-SET-ERROR
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP ERROR '64))
                      (GOOD-TM (TM-SET-ERROR ERROR TM)))
             ((ENABLE GOOD-TM TM-SET-ERROR)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-ERROR)

(PROVE-LEMMA
 ACCESS-TM-SET-ERROR
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-ERROR ERROR TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-ERROR ERROR TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-ERROR ERROR TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-ERROR ERROR TM))
            ERROR)
     (AND
      (EQUAL (TM-BASE (TM-SET-ERROR ERROR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-ERROR ERROR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-ERROR ERROR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-ERROR ERROR TM))
                (TM-SVMODE TM))
         (AND
           (EQUAL (TM-SVCFLAG (TM-SET-ERROR ERROR TM))
                  (TM-SVCFLAG TM))
           (AND (EQUAL (TM-SVCID (TM-SET-ERROR ERROR TM))
                       (TM-SVCID TM))
                (AND (EQUAL (TM-RWSTATE (TM-SET-ERROR ERROR TM))
                            (TM-RWSTATE TM))
                     (AND (EQUAL (TM-CLOCK (TM-SET-ERROR ERROR TM))
                                 (TM-CLOCK TM))
                          (AND (EQUAL (TM-IPORTS (TM-SET-ERROR ERROR TM))
                                      (TM-IPORTS TM))
                               (AND (EQUAL (TM-OPORTS (TM-SET-ERROR ERROR TM))
                                           (TM-OPORTS TM))
                                    (AND (EQUAL (TM-PC (TM-SET-ERROR ERROR TM))
                                                (TM-PC TM))
                                         (EQUAL (TM-SP (TM-SET-ERROR ERROR TM))
                                                (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-ERROR TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-ERROR)

(PROVE-LEMMA GOOD-TM-TM-SET-BASE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP BASE '65536))
                      (GOOD-TM (TM-SET-BASE BASE TM)))
             ((ENABLE GOOD-TM TM-SET-BASE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-BASE)

(PROVE-LEMMA
 ACCESS-TM-SET-BASE
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-BASE BASE TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-BASE BASE TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-BASE BASE TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-BASE BASE TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-BASE BASE TM))
             BASE)
      (AND
       (EQUAL (TM-LIMIT (TM-SET-BASE BASE TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-BASE BASE TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-BASE BASE TM))
                (TM-SVMODE TM))
         (AND
             (EQUAL (TM-SVCFLAG (TM-SET-BASE BASE TM))
                    (TM-SVCFLAG TM))
             (AND (EQUAL (TM-SVCID (TM-SET-BASE BASE TM))
                         (TM-SVCID TM))
                  (AND (EQUAL (TM-RWSTATE (TM-SET-BASE BASE TM))
                              (TM-RWSTATE TM))
                       (AND (EQUAL (TM-CLOCK (TM-SET-BASE BASE TM))
                                   (TM-CLOCK TM))
                            (AND (EQUAL (TM-IPORTS (TM-SET-BASE BASE TM))
                                        (TM-IPORTS TM))
                                 (AND (EQUAL (TM-OPORTS (TM-SET-BASE BASE TM))
                                             (TM-OPORTS TM))
                                      (AND (EQUAL (TM-PC (TM-SET-BASE BASE TM))
                                                  (TM-PC TM))
                                           (EQUAL (TM-SP (TM-SET-BASE BASE TM))
                                                  (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-BASE TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-BASE)

(PROVE-LEMMA GOOD-TM-TM-SET-LIMIT
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP LIMIT '65536))
                      (GOOD-TM (TM-SET-LIMIT LIMIT TM)))
             ((ENABLE GOOD-TM TM-SET-LIMIT)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-LIMIT)

(PROVE-LEMMA
 ACCESS-TM-SET-LIMIT
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-LIMIT LIMIT TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-LIMIT LIMIT TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-LIMIT LIMIT TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-LIMIT LIMIT TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-LIMIT LIMIT TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-LIMIT LIMIT TM))
              LIMIT)
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-LIMIT LIMIT TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-LIMIT LIMIT TM))
                (TM-SVMODE TM))
         (AND
           (EQUAL (TM-SVCFLAG (TM-SET-LIMIT LIMIT TM))
                  (TM-SVCFLAG TM))
           (AND (EQUAL (TM-SVCID (TM-SET-LIMIT LIMIT TM))
                       (TM-SVCID TM))
                (AND (EQUAL (TM-RWSTATE (TM-SET-LIMIT LIMIT TM))
                            (TM-RWSTATE TM))
                     (AND (EQUAL (TM-CLOCK (TM-SET-LIMIT LIMIT TM))
                                 (TM-CLOCK TM))
                          (AND (EQUAL (TM-IPORTS (TM-SET-LIMIT LIMIT TM))
                                      (TM-IPORTS TM))
                               (AND (EQUAL (TM-OPORTS (TM-SET-LIMIT LIMIT TM))
                                           (TM-OPORTS TM))
                                    (AND (EQUAL (TM-PC (TM-SET-LIMIT LIMIT TM))
                                                (TM-PC TM))
                                         (EQUAL (TM-SP (TM-SET-LIMIT LIMIT TM))
                                                (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-LIMIT TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-LIMIT)

(PROVE-LEMMA GOOD-TM-TM-SET-SLIMIT
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP SLIMIT '65536))
                      (GOOD-TM (TM-SET-SLIMIT SLIMIT TM)))
             ((ENABLE GOOD-TM TM-SET-SLIMIT)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-SLIMIT)

(PROVE-LEMMA
 ACCESS-TM-SET-SLIMIT
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-SLIMIT SLIMIT TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-SLIMIT SLIMIT TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-SLIMIT SLIMIT TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-SLIMIT SLIMIT TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-SLIMIT SLIMIT TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-SLIMIT SLIMIT TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-SLIMIT SLIMIT TM))
               SLIMIT)
        (AND
         (EQUAL (TM-SVMODE (TM-SET-SLIMIT SLIMIT TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-SLIMIT SLIMIT TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-SLIMIT SLIMIT TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-SLIMIT SLIMIT TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-SLIMIT SLIMIT TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-SLIMIT SLIMIT TM))
                                    (TM-IPORTS TM))
                             (AND (EQUAL (TM-OPORTS (TM-SET-SLIMIT SLIMIT TM))
                                         (TM-OPORTS TM))
                                  (AND (EQUAL (TM-PC (TM-SET-SLIMIT SLIMIT TM))
                                              (TM-PC TM))
                                       (EQUAL (TM-SP (TM-SET-SLIMIT SLIMIT TM))
                                              (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-SLIMIT TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-SLIMIT)

(PROVE-LEMMA GOOD-TM-TM-SET-SVMODE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP SVMODE '2))
                      (GOOD-TM (TM-SET-SVMODE SVMODE TM)))
             ((ENABLE GOOD-TM TM-SET-SVMODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-SVMODE)

(PROVE-LEMMA
 ACCESS-TM-SET-SVMODE
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-SVMODE SVMODE TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-SVMODE SVMODE TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-SVMODE SVMODE TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-SVMODE SVMODE TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-SVMODE SVMODE TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-SVMODE SVMODE TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-SVMODE SVMODE TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-SVMODE SVMODE TM))
                SVMODE)
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-SVMODE SVMODE TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-SVMODE SVMODE TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-SVMODE SVMODE TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-SVMODE SVMODE TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-SVMODE SVMODE TM))
                                    (TM-IPORTS TM))
                             (AND (EQUAL (TM-OPORTS (TM-SET-SVMODE SVMODE TM))
                                         (TM-OPORTS TM))
                                  (AND (EQUAL (TM-PC (TM-SET-SVMODE SVMODE TM))
                                              (TM-PC TM))
                                       (EQUAL (TM-SP (TM-SET-SVMODE SVMODE TM))
                                              (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-SVMODE TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-SVMODE)

(PROVE-LEMMA GOOD-TM-TM-SET-SVCFLAG
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP SVCFLAG '2))
                      (GOOD-TM (TM-SET-SVCFLAG SVCFLAG TM)))
             ((ENABLE GOOD-TM TM-SET-SVCFLAG)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-SVCFLAG)

(PROVE-LEMMA
 ACCESS-TM-SET-SVCFLAG
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-SVCFLAG SVCFLAG TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-SVCFLAG SVCFLAG TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-SVCFLAG SVCFLAG TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-SVCFLAG SVCFLAG TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-SVCFLAG SVCFLAG TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-SVCFLAG SVCFLAG TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-SVCFLAG SVCFLAG TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-SVCFLAG SVCFLAG TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-SVCFLAG SVCFLAG TM))
                 SVCFLAG)
          (AND
            (EQUAL (TM-SVCID (TM-SET-SVCFLAG SVCFLAG TM))
                   (TM-SVCID TM))
            (AND (EQUAL (TM-RWSTATE (TM-SET-SVCFLAG SVCFLAG TM))
                        (TM-RWSTATE TM))
                 (AND (EQUAL (TM-CLOCK (TM-SET-SVCFLAG SVCFLAG TM))
                             (TM-CLOCK TM))
                      (AND (EQUAL (TM-IPORTS (TM-SET-SVCFLAG SVCFLAG TM))
                                  (TM-IPORTS TM))
                           (AND (EQUAL (TM-OPORTS (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-OPORTS TM))
                                (AND (EQUAL (TM-PC (TM-SET-SVCFLAG SVCFLAG TM))
                                            (TM-PC TM))
                                     (EQUAL (TM-SP (TM-SET-SVCFLAG SVCFLAG TM))
                                            (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-SVCFLAG TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-SVCFLAG)

(PROVE-LEMMA GOOD-TM-TM-SET-SVCID
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP SVCID '128))
                      (GOOD-TM (TM-SET-SVCID SVCID TM)))
             ((ENABLE GOOD-TM TM-SET-SVCID)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-SVCID)

(PROVE-LEMMA
 ACCESS-TM-SET-SVCID
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-SVCID SVCID TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-SVCID SVCID TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-SVCID SVCID TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-SVCID SVCID TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-SVCID SVCID TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-SVCID SVCID TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-SVCID SVCID TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-SVCID SVCID TM))
                (TM-SVMODE TM))
         (AND
           (EQUAL (TM-SVCFLAG (TM-SET-SVCID SVCID TM))
                  (TM-SVCFLAG TM))
           (AND (EQUAL (TM-SVCID (TM-SET-SVCID SVCID TM))
                       SVCID)
                (AND (EQUAL (TM-RWSTATE (TM-SET-SVCID SVCID TM))
                            (TM-RWSTATE TM))
                     (AND (EQUAL (TM-CLOCK (TM-SET-SVCID SVCID TM))
                                 (TM-CLOCK TM))
                          (AND (EQUAL (TM-IPORTS (TM-SET-SVCID SVCID TM))
                                      (TM-IPORTS TM))
                               (AND (EQUAL (TM-OPORTS (TM-SET-SVCID SVCID TM))
                                           (TM-OPORTS TM))
                                    (AND (EQUAL (TM-PC (TM-SET-SVCID SVCID TM))
                                                (TM-PC TM))
                                         (EQUAL (TM-SP (TM-SET-SVCID SVCID TM))
                                                (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-SVCID TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-SVCID)

(PROVE-LEMMA GOOD-TM-TM-SET-RWSTATE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP RWSTATE '2))
                      (GOOD-TM (TM-SET-RWSTATE RWSTATE TM)))
             ((ENABLE GOOD-TM TM-SET-RWSTATE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-RWSTATE)

(PROVE-LEMMA
 ACCESS-TM-SET-RWSTATE
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-RWSTATE RWSTATE TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-RWSTATE RWSTATE TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-RWSTATE RWSTATE TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-RWSTATE RWSTATE TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-RWSTATE RWSTATE TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-RWSTATE RWSTATE TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-RWSTATE RWSTATE TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-RWSTATE RWSTATE TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-RWSTATE RWSTATE TM))
                 (TM-SVCFLAG TM))
          (AND
            (EQUAL (TM-SVCID (TM-SET-RWSTATE RWSTATE TM))
                   (TM-SVCID TM))
            (AND (EQUAL (TM-RWSTATE (TM-SET-RWSTATE RWSTATE TM))
                        RWSTATE)
                 (AND (EQUAL (TM-CLOCK (TM-SET-RWSTATE RWSTATE TM))
                             (TM-CLOCK TM))
                      (AND (EQUAL (TM-IPORTS (TM-SET-RWSTATE RWSTATE TM))
                                  (TM-IPORTS TM))
                           (AND (EQUAL (TM-OPORTS (TM-SET-RWSTATE RWSTATE TM))
                                       (TM-OPORTS TM))
                                (AND (EQUAL (TM-PC (TM-SET-RWSTATE RWSTATE TM))
                                            (TM-PC TM))
                                     (EQUAL (TM-SP (TM-SET-RWSTATE RWSTATE TM))
                                            (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-RWSTATE TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-RWSTATE)

(PROVE-LEMMA GOOD-TM-TM-SET-CLOCK
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP CLOCK '65536))
                      (GOOD-TM (TM-SET-CLOCK CLOCK TM)))
             ((ENABLE GOOD-TM TM-SET-CLOCK)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-CLOCK)

(PROVE-LEMMA
 ACCESS-TM-SET-CLOCK
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-CLOCK CLOCK TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-CLOCK CLOCK TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-CLOCK CLOCK TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-CLOCK CLOCK TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-CLOCK CLOCK TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-CLOCK CLOCK TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-CLOCK CLOCK TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-CLOCK CLOCK TM))
                (TM-SVMODE TM))
         (AND
           (EQUAL (TM-SVCFLAG (TM-SET-CLOCK CLOCK TM))
                  (TM-SVCFLAG TM))
           (AND (EQUAL (TM-SVCID (TM-SET-CLOCK CLOCK TM))
                       (TM-SVCID TM))
                (AND (EQUAL (TM-RWSTATE (TM-SET-CLOCK CLOCK TM))
                            (TM-RWSTATE TM))
                     (AND (EQUAL (TM-CLOCK (TM-SET-CLOCK CLOCK TM))
                                 CLOCK)
                          (AND (EQUAL (TM-IPORTS (TM-SET-CLOCK CLOCK TM))
                                      (TM-IPORTS TM))
                               (AND (EQUAL (TM-OPORTS (TM-SET-CLOCK CLOCK TM))
                                           (TM-OPORTS TM))
                                    (AND (EQUAL (TM-PC (TM-SET-CLOCK CLOCK TM))
                                                (TM-PC TM))
                                         (EQUAL (TM-SP (TM-SET-CLOCK CLOCK TM))
                                                (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-CLOCK TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-CLOCK)

(PROVE-LEMMA GOOD-TM-TM-SET-IPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (PLISTP IPORTS)
                                (AND (EQUAL (LENGTH IPORTS) '16)
                                     (GOOD-TM-IPORT-ARRAY IPORTS))))
                      (GOOD-TM (TM-SET-IPORTS IPORTS TM)))
             ((ENABLE GOOD-TM TM-SET-IPORTS LENGTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-IPORTS)

(PROVE-LEMMA
 ACCESS-TM-SET-IPORTS
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-IPORTS IPORTS TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-IPORTS IPORTS TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-IPORTS IPORTS TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-IPORTS IPORTS TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-IPORTS IPORTS TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-IPORTS IPORTS TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-IPORTS IPORTS TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-IPORTS IPORTS TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-IPORTS IPORTS TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-IPORTS IPORTS TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-IPORTS IPORTS TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-IPORTS IPORTS TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-IPORTS IPORTS TM))
                                    IPORTS)
                             (AND (EQUAL (TM-OPORTS (TM-SET-IPORTS IPORTS TM))
                                         (TM-OPORTS TM))
                                  (AND (EQUAL (TM-PC (TM-SET-IPORTS IPORTS TM))
                                              (TM-PC TM))
                                       (EQUAL (TM-SP (TM-SET-IPORTS IPORTS TM))
                                              (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-IPORTS TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-IPORTS)

(PROVE-LEMMA GOOD-TM-TM-SET-OPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (PLISTP OPORTS)
                                (AND (EQUAL (LENGTH OPORTS) '16)
                                     (GOOD-TM-OPORT-ARRAY OPORTS))))
                      (GOOD-TM (TM-SET-OPORTS OPORTS TM)))
             ((ENABLE GOOD-TM TM-SET-OPORTS LENGTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-OPORTS)

(PROVE-LEMMA
 ACCESS-TM-SET-OPORTS
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-OPORTS OPORTS TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-SET-OPORTS OPORTS TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-SET-OPORTS OPORTS TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-SET-OPORTS OPORTS TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-SET-OPORTS OPORTS TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-SET-OPORTS OPORTS TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-SET-OPORTS OPORTS TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-SET-OPORTS OPORTS TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-SET-OPORTS OPORTS TM))
                 (TM-SVCFLAG TM))
          (AND
              (EQUAL (TM-SVCID (TM-SET-OPORTS OPORTS TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-SET-OPORTS OPORTS TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-SET-OPORTS OPORTS TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-SET-OPORTS OPORTS TM))
                                    (TM-IPORTS TM))
                             (AND (EQUAL (TM-OPORTS (TM-SET-OPORTS OPORTS TM))
                                         OPORTS)
                                  (AND (EQUAL (TM-PC (TM-SET-OPORTS OPORTS TM))
                                              (TM-PC TM))
                                       (EQUAL (TM-SP (TM-SET-OPORTS OPORTS TM))
                                              (TM-SP TM)))))))))))))))))
 ((ENABLE TM-SET-OPORTS TM-PC TM-SP)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-OPORTS)

(PROVE-LEMMA GOOD-TM-TM-SET-PC
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP PC '65536))
                      (GOOD-TM (TM-SET-PC PC TM)))
             ((ENABLE GOOD-TM TM-SET-PC TM-SET-REGS LENGTH-PUTNTH
                      PLISTP-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-PC)

(PROVE-LEMMA
 ACCESS-TM-SET-PC
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-PC PC TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-SET-PC PC TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-ERROR (TM-SET-PC PC TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-SET-PC PC TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-SET-PC PC TM))
             (TM-LIMIT TM))
      (AND
        (EQUAL (TM-SLIMIT (TM-SET-PC PC TM))
               (TM-SLIMIT TM))
        (AND (EQUAL (TM-SVMODE (TM-SET-PC PC TM))
                    (TM-SVMODE TM))
             (AND (EQUAL (TM-SVCFLAG (TM-SET-PC PC TM))
                         (TM-SVCFLAG TM))
                  (AND (EQUAL (TM-SVCID (TM-SET-PC PC TM))
                              (TM-SVCID TM))
                       (AND (EQUAL (TM-RWSTATE (TM-SET-PC PC TM))
                                   (TM-RWSTATE TM))
                            (AND (EQUAL (TM-CLOCK (TM-SET-PC PC TM))
                                        (TM-CLOCK TM))
                                 (AND (EQUAL (TM-IPORTS (TM-SET-PC PC TM))
                                             (TM-IPORTS TM))
                                      (AND (EQUAL (TM-OPORTS (TM-SET-PC PC TM))
                                                  (TM-OPORTS TM))
                                           (EQUAL (TM-SP (TM-SET-PC PC TM))
                                                  (TM-SP TM)))))))))))))))
 ((ENABLE TM-SET-PC TM-PC TM-SP TM-SET-REGS
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GETNTH-PUTNTH-NON-INTERFERENCE)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-PC)

(PROVE-LEMMA GOOD-TM-TM-SET-SP
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (FINITE-NUMBERP SP '65536))
                      (GOOD-TM (TM-SET-SP SP TM)))
             ((ENABLE GOOD-TM TM-SET-SP TM-SET-REGS LENGTH-PUTNTH
                      PLISTP-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-SET-SP)

(PROVE-LEMMA
 ACCESS-TM-SET-SP
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-SET-SP SP TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-SET-SP SP TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-ERROR (TM-SET-SP SP TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-SET-SP SP TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-SET-SP SP TM))
             (TM-LIMIT TM))
      (AND
        (EQUAL (TM-SLIMIT (TM-SET-SP SP TM))
               (TM-SLIMIT TM))
        (AND (EQUAL (TM-SVMODE (TM-SET-SP SP TM))
                    (TM-SVMODE TM))
             (AND (EQUAL (TM-SVCFLAG (TM-SET-SP SP TM))
                         (TM-SVCFLAG TM))
                  (AND (EQUAL (TM-SVCID (TM-SET-SP SP TM))
                              (TM-SVCID TM))
                       (AND (EQUAL (TM-RWSTATE (TM-SET-SP SP TM))
                                   (TM-RWSTATE TM))
                            (AND (EQUAL (TM-CLOCK (TM-SET-SP SP TM))
                                        (TM-CLOCK TM))
                                 (AND (EQUAL (TM-IPORTS (TM-SET-SP SP TM))
                                             (TM-IPORTS TM))
                                      (AND (EQUAL (TM-OPORTS (TM-SET-SP SP TM))
                                                  (TM-OPORTS TM))
                                           (EQUAL (TM-PC (TM-SET-SP SP TM))
                                                  (TM-PC TM)))))))))))))))
 ((ENABLE TM-SET-SP TM-PC TM-SP TM-SET-REGS
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GETNTH-PUTNTH-NON-INTERFERENCE)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ACCESS-TM-SET-SP)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-ADD
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-ADD ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-ADD GOOD-TM-TM-SET-CC GOOD-TM-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-ADD)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-BRANCH
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-BRANCH ADDR TM)))
             ((ENABLE TM-EXECUTE-BRANCH FINITE-NUMBERP-TM-FETCH
                      GOOD-TM-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-BRANCH)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-BRANCH-ON-ZERO
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM)))
             ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO FINITE-NUMBERP-TM-FETCH
                      GOOD-TM-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-BRANCH-ON-ZERO)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-BRANCH-NOT-ZERO
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM)))
             ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO FINITE-NUMBERP-TM-FETCH
                      GOOD-TM-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-BRANCH-NOT-ZERO)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-CALL
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-CALL ADDR TM)))
             ((ENABLE TM-EXECUTE-CALL FINITE-NUMBERP FINITE-NUMBERP-TM-FETCH
                      FINITE-NUMBERP-TM-DECR FINITE-NUMBERP-TM-SP
                      FINITE-NUMBERP-TM-PC GOOD-TM-TM-STORE
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-SET-PC GOOD-TM-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-CALL)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-COMPARE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-COMPARE GOOD-TM-TM-SET-CC
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-COMPARE)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-DECR
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-DECR ADDR TM)))
             ((ENABLE TM-EXECUTE-DECR GOOD-TM-TM-STORE GOOD-TM-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-DECR)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-DECR-MOD
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (TM-GOOD-ADDRESS ADDR1 TM)
                                (TM-GOOD-ADDRESS ADDR2 TM)))
                      (GOOD-TM (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-DECR-MOD GOOD-TM-TM-STORE GOOD-TM-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-DECR-MOD)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-INCR
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-INCR ADDR TM)))
             ((ENABLE TM-EXECUTE-INCR GOOD-TM-TM-STORE GOOD-TM-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-INCR)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-INCR-MOD
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (TM-GOOD-ADDRESS ADDR1 TM)
                                (TM-GOOD-ADDRESS ADDR2 TM)))
                      (GOOD-TM (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-INCR-MOD GOOD-TM-TM-STORE GOOD-TM-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-INCR-MOD)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-LOAD-BASE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-LOAD-BASE ADDR TM)))
             ((ENABLE TM-EXECUTE-LOAD-BASE FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH GOOD-TM-TM-SET-BASE
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-LOAD-BASE)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-LOAD-LIMIT
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-LOAD-LIMIT ADDR TM)))
             ((ENABLE TM-EXECUTE-LOAD-LIMIT FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH GOOD-TM-TM-SET-LIMIT
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-LOAD-LIMIT)

(DEFN TM-GOOD-SUPERVISOR-ADDRESS
      (ADDR)
      (IF (ZEROP (REAL-ADDR-SOURCE ADDR))
          (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                          '65536)
          (IF (EQUAL (REAL-ADDR-SOURCE ADDR) '1)
              (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                              '8)
              (FINITE-NUMBERP (REAL-ADDR-NUM ADDR)
                              '65536)))
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-TM-FETCH-IN-SUPERVISOR-MODE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (TM-IN-SUPERVISOR-MODE TM)
                                (TM-GOOD-SUPERVISOR-ADDRESS ADDR)))
                      (FINITE-NUMBERP (TM-FETCH ADDR TM)
                                      '65536))
             ((ENABLE TM-GOOD-SUPERVISOR-ADDRESS TM-FETCH TM-FETCH-FROM-REGMEM
                      LESSP-PLUS-BASE-ADDR-MEMLENGTH FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                      TM-FETCH-FROM-MEMORY)
              (ENABLE-THEORY TM-SHELLS GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-FETCH-IN-SUPERVISOR-MODE)

(PROVE-LEMMA TM-GOOD-SUPERVISOR-ADDRESS-TM-INCR-ADDRESS
             (REWRITE)
             (TM-GOOD-SUPERVISOR-ADDRESS (TM-INCR-ADDRESS ADDR))
             ((ENABLE TM-GOOD-SUPERVISOR-ADDRESS TM-INCR-ADDRESS REAL-ADDR
                      REAL-ADDR-NUM REAL-ADDR-SOURCE FINITE-NUMBERP-TM-INCR
                      FINITE-NUMBERP-REMAINDER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-SUPERVISOR-ADDRESS-TM-INCR-ADDRESS)

(PROVE-LEMMA TM-GOOD-SUPERVISOR-ADDRESS-TM-INCRN-ADDRESS
             (REWRITE)
             (IMPLIES (TM-GOOD-SUPERVISOR-ADDRESS ADDR)
                      (TM-GOOD-SUPERVISOR-ADDRESS (TM-INCRN-ADDRESS N ADDR)))
             ((ENABLE TM-GOOD-SUPERVISOR-ADDRESS-TM-INCR-ADDRESS
                      TM-INCRN-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-SUPERVISOR-ADDRESS-TM-INCRN-ADDRESS)

(PROVE-LEMMA
 TM-GOOD-SUPERVISOR-ADDRESS-TM-GOOD-ADDRESS
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (TM-GOOD-ADDRESS ADDR TM))
          (TM-GOOD-SUPERVISOR-ADDRESS ADDR))
 ((ENABLE TM-GOOD-ADDRESS TM-GOOD-SUPERVISOR-ADDRESS
          FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
  (USE
     (FINITE-NUMBERP-TM-SLIMIT (TM TM))
     (FINITE-NUMBERP-FROM-SMALLER-LUB (N (REAL-ADDR-NUM ADDR))
                                      (I (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                              (TM-LIMIT TM)))
                                      (J '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-GOOD-SUPERVISOR-ADDRESS-TM-GOOD-ADDRESS)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-LOAD-PSW
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-LOAD-PSW ADDR TM)))
             ((ENABLE TM-EXECUTE-LOAD-PSW FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH-IN-SUPERVISOR-MODE
                      FINITE-NUMBERP-TM-FETCH FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCFLAG
                      FINITE-NUMBERP-TM-UNPACK-SVCID
                      TM-GOOD-SUPERVISOR-ADDRESS-TM-GOOD-ADDRESS
                      TM-GOOD-SUPERVISOR-ADDRESS-TM-INCRN-ADDRESS
                      GOOD-TM-TM-SET-SVCFLAG GOOD-TM-TM-SET-SVCID
                      GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-SET-PC
                      GOOD-TM-TM-SET-SP GOOD-TM-TM-SET-CC GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-LOAD-PSW)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-MOD
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-MOD ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-MOD GOOD-TM-TM-SET-CC GOOD-TM-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-MOD)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-MOVE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR2 TM))
                      (GOOD-TM (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-MOVE GOOD-TM-TM-STORE FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-MOVE)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-MULTIPLY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-MULTIPLY GOOD-TM-TM-SET-CC GOOD-TM-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-MULTIPLY)

(PROVE-LEMMA
 FINITE-NUMBERP-ADD1-TM-SP
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (NOT (TM-STACK-UNDERFLOWP TM)))
          (FINITE-NUMBERP (ADD1 (TM-SP TM))
                          '65536))
 ((ENABLE TM-STACK-UNDERFLOWP FINITE-NUMBERP MIN)
  (USE
     (FINITE-NUMBERP-TM-SLIMIT (TM TM))
     (FINITE-NUMBERP-TM-LIMIT (TM TM))
     (FINITE-NUMBERP-TM-SP (TM TM))
     (FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT (TM TM))
     (FINITE-NUMBERP-FROM-SMALLER-LUB (N (ADD1 (TM-SP TM)))
                                      (I (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                              (TM-LIMIT TM)))
                                      (J '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADD1-TM-SP)

(PROVE-LEMMA TM-INCR-SP-IS-ADD1-SP
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (NOT (TM-STACK-UNDERFLOWP TM)))
                      (EQUAL (TM-INCR (TM-SP TM))
                             (ADD1 (TM-SP TM))))
             ((ENABLE TM-STACK-UNDERFLOWP TM-INCR FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT (TM TM))
                   (FINITE-NUMBERP-TM-SLIMIT (TM TM))
                   (REMAINDER-NOOP (A (ADD1 (TM-SP TM)))
                                   (B '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-INCR-SP-IS-ADD1-SP)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-RETURN
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-RETURN TM)))
             ((ENABLE TM-EXECUTE-RETURN FINITE-NUMBERP FINITE-NUMBERP-TM-FETCH
                      TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS
                      TM-INCR-SP-IS-ADD1-SP FINITE-NUMBERP-ADD1-TM-SP
                      FINITE-NUMBERP-TM-SLIMIT GOOD-TM-TM-SET-ERROR
                      GOOD-TM-TM-SET-PC GOOD-TM-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-RETURN)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-TEST-IPORT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-TEST-IPORT ADDR TM)))
             ((ENABLE TM-EXECUTE-TEST-IPORT FINITE-NUMBERP GOOD-TM-TM-SET-CC
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-TEST-IPORT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-TEST-OPORT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-TEST-OPORT ADDR TM)))
             ((ENABLE TM-EXECUTE-TEST-OPORT FINITE-NUMBERP GOOD-TM-TM-SET-CC
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-TEST-OPORT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-SET-CLOCK
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-SET-CLOCK ADDR TM)))
             ((ENABLE TM-EXECUTE-SET-CLOCK FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH GOOD-TM-TM-SET-CLOCK
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-SET-CLOCK)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-RUN
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-RUN TM)))
             ((ENABLE TM-EXECUTE-RUN FINITE-NUMBERP FINITE-NUMBERP-TM-FETCH
                      GOOD-TM-TM-SET-RWSTATE GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-RUN)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-WAIT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-WAIT TM)))
             ((ENABLE TM-EXECUTE-WAIT FINITE-NUMBERP FINITE-NUMBERP-TM-FETCH
                      GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-SET-RWSTATE
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-WAIT)

(PROVE-LEMMA
    GOOD-TM-OPORTS-TM-POST-OUTPUT-INTERRUPT
    (REWRITE)
    (IMPLIES (AND (PLISTP L)
                  (GOOD-TM-OPORT-ARRAY L))
             (AND (PLISTP (TM-POST-OUTPUT-INTERRUPT ID L))
                  (AND (EQUAL (LENGTH (TM-POST-OUTPUT-INTERRUPT ID L))
                              (LENGTH L))
                       (GOOD-TM-OPORT-ARRAY (TM-POST-OUTPUT-INTERRUPT ID L)))))
    ((ENABLE GOOD-TM-OPORT-ARRAY-PUTNTH LENGTH FINITE-NUMBERP GOOD-TM-OPORT
             PLISTP-PUTNTH LENGTH-PUTNTH TM-POST-OUTPUT-INTERRUPT)
     (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORTS-TM-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-POST-OUTPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM)))
             ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT FINITE-NUMBERP
                      GOOD-TM-OPORT-ARRAY-TM-OPORTS
                      GOOD-TM-OPORTS-TM-POST-OUTPUT-INTERRUPT PLISTP-TM-OPORTS
                      LENGTH-TM-OPORTS GOOD-TM-OPORT-ARRAY-TM-OPORTS
                      GOOD-TM-TM-SET-OPORTS GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA
        GOOD-TM-OPORTS-TM-START-OUTPUT
        (REWRITE)
        (IMPLIES (AND (PLISTP L)
                      (GOOD-TM-OPORT-ARRAY L))
                 (AND (PLISTP (TM-START-OUTPUT CHAR ID L))
                      (AND (EQUAL (LENGTH (TM-START-OUTPUT CHAR ID L))
                                  (LENGTH L))
                           (GOOD-TM-OPORT-ARRAY (TM-START-OUTPUT CHAR ID L)))))
        ((ENABLE GOOD-TM-OPORT-ARRAY-PUTNTH LENGTH GOOD-TM-OPORT
                 LESSP-REMAINDER2 FINITE-NUMBERP PLISTP-PUTNTH LENGTH-PUTNTH
                 TM-START-OUTPUT)
         (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORTS-TM-START-OUTPUT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-START-OUTPUT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-START-OUTPUT FINITE-NUMBERP
                      GOOD-TM-OPORT-ARRAY-TM-OPORTS
                      GOOD-TM-OPORTS-TM-START-OUTPUT PLISTP-TM-OPORTS
                      LENGTH-TM-OPORTS GOOD-TM-OPORT-ARRAY-TM-OPORTS
                      GOOD-TM-TM-SET-OPORTS GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-START-OUTPUT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-SVC
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-SVC ADDR TM)))
             ((ENABLE TM-EXECUTE-SVC FINITE-NUMBERP FINITE-NUMBERP-REMAINDER
                      GOOD-TM-TM-SET-SVCFLAG GOOD-TM-TM-SET-SVCID
                      FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-SVC)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-SVC-RETURN
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS ADDR TM))
                      (GOOD-TM (TM-EXECUTE-SVC-RETURN ADDR TM)))
             ((ENABLE TM-EXECUTE-SVC-RETURN FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH-IN-SUPERVISOR-MODE
                      FINITE-NUMBERP-TM-FETCH FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCID
                      TM-GOOD-SUPERVISOR-ADDRESS-TM-GOOD-ADDRESS
                      TM-GOOD-SUPERVISOR-ADDRESS-TM-INCRN-ADDRESS
                      GOOD-TM-TM-SET-SVCFLAG GOOD-TM-TM-SET-SVCID
                      GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-SET-PC
                      GOOD-TM-TM-SET-SP GOOD-TM-TM-SET-CC GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-SVC-RETURN)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-NULLARY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-NULLARY OPCODE TM)))
             ((ENABLE TM-EXECUTE-NULLARY FINITE-NUMBERP GOOD-TM-TM-SET-ERROR
                      GOOD-TM-TM-EXECUTE-RUN GOOD-TM-TM-EXECUTE-WAIT
                      GOOD-TM-TM-EXECUTE-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-NULLARY)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-UNARY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-UNARY OPCODE ADDR TM)))
             ((ENABLE TM-EXECUTE-UNARY FINITE-NUMBERP GOOD-TM-TM-SET-ERROR
                      GOOD-TM-TM-EXECUTE-BRANCH
                      GOOD-TM-TM-EXECUTE-BRANCH-ON-ZERO
                      GOOD-TM-TM-EXECUTE-BRANCH-NOT-ZERO
                      GOOD-TM-TM-EXECUTE-CALL GOOD-TM-TM-EXECUTE-DECR
                      GOOD-TM-TM-EXECUTE-INCR GOOD-TM-TM-EXECUTE-LOAD-BASE
                      GOOD-TM-TM-EXECUTE-LOAD-LIMIT
                      GOOD-TM-TM-EXECUTE-LOAD-PSW GOOD-TM-TM-EXECUTE-SET-CLOCK
                      GOOD-TM-TM-EXECUTE-TEST-IPORT
                      GOOD-TM-TM-EXECUTE-TEST-OPORT
                      GOOD-TM-TM-EXECUTE-POST-OUTPUT-INTERRUPT
                      GOOD-TM-TM-EXECUTE-SVC GOOD-TM-TM-EXECUTE-SVC-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-UNARY)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-BINARY
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM)))
             ((ENABLE TM-EXECUTE-BINARY FINITE-NUMBERP GOOD-TM-TM-SET-ERROR
                      GOOD-TM-TM-EXECUTE-ADD GOOD-TM-TM-EXECUTE-COMPARE
                      GOOD-TM-TM-EXECUTE-DECR-MOD GOOD-TM-TM-EXECUTE-INCR-MOD
                      GOOD-TM-TM-EXECUTE-MOD GOOD-TM-TM-EXECUTE-MOVE
                      GOOD-TM-TM-EXECUTE-MULTIPLY
                      GOOD-TM-TM-EXECUTE-START-OUTPUT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-BINARY)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-INSTRUCTION
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-INSTRUCTION INSTRUCTION TM)))
             ((ENABLE TM-EXECUTE-INSTRUCTION FINITE-NUMBERP
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-EXECUTE-BINARY
                      GOOD-TM-TM-EXECUTE-UNARY GOOD-TM-TM-EXECUTE-NULLARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA PLUS-TM-BASE-TM-LIMIT-TM-SET-PC
             (REWRITE)
             (EQUAL (PLUS (TM-BASE (TM-SET-PC PC TM))
                          (TM-LIMIT (TM-SET-PC PC TM)))
                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
             ((ENABLE TM-SET-PC TM-SET-REGS)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TM-BASE-TM-LIMIT-TM-SET-PC)

(PROVE-LEMMA FINITE-NUMBERP-TM-GOOD-ADDRESS
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-GOOD-ADDRESS (REAL-ADDR '2 N)
                                            TM))
                      (FINITE-NUMBERP N '65536))
             ((ENABLE GOOD-TM TM-GOOD-ADDRESS REAL-ADDR REAL-ADDR-SOURCE
                      REAL-ADDR-NUM MIN FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-GOOD-ADDRESS)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE INSTRUCTION TM)))
             ((ENABLE TM-EXECUTE FINITE-NUMBERP
                      PLUS-TM-BASE-TM-LIMIT-TM-SET-PC
                      FINITE-NUMBERP-TM-GOOD-ADDRESS FINITE-NUMBERP-TM-INCRN
                      FINITE-NUMBERP-TM-PC GOOD-TM-TM-SET-ERROR
                      GOOD-TM-TM-SET-PC GOOD-TM-TM-EXECUTE-INSTRUCTION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE)

(PROVE-LEMMA GOOD-TM-TM-DECREMENT-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-DECREMENT-CLOCK TM)))
             ((ENABLE TM-DECREMENT-CLOCK GOOD-TM-TM-SET-CLOCK TM-DECR
                      FINITE-NUMBER-SUB1)
              (USE (FINITE-NUMBERP-TM-CLOCK (TM TM)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-DECREMENT-CLOCK)

(PROVE-LEMMA PLUS-TM-BASE-TM-LIMIT-TM-DECREMENT-CLOCK
             (REWRITE)
             (EQUAL (PLUS (TM-BASE (TM-DECREMENT-CLOCK TM))
                          (TM-LIMIT (TM-DECREMENT-CLOCK TM)))
                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
             ((ENABLE TM-DECREMENT-CLOCK TM-SET-CLOCK)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TM-BASE-TM-LIMIT-TM-DECREMENT-CLOCK)

(PROVE-LEMMA
 TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-DECREMENT-CLOCK TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-DECREMENT-CLOCK TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-DECREMENT-CLOCK TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-DECREMENT-CLOCK TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-DECREMENT-CLOCK TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-DECREMENT-CLOCK TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-DECREMENT-CLOCK TM))
               (TM-SLIMIT TM))
        (AND
           (EQUAL (TM-SVMODE (TM-DECREMENT-CLOCK TM))
                  (TM-SVMODE TM))
           (AND (EQUAL (TM-SVCFLAG (TM-DECREMENT-CLOCK TM))
                       (TM-SVCFLAG TM))
                (AND (EQUAL (TM-SVCID (TM-DECREMENT-CLOCK TM))
                            (TM-SVCID TM))
                     (AND (EQUAL (TM-RWSTATE (TM-DECREMENT-CLOCK TM))
                                 (TM-RWSTATE TM))
                          (AND (EQUAL (TM-IPORTS (TM-DECREMENT-CLOCK TM))
                                      (TM-IPORTS TM))
                               (AND (EQUAL (TM-OPORTS (TM-DECREMENT-CLOCK TM))
                                           (TM-OPORTS TM))
                                    (AND (EQUAL (TM-PC (TM-DECREMENT-CLOCK TM))
                                                (TM-PC TM))
                                         (EQUAL (TM-SP (TM-DECREMENT-CLOCK TM))
                                                (TM-SP TM))))))))))))))))
 ((ENABLE TM-DECREMENT-CLOCK ACCESS-TM-SET-CLOCK)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK)

(PROVE-LEMMA TM-GOOD-ADDRESS-TM-DECREMENT-CLOCK
             (REWRITE)
             (EQUAL (TM-GOOD-ADDRESS ADDR
                                     (TM-DECREMENT-CLOCK TM))
                    (TM-GOOD-ADDRESS ADDR TM))
             ((ENABLE TM-GOOD-ADDRESS TM-IN-SUPERVISOR-MODE
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-DECREMENT-CLOCK)

(PROVE-LEMMA GOOD-TM-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-FETCH-EXECUTE TM)))
             ((ENABLE TM-FETCH-EXECUTE FINITE-NUMBERP TM-GOOD-PC-ADDRESS
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
                      TM-GOOD-ADDRESS-TM-DECREMENT-CLOCK GOOD-TM-TM-EXECUTE
                      GOOD-TM-TM-DECREMENT-CLOCK GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-FETCH-EXECUTE)

(PROVE-LEMMA TM-GOOD-ADDRESS-TM-STORE
             (REWRITE)
             (EQUAL (TM-GOOD-ADDRESS ADDR
                                     (TM-STORE VALUE ADDR TM))
                    (TM-GOOD-ADDRESS ADDR TM))
             ((ENABLE TM-GOOD-ADDRESS TM-IN-SUPERVISOR-MODE
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-STORE)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-CLOCK-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-CLOCK-INTERRUPT TM)))
             ((ENABLE TM-EXECUTE-CLOCK-INTERRUPT FINITE-NUMBERP
                      ACCESS-TM-SET-SVMODE TM-IN-SUPERVISOR-MODE
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-STORE-OLD-PSW-ON-INTERRUPT
                      TM-FETCH-NEW-PC-ON-INTERRUPT GOOD-TM-TM-SET-RWSTATE
                      GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-SET-PC
                      GOOD-TM-TM-SET-SP GOOD-TM-TM-STORE
                      FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
                      TM-GOOD-ADDRESS-TM-STORE FINITE-NUMBERP-TM-DECR)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-CLOCK-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-ERROR-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-ERROR-INTERRUPT TM)))
             ((ENABLE TM-EXECUTE-ERROR-INTERRUPT FINITE-NUMBERP
                      ACCESS-TM-SET-SVMODE TM-IN-SUPERVISOR-MODE
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-STORE-OLD-PSW-ON-INTERRUPT
                      TM-FETCH-NEW-PC-ON-INTERRUPT GOOD-TM-TM-SET-RWSTATE
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-SET-SVMODE
                      GOOD-TM-TM-SET-PC GOOD-TM-TM-SET-SP GOOD-TM-TM-STORE
                      FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
                      TM-GOOD-ADDRESS-TM-STORE FINITE-NUMBERP-TM-DECR)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-ERROR-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-SVC-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-EXECUTE-SVC-INTERRUPT TM)))
             ((ENABLE ACCESS-TM-SET-SVMODE FINITE-NUMBERP
                      ACCESS-TM-SET-SVCFLAG ACCESS-TM-SET-RWSTATE
                      FINITE-NUMBERP-TM-PACK-PSW1 FINITE-NUMBERP-TM-DECR
                      FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-SET-PC
                      GOOD-TM-TM-SET-RWSTATE GOOD-TM-TM-SET-SP
                      GOOD-TM-TM-SET-SVCFLAG GOOD-TM-TM-SET-SVMODE
                      GOOD-TM-TM-STORE TM-EXECUTE-SVC-INTERRUPT
                      TM-FETCH-NEW-PC-ON-INTERRUPT TM-GOOD-ADDRESS-TM-STORE
                      TM-IN-SUPERVISOR-MODE TM-STORE-OLD-PSW-ON-INTERRUPT
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-STORE-SVCID-ON-INTERRUPT)
              (USE (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-SVCID TM))
                                                    (I '128)
                                                    (J '65536)))
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-SVC-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-INPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS TM)))
                      (GOOD-TM (TM-EXECUTE-INPUT-INTERRUPT TM)))
             ((ENABLE TM-EXECUTE-INPUT-INTERRUPT FINITE-NUMBERP
                      TM-FETCH-NEW-PC-ON-INTERRUPT TM-IN-SUPERVISOR-MODE
                      TM-STORE-INTERRUPTING-INPUT-DEVICE
                      TM-STORE-OLD-PSW-ON-INTERRUPT
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB ACCESS-TM-SET-SP
                      ACCESS-TM-SET-ERROR ACCESS-TM-SET-IPORTS
                      ACCESS-TM-SET-SVMODE ACCESS-TM-SET-RWSTATE
                      FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
                      GOOD-TM-IPORTS-TM-CLEAR-INPUT-INTERRUPT
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-SET-IPORTS
                      GOOD-TM-TM-SET-PC GOOD-TM-TM-SET-RWSTATE
                      GOOD-TM-TM-SET-SP GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-STORE
                      TM-GOOD-ADDRESS-TM-STORE
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      FINITE-NUMBERP-TM-DECR)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-INPUT-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-EXECUTE-OUTPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS TM)))
                      (GOOD-TM (TM-EXECUTE-OUTPUT-INTERRUPT TM)))
             ((ENABLE TM-EXECUTE-OUTPUT-INTERRUPT FINITE-NUMBERP
                      TM-FETCH-NEW-PC-ON-INTERRUPT TM-IN-SUPERVISOR-MODE
                      TM-STORE-INTERRUPTING-OUTPUT-DEVICE
                      TM-STORE-OLD-PSW-ON-INTERRUPT
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB ACCESS-TM-SET-SP
                      ACCESS-TM-SET-ERROR ACCESS-TM-SET-OPORTS
                      ACCESS-TM-SET-SVMODE ACCESS-TM-SET-RWSTATE
                      FINITE-NUMBERP-TM-FETCH-FROM-MEMORY-IN-SUPERVISOR-MODE
                      GOOD-TM-OPORTS-TM-CLEAR-OUTPUT-INTERRUPT
                      GOOD-TM-TM-SET-ERROR GOOD-TM-TM-SET-OPORTS
                      GOOD-TM-TM-SET-PC GOOD-TM-TM-SET-RWSTATE
                      GOOD-TM-TM-SET-SP GOOD-TM-TM-SET-SVMODE GOOD-TM-TM-STORE
                      TM-GOOD-ADDRESS-TM-STORE
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      FINITE-NUMBERP-TM-DECR)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-EXECUTE-OUTPUT-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-STEP
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-STEP TM)))
             ((ENABLE TM-STEP TM-INPUT-INTERRUPTP TM-OUTPUT-INTERRUPTP
                      GOOD-TM-TM-EXECUTE-ERROR-INTERRUPT
                      GOOD-TM-TM-EXECUTE-SVC-INTERRUPT
                      GOOD-TM-TM-EXECUTE-INPUT-INTERRUPT
                      GOOD-TM-TM-EXECUTE-OUTPUT-INTERRUPT
                      GOOD-TM-TM-EXECUTE-CLOCK-INTERRUPT
                      GOOD-TM-TM-FETCH-EXECUTE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-STEP)

(PROVE-LEMMA
        GOOD-TM-IPORTS-TM-POST-INPUT-INTERRUPT
        (REWRITE)
        (IMPLIES (AND (PLISTP L)
                      (AND (FINITE-NUMBERP ID (LENGTH L))
                           (AND (FINITE-NUMBERP CHAR '256)
                                (GOOD-TM-IPORT-ARRAY L))))
                 (AND (PLISTP (TM-POST-INPUT-INTERRUPT CHAR ID L))
                      (AND (EQUAL (LENGTH (TM-POST-INPUT-INTERRUPT CHAR ID L))
                                  (LENGTH L))
                           (GOOD-TM-IPORT-ARRAY (TM-POST-INPUT-INTERRUPT CHAR
                                                                         ID
                                                                         L)))))
        ((ENABLE GOOD-TM-IPORT-ARRAY-PUTNTH LENGTH FINITE-NUMBERP
                 A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TM-IPORT
                 PLISTP-PUTNTH LENGTH-PUTNTH TM-POST-INPUT-INTERRUPT)
         (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
         (USE (GOOD-TM-IPORT-GETNTH (I ID) (L L)))
         (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORTS-TM-POST-INPUT-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-POST-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-POST-INTERRUPT EVENT TM)))
             ((ENABLE TM-POST-INTERRUPT FINITE-NUMBERP-REMAINDER
                      GOOD-TM-OPORTS-TM-POST-OUTPUT-INTERRUPT
                      GOOD-TM-IPORTS-TM-POST-INPUT-INTERRUPT
                      GOOD-TM-TM-SET-IPORTS GOOD-TM-TM-SET-OPORTS)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-POST-INTERRUPT)

(PROVE-LEMMA GOOD-TM-TM-PROCESSOR
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (GOOD-TM (TM-PROCESSOR TM N)))
             ((ENABLE TM-PROCESSOR GOOD-TM-TM-STEP GOOD-TM-TM-POST-INTERRUPT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-TM-PROCESSOR)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-ADD
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
             (TM-SVMODE TM))
      (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                (TM-SVCFLAG TM))
         (AND (EQUAL (TM-SVCID (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                    (TM-IPORTS TM))
                             (EQUAL (TM-OPORTS (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                    (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-ADD TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-ADD)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH ADDR TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-EXECUTE-BRANCH ADDR TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-ERROR (TM-EXECUTE-BRANCH ADDR TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-BRANCH ADDR TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-BRANCH ADDR TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-BRANCH ADDR TM))
              (TM-SLIMIT TM))
       (AND
        (EQUAL (TM-SVMODE (TM-EXECUTE-BRANCH ADDR TM))
               (TM-SVMODE TM))
        (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-BRANCH ADDR TM))
                (TM-SVCFLAG TM))
         (AND
             (EQUAL (TM-SVCID (TM-EXECUTE-BRANCH ADDR TM))
                    (TM-SVCID TM))
             (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-BRANCH ADDR TM))
                         (TM-RWSTATE TM))
                  (AND (EQUAL (TM-CLOCK (TM-EXECUTE-BRANCH ADDR TM))
                              (TM-CLOCK TM))
                       (AND (EQUAL (TM-IPORTS (TM-EXECUTE-BRANCH ADDR TM))
                                   (TM-IPORTS TM))
                            (AND (EQUAL (TM-OPORTS (TM-EXECUTE-BRANCH ADDR TM))
                                        (TM-OPORTS TM))
                                 (EQUAL (TM-SP (TM-EXECUTE-BRANCH ADDR TM))
                                        (TM-SP TM)))))))))))))))
 ((ENABLE TM-EXECUTE-BRANCH ACCESS-TM-SET-PC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-ON-ZERO
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-ERROR (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
              (TM-SLIMIT TM))
       (AND
        (EQUAL (TM-SVMODE (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
               (TM-SVMODE TM))
        (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                (TM-SVCFLAG TM))
         (AND
          (EQUAL (TM-SVCID (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                 (TM-SVCID TM))
          (AND
           (EQUAL (TM-RWSTATE (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                  (TM-RWSTATE TM))
           (AND
               (EQUAL (TM-CLOCK (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                      (TM-CLOCK TM))
               (AND (EQUAL (TM-IPORTS (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                           (TM-IPORTS TM))
                    (AND (EQUAL (TM-OPORTS (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                                (TM-OPORTS TM))
                         (EQUAL (TM-SP (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                                (TM-SP TM)))))))))))))))
 ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO ACCESS-TM-SET-PC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-ON-ZERO)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-NOT-ZERO
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-ERROR (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
              (TM-SLIMIT TM))
       (AND
        (EQUAL (TM-SVMODE (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
               (TM-SVMODE TM))
        (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                (TM-SVCFLAG TM))
         (AND
          (EQUAL (TM-SVCID (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                 (TM-SVCID TM))
          (AND
           (EQUAL (TM-RWSTATE (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                  (TM-RWSTATE TM))
           (AND
              (EQUAL (TM-CLOCK (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                     (TM-CLOCK TM))
              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                          (TM-IPORTS TM))
                   (AND (EQUAL (TM-OPORTS (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                               (TM-OPORTS TM))
                        (EQUAL (TM-SP (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                               (TM-SP TM)))))))))))))))
 ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO ACCESS-TM-SET-PC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-NOT-ZERO)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-CALL
 (REWRITE)
 (AND
  (EQUAL (TM-CC (TM-EXECUTE-CALL ADDR TM))
         (TM-CC TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-CALL ADDR TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-CALL ADDR TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-CALL ADDR TM))
            (TM-SLIMIT TM))
     (AND (EQUAL (TM-SVMODE (TM-EXECUTE-CALL ADDR TM))
                 (TM-SVMODE TM))
          (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-CALL ADDR TM))
                      (TM-SVCFLAG TM))
               (AND (EQUAL (TM-SVCID (TM-EXECUTE-CALL ADDR TM))
                           (TM-SVCID TM))
                    (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-CALL ADDR TM))
                                (TM-RWSTATE TM))
                         (AND (EQUAL (TM-CLOCK (TM-EXECUTE-CALL ADDR TM))
                                     (TM-CLOCK TM))
                              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-CALL ADDR TM))
                                          (TM-IPORTS TM))
                                   (EQUAL (TM-OPORTS (TM-EXECUTE-CALL ADDR TM))
                                          (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-CALL ACCESS-TM-SET-PC ACCESS-TM-SET-SP
          ACCESS-TM-SET-ERROR TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-CALL)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-COMPARE
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-ERROR (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
           (TM-ERROR TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
              (TM-SLIMIT TM))
       (AND
        (EQUAL (TM-SVMODE (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
               (TM-SVMODE TM))
        (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                (TM-SVCFLAG TM))
         (AND
          (EQUAL (TM-SVCID (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                 (TM-SVCID TM))
          (AND
           (EQUAL (TM-RWSTATE (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                  (TM-RWSTATE TM))
           (AND
              (EQUAL (TM-CLOCK (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                     (TM-CLOCK TM))
              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                          (TM-IPORTS TM))
                   (AND (EQUAL (TM-OPORTS (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-OPORTS TM))
                        (AND (EQUAL (TM-PC (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                                    (TM-PC TM))
                             (EQUAL (TM-SP (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                                    (TM-SP TM))))))))))))))))
 ((ENABLE TM-EXECUTE-COMPARE ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-COMPARE)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-DECR ADDR TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-DECR ADDR TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-DECR ADDR TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-DECR ADDR TM))
            (TM-SLIMIT TM))
     (AND (EQUAL (TM-SVMODE (TM-EXECUTE-DECR ADDR TM))
                 (TM-SVMODE TM))
          (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-DECR ADDR TM))
                      (TM-SVCFLAG TM))
               (AND (EQUAL (TM-SVCID (TM-EXECUTE-DECR ADDR TM))
                           (TM-SVCID TM))
                    (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-DECR ADDR TM))
                                (TM-RWSTATE TM))
                         (AND (EQUAL (TM-CLOCK (TM-EXECUTE-DECR ADDR TM))
                                     (TM-CLOCK TM))
                              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-DECR ADDR TM))
                                          (TM-IPORTS TM))
                                   (EQUAL (TM-OPORTS (TM-EXECUTE-DECR ADDR TM))
                                          (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-DECR TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR-MOD
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
             (TM-SVMODE TM))
      (AND
       (EQUAL (TM-SVCFLAG (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
              (TM-SVCFLAG TM))
       (AND
         (EQUAL (TM-SVCID (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                (TM-SVCID TM))
         (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                     (TM-RWSTATE TM))
              (AND (EQUAL (TM-CLOCK (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                          (TM-CLOCK TM))
                   (AND (EQUAL (TM-IPORTS (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                               (TM-IPORTS TM))
                        (EQUAL (TM-OPORTS (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                               (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-DECR-MOD TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR-MOD)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-INCR ADDR TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-INCR ADDR TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-INCR ADDR TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-INCR ADDR TM))
            (TM-SLIMIT TM))
     (AND (EQUAL (TM-SVMODE (TM-EXECUTE-INCR ADDR TM))
                 (TM-SVMODE TM))
          (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-INCR ADDR TM))
                      (TM-SVCFLAG TM))
               (AND (EQUAL (TM-SVCID (TM-EXECUTE-INCR ADDR TM))
                           (TM-SVCID TM))
                    (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-INCR ADDR TM))
                                (TM-RWSTATE TM))
                         (AND (EQUAL (TM-CLOCK (TM-EXECUTE-INCR ADDR TM))
                                     (TM-CLOCK TM))
                              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-INCR ADDR TM))
                                          (TM-IPORTS TM))
                                   (EQUAL (TM-OPORTS (TM-EXECUTE-INCR ADDR TM))
                                          (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-INCR TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR-MOD
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
             (TM-SVMODE TM))
      (AND
       (EQUAL (TM-SVCFLAG (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
              (TM-SVCFLAG TM))
       (AND
         (EQUAL (TM-SVCID (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                (TM-SVCID TM))
         (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                     (TM-RWSTATE TM))
              (AND (EQUAL (TM-CLOCK (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                          (TM-CLOCK TM))
                   (AND (EQUAL (TM-IPORTS (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                               (TM-IPORTS TM))
                        (EQUAL (TM-OPORTS (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                               (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-INCR-MOD TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR-MOD)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-BASE
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-BASE ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-LOAD-BASE ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-LOAD-BASE ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-LOAD-BASE ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-LOAD-BASE ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-LOAD-BASE ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-LOAD-BASE ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-LOAD-BASE ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-LOAD-BASE ADDR TM))
                  (TM-SVCID TM))
           (AND
              (EQUAL (TM-RWSTATE (TM-EXECUTE-LOAD-BASE ADDR TM))
                     (TM-RWSTATE TM))
              (AND (EQUAL (TM-CLOCK (TM-EXECUTE-LOAD-BASE ADDR TM))
                          (TM-CLOCK TM))
                   (AND (EQUAL (TM-IPORTS (TM-EXECUTE-LOAD-BASE ADDR TM))
                               (TM-IPORTS TM))
                        (AND (EQUAL (TM-OPORTS (TM-EXECUTE-LOAD-BASE ADDR TM))
                                    (TM-OPORTS TM))
                             (AND (EQUAL (TM-PC (TM-EXECUTE-LOAD-BASE ADDR TM))
                                         (TM-PC TM))
                                  (EQUAL (TM-SP (TM-EXECUTE-LOAD-BASE ADDR TM))
                                         (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-LOAD-BASE ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-BASE)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-LIMIT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-LIMIT ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-LOAD-LIMIT ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-LOAD-LIMIT ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-LOAD-LIMIT ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-LOAD-LIMIT ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-LOAD-LIMIT ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                  (TM-SVCID TM))
           (AND
             (EQUAL (TM-RWSTATE (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                    (TM-RWSTATE TM))
             (AND (EQUAL (TM-CLOCK (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                         (TM-CLOCK TM))
                  (AND (EQUAL (TM-IPORTS (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                              (TM-IPORTS TM))
                       (AND (EQUAL (TM-OPORTS (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                   (TM-OPORTS TM))
                            (AND (EQUAL (TM-PC (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                        (TM-PC TM))
                                 (EQUAL (TM-SP (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                        (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-LOAD-LIMIT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-LIMIT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-PSW
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-PSW ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-LOAD-PSW ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-LOAD-PSW ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-LOAD-PSW ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-LOAD-PSW ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-LOAD-PSW ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-LOAD-PSW ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-LOAD-PSW ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-LOAD-PSW ADDR TM))
                  (TM-SVCID TM))
           (AND
               (EQUAL (TM-RWSTATE (TM-EXECUTE-LOAD-PSW ADDR TM))
                      (TM-RWSTATE TM))
               (AND (EQUAL (TM-CLOCK (TM-EXECUTE-LOAD-PSW ADDR TM))
                           (TM-CLOCK TM))
                    (AND (EQUAL (TM-IPORTS (TM-EXECUTE-LOAD-PSW ADDR TM))
                                (TM-IPORTS TM))
                         (AND (EQUAL (TM-OPORTS (TM-EXECUTE-LOAD-PSW ADDR TM))
                                     (TM-OPORTS TM))
                              (AND (EQUAL (TM-PC (TM-EXECUTE-LOAD-PSW ADDR TM))
                                          (TM-PC TM))
                                   (EQUAL (TM-SP (TM-EXECUTE-LOAD-PSW ADDR TM))
                                          (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-LOAD-PSW ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-PSW)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOD
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
             (TM-SVMODE TM))
      (AND
         (EQUAL (TM-SVCFLAG (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                (TM-SVCFLAG TM))
         (AND (EQUAL (TM-SVCID (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                     (TM-SVCID TM))
              (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                          (TM-RWSTATE TM))
                   (AND (EQUAL (TM-CLOCK (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                               (TM-CLOCK TM))
                        (AND (EQUAL (TM-IPORTS (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                    (TM-IPORTS TM))
                             (EQUAL (TM-OPORTS (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                    (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-MOD TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOD)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOVE
 (REWRITE)
 (AND
  (EQUAL (TM-CC (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
         (TM-CC TM))
  (AND
   (EQUAL (TM-ERROR (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
          (TM-ERROR TM))
   (AND
    (EQUAL (TM-BASE (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
           (TM-BASE TM))
    (AND
     (EQUAL (TM-LIMIT (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
            (TM-LIMIT TM))
     (AND
      (EQUAL (TM-SLIMIT (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
             (TM-SLIMIT TM))
      (AND
       (EQUAL (TM-SVMODE (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
              (TM-SVMODE TM))
       (AND
        (EQUAL (TM-SVCFLAG (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
               (TM-SVCFLAG TM))
        (AND (EQUAL (TM-SVCID (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                    (TM-SVCID TM))
             (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                         (TM-RWSTATE TM))
                  (AND (EQUAL (TM-CLOCK (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                              (TM-CLOCK TM))
                       (AND (EQUAL (TM-IPORTS (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                   (TM-IPORTS TM))
                            (EQUAL (TM-OPORTS (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                   (TM-OPORTS TM)))))))))))))
 ((ENABLE TM-EXECUTE-MOVE TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOVE)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MULTIPLY
 (REWRITE)
 (AND
  (EQUAL (TM-ERROR (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
         (TM-ERROR TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
             (TM-SVMODE TM))
      (AND
       (EQUAL (TM-SVCFLAG (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
              (TM-SVCFLAG TM))
       (AND
         (EQUAL (TM-SVCID (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                (TM-SVCID TM))
         (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                     (TM-RWSTATE TM))
              (AND (EQUAL (TM-CLOCK (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                          (TM-CLOCK TM))
                   (AND (EQUAL (TM-IPORTS (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                               (TM-IPORTS TM))
                        (EQUAL (TM-OPORTS (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                               (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-MULTIPLY TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
          ACCESS-TM-SET-CC)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MULTIPLY)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RETURN
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-RETURN TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-CC (TM-EXECUTE-RETURN TM))
          (TM-CC TM))
   (AND
    (EQUAL (TM-BASE (TM-EXECUTE-RETURN TM))
           (TM-BASE TM))
    (AND
     (EQUAL (TM-LIMIT (TM-EXECUTE-RETURN TM))
            (TM-LIMIT TM))
     (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-RETURN TM))
               (TM-SLIMIT TM))
        (AND (EQUAL (TM-SVMODE (TM-EXECUTE-RETURN TM))
                    (TM-SVMODE TM))
             (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-RETURN TM))
                         (TM-SVCFLAG TM))
                  (AND (EQUAL (TM-SVCID (TM-EXECUTE-RETURN TM))
                              (TM-SVCID TM))
                       (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-RETURN TM))
                                   (TM-RWSTATE TM))
                            (AND (EQUAL (TM-CLOCK (TM-EXECUTE-RETURN TM))
                                        (TM-CLOCK TM))
                                 (AND (EQUAL (TM-IPORTS (TM-EXECUTE-RETURN TM))
                                             (TM-IPORTS TM))
                                      (EQUAL (TM-OPORTS (TM-EXECUTE-RETURN TM))
                                             (TM-OPORTS TM)))))))))))))
 ((ENABLE TM-EXECUTE-RETURN ACCESS-TM-SET-ERROR ACCESS-TM-SET-PC
          ACCESS-TM-SET-SP)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RETURN)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SET-CLOCK
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-SET-CLOCK ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-SET-CLOCK ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-SET-CLOCK ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-SET-CLOCK ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-SET-CLOCK ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-SET-CLOCK ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-SET-CLOCK ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-SET-CLOCK ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-SET-CLOCK ADDR TM))
                  (TM-SVCID TM))
           (AND
              (EQUAL (TM-RWSTATE (TM-EXECUTE-SET-CLOCK ADDR TM))
                     (TM-RWSTATE TM))
              (AND (EQUAL (TM-CLOCK (TM-EXECUTE-SET-CLOCK ADDR TM))
                          (TM-CLOCK TM))
                   (AND (EQUAL (TM-IPORTS (TM-EXECUTE-SET-CLOCK ADDR TM))
                               (TM-IPORTS TM))
                        (AND (EQUAL (TM-OPORTS (TM-EXECUTE-SET-CLOCK ADDR TM))
                                    (TM-OPORTS TM))
                             (AND (EQUAL (TM-PC (TM-EXECUTE-SET-CLOCK ADDR TM))
                                         (TM-PC TM))
                                  (EQUAL (TM-SP (TM-EXECUTE-SET-CLOCK ADDR TM))
                                         (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-SET-CLOCK ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SET-CLOCK)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RUN
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-RUN TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-CC (TM-EXECUTE-RUN TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-RUN TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-RUN TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-RUN TM))
              (TM-SLIMIT TM))
       (AND
          (EQUAL (TM-SVMODE (TM-EXECUTE-RUN TM))
                 (TM-SVMODE TM))
          (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-RUN TM))
                      (TM-SVCFLAG TM))
               (AND (EQUAL (TM-SVCID (TM-EXECUTE-RUN TM))
                           (TM-SVCID TM))
                    (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-RUN TM))
                                (TM-RWSTATE TM))
                         (AND (EQUAL (TM-CLOCK (TM-EXECUTE-RUN TM))
                                     (TM-CLOCK TM))
                              (AND (EQUAL (TM-IPORTS (TM-EXECUTE-RUN TM))
                                          (TM-IPORTS TM))
                                   (AND (EQUAL (TM-OPORTS (TM-EXECUTE-RUN TM))
                                               (TM-OPORTS TM))
                                        (AND (EQUAL (TM-PC (TM-EXECUTE-RUN TM))
                                                    (TM-PC TM))
                                             (EQUAL (TM-SP (TM-EXECUTE-RUN TM))
                                                    (TM-SP TM))))))))))))))))
 ((ENABLE TM-EXECUTE-RUN ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RUN)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-WAIT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-WAIT TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-CC (TM-EXECUTE-WAIT TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-BASE (TM-EXECUTE-WAIT TM))
            (TM-BASE TM))
     (AND
      (EQUAL (TM-LIMIT (TM-EXECUTE-WAIT TM))
             (TM-LIMIT TM))
      (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-WAIT TM))
              (TM-SLIMIT TM))
       (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-WAIT TM))
                (TM-SVMODE TM))
         (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-WAIT TM))
                     (TM-SVCFLAG TM))
              (AND (EQUAL (TM-SVCID (TM-EXECUTE-WAIT TM))
                          (TM-SVCID TM))
                   (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-WAIT TM))
                               (TM-RWSTATE TM))
                        (AND (EQUAL (TM-CLOCK (TM-EXECUTE-WAIT TM))
                                    (TM-CLOCK TM))
                             (AND (EQUAL (TM-IPORTS (TM-EXECUTE-WAIT TM))
                                         (TM-IPORTS TM))
                                  (AND (EQUAL (TM-OPORTS (TM-EXECUTE-WAIT TM))
                                              (TM-OPORTS TM))
                                       (AND (EQUAL (TM-PC (TM-EXECUTE-WAIT TM))
                                                   (TM-PC TM))
                                            (EQUAL (TM-SP (TM-EXECUTE-WAIT TM))
                                                   (TM-SP TM))))))))))))))))
 ((ENABLE TM-EXECUTE-WAIT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-WAIT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-IPORT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-TEST-IPORT ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-TEST-IPORT ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-TEST-IPORT ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-TEST-IPORT ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-TEST-IPORT ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-TEST-IPORT ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-TEST-IPORT ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-TEST-IPORT ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-TEST-IPORT ADDR TM))
                  (TM-SVCID TM))
           (AND
             (EQUAL (TM-RWSTATE (TM-EXECUTE-TEST-IPORT ADDR TM))
                    (TM-RWSTATE TM))
             (AND (EQUAL (TM-CLOCK (TM-EXECUTE-TEST-IPORT ADDR TM))
                         (TM-CLOCK TM))
                  (AND (EQUAL (TM-IPORTS (TM-EXECUTE-TEST-IPORT ADDR TM))
                              (TM-IPORTS TM))
                       (AND (EQUAL (TM-OPORTS (TM-EXECUTE-TEST-IPORT ADDR TM))
                                   (TM-OPORTS TM))
                            (AND (EQUAL (TM-PC (TM-EXECUTE-TEST-IPORT ADDR TM))
                                        (TM-PC TM))
                                 (EQUAL (TM-SP (TM-EXECUTE-TEST-IPORT ADDR TM))
                                        (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-TEST-IPORT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-IPORT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-OPORT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-TEST-OPORT ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-TEST-OPORT ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-TEST-OPORT ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-TEST-OPORT ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-TEST-OPORT ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-TEST-OPORT ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-TEST-OPORT ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-TEST-OPORT ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-TEST-OPORT ADDR TM))
                  (TM-SVCID TM))
           (AND
             (EQUAL (TM-RWSTATE (TM-EXECUTE-TEST-OPORT ADDR TM))
                    (TM-RWSTATE TM))
             (AND (EQUAL (TM-CLOCK (TM-EXECUTE-TEST-OPORT ADDR TM))
                         (TM-CLOCK TM))
                  (AND (EQUAL (TM-IPORTS (TM-EXECUTE-TEST-OPORT ADDR TM))
                              (TM-IPORTS TM))
                       (AND (EQUAL (TM-OPORTS (TM-EXECUTE-TEST-OPORT ADDR TM))
                                   (TM-OPORTS TM))
                            (AND (EQUAL (TM-PC (TM-EXECUTE-TEST-OPORT ADDR TM))
                                        (TM-PC TM))
                                 (EQUAL (TM-SP (TM-EXECUTE-TEST-OPORT ADDR TM))
                                        (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-TEST-OPORT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-OPORT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-START-OUTPUT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                  (TM-SVCID TM))
           (AND
               (EQUAL (TM-RWSTATE (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                      (TM-RWSTATE TM))
               (AND (EQUAL (TM-CLOCK (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                           (TM-CLOCK TM))
                    (AND (EQUAL (TM-IPORTS (TM-EXECUTE-START-OUTPUT ADDR1
                                                                    ADDR2 TM))
                                (TM-IPORTS TM))
                         (AND (EQUAL (TM-OPORTS (TM-EXECUTE-START-OUTPUT ADDR1
                                                                         ADDR2
                                                                         TM))
                                     (TM-OPORTS TM))
                              (AND (EQUAL (TM-PC (TM-EXECUTE-START-OUTPUT ADDR1
                                                                          ADDR2
                                                                          TM))
                                          (TM-PC TM))
                                   (EQUAL (TM-SP (TM-EXECUTE-START-OUTPUT ADDR1
                                                                          ADDR2
                                                                          TM))
                                          (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-START-OUTPUT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-START-OUTPUT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-POST-OUTPUT-INTERRUPT
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                  (TM-SVCID TM))
           (AND
            (EQUAL (TM-RWSTATE (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                   (TM-RWSTATE TM))
            (AND
             (EQUAL (TM-CLOCK (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                    (TM-CLOCK TM))
             (AND
                 (EQUAL (TM-IPORTS (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                        (TM-IPORTS TM))
                 (AND (EQUAL (TM-OPORTS (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                          TM))
                             (TM-OPORTS TM))
                      (AND (EQUAL (TM-PC (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                           TM))
                                  (TM-PC TM))
                           (EQUAL (TM-SP (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                           TM))
                                  (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC
 (REWRITE)
 (AND
  (EQUAL (TM-MEMORY (TM-EXECUTE-SVC ADDR TM))
         (TM-MEMORY TM))
  (AND
   (EQUAL (TM-REGS (TM-EXECUTE-SVC ADDR TM))
          (TM-REGS TM))
   (AND
    (EQUAL (TM-CC (TM-EXECUTE-SVC ADDR TM))
           (TM-CC TM))
    (AND
     (EQUAL (TM-ERROR (TM-EXECUTE-SVC ADDR TM))
            (TM-ERROR TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-SVC ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-SVC ADDR TM))
              (TM-LIMIT TM))
       (AND
          (EQUAL (TM-SLIMIT (TM-EXECUTE-SVC ADDR TM))
                 (TM-SLIMIT TM))
          (AND (EQUAL (TM-SVMODE (TM-EXECUTE-SVC ADDR TM))
                      (TM-SVMODE TM))
               (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-SVC ADDR TM))
                           (TM-RWSTATE TM))
                    (AND (EQUAL (TM-CLOCK (TM-EXECUTE-SVC ADDR TM))
                                (TM-CLOCK TM))
                         (AND (EQUAL (TM-IPORTS (TM-EXECUTE-SVC ADDR TM))
                                     (TM-IPORTS TM))
                              (AND (EQUAL (TM-OPORTS (TM-EXECUTE-SVC ADDR TM))
                                          (TM-OPORTS TM))
                                   (AND (EQUAL (TM-PC (TM-EXECUTE-SVC ADDR TM))
                                               (TM-PC TM))
                                        (EQUAL (TM-SP (TM-EXECUTE-SVC ADDR TM))
                                               (TM-SP TM)))))))))))))))
 ((ENABLE TM-EXECUTE-SVC ACCESS-TM-SET-SVCID ACCESS-TM-SET-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC-RETURN
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-MEMORY (TM-EXECUTE-SVC-RETURN ADDR TM))
          (TM-MEMORY TM))
   (AND
    (EQUAL (TM-REGS (TM-EXECUTE-SVC-RETURN ADDR TM))
           (TM-REGS TM))
    (AND
     (EQUAL (TM-CC (TM-EXECUTE-SVC-RETURN ADDR TM))
            (TM-CC TM))
     (AND
      (EQUAL (TM-BASE (TM-EXECUTE-SVC-RETURN ADDR TM))
             (TM-BASE TM))
      (AND
       (EQUAL (TM-LIMIT (TM-EXECUTE-SVC-RETURN ADDR TM))
              (TM-LIMIT TM))
       (AND
        (EQUAL (TM-SLIMIT (TM-EXECUTE-SVC-RETURN ADDR TM))
               (TM-SLIMIT TM))
        (AND
         (EQUAL (TM-SVMODE (TM-EXECUTE-SVC-RETURN ADDR TM))
                (TM-SVMODE TM))
         (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-SVC-RETURN ADDR TM))
                 (TM-SVCFLAG TM))
          (AND
           (EQUAL (TM-SVCID (TM-EXECUTE-SVC-RETURN ADDR TM))
                  (TM-SVCID TM))
           (AND
             (EQUAL (TM-RWSTATE (TM-EXECUTE-SVC-RETURN ADDR TM))
                    (TM-RWSTATE TM))
             (AND (EQUAL (TM-CLOCK (TM-EXECUTE-SVC-RETURN ADDR TM))
                         (TM-CLOCK TM))
                  (AND (EQUAL (TM-IPORTS (TM-EXECUTE-SVC-RETURN ADDR TM))
                              (TM-IPORTS TM))
                       (AND (EQUAL (TM-OPORTS (TM-EXECUTE-SVC-RETURN ADDR TM))
                                   (TM-OPORTS TM))
                            (AND (EQUAL (TM-PC (TM-EXECUTE-SVC-RETURN ADDR TM))
                                        (TM-PC TM))
                                 (EQUAL (TM-SP (TM-EXECUTE-SVC-RETURN ADDR TM))
                                        (TM-SP TM)))))))))))))))))
 ((ENABLE TM-EXECUTE-SVC-RETURN ACCESS-TM-SET-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC-RETURN)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-NULLARY
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-NULLARY OPCODE TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-NULLARY OPCODE TM))
           (TM-LIMIT TM))
    (AND
     (EQUAL (TM-SLIMIT (TM-EXECUTE-NULLARY OPCODE TM))
            (TM-SLIMIT TM))
     (AND
      (EQUAL (TM-SVMODE (TM-EXECUTE-NULLARY OPCODE TM))
             (TM-SVMODE TM))
      (AND
          (EQUAL (TM-SVCFLAG (TM-EXECUTE-NULLARY OPCODE TM))
                 (TM-SVCFLAG TM))
          (AND (EQUAL (TM-SVCID (TM-EXECUTE-NULLARY OPCODE TM))
                      (TM-SVCID TM))
               (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-NULLARY OPCODE TM))
                           (TM-RWSTATE TM))
                    (AND (EQUAL (TM-CLOCK (TM-EXECUTE-NULLARY OPCODE TM))
                                (TM-CLOCK TM))
                         (AND (EQUAL (TM-IPORTS (TM-EXECUTE-NULLARY OPCODE TM))
                                     (TM-IPORTS TM))
                              (EQUAL (TM-OPORTS (TM-EXECUTE-NULLARY OPCODE TM))
                                     (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-NULLARY ACCESS-TM-SET-ERROR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RUN
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-WAIT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-RETURN)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-NULLARY)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-UNARY
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-UNARY OPCODE ADDR TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-UNARY OPCODE ADDR TM))
           (TM-LIMIT TM))
    (AND
       (EQUAL (TM-SLIMIT (TM-EXECUTE-UNARY OPCODE ADDR TM))
              (TM-SLIMIT TM))
       (AND (EQUAL (TM-SVMODE (TM-EXECUTE-UNARY OPCODE ADDR TM))
                   (TM-SVMODE TM))
            (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-UNARY OPCODE ADDR TM))
                        (TM-RWSTATE TM))
                 (AND (EQUAL (TM-CLOCK (TM-EXECUTE-UNARY OPCODE ADDR TM))
                             (TM-CLOCK TM))
                      (AND (EQUAL (TM-IPORTS (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                  (TM-IPORTS TM))
                           (EQUAL (TM-OPORTS (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                  (TM-OPORTS TM))))))))))
 ((ENABLE TM-EXECUTE-UNARY ACCESS-TM-SET-ERROR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-POST-OUTPUT-INTERRUPT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SVC-RETURN
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-SET-CLOCK
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-IPORT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-TEST-OPORT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-PSW
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-LIMIT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-LOAD-BASE
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-CALL
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-NOT-ZERO
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH-ON-ZERO
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BRANCH)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-UNARY)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BINARY
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
           (TM-LIMIT TM))
    (AND
      (EQUAL (TM-SLIMIT (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
             (TM-SLIMIT TM))
      (AND (EQUAL (TM-SVMODE (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
                  (TM-SVMODE TM))
           (AND (EQUAL (TM-SVCFLAG (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
                       (TM-SVCFLAG TM))
                (AND (EQUAL (TM-SVCID (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2
                                                         TM))
                            (TM-SVCID TM))
                     (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-BINARY OPCODE ADDR1
                                                                ADDR2 TM))
                                 (TM-RWSTATE TM))
                          (AND (EQUAL (TM-CLOCK (TM-EXECUTE-BINARY OPCODE
                                                                   ADDR1
                                                                   ADDR2 TM))
                                      (TM-CLOCK TM))
                               (AND (EQUAL (TM-IPORTS (TM-EXECUTE-BINARY OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                           (TM-IPORTS TM))
                                    (EQUAL (TM-OPORTS (TM-EXECUTE-BINARY OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                           (TM-OPORTS TM))))))))))))
 ((ENABLE TM-EXECUTE-BINARY ACCESS-TM-SET-ERROR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-START-OUTPUT
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-ADD
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-COMPARE
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-DECR-MOD
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INCR-MOD
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOD
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MOVE
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-MULTIPLY)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BINARY)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INSTRUCTION
 (REWRITE)
 (IMPLIES
  (NOT (TM-IN-SUPERVISOR-MODE TM))
  (AND
   (EQUAL (TM-BASE (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
          (TM-BASE TM))
   (AND
    (EQUAL (TM-LIMIT (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
           (TM-LIMIT TM))
    (AND
      (EQUAL (TM-SLIMIT (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
             (TM-SLIMIT TM))
      (AND (EQUAL (TM-SVMODE (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
                  (TM-SVMODE TM))
           (AND (EQUAL (TM-RWSTATE (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
                       (TM-RWSTATE TM))
                (AND (EQUAL (TM-CLOCK (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
                            (TM-CLOCK TM))
                     (AND (EQUAL (TM-IPORTS (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                    TM))
                                 (TM-IPORTS TM))
                          (EQUAL (TM-OPORTS (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                    TM))
                                 (TM-OPORTS TM))))))))))
 ((ENABLE TM-EXECUTE-INSTRUCTION ACCESS-TM-SET-ERROR
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-BINARY
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-UNARY
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE-NULLARY)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-EXECUTE
 (REWRITE)
 (IMPLIES
   (NOT (TM-IN-SUPERVISOR-MODE TM))
   (AND (EQUAL (TM-BASE (TM-EXECUTE OPCODE TM))
               (TM-BASE TM))
        (AND (EQUAL (TM-LIMIT (TM-EXECUTE OPCODE TM))
                    (TM-LIMIT TM))
             (AND (EQUAL (TM-SLIMIT (TM-EXECUTE OPCODE TM))
                         (TM-SLIMIT TM))
                  (AND (EQUAL (TM-SVMODE (TM-EXECUTE OPCODE TM))
                              (TM-SVMODE TM))
                       (AND (EQUAL (TM-RWSTATE (TM-EXECUTE OPCODE TM))
                                   (TM-RWSTATE TM))
                            (AND (EQUAL (TM-CLOCK (TM-EXECUTE OPCODE TM))
                                        (TM-CLOCK TM))
                                 (AND (EQUAL (TM-IPORTS (TM-EXECUTE OPCODE TM))
                                             (TM-IPORTS TM))
                                      (EQUAL (TM-OPORTS (TM-EXECUTE OPCODE TM))
                                             (TM-OPORTS TM))))))))))
 ((ENABLE TM-EXECUTE TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-PC
          ACCESS-TM-SET-ERROR REGISTERS-UNTOUCHED-BY-TM-EXECUTE-INSTRUCTION)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-EXECUTE)

(PROVE-LEMMA
 REGISTERS-UNTOUCHED-BY-TM-FETCH-EXECUTE
 (REWRITE)
 (IMPLIES
         (NOT (TM-IN-SUPERVISOR-MODE TM))
         (AND (EQUAL (TM-BASE (TM-FETCH-EXECUTE TM))
                     (TM-BASE TM))
              (AND (EQUAL (TM-LIMIT (TM-FETCH-EXECUTE TM))
                          (TM-LIMIT TM))
                   (AND (EQUAL (TM-SLIMIT (TM-FETCH-EXECUTE TM))
                               (TM-SLIMIT TM))
                        (AND (EQUAL (TM-SVMODE (TM-FETCH-EXECUTE TM))
                                    (TM-SVMODE TM))
                             (AND (EQUAL (TM-RWSTATE (TM-FETCH-EXECUTE TM))
                                         (TM-RWSTATE TM))
                                  (AND (EQUAL (TM-IPORTS (TM-FETCH-EXECUTE TM))
                                              (TM-IPORTS TM))
                                       (EQUAL (TM-OPORTS (TM-FETCH-EXECUTE TM))
                                              (TM-OPORTS TM)))))))))
 ((ENABLE TM-FETCH-EXECUTE TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-ERROR
          TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
          REGISTERS-UNTOUCHED-BY-TM-EXECUTE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REGISTERS-UNTOUCHED-BY-TM-FETCH-EXECUTE)

(PROVE-LEMMA TM-CLOCK-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (NOT (TM-CLOCK-INTERRUPTP TM)))
                      (EQUAL (TM-CLOCK (TM-FETCH-EXECUTE TM))
                             (SUB1 (TM-CLOCK TM))))
             ((ENABLE TM-FETCH-EXECUTE TM-DECREMENT-CLOCK TM-DECR
                      ACCESS-TM-SET-ERROR ACCESS-TM-SET-CLOCK
                      TM-IN-SUPERVISOR-MODE TM-CLOCK-INTERRUPTP
                      REGISTERS-UNTOUCHED-BY-TM-EXECUTE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-TM-FETCH-EXECUTE)

(DEFN BASE-LIMIT
      (BASE LIMIT)
      (CONS BASE (CONS LIMIT 'NIL))
      NIL)

(DEFN BASE
      (BASE-LIMIT)
      (CAR BASE-LIMIT)
      NIL)

(DEFN LIMIT
      (BASE-LIMIT)
      (CAR (CDR BASE-LIMIT))
      NIL)

(DEFN DISJOINT
      (B1 L1 B2 L2)
      (OR (IF (LESSP B2 (PLUS B1 L1))
              '*1*FALSE
              '*1*TRUE)
          (IF (LESSP B1 (PLUS B2 L2))
              '*1*FALSE
              '*1*TRUE))
      NIL)

(PROVE-LEMMA SYMMETRY-OF-DISJOINT
             (REWRITE)
             (EQUAL (DISJOINT B2 L2 B1 L1)
                    (DISJOINT B1 L1 B2 L2))
             ((ENABLE DISJOINT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SYMMETRY-OF-DISJOINT)

(DEFN DISJOINT-EVERYWHERE
      (B L TABLE)
      (IF (LISTP TABLE)
          (AND (DISJOINT B L
                         (BASE (CAR TABLE))
                         (LIMIT (CAR TABLE)))
               (DISJOINT-EVERYWHERE B L (CDR TABLE)))
          '*1*TRUE)
      NIL)

(DEFN MUTUALLY-DISJOINT
      (TABLE)
      (IF (LISTP TABLE)
          (AND (DISJOINT-EVERYWHERE (BASE (CAR TABLE))
                                    (LIMIT (CAR TABLE))
                                    (CDR TABLE))
               (MUTUALLY-DISJOINT (CDR TABLE)))
          '*1*TRUE)
      NIL)

(DEFN FINITE-SEGMENT-TABLEP
      (TABLE MAX)
      (IF (LISTP TABLE)
          (AND (IF (LESSP MAX
                          (PLUS (BASE (CAR TABLE))
                                (LIMIT (CAR TABLE))))
                   '*1*FALSE
                   '*1*TRUE)
               (FINITE-SEGMENT-TABLEP (CDR TABLE)
                                      MAX))
          '*1*TRUE)
      NIL)

(PROVE-LEMMA DISJOINT-GETNTH
             (REWRITE)
             (IMPLIES (AND (DISJOINT-EVERYWHERE B L TABLE)
                           (LESSP I (LENGTH TABLE)))
                      (DISJOINT B L
                                (BASE (GETNTH I TABLE))
                                (LIMIT (GETNTH I TABLE))))
             ((ENABLE DISJOINT-EVERYWHERE GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISJOINT-GETNTH)

(PROVE-LEMMA TM-GOOD-ADDRESS-TM-SET-CC
             (REWRITE)
             (EQUAL (TM-GOOD-ADDRESS ADDR
                                     (TM-SET-CC CC TM))
                    (TM-GOOD-ADDRESS ADDR TM))
             ((ENABLE TM-GOOD-ADDRESS ACCESS-TM-SET-CC TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-SET-CC)

(PROVE-LEMMA TM-GOOD-ADDRESS-TM-SET-PC
             (REWRITE)
             (EQUAL (TM-GOOD-ADDRESS ADDR
                                     (TM-SET-PC PC TM))
                    (TM-GOOD-ADDRESS ADDR TM))
             ((ENABLE TM-GOOD-ADDRESS ACCESS-TM-SET-PC TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-SET-PC)

(PROVE-LEMMA TM-GOOD-ADDRESS-TM-SET-SP
             (REWRITE)
             (EQUAL (TM-GOOD-ADDRESS ADDR
                                     (TM-SET-SP SP TM))
                    (TM-GOOD-ADDRESS ADDR TM))
             ((ENABLE TM-GOOD-ADDRESS ACCESS-TM-SET-SP TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-SET-SP)

(PROVE-LEMMA
      TM-STORE-IN-MEMORY-PROTECTION-THEOREM
      (REWRITE)
      (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                    (AND (DISJOINT B L
                                   (TM-BASE TM)
                                   (TM-LIMIT TM))
                         (FINITE-NUMBERP ADDR
                                         (MIN (DIFFERENCE '65536 (TM-BASE TM))
                                              (TM-LIMIT TM)))))
               (EQUAL (GETSEG B L
                              (TM-MEMORY (TM-STORE-IN-MEMORY VALUE ADDR TM)))
                      (GETSEG B L (TM-MEMORY TM))))
      ((ENABLE DISJOINT TM-STORE-IN-MEMORY TM-SET-MEMORY FINITE-NUMBERP
               TM-GOOD-ADDRESS GETSEG-BEFORE-PUTNTH GETSEG-AFTER-PUTNTH MIN)
       (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
       (USE (LESSP-TRANSITIVITY (A ADDR)
                                (B (DIFFERENCE '65536 (TM-BASE TM)))
                                (C (TM-LIMIT TM))))
       (DISABLE-THEORY T)))

(DISABLE TM-STORE-IN-MEMORY-PROTECTION-THEOREM)

(PROVE-LEMMA TM-STORE-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (AND (DISJOINT B L
                                          (TM-BASE TM)
                                          (TM-LIMIT TM))
                                (TM-GOOD-ADDRESS ADDR TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-STORE VALUE ADDR TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-STORE TM-STORE-IN-REGMEM TM-GOOD-ADDRESS TM-SET-REGS
                      TM-STORE-IN-MEMORY-PROTECTION-THEOREM)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-STORE-PROTECTION-THEOREM)

(PROVE-LEMMA
           TM-EXECUTE-ADD-PROTECTION-THEOREM
           (REWRITE)
           (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                         (AND (DISJOINT B L
                                        (TM-BASE TM)
                                        (TM-LIMIT TM))
                              (TM-GOOD-ADDRESS ADDR1 TM)))
                    (EQUAL (GETSEG B L
                                   (TM-MEMORY (TM-EXECUTE-ADD ADDR1 ADDR2 TM)))
                           (GETSEG B L (TM-MEMORY TM))))
           ((ENABLE TM-EXECUTE-ADD TM-STORE-PROTECTION-THEOREM
                    TM-GOOD-ADDRESS-TM-SET-CC
                    TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                    TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-ADD-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-BRANCH-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-BRANCH ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-BRANCH-ON-ZERO-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-ON-ZERO-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-BRANCH-NOT-ZERO-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-NOT-ZERO-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-CALL-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (AND (DISJOINT B L
                                          (TM-BASE TM)
                                          (TM-LIMIT TM))
                                (TM-GOOD-ADDRESS ADDR TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-EXECUTE-CALL ADDR TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-EXECUTE-CALL TM-STORE-PROTECTION-THEOREM
                      TM-GOOD-ADDRESS-TM-SET-PC TM-GOOD-ADDRESS-TM-SET-SP
                      ACCESS-TM-SET-PC ACCESS-TM-SET-SP ACCESS-TM-SET-ERROR
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-CALL-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-COMPARE-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-COMPARE ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-COMPARE-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-DECR-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (AND (DISJOINT B L
                                          (TM-BASE TM)
                                          (TM-LIMIT TM))
                                (TM-GOOD-ADDRESS ADDR TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-EXECUTE-DECR ADDR TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-EXECUTE-DECR TM-STORE-PROTECTION-THEOREM
                      TM-GOOD-ADDRESS-TM-SET-CC
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-DECR-PROTECTION-THEOREM)

(PROVE-LEMMA
      TM-EXECUTE-DECR-MOD-PROTECTION-THEOREM
      (REWRITE)
      (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                    (AND (DISJOINT B L
                                   (TM-BASE TM)
                                   (TM-LIMIT TM))
                         (TM-GOOD-ADDRESS ADDR1 TM)))
               (EQUAL (GETSEG B L
                              (TM-MEMORY (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM)))
                      (GETSEG B L (TM-MEMORY TM))))
      ((ENABLE TM-EXECUTE-DECR-MOD TM-STORE-PROTECTION-THEOREM
               TM-GOOD-ADDRESS-TM-SET-CC
               TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
               TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-DECR-MOD-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-INCR-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (AND (DISJOINT B L
                                          (TM-BASE TM)
                                          (TM-LIMIT TM))
                                (TM-GOOD-ADDRESS ADDR TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-EXECUTE-INCR ADDR TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-EXECUTE-INCR TM-STORE-PROTECTION-THEOREM
                      TM-GOOD-ADDRESS-TM-SET-CC
                      TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                      TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INCR-PROTECTION-THEOREM)

(PROVE-LEMMA
      TM-EXECUTE-INCR-MOD-PROTECTION-THEOREM
      (REWRITE)
      (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                    (AND (DISJOINT B L
                                   (TM-BASE TM)
                                   (TM-LIMIT TM))
                         (TM-GOOD-ADDRESS ADDR1 TM)))
               (EQUAL (GETSEG B L
                              (TM-MEMORY (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM)))
                      (GETSEG B L (TM-MEMORY TM))))
      ((ENABLE TM-EXECUTE-INCR-MOD TM-STORE-PROTECTION-THEOREM
               TM-GOOD-ADDRESS-TM-SET-CC
               TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
               TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INCR-MOD-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-LOAD-BASE-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-BASE ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-LOAD-BASE ACCESS-TM-SET-BASE
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-BASE-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-LOAD-LIMIT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-LOAD-LIMIT ACCESS-TM-SET-LIMIT
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-LIMIT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-LOAD-PSW-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-LOAD-PSW ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-LOAD-PSW ACCESS-TM-SET-PC ACCESS-TM-SET-SP
                      ACCESS-TM-SET-CC ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-ERROR ACCESS-TM-SET-SVCFLAG
                      ACCESS-TM-SET-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-PSW-PROTECTION-THEOREM)

(PROVE-LEMMA
           TM-EXECUTE-MOD-PROTECTION-THEOREM
           (REWRITE)
           (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                         (AND (DISJOINT B L
                                        (TM-BASE TM)
                                        (TM-LIMIT TM))
                              (TM-GOOD-ADDRESS ADDR1 TM)))
                    (EQUAL (GETSEG B L
                                   (TM-MEMORY (TM-EXECUTE-MOD ADDR1 ADDR2 TM)))
                           (GETSEG B L (TM-MEMORY TM))))
           ((ENABLE TM-EXECUTE-MOD TM-STORE-PROTECTION-THEOREM
                    TM-GOOD-ADDRESS-TM-SET-CC
                    TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
                    TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MOD-PROTECTION-THEOREM)

(PROVE-LEMMA
          TM-EXECUTE-MOVE-PROTECTION-THEOREM
          (REWRITE)
          (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                        (AND (DISJOINT B L
                                       (TM-BASE TM)
                                       (TM-LIMIT TM))
                             (TM-GOOD-ADDRESS ADDR1 TM)))
                   (EQUAL (GETSEG B L
                                  (TM-MEMORY (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)))
                          (GETSEG B L (TM-MEMORY TM))))
          ((ENABLE TM-EXECUTE-MOVE TM-STORE-PROTECTION-THEOREM)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MOVE-PROTECTION-THEOREM)

(PROVE-LEMMA
      TM-EXECUTE-MULTIPLY-PROTECTION-THEOREM
      (REWRITE)
      (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                    (AND (DISJOINT B L
                                   (TM-BASE TM)
                                   (TM-LIMIT TM))
                         (TM-GOOD-ADDRESS ADDR1 TM)))
               (EQUAL (GETSEG B L
                              (TM-MEMORY (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM)))
                      (GETSEG B L (TM-MEMORY TM))))
      ((ENABLE TM-EXECUTE-MULTIPLY TM-STORE-PROTECTION-THEOREM
               TM-GOOD-ADDRESS-TM-SET-CC
               TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS
               TM-IN-SUPERVISOR-MODE ACCESS-TM-SET-CC)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MULTIPLY-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-RETURN-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-RETURN TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-RETURN ACCESS-TM-SET-PC ACCESS-TM-SET-ERROR
                      ACCESS-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-RETURN-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-TEST-IPORT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-TEST-IPORT ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-TEST-IPORT ACCESS-TM-SET-ERROR
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-TEST-IPORT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-TEST-OPORT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-TEST-OPORT ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-TEST-OPORT ACCESS-TM-SET-ERROR
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-TEST-OPORT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-SET-CLOCK-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-SET-CLOCK ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-SET-CLOCK ACCESS-TM-SET-CLOCK
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SET-CLOCK-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-RUN-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-RUN TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-RUN ACCESS-TM-SET-RWSTATE ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-RUN-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-WAIT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-WAIT TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-WAIT ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-RWSTATE ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-WAIT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-START-OUTPUT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-START-OUTPUT ACCESS-TM-SET-OPORTS
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-START-OUTPUT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-POST-OUTPUT-INTERRUPT-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT ACCESS-TM-SET-OPORTS
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-SVC-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-SVC ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-SVC ACCESS-TM-SET-SVCFLAG ACCESS-TM-SET-SVCID
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SVC-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-SVC-RETURN-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-SVC-RETURN ADDR TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-SVC-RETURN ACCESS-TM-SET-PC ACCESS-TM-SET-SP
                      ACCESS-TM-SET-CC ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-ERROR ACCESS-TM-SET-SVCFLAG
                      ACCESS-TM-SET-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SVC-RETURN-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-NULLARY-PROTECTION-THEOREM
             (REWRITE)
             (EQUAL (TM-MEMORY (TM-EXECUTE-NULLARY OPCODE TM))
                    (TM-MEMORY TM))
             ((ENABLE TM-EXECUTE-NULLARY TM-EXECUTE-RUN-PROTECTION-THEOREM
                      TM-EXECUTE-WAIT-PROTECTION-THEOREM
                      TM-EXECUTE-RETURN-PROTECTION-THEOREM ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-NULLARY-PROTECTION-THEOREM)

(PROVE-LEMMA
         TM-EXECUTE-UNARY-PROTECTION-THEOREM
         (REWRITE)
         (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                       (DISJOINT B L
                                 (TM-BASE TM)
                                 (TM-LIMIT TM)))
                  (EQUAL (GETSEG B L
                                 (TM-MEMORY (TM-EXECUTE-UNARY OPCODE ADDR TM)))
                         (GETSEG B L (TM-MEMORY TM))))
         ((ENABLE TM-EXECUTE-UNARY ACCESS-TM-SET-ERROR
                  TM-EXECUTE-SVC-RETURN-PROTECTION-THEOREM
                  TM-EXECUTE-SVC-PROTECTION-THEOREM
                  TM-EXECUTE-POST-OUTPUT-INTERRUPT-PROTECTION-THEOREM
                  TM-EXECUTE-TEST-IPORT-PROTECTION-THEOREM
                  TM-EXECUTE-TEST-OPORT-PROTECTION-THEOREM
                  TM-EXECUTE-BRANCH-PROTECTION-THEOREM
                  TM-EXECUTE-BRANCH-ON-ZERO-PROTECTION-THEOREM
                  TM-EXECUTE-BRANCH-NOT-ZERO-PROTECTION-THEOREM
                  TM-EXECUTE-CALL-PROTECTION-THEOREM
                  TM-EXECUTE-DECR-PROTECTION-THEOREM
                  TM-EXECUTE-INCR-PROTECTION-THEOREM
                  TM-EXECUTE-LOAD-BASE-PROTECTION-THEOREM
                  TM-EXECUTE-LOAD-LIMIT-PROTECTION-THEOREM
                  TM-EXECUTE-LOAD-PSW-PROTECTION-THEOREM
                  TM-EXECUTE-SET-CLOCK-PROTECTION-THEOREM)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-BINARY-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (DISJOINT B L
                                     (TM-BASE TM)
                                     (TM-LIMIT TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-EXECUTE-BINARY OPCODE
                                                                   ADDR1
                                                                   ADDR2 TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-EXECUTE-BINARY
                      TM-EXECUTE-START-OUTPUT-PROTECTION-THEOREM
                      TM-EXECUTE-ADD-PROTECTION-THEOREM
                      TM-EXECUTE-COMPARE-PROTECTION-THEOREM
                      TM-EXECUTE-DECR-MOD-PROTECTION-THEOREM
                      TM-EXECUTE-INCR-MOD-PROTECTION-THEOREM
                      TM-EXECUTE-MOD-PROTECTION-THEOREM
                      TM-EXECUTE-MOVE-PROTECTION-THEOREM
                      TM-EXECUTE-MULTIPLY-PROTECTION-THEOREM
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY-PROTECTION-THEOREM)

(PROVE-LEMMA
         TM-EXECUTE-INSTRUCTION-PROTECTION-THEOREM
         (REWRITE)
         (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                       (DISJOINT B L
                                 (TM-BASE TM)
                                 (TM-LIMIT TM)))
                  (EQUAL (GETSEG B L
                                 (TM-MEMORY (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                    TM)))
                         (GETSEG B L (TM-MEMORY TM))))
         ((ENABLE TM-EXECUTE-INSTRUCTION ACCESS-TM-SET-ERROR
                  TM-EXECUTE-NULLARY-PROTECTION-THEOREM
                  TM-EXECUTE-UNARY-PROTECTION-THEOREM
                  TM-EXECUTE-BINARY-PROTECTION-THEOREM)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INSTRUCTION-PROTECTION-THEOREM)

(PROVE-LEMMA TM-EXECUTE-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (DISJOINT B L
                                     (TM-BASE TM)
                                     (TM-LIMIT TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-EXECUTE OPCODE TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-EXECUTE TM-EXECUTE-INSTRUCTION-PROTECTION-THEOREM
                      ACCESS-TM-SET-PC ACCESS-TM-SET-ERROR
                      TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-PROTECTION-THEOREM)

(PROVE-LEMMA TM-FETCH-EXECUTE-PROTECTION-THEOREM
             (REWRITE)
             (IMPLIES (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (DISJOINT B L
                                     (TM-BASE TM)
                                     (TM-LIMIT TM)))
                      (EQUAL (GETSEG B L
                                     (TM-MEMORY (TM-FETCH-EXECUTE TM)))
                             (GETSEG B L (TM-MEMORY TM))))
             ((ENABLE TM-FETCH-EXECUTE ACCESS-TM-SET-ERROR
                      TM-EXECUTE-PROTECTION-THEOREM
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
                      TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-STORE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-STORE VALUE ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-STORE TM-SET-MEMORY TM-SET-REGS TM-STORE-IN-REGMEM
                      TM-STORE-IN-MEMORY LENGTH-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-STORE)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-ADD
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-ADD ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-ADD LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-ADD)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-BRANCH ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-BRANCH ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-ON-ZERO
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-ON-ZERO)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-NOT-ZERO
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO ACCESS-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-NOT-ZERO)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-CALL
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-CALL ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-CALL LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-PC ACCESS-TM-SET-SP ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-CALL)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-COMPARE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-COMPARE ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-COMPARE)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-DECR
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-DECR ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-DECR LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-DECR)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-DECR-MOD
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-DECR-MOD LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-DECR-MOD)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-INCR
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-INCR ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-INCR LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-INCR)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-INCR-MOD
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-INCR-MOD LENGTH-TM-MEMORY-TM-STORE
                      ACCESS-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-INCR-MOD)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-BASE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-LOAD-BASE ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-LOAD-BASE ACCESS-TM-SET-BASE
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-BASE)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-LIMIT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-LOAD-LIMIT ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-LOAD-LIMIT ACCESS-TM-SET-LIMIT
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-LIMIT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-PSW
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-LOAD-PSW ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-LOAD-PSW ACCESS-TM-SET-SVCFLAG
                      ACCESS-TM-SET-SVCID ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-PC ACCESS-TM-SET-SP ACCESS-TM-SET-CC
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-PSW)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-MOD
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-MOD ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-MOD ACCESS-TM-SET-CC
                      LENGTH-TM-MEMORY-TM-STORE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-MOD)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-MOVE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-MOVE LENGTH-TM-MEMORY-TM-STORE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-MOVE)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-MULTIPLY
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-MULTIPLY ACCESS-TM-SET-CC
                      LENGTH-TM-MEMORY-TM-STORE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-MULTIPLY)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-RETURN
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-RETURN TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-RETURN ACCESS-TM-SET-ERROR ACCESS-TM-SET-PC
                      ACCESS-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-RETURN)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-TEST-IPORT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-TEST-IPORT ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-TEST-IPORT ACCESS-TM-SET-CC
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-TEST-IPORT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-TEST-OPORT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-TEST-OPORT ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-TEST-OPORT ACCESS-TM-SET-CC
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-TEST-OPORT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-SET-CLOCK
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-SET-CLOCK ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-SET-CLOCK ACCESS-TM-SET-CLOCK
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-SET-CLOCK)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-RUN
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-RUN TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-RUN ACCESS-TM-SET-RWSTATE ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-RUN)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-WAIT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-WAIT TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-WAIT ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-RWSTATE ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-WAIT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-POST-OUTPUT-INTERRUPT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                         TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT ACCESS-TM-SET-OPORTS
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-START-OUTPUT
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2
                                                                TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-START-OUTPUT ACCESS-TM-SET-OPORTS
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-START-OUTPUT)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-SVC
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-SVC ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-SVC ACCESS-TM-SET-SVCFLAG ACCESS-TM-SET-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-SVC)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-SVC-RETURN
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-SVC-RETURN ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-SVC-RETURN ACCESS-TM-SET-SVCFLAG
                      ACCESS-TM-SET-SVCID ACCESS-TM-SET-SVMODE
                      ACCESS-TM-SET-PC ACCESS-TM-SET-SP ACCESS-TM-SET-CC
                      ACCESS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-SVC-RETURN)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-NULLARY
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-NULLARY OPCODE TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-NULLARY ACCESS-TM-SET-ERROR
                      LENGTH-TM-MEMORY-TM-EXECUTE-RUN
                      LENGTH-TM-MEMORY-TM-EXECUTE-WAIT
                      LENGTH-TM-MEMORY-TM-EXECUTE-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-NULLARY)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-UNARY
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-UNARY OPCODE ADDR TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-UNARY ACCESS-TM-SET-ERROR
                      LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH
                      LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-ON-ZERO
                      LENGTH-TM-MEMORY-TM-EXECUTE-BRANCH-NOT-ZERO
                      LENGTH-TM-MEMORY-TM-EXECUTE-CALL
                      LENGTH-TM-MEMORY-TM-EXECUTE-DECR
                      LENGTH-TM-MEMORY-TM-EXECUTE-INCR
                      LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-BASE
                      LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-LIMIT
                      LENGTH-TM-MEMORY-TM-EXECUTE-LOAD-PSW
                      LENGTH-TM-MEMORY-TM-EXECUTE-SET-CLOCK
                      LENGTH-TM-MEMORY-TM-EXECUTE-TEST-IPORT
                      LENGTH-TM-MEMORY-TM-EXECUTE-TEST-OPORT
                      LENGTH-TM-MEMORY-TM-EXECUTE-POST-OUTPUT-INTERRUPT
                      LENGTH-TM-MEMORY-TM-EXECUTE-SVC
                      LENGTH-TM-MEMORY-TM-EXECUTE-SVC-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-UNARY)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-BINARY
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2
                                                          TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-BINARY ACCESS-TM-SET-ERROR
                      LENGTH-TM-MEMORY-TM-EXECUTE-ADD
                      LENGTH-TM-MEMORY-TM-EXECUTE-COMPARE
                      LENGTH-TM-MEMORY-TM-EXECUTE-DECR-MOD
                      LENGTH-TM-MEMORY-TM-EXECUTE-INCR-MOD
                      LENGTH-TM-MEMORY-TM-EXECUTE-MOD
                      LENGTH-TM-MEMORY-TM-EXECUTE-MOVE
                      LENGTH-TM-MEMORY-TM-EXECUTE-MULTIPLY
                      LENGTH-TM-MEMORY-TM-EXECUTE-START-OUTPUT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-BINARY)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE-INSTRUCTION
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                               TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE-INSTRUCTION ACCESS-TM-SET-ERROR
                      LENGTH-TM-MEMORY-TM-EXECUTE-BINARY
                      LENGTH-TM-MEMORY-TM-EXECUTE-UNARY
                      LENGTH-TM-MEMORY-TM-EXECUTE-NULLARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-EXECUTE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-EXECUTE INSTRUCTION TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-EXECUTE ACCESS-TM-SET-ERROR ACCESS-TM-SET-PC
                      LENGTH-TM-MEMORY-TM-EXECUTE-INSTRUCTION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-EXECUTE)

(PROVE-LEMMA LENGTH-TM-MEMORY-TM-FETCH-EXECUTE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (TM-FETCH-EXECUTE TM)))
                    (LENGTH (TM-MEMORY TM)))
             ((ENABLE TM-FETCH-EXECUTE ACCESS-TM-SET-ERROR
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
                      LENGTH-TM-MEMORY-TM-EXECUTE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-TM-FETCH-EXECUTE)

(DEFN
 GOOD-ADDRESS-SPACE
 (X MEMLENGTH)
 (AND
  (TM-SHELLP X)
  (AND
   (NUMBERP MEMLENGTH)
   (AND
    (IF (LESSP '65536 MEMLENGTH)
        '*1*FALSE
        '*1*TRUE)
    (AND
     (PLISTP (TM-MEMORY X))
     (AND
      (FINITE-NUMBER-LISTP (TM-MEMORY X)
                           '65536)
      (AND
       (EQUAL (LENGTH (TM-MEMORY X))
              MEMLENGTH)
       (AND
         (PLISTP (TM-REGS X))
         (AND (FINITE-NUMBER-LISTP (TM-REGS X)
                                   '65536)
              (AND (EQUAL (LENGTH (TM-REGS X)) '8)
                   (AND (FINITE-NUMBERP (TM-CC X) '4)
                        (AND (FINITE-NUMBERP (TM-ERROR X) '64)
                             (AND (FINITE-NUMBERP (TM-SVCFLAG X) '2)
                                  (AND (FINITE-NUMBERP (TM-SVCID X) '128)
                                       (AND (EQUAL (TM-BASE X) '0)
                                            (AND (EQUAL (TM-LIMIT X) MEMLENGTH)
                                                 (EQUAL (TM-SVMODE X)
                                                        '0))))))))))))))))
 NIL)

(PROVE-LEMMA TM-SHELLP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (TM-SHELLP ADDRESS-SPACE))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SHELLP-ADDRESS-SPACE)

(PROVE-LEMMA NON-NUMBER-MEMLENGTH-GIVES-BAD-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (NOT (NUMBERP MEMLENGTH))
                      (NOT (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NON-NUMBER-MEMLENGTH-GIVES-BAD-ADDRESS-SPACE)

(PROVE-LEMMA ADDRESS-SPACE-MEMLENGTH
             NIL
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (IF (LESSP '65536 MEMLENGTH)
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PLISTP-ADDRESS-SPACE-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (PLISTP (TM-MEMORY ADDRESS-SPACE)))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ADDRESS-SPACE-MEMORY)

(PROVE-LEMMA FINITE-NUMBER-LISTP-ADDRESS-SPACE-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBER-LISTP (TM-MEMORY ADDRESS-SPACE)
                                           '65536))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-ADDRESS-SPACE-MEMORY)

(PROVE-LEMMA LENGTH-ADDRESS-SPACE-MEMORY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (LENGTH (TM-MEMORY ADDRESS-SPACE))
                             MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ADDRESS-SPACE-MEMORY)

(PROVE-LEMMA PLISTP-ADDRESS-SPACE-REGS
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (PLISTP (TM-REGS ADDRESS-SPACE)))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-ADDRESS-SPACE-REGS)

(PROVE-LEMMA FINITE-NUMBER-LISTP-ADDRESS-SPACE-REGS
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBER-LISTP (TM-REGS ADDRESS-SPACE)
                                           '65536))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-ADDRESS-SPACE-REGS)

(PROVE-LEMMA LENGTH-ADDRESS-SPACE-REGS
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (LENGTH (TM-REGS ADDRESS-SPACE))
                             '8))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-ADDRESS-SPACE-REGS)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-CC
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-CC ADDRESS-SPACE)
                                      '4))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-CC)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-ERROR
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-ERROR ADDRESS-SPACE)
                                      '64))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-ERROR)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-SVCFLAG
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-SVCFLAG ADDRESS-SPACE)
                                      '2))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-SVCFLAG)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-SVCID
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-SVCID ADDRESS-SPACE)
                                      '128))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-SVCID)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-PC
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-PC ADDRESS-SPACE)
                                      '65536))
             ((ENABLE GOOD-ADDRESS-SPACE TM-PC FINITE-NUMBERP-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-PC)

(PROVE-LEMMA FINITE-NUMBERP-ADDRESS-SPACE-SP
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP (TM-SP ADDRESS-SPACE)
                                      '65536))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SP FINITE-NUMBERP-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADDRESS-SPACE-SP)

(PROVE-LEMMA TM-BASE-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (TM-BASE ADDRESS-SPACE) '0))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-ADDRESS-SPACE)

(PROVE-LEMMA TM-LIMIT-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (TM-LIMIT ADDRESS-SPACE)
                             MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-ADDRESS-SPACE)

(PROVE-LEMMA TM-SVMODE-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (TM-SVMODE ADDRESS-SPACE) '0))
             ((ENABLE GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SVMODE-ADDRESS-SPACE)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (TM-IN-SUPERVISOR-MODE ADDRESS-SPACE)
                             '*1*FALSE))
             ((ENABLE GOOD-ADDRESS-SPACE TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE)

(DEFTHEORY
 GOOD-ADDRESS-SPACE-PROPERTIES
 (TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                                   NON-NUMBER-MEMLENGTH-GIVES-BAD-ADDRESS-SPACE
                                   TM-SVMODE-ADDRESS-SPACE
                                   TM-LIMIT-ADDRESS-SPACE
                                   TM-BASE-ADDRESS-SPACE
                                   FINITE-NUMBERP-ADDRESS-SPACE-SVCID
                                   FINITE-NUMBERP-ADDRESS-SPACE-SVCFLAG
                                   FINITE-NUMBERP-ADDRESS-SPACE-ERROR
                                   FINITE-NUMBERP-ADDRESS-SPACE-CC
                                   LENGTH-ADDRESS-SPACE-REGS
                                   FINITE-NUMBER-LISTP-ADDRESS-SPACE-REGS
                                   PLISTP-ADDRESS-SPACE-REGS
                                   LENGTH-ADDRESS-SPACE-MEMORY
                                   FINITE-NUMBER-LISTP-ADDRESS-SPACE-MEMORY
                                   PLISTP-ADDRESS-SPACE-MEMORY
                                   ADDRESS-SPACE-MEMLENGTH
                                   TM-SHELLP-ADDRESS-SPACE
                                   FINITE-NUMBERP-ADDRESS-SPACE-PC
                                   FINITE-NUMBERP-ADDRESS-SPACE-SP))

(PROVE-LEMMA GOOD-ADDRESS-SPACE-BASE-LIMIT-PROPERTY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (MIN (DIFFERENCE '65536
                                              (TM-BASE ADDRESS-SPACE))
                                  (TM-LIMIT ADDRESS-SPACE))
                             (TM-LIMIT ADDRESS-SPACE)))
             ((ENABLE GOOD-ADDRESS-SPACE MIN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-BASE-LIMIT-PROPERTY)

(PROVE-LEMMA MIN-TM-MEMLENGTH-MEMLENGTH-IN-GOOD-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (MIN '65536 MEMLENGTH)
                             MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE MIN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MIN-TM-MEMLENGTH-MEMLENGTH-IN-GOOD-ADDRESS-SPACE)

(PROVE-LEMMA
  GOOD-MEMORY-ADDRESS-IMPLIES-NON-ZERO-LIMIT-FOR-ADDRESS-SPACE NIL
  (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                (TM-GOOD-ADDRESS (REAL-ADDR '2 PC)
                                 ADDRESS-SPACE))
           (NOT (ZEROP (TM-LIMIT ADDRESS-SPACE))))
  ((ENABLE TM-GOOD-ADDRESS GOOD-ADDRESS-SPACE-BASE-LIMIT-PROPERTY REAL-ADDR
           REAL-ADDR-SOURCE REAL-ADDR-NUM FINITE-NUMBERP)
   (USE (FINITE-NUMBERP-ADDRESS-SPACE-PC (ADDRESS-SPACE ADDRESS-SPACE)
                                         (MEMLENGTH MEMLENGTH))
        (TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE (ADDRESS-SPACE ADDRESS-SPACE)
                                                  (MEMLENGTH MEMLENGTH)))
   (ENABLE-THEORY GROUND-ZERO)
   (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-TM-GOOD-ADDRESS-FOR-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (TM-GOOD-ADDRESS (REAL-ADDR '2 N)
                                            ADDRESS-SPACE))
                      (FINITE-NUMBERP N MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-GOOD-ADDRESS REAL-ADDR
                      REAL-ADDR-SOURCE REAL-ADDR-NUM MIN TM-IN-SUPERVISOR-MODE
                      FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-GOOD-ADDRESS-FOR-ADDRESS-SPACE)

(PROVE-LEMMA
 FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
               (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
          (FINITE-NUMBERP (TM-FETCH ADDR ADDRESS-SPACE)
                          '65536))
 ((ENABLE TM-GOOD-ADDRESS TM-FETCH TM-FETCH-FROM-REGMEM
          MIN-TM-MEMLENGTH-MEMLENGTH-IN-GOOD-ADDRESS-SPACE
          GOOD-ADDRESS-SPACE-BASE-LIMIT-PROPERTY FINITE-NUMBERP-GETNTH
          FINITE-NUMBERP A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
          TM-FETCH-FROM-MEMORY)
  (USE
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                                   (N (REAL-ADDR-NUM ADDR))
                                   (I (MIN (DIFFERENCE '65536
                                                       (TM-BASE ADDRESS-SPACE))
                                           (TM-LIMIT ADDRESS-SPACE)))
                                   (J '65536))
   (FINITE-NUMBERP-MIN-DIFFERENCE-MEMLENGTH-BASE-LIMIT (TM ADDRESS-SPACE)))
  (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE)

(PROVE-LEMMA
 ADDRESS-SPACE-GOOD-MEMORY-TM-STORE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
       (FINITE-NUMBERP VALUE '65536))
  (AND
      (PLISTP (TM-MEMORY (TM-STORE VALUE ADDR ADDRESS-SPACE)))
      (AND (EQUAL (LENGTH (TM-MEMORY (TM-STORE VALUE ADDR ADDRESS-SPACE)))
                  (FIX MEMLENGTH))
           (FINITE-NUMBER-LISTP (TM-MEMORY (TM-STORE VALUE ADDR ADDRESS-SPACE))
                                '65536))))
 ((ENABLE TM-STORE TM-STORE-IN-REGMEM TM-STORE-IN-MEMORY TM-SET-MEMORY
          TM-SET-REGS PLISTP-PUTNTH LENGTH-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
  (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ADDRESS-SPACE-GOOD-MEMORY-TM-STORE)

(PROVE-LEMMA
 ADDRESS-SPACE-GOOD-REGS-TM-STORE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
        (FINITE-NUMBERP VALUE '65536))
   (AND (PLISTP (TM-REGS (TM-STORE VALUE ADDR ADDRESS-SPACE)))
        (AND (EQUAL (LENGTH (TM-REGS (TM-STORE VALUE ADDR ADDRESS-SPACE)))
                    '8)
             (FINITE-NUMBER-LISTP (TM-REGS (TM-STORE VALUE ADDR ADDRESS-SPACE))
                                  '65536))))
 ((ENABLE TM-STORE TM-STORE-IN-REGMEM TM-STORE-IN-MEMORY TM-SET-MEMORY
          TM-SET-REGS PLISTP-PUTNTH LENGTH-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
  (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE ADDRESS-SPACE-GOOD-REGS-TM-STORE)

(PROVE-LEMMA
        GOOD-ADDRESS-SPACE-TM-STORE
        (REWRITE)
        (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (FINITE-NUMBERP VALUE '65536))
                 (GOOD-ADDRESS-SPACE (TM-STORE VALUE ADDR ADDRESS-SPACE)
                                     MEMLENGTH))
        ((ENABLE GOOD-ADDRESS-SPACE)
         (USE (ADDRESS-SPACE-GOOD-REGS-TM-STORE (VALUE VALUE)
                                                (ADDR ADDR)
                                                (ADDRESS-SPACE ADDRESS-SPACE)
                                                (MEMLENGTH MEMLENGTH))
              (ADDRESS-SPACE-GOOD-MEMORY-TM-STORE (VALUE VALUE)
                                                  (ADDR ADDR)
                                                  (ADDRESS-SPACE ADDRESS-SPACE)
                                                  (MEMLENGTH MEMLENGTH))
              (TM-STORE-PRESERVES-ALL-BUT-MEMORY-AND-REGS (VALUE VALUE)
                                                          (ADDR ADDR)
                                                          (TM ADDRESS-SPACE)))
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-STORE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-SET-CC
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (FINITE-NUMBERP CC '4))
                      (GOOD-ADDRESS-SPACE (TM-SET-CC CC ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SET-CC)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-CC)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-SET-ERROR
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (FINITE-NUMBERP ERROR '64))
                      (GOOD-ADDRESS-SPACE (TM-SET-ERROR ERROR ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SET-ERROR)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-ERROR)

(PROVE-LEMMA
            GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG
            (REWRITE)
            (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                          (FINITE-NUMBERP SVCFLAG '2))
                     (GOOD-ADDRESS-SPACE (TM-SET-SVCFLAG SVCFLAG ADDRESS-SPACE)
                                         MEMLENGTH))
            ((ENABLE GOOD-ADDRESS-SPACE TM-SET-SVCFLAG)
             (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-SET-SVCID
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (FINITE-NUMBERP SVCID '128))
                      (GOOD-ADDRESS-SPACE (TM-SET-SVCID SVCID ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SET-SVCID)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-SVCID)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-SET-PC
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (FINITE-NUMBERP PC '65536))
                      (GOOD-ADDRESS-SPACE (TM-SET-PC PC ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SET-PC TM-SET-REGS LENGTH-PUTNTH
                      PLISTP-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-PC)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-SET-SP
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (FINITE-NUMBERP SP '65536))
                      (GOOD-ADDRESS-SPACE (TM-SET-SP SP ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE TM-SET-SP TM-SET-REGS LENGTH-PUTNTH
                      PLISTP-PUTNTH FINITE-NUMBER-LISTP-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-SET-SP)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-ADD
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-ADD ADDR1 ADDR2
                                                          ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-ADD GOOD-ADDRESS-SPACE-TM-SET-CC
                      GOOD-ADDRESS-SPACE-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-ADD)

(PROVE-LEMMA
            GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH
            (REWRITE)
            (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                          (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
                     (GOOD-ADDRESS-SPACE (TM-EXECUTE-BRANCH ADDR ADDRESS-SPACE)
                                         MEMLENGTH))
            ((ENABLE TM-EXECUTE-BRANCH
                     FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                     GOOD-ADDRESS-SPACE-TM-SET-PC)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH)

(PROVE-LEMMA
         GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-ON-ZERO
         (REWRITE)
         (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                       (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
                  (GOOD-ADDRESS-SPACE (TM-EXECUTE-BRANCH-ON-ZERO ADDR
                                                                 ADDRESS-SPACE)
                                      MEMLENGTH))
         ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO
                  FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                  GOOD-ADDRESS-SPACE-TM-SET-PC)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-ON-ZERO)

(PROVE-LEMMA
        GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-NOT-ZERO
        (REWRITE)
        (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
                 (GOOD-ADDRESS-SPACE (TM-EXECUTE-BRANCH-NOT-ZERO ADDR
                                                                 ADDRESS-SPACE)
                                     MEMLENGTH))
        ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO
                 FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                 GOOD-ADDRESS-SPACE-TM-SET-PC)
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-NOT-ZERO)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-CALL
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-CALL ADDR ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-CALL FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                      FINITE-NUMBERP-TM-DECR FINITE-NUMBERP-ADDRESS-SPACE-SP
                      FINITE-NUMBERP-ADDRESS-SPACE-PC
                      GOOD-ADDRESS-SPACE-TM-STORE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR
                      GOOD-ADDRESS-SPACE-TM-SET-PC
                      GOOD-ADDRESS-SPACE-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-CALL)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-COMPARE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-COMPARE ADDR1 ADDR2
                                                              ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-COMPARE GOOD-ADDRESS-SPACE-TM-SET-CC
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-COMPARE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-DECR ADDR ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-DECR GOOD-ADDRESS-SPACE-TM-STORE
                      GOOD-ADDRESS-SPACE-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR-MOD
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-DECR-MOD ADDR1 ADDR2
                                                               ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-DECR-MOD GOOD-ADDRESS-SPACE-TM-STORE
                      GOOD-ADDRESS-SPACE-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR-MOD)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-INCR ADDR ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-INCR GOOD-ADDRESS-SPACE-TM-STORE
                      GOOD-ADDRESS-SPACE-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR-MOD
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-INCR-MOD ADDR1 ADDR2
                                                               ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-INCR-MOD GOOD-ADDRESS-SPACE-TM-STORE
                      GOOD-ADDRESS-SPACE-TM-SET-CC
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR-MOD)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-BASE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-LOAD-BASE ADDR
                                                                ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-LOAD-BASE FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-BASE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-LIMIT
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-LOAD-LIMIT ADDR
                                                                 ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-LOAD-LIMIT FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-LIMIT)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-PSW
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-LOAD-PSW ADDR
                                                               ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-LOAD-PSW FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-PSW)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-MOD
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-MOD ADDR1 ADDR2
                                                          ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-MOD GOOD-ADDRESS-SPACE-TM-SET-CC
                      GOOD-ADDRESS-SPACE-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-MOD)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-MOVE
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (TM-GOOD-ADDRESS ADDR2 ADDRESS-SPACE))
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-MOVE ADDR1 ADDR2
                                                           ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-MOVE GOOD-ADDRESS-SPACE-TM-STORE
                      FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-MOVE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-MULTIPLY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-MULTIPLY ADDR1 ADDR2
                                                               ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-MULTIPLY GOOD-ADDRESS-SPACE-TM-SET-CC
                      GOOD-ADDRESS-SPACE-TM-STORE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-MULTIPLY)

(PROVE-LEMMA FINITE-NUMBERP-ADD1-ADDRESS-SPACE-SP
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (NOT (TM-STACK-UNDERFLOWP ADDRESS-SPACE)))
                      (FINITE-NUMBERP (ADD1 (TM-SP ADDRESS-SPACE))
                                      '65536))
             ((ENABLE TM-STACK-UNDERFLOWP FINITE-NUMBERP MIN
                      GOOD-ADDRESS-SPACE TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-ADD1-ADDRESS-SPACE-SP)

(PROVE-LEMMA MIN-MEMLENGTH-TM-MEMLENGTH-IN-GOOD-ADDRESS-SPACE
             NIL
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (EQUAL (MIN '65536 MEMLENGTH)
                             MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE MIN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBERP-TM-INCR-MEMLENGTH
             (REWRITE)
             (IMPLIES (AND (NUMBERP MEMLENGTH)
                           (AND (EQUAL (MIN '65536 MEMLENGTH)
                                       MEMLENGTH)
                                (LESSP B (SUB1 MEMLENGTH))))
                      (FINITE-NUMBERP (TM-INCR B)
                                      MEMLENGTH))
             ((ENABLE MIN TM-INCR FINITE-NUMBERP LESSP-REMAINDER2
                      REMAINDER-NOOP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-TM-INCR-MEMLENGTH)

(PROVE-LEMMA
 TM-GOOD-ADDRESS-TM-INCR-TM-SP-FOR-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
               (NOT (TM-STACK-UNDERFLOWP ADDRESS-SPACE)))
          (TM-GOOD-ADDRESS (REAL-ADDR '2
                                      (TM-INCR (TM-SP ADDRESS-SPACE)))
                           ADDRESS-SPACE))
 ((ENABLE TM-STACK-UNDERFLOWP TM-GOOD-ADDRESS FINITE-NUMBERP-TM-INCR
          FINITE-NUMBERP-TM-INCR-MEMLENGTH REAL-ADDR REAL-ADDR-SOURCE
          REAL-ADDR-NUM)
  (USE
   (A-FINITE-NUMBER-IS-A-NUMBER (N (TM-SP ADDRESS-SPACE))
                                (LUB '65536))
   (MIN-MEMLENGTH-TM-MEMLENGTH-IN-GOOD-ADDRESS-SPACE
                                                  (ADDRESS-SPACE ADDRESS-SPACE)
                                                  (MEMLENGTH MEMLENGTH)))
  (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-TM-INCR-TM-SP-FOR-ADDRESS-SPACE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-RETURN
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-RETURN ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-RETURN FINITE-NUMBERP
                      TM-GOOD-ADDRESS-TM-INCR-TM-SP-FOR-ADDRESS-SPACE
                      FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                      TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS
                      FINITE-NUMBERP-ADD1-ADDRESS-SPACE-SP
                      FINITE-NUMBERP-TM-INCR GOOD-ADDRESS-SPACE-TM-SET-ERROR
                      GOOD-ADDRESS-SPACE-TM-SET-PC
                      GOOD-ADDRESS-SPACE-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-RETURN)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-SET-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-SET-CLOCK ADDR
                                                                ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-SET-CLOCK FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-SET-CLOCK)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-RUN
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-RUN ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-RUN FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-RUN)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-WAIT
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-WAIT ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-WAIT FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-WAIT)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-IPORT
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-TEST-IPORT ADDR
                                                                 ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-TEST-IPORT FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-IPORT)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-OPORT
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-TEST-OPORT ADDR
                                                                 ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-TEST-OPORT FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-OPORT)

(PROVE-LEMMA
           GOOD-ADDRESS-SPACE-TM-EXECUTE-START-OUTPUT
           (REWRITE)
           (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                    (GOOD-ADDRESS-SPACE (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2
                                                                 ADDRESS-SPACE)
                                        MEMLENGTH))
           ((ENABLE TM-EXECUTE-START-OUTPUT FINITE-NUMBERP
                    TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                    GOOD-ADDRESS-SPACE-TM-SET-ERROR)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-START-OUTPUT)

(PROVE-LEMMA
  GOOD-ADDRESS-SPACE-TM-EXECUTE-POST-OUTPUT-INTERRUPT
  (REWRITE)
  (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
           (GOOD-ADDRESS-SPACE (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                 ADDRESS-SPACE)
                               MEMLENGTH))
  ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT FINITE-NUMBERP
           TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
           GOOD-ADDRESS-SPACE-TM-SET-ERROR)
   (ENABLE-THEORY GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                           (TM-GOOD-ADDRESS ADDR ADDRESS-SPACE))
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-SVC ADDR ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-SVC FINITE-NUMBERP
                      FINITE-NUMBERP-TM-FETCH-FROM-ADDRESS-SPACE
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      FINITE-NUMBERP-REMAINDER
                      GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG
                      GOOD-ADDRESS-SPACE-TM-SET-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC-RETURN
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-SVC-RETURN ADDR
                                                                 ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-SVC-RETURN FINITE-NUMBERP
                      TM-IN-SUPERVISOR-MODE-GOOD-ADDRESS-SPACE
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC-RETURN)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-NULLARY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-NULLARY OPCODE
                                                              ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-NULLARY FINITE-NUMBERP
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-RUN
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-WAIT
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-NULLARY)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-UNARY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-UNARY OPCODE ADDR
                                                            ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-UNARY FINITE-NUMBERP
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-ON-ZERO
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-BRANCH-NOT-ZERO
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-CALL
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-BASE
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-LIMIT
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-LOAD-PSW
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-SET-CLOCK
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-POST-OUTPUT-INTERRUPT
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-IPORT
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-TEST-OPORT
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-SVC-RETURN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-UNARY)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-EXECUTE-BINARY
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-EXECUTE-BINARY OPCODE ADDR1
                                                             ADDR2
                                                             ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-EXECUTE-BINARY FINITE-NUMBERP
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-ADD
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-COMPARE
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-DECR-MOD
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-INCR-MOD
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-MOD
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-MOVE
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-MULTIPLY
                      GOOD-ADDRESS-SPACE-TM-EXECUTE-START-OUTPUT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-BINARY)

(PROVE-LEMMA
            GOOD-ADDRESS-SPACE-TM-EXECUTE-INSTRUCTION
            (REWRITE)
            (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                     (GOOD-ADDRESS-SPACE (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                 ADDRESS-SPACE)
                                         MEMLENGTH))
            ((ENABLE TM-EXECUTE-INSTRUCTION FINITE-NUMBERP
                     GOOD-ADDRESS-SPACE-TM-SET-ERROR
                     GOOD-ADDRESS-SPACE-TM-EXECUTE-BINARY
                     GOOD-ADDRESS-SPACE-TM-EXECUTE-UNARY
                     GOOD-ADDRESS-SPACE-TM-EXECUTE-NULLARY)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA
            GOOD-ADDRESS-SPACE-TM-EXECUTE
            (REWRITE)
            (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                     (GOOD-ADDRESS-SPACE (TM-EXECUTE INSTRUCTION ADDRESS-SPACE)
                                         MEMLENGTH))
            ((ENABLE TM-EXECUTE FINITE-NUMBERP FINITE-NUMBERP-TM-INCRN
                     FINITE-NUMBERP-ADDRESS-SPACE-PC
                     GOOD-ADDRESS-SPACE-TM-SET-ERROR
                     GOOD-ADDRESS-SPACE-TM-SET-PC
                     GOOD-ADDRESS-SPACE-TM-EXECUTE-INSTRUCTION)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-EXECUTE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-DECREMENT-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-DECREMENT-CLOCK ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-DECREMENT-CLOCK TM-SET-CLOCK TM-IN-SUPERVISOR-MODE
                      GOOD-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-DECREMENT-CLOCK)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE ADDRESS-SPACE MEMLENGTH)
                      (GOOD-ADDRESS-SPACE (TM-FETCH-EXECUTE ADDRESS-SPACE)
                                          MEMLENGTH))
             ((ENABLE TM-FETCH-EXECUTE FINITE-NUMBERP
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
                      TM-GOOD-ADDRESS-TM-DECREMENT-CLOCK
                      GOOD-ADDRESS-SPACE-TM-EXECUTE
                      GOOD-ADDRESS-SPACE-TM-DECREMENT-CLOCK
                      GOOD-ADDRESS-SPACE-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-TM-FETCH-EXECUTE)

(DEFN MAPUP-ADDRESS-SPACE
      (MEMORY REGS CC ERROR SVCFLAG SVCID BASE LIMIT)
      (TM (GETSEG BASE LIMIT MEMORY)
          REGS CC ERROR SVCFLAG SVCID '0
          (FIX LIMIT)
          '0
          '0
          '0
          '0
          '0
          '0)
      NIL)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND
     (FINITE-NUMBER-LISTP MEMORY '65536)
     (AND (NUMBERP LIMIT)
          (AND (IF (LESSP '65536 (LENGTH MEMORY))
                   '*1*FALSE
                   '*1*TRUE)
               (AND (PLISTP REGS)
                    (AND (FINITE-NUMBER-LISTP REGS '65536)
                         (AND (EQUAL (LENGTH REGS) '8)
                              (AND (FINITE-NUMBERP CC '4)
                                   (AND (FINITE-NUMBERP ERROR '64)
                                        (AND (FINITE-NUMBERP SVCFLAG '2)
                                             (AND (FINITE-NUMBERP SVCID '128)
                                                  (IF (LESSP (LENGTH MEMORY)
                                                             (PLUS BASE LIMIT))
                                                      '*1*FALSE
                                                      '*1*TRUE)))))))))))
  (GOOD-ADDRESS-SPACE (MAPUP-ADDRESS-SPACE MEMORY REGS CC ERROR SVCFLAG SVCID
                                           BASE LIMIT)
                      LIMIT))
 ((ENABLE GOOD-ADDRESS-SPACE MAPUP-ADDRESS-SPACE PLISTP-GETSEG LENGTH-GETSEG
          FINITE-NUMBER-LISTP-GETSEG)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
     TM-FETCH-FROM-MEMORY-MAPUP-ADDRESS-SPACE
     (REWRITE)
     (IMPLIES (AND (GOOD-TM TM)
                   (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                        (LESSP ADDR (TM-LIMIT TM))))
              (EQUAL (TM-FETCH-FROM-MEMORY ADDR
                                           (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                     (TM-FETCH-FROM-MEMORY ADDR TM)))
     ((ENABLE TM-FETCH-FROM-MEMORY MAPUP-ADDRESS-SPACE GETNTH-GETSEG-INVERSE
              GETNTH-WITH-NON-NUMBER-INDEX)
      (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE TM-FETCH-FROM-MEMORY-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
     TM-FETCH-FROM-REGMEM-MAPUP-ADDRESS-SPACE
     (REWRITE)
     (IMPLIES (GOOD-TM TM)
              (EQUAL (TM-FETCH-FROM-REGMEM ADDR
                                           (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                     (TM-FETCH-FROM-REGMEM ADDR TM)))
     ((ENABLE TM-FETCH-FROM-REGMEM MAPUP-ADDRESS-SPACE)
      (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE TM-FETCH-FROM-REGMEM-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
         LESSP-GOOD-MEMORY-ADDRESS-LIMIT NIL
         (IMPLIES (AND (GOOD-TM TM)
                       (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                            (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                                 (AND (NOT (EQUAL (REAL-ADDR-SOURCE ADDR) '1))
                                      (TM-GOOD-ADDRESS ADDR TM)))))
                  (LESSP (REAL-ADDR-NUM ADDR)
                         (TM-LIMIT TM)))
         ((ENABLE TM-GOOD-ADDRESS MIN FINITE-NUMBERP)
          (USE (LESSP-TRANSITIVITY (A (REAL-ADDR-NUM ADDR))
                                   (B (DIFFERENCE '65536 (TM-BASE TM)))
                                   (C (TM-LIMIT TM))))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(PROVE-LEMMA TM-FETCH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                                (TM-GOOD-ADDRESS ADDR TM)))
                      (EQUAL (TM-FETCH ADDR
                                       (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                            (TM-REGS TM)
                                                            (TM-CC TM)
                                                            (TM-ERROR TM)
                                                            (TM-SVCFLAG TM)
                                                            (TM-SVCID TM)
                                                            (TM-BASE TM)
                                                            (TM-LIMIT TM)))
                             (TM-FETCH ADDR TM)))
             ((ENABLE TM-FETCH A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                      TM-FETCH-FROM-MEMORY-MAPUP-ADDRESS-SPACE
                      TM-FETCH-FROM-REGMEM-MAPUP-ADDRESS-SPACE TM-GOOD-ADDRESS)
              (USE (LESSP-GOOD-MEMORY-ADDRESS-LIMIT (TM TM)
                                                    (ADDR ADDR)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-FETCH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-STORE-IN-MEMORY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (LESSP ADDR (TM-LIMIT TM)))))
   (EQUAL (TM-STORE-IN-MEMORY VALUE ADDR
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-REGS (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-CC (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-ERROR (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-SVCFLAG (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-SVCID (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-BASE (TM-STORE-IN-MEMORY VALUE ADDR TM))
                               (TM-LIMIT (TM-STORE-IN-MEMORY VALUE ADDR TM)))))
 ((ENABLE MAPUP-ADDRESS-SPACE DIFFERENCE-PLUS1 TM-IN-SUPERVISOR-MODE
          GETSEG-PUTNTH-COINCIDENCE TM-STORE-IN-MEMORY TM-SET-MEMORY)
  (ENABLE-THEORY GOOD-TM-PROPERTIES TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-STORE-IN-MEMORY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-STORE-IN-REGMEM-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (GOOD-TM TM)
   (EQUAL (TM-STORE-IN-REGMEM VALUE ADDR
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-REGS (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-CC (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-ERROR (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-SVCFLAG (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-SVCID (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-BASE (TM-STORE-IN-REGMEM VALUE ADDR TM))
                               (TM-LIMIT (TM-STORE-IN-REGMEM VALUE ADDR TM)))))
 ((ENABLE MAPUP-ADDRESS-SPACE TM-STORE-IN-REGMEM TM-SET-REGS)
  (ENABLE-THEORY GOOD-TM-PROPERTIES TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-STORE-IN-REGMEM-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (IF (LESSP '65536
                                  (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                           '*1*FALSE
                           '*1*TRUE)
                       (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                            (TM-GOOD-ADDRESS ADDR TM))))
             (EQUAL (TM-STORE VALUE ADDR
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-STORE VALUE ADDR TM))
                                         (TM-REGS (TM-STORE VALUE ADDR TM))
                                         (TM-CC (TM-STORE VALUE ADDR TM))
                                         (TM-ERROR (TM-STORE VALUE ADDR TM))
                                         (TM-SVCFLAG (TM-STORE VALUE ADDR TM))
                                         (TM-SVCID (TM-STORE VALUE ADDR TM))
                                         (TM-BASE (TM-STORE VALUE ADDR TM))
                                         (TM-LIMIT (TM-STORE VALUE ADDR TM)))))
    ((ENABLE TM-GOOD-ADDRESS TM-STORE
             TM-STORE-IN-MEMORY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-STORE-IN-REGMEM-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (USE (LESSP-GOOD-MEMORY-ADDRESS-LIMIT (TM TM)
                                           (ADDR ADDR)))
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-SET-PC PC
                               (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                    (TM-REGS TM)
                                                    (TM-CC TM)
                                                    (TM-ERROR TM)
                                                    (TM-SVCFLAG TM)
                                                    (TM-SVCID TM)
                                                    (TM-BASE TM)
                                                    (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-PC PC TM))
                                         (TM-REGS (TM-SET-PC PC TM))
                                         (TM-CC (TM-SET-PC PC TM))
                                         (TM-ERROR (TM-SET-PC PC TM))
                                         (TM-SVCFLAG (TM-SET-PC PC TM))
                                         (TM-SVCID (TM-SET-PC PC TM))
                                         (TM-BASE (TM-SET-PC PC TM))
                                         (TM-LIMIT (TM-SET-PC PC TM))))
             ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-PC TM-SET-REGS)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SET-SP-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-SET-SP SP
                               (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                    (TM-REGS TM)
                                                    (TM-CC TM)
                                                    (TM-ERROR TM)
                                                    (TM-SVCFLAG TM)
                                                    (TM-SVCID TM)
                                                    (TM-BASE TM)
                                                    (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-SP SP TM))
                                         (TM-REGS (TM-SET-SP SP TM))
                                         (TM-CC (TM-SET-SP SP TM))
                                         (TM-ERROR (TM-SET-SP SP TM))
                                         (TM-SVCFLAG (TM-SET-SP SP TM))
                                         (TM-SVCID (TM-SET-SP SP TM))
                                         (TM-BASE (TM-SET-SP SP TM))
                                         (TM-LIMIT (TM-SET-SP SP TM))))
             ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-SP TM-SET-REGS)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-SP-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-SET-CC CC
                               (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                    (TM-REGS TM)
                                                    (TM-CC TM)
                                                    (TM-ERROR TM)
                                                    (TM-SVCFLAG TM)
                                                    (TM-SVCID TM)
                                                    (TM-BASE TM)
                                                    (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-CC CC TM))
                                         (TM-REGS (TM-SET-CC CC TM))
                                         (TM-CC (TM-SET-CC CC TM))
                                         (TM-ERROR (TM-SET-CC CC TM))
                                         (TM-SVCFLAG (TM-SET-CC CC TM))
                                         (TM-SVCID (TM-SET-CC CC TM))
                                         (TM-BASE (TM-SET-CC CC TM))
                                         (TM-LIMIT (TM-SET-CC CC TM))))
             ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-CC TM-ERROR)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-SET-ERROR ERROR
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-ERROR ERROR TM))
                                         (TM-REGS (TM-SET-ERROR ERROR TM))
                                         (TM-CC (TM-SET-ERROR ERROR TM))
                                         (TM-ERROR (TM-SET-ERROR ERROR TM))
                                         (TM-SVCFLAG (TM-SET-ERROR ERROR TM))
                                         (TM-SVCID (TM-SET-ERROR ERROR TM))
                                         (TM-BASE (TM-SET-ERROR ERROR TM))
                                         (TM-LIMIT (TM-SET-ERROR ERROR TM))))
             ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-ERROR TM-CC)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
           TM-SET-SVCFLAG-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
           (REWRITE)
           (EQUAL (TM-SET-SVCFLAG SVCFLAG
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
                  (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-REGS (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-CC (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-ERROR (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-SVCFLAG (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-SVCID (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-BASE (TM-SET-SVCFLAG SVCFLAG TM))
                                       (TM-LIMIT (TM-SET-SVCFLAG SVCFLAG TM))))
           ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-SVCFLAG TM-CC)
            (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TM-SET-SVCFLAG-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SET-SVCID-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-SET-SVCID SVCID
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-SET-SVCID SVCID TM))
                                         (TM-REGS (TM-SET-SVCID SVCID TM))
                                         (TM-CC (TM-SET-SVCID SVCID TM))
                                         (TM-ERROR (TM-SET-SVCID SVCID TM))
                                         (TM-SVCFLAG (TM-SET-SVCID SVCID TM))
                                         (TM-SVCID (TM-SET-SVCID SVCID TM))
                                         (TM-BASE (TM-SET-SVCID SVCID TM))
                                         (TM-LIMIT (TM-SET-SVCID SVCID TM))))
             ((ENABLE MAPUP-ADDRESS-SPACE TM-SET-SVCID TM-CC)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-SVCID-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-SET-CC
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-SET-CC CC TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-SET-CC TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-SET-CC)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-SET-SVCFLAG
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-SET-SVCFLAG SVCFLAG TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-SET-SVCFLAG TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-SET-SVCFLAG)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-SET-SVCID
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-SET-SVCID SVCID TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-SET-SVCID TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-SET-SVCID)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-SET-SP
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-SET-SP SP TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-SET-SP TM-SET-REGS TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-SET-SP)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-SET-PC
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-SET-PC PC TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-SET-PC TM-SET-REGS TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-SET-PC)

(PROVE-LEMMA TM-LIMIT-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-LIMIT (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
                    (FIX (TM-LIMIT TM)))
             ((ENABLE MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-BASE-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-BASE (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
                    '0)
             ((ENABLE MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
             (REWRITE)
             (EQUAL (PLUS (TM-BASE (TM-SET-CC CC TM))
                          (TM-LIMIT (TM-SET-CC CC TM)))
                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
             ((ENABLE TM-SET-CC)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TM-BASE-TM-LIMIT-TM-SET-CC)

(PROVE-LEMMA PLUS-TM-BASE-TM-LIMIT-TM-SET-SP
             (REWRITE)
             (EQUAL (PLUS (TM-BASE (TM-SET-SP SP TM))
                          (TM-LIMIT (TM-SET-SP SP TM)))
                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
             ((ENABLE TM-SET-SP TM-SET-REGS)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLUS-TM-BASE-TM-LIMIT-TM-SET-SP)

(PROVE-LEMMA
 TM-EXECUTE-ADD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                (AND (IF (LESSP '65536
                                (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                         '*1*FALSE
                         '*1*TRUE)
                     (AND (TM-GOOD-ADDRESS ADDR1 TM)
                          (TM-GOOD-ADDRESS ADDR2 TM)))))
      (EQUAL (TM-EXECUTE-ADD ADDR1 ADDR2
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-REGS (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-CC (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-ERROR (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-SVCFLAG (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-SVCID (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-BASE (TM-EXECUTE-ADD ADDR1 ADDR2 TM))
                                  (TM-LIMIT (TM-EXECUTE-ADD ADDR1 ADDR2 TM)))))
 ((ENABLE TM-EXECUTE-ADD PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
          FINITE-NUMBERP-TM-CC-VALUE TM-GOOD-ADDRESS-TM-SET-CC
          GOOD-TM-TM-SET-CC TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-IN-SUPERVISOR-MODE-TM-SET-CC
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-ADD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-BRANCH-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                    (TM-GOOD-ADDRESS ADDR TM)))
          (EQUAL (TM-EXECUTE-BRANCH ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                 (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-REGS (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-CC (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-ERROR (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-SVCFLAG (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-SVCID (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-BASE (TM-EXECUTE-BRANCH ADDR TM))
                                      (TM-LIMIT (TM-EXECUTE-BRANCH ADDR TM)))))
 ((ENABLE TM-EXECUTE-BRANCH TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-CC-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-CC (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                             (TM-CC TM)))
             ((ENABLE TM-CC MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CC-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-ERROR-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-ERROR (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                            (TM-REGS TM)
                                                            (TM-CC TM)
                                                            (TM-ERROR TM)
                                                            (TM-SVCFLAG TM)
                                                            (TM-SVCID TM)
                                                            (TM-BASE TM)
                                                            (TM-LIMIT TM)))
                             (TM-ERROR TM)))
             ((ENABLE TM-ERROR MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-ERROR-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SVCFLAG-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-SVCFLAG (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                             (TM-SVCFLAG TM)))
             ((ENABLE TM-SVCFLAG MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SVCFLAG-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SVCID-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-SVCID (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                            (TM-REGS TM)
                                                            (TM-CC TM)
                                                            (TM-ERROR TM)
                                                            (TM-SVCFLAG TM)
                                                            (TM-SVCID TM)
                                                            (TM-BASE TM)
                                                            (TM-LIMIT TM)))
                             (TM-SVCID TM)))
             ((ENABLE TM-SVCID MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SVCID-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-PC-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-PC (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                             (TM-PC TM)))
             ((ENABLE TM-PC MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PC-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-SP-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (IMPLIES (GOOD-TM TM)
                      (EQUAL (TM-SP (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                             (TM-SP TM)))
             ((ENABLE TM-SP MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SP-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-BRANCH-ON-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
             (TM-GOOD-ADDRESS ADDR TM)))
   (EQUAL (TM-EXECUTE-BRANCH-ON-ZERO ADDR
                                     (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                          (TM-REGS TM)
                                                          (TM-CC TM)
                                                          (TM-ERROR TM)
                                                          (TM-SVCFLAG TM)
                                                          (TM-SVCID TM)
                                                          (TM-BASE TM)
                                                          (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-REGS (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-CC (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-ERROR (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-SVCID (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-BASE (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-BRANCH-ON-ZERO ADDR
                                                                    TM)))))
 ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-CC-MAPUP-ADDRESS-SPACE
          TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-ON-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-BRANCH-NOT-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
            (TM-GOOD-ADDRESS ADDR TM)))
  (EQUAL (TM-EXECUTE-BRANCH-NOT-ZERO ADDR
                                     (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                          (TM-REGS TM)
                                                          (TM-CC TM)
                                                          (TM-ERROR TM)
                                                          (TM-SVCFLAG TM)
                                                          (TM-SVCID TM)
                                                          (TM-BASE TM)
                                                          (TM-LIMIT TM)))
         (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-REGS (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-CC (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-ERROR (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-SVCFLAG (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-SVCID (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-BASE (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM))
                              (TM-LIMIT (TM-EXECUTE-BRANCH-NOT-ZERO ADDR
                                                                    TM)))))
 ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-CC-MAPUP-ADDRESS-SPACE
          TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BRANCH-NOT-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
       TM-STACK-OVERFLOWP-MAPUP-ADDRESS-SPACE
       (REWRITE)
       (IMPLIES (GOOD-TM TM)
                (EQUAL (TM-STACK-OVERFLOWP (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                       (TM-STACK-OVERFLOWP TM)))
       ((ENABLE TM-STACK-OVERFLOWP TM-SP-MAPUP-ADDRESS-SPACE)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE TM-STACK-OVERFLOWP-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
          TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          (REWRITE)
          (IMPLIES (AND (GOOD-TM TM)
                        (AND (IF (LESSP '65536
                                        (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                 '*1*FALSE
                                 '*1*TRUE)
                             (NOT (TM-IN-SUPERVISOR-MODE TM))))
                   (EQUAL (TM-GOOD-ADDRESS ADDR
                                           (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                          (TM-GOOD-ADDRESS ADDR TM)))
          ((ENABLE TM-GOOD-ADDRESS MAPUP-ADDRESS-SPACE TM-IN-SUPERVISOR-MODE
                   FINITE-NUMBERP MIN)
           (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
           (USE (FINITE-NUMBERP-TM-LIMIT (TM TM)))
           (DISABLE-THEORY T)))

(DISABLE TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
   TM-EXECUTE-CALL-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
   (REWRITE)
   (IMPLIES (AND (GOOD-TM TM)
                 (AND (IF (LESSP '65536
                                 (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                          '*1*FALSE
                          '*1*TRUE)
                      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (TM-GOOD-ADDRESS ADDR TM))))
            (EQUAL (TM-EXECUTE-CALL ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                   (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-CALL ADDR TM))
                                        (TM-REGS (TM-EXECUTE-CALL ADDR TM))
                                        (TM-CC (TM-EXECUTE-CALL ADDR TM))
                                        (TM-ERROR (TM-EXECUTE-CALL ADDR TM))
                                        (TM-SVCFLAG (TM-EXECUTE-CALL ADDR TM))
                                        (TM-SVCID (TM-EXECUTE-CALL ADDR TM))
                                        (TM-BASE (TM-EXECUTE-CALL ADDR TM))
                                        (TM-LIMIT (TM-EXECUTE-CALL ADDR TM)))))
   ((ENABLE FINITE-NUMBERP-TM-DECR FINITE-NUMBERP-TM-FETCH
            FINITE-NUMBERP-TM-SP FINITE-NUMBER-SUB1 GOOD-TM-TM-SET-PC
            GOOD-TM-TM-SET-SP PLUS-TM-BASE-TM-LIMIT-TM-SET-PC
            PLUS-TM-BASE-TM-LIMIT-TM-SET-SP TM-EXECUTE-CALL
            TM-FETCH-MAPUP-ADDRESS-SPACE TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
            TM-GOOD-ADDRESS-TM-SET-PC TM-GOOD-ADDRESS-TM-SET-SP
            TM-IN-SUPERVISOR-MODE-TM-SET-PC TM-IN-SUPERVISOR-MODE-TM-SET-SP
            TM-PC-MAPUP-ADDRESS-SPACE
            TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
            TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
            TM-SET-SP-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
            TM-SP-MAPUP-ADDRESS-SPACE TM-STACK-OVERFLOWP-MAPUP-ADDRESS-SPACE
            TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
    (ENABLE-THEORY GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-CALL-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-COMPARE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
             (AND (TM-GOOD-ADDRESS ADDR1 TM)
                  (TM-GOOD-ADDRESS ADDR2 TM))))
   (EQUAL (TM-EXECUTE-COMPARE ADDR1 ADDR2
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-REGS (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-CC (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-ERROR (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-SVCFLAG (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-SVCID (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-BASE (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM))
                               (TM-LIMIT (TM-EXECUTE-COMPARE ADDR1 ADDR2
                                                             TM)))))
 ((ENABLE TM-EXECUTE-COMPARE TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-COMPARE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
   TM-EXECUTE-DECR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
   (REWRITE)
   (IMPLIES (AND (GOOD-TM TM)
                 (AND (IF (LESSP '65536
                                 (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                          '*1*FALSE
                          '*1*TRUE)
                      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (TM-GOOD-ADDRESS ADDR TM))))
            (EQUAL (TM-EXECUTE-DECR ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                   (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-DECR ADDR TM))
                                        (TM-REGS (TM-EXECUTE-DECR ADDR TM))
                                        (TM-CC (TM-EXECUTE-DECR ADDR TM))
                                        (TM-ERROR (TM-EXECUTE-DECR ADDR TM))
                                        (TM-SVCFLAG (TM-EXECUTE-DECR ADDR TM))
                                        (TM-SVCID (TM-EXECUTE-DECR ADDR TM))
                                        (TM-BASE (TM-EXECUTE-DECR ADDR TM))
                                        (TM-LIMIT (TM-EXECUTE-DECR ADDR TM)))))
   ((ENABLE TM-EXECUTE-DECR PLUS-TM-BASE-TM-LIMIT-TM-SET-CC GOOD-TM-TM-SET-CC
            FINITE-NUMBERP-TM-CC-VALUE TM-IN-SUPERVISOR-MODE-TM-SET-CC
            TM-GOOD-ADDRESS-TM-SET-CC
            TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
            TM-FETCH-MAPUP-ADDRESS-SPACE
            TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
    (ENABLE-THEORY GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-DECR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-DECR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (AND (IF (LESSP '65536
                       (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                '*1*FALSE
                '*1*TRUE)
            (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                 (AND (TM-GOOD-ADDRESS ADDR1 TM)
                      (TM-GOOD-ADDRESS ADDR2 TM)))))
  (EQUAL (TM-EXECUTE-DECR-MOD ADDR1 ADDR2
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
         (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-REGS (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-CC (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-ERROR (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-SVCFLAG (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-SVCID (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-BASE (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM))
                              (TM-LIMIT (TM-EXECUTE-DECR-MOD ADDR1 ADDR2
                                                             TM)))))
 ((ENABLE TM-EXECUTE-DECR-MOD PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
          GOOD-TM-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
          TM-IN-SUPERVISOR-MODE-TM-SET-CC TM-GOOD-ADDRESS-TM-SET-CC
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-DECR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
   TM-EXECUTE-INCR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
   (REWRITE)
   (IMPLIES (AND (GOOD-TM TM)
                 (AND (IF (LESSP '65536
                                 (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                          '*1*FALSE
                          '*1*TRUE)
                      (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                           (TM-GOOD-ADDRESS ADDR TM))))
            (EQUAL (TM-EXECUTE-INCR ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                   (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-INCR ADDR TM))
                                        (TM-REGS (TM-EXECUTE-INCR ADDR TM))
                                        (TM-CC (TM-EXECUTE-INCR ADDR TM))
                                        (TM-ERROR (TM-EXECUTE-INCR ADDR TM))
                                        (TM-SVCFLAG (TM-EXECUTE-INCR ADDR TM))
                                        (TM-SVCID (TM-EXECUTE-INCR ADDR TM))
                                        (TM-BASE (TM-EXECUTE-INCR ADDR TM))
                                        (TM-LIMIT (TM-EXECUTE-INCR ADDR TM)))))
   ((ENABLE TM-EXECUTE-INCR PLUS-TM-BASE-TM-LIMIT-TM-SET-CC GOOD-TM-TM-SET-CC
            FINITE-NUMBERP-TM-CC-VALUE TM-IN-SUPERVISOR-MODE-TM-SET-CC
            TM-GOOD-ADDRESS-TM-SET-CC
            TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
            TM-FETCH-MAPUP-ADDRESS-SPACE
            TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
    (ENABLE-THEORY GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INCR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-INCR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (AND (IF (LESSP '65536
                       (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                '*1*FALSE
                '*1*TRUE)
            (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                 (AND (TM-GOOD-ADDRESS ADDR1 TM)
                      (TM-GOOD-ADDRESS ADDR2 TM)))))
  (EQUAL (TM-EXECUTE-INCR-MOD ADDR1 ADDR2
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
         (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-REGS (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-CC (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-ERROR (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-SVCFLAG (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-SVCID (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-BASE (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM))
                              (TM-LIMIT (TM-EXECUTE-INCR-MOD ADDR1 ADDR2
                                                             TM)))))
 ((ENABLE TM-EXECUTE-INCR-MOD PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
          GOOD-TM-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
          TM-IN-SUPERVISOR-MODE-TM-SET-CC TM-GOOD-ADDRESS-TM-SET-CC
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INCR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (MAPUP-ADDRESS-SPACE MEMORY REGS
                                                                CC ERROR
                                                                SVCFLAG SVCID
                                                                BASE LIMIT))
                    '*1*FALSE)
             ((ENABLE TM-IN-SUPERVISOR-MODE MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-LOAD-BASE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
       (AND (GOOD-TM TM)
            (NOT (TM-IN-SUPERVISOR-MODE TM)))
       (EQUAL (TM-EXECUTE-LOAD-BASE ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
              (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-REGS (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-CC (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-ERROR (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-SVCFLAG (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-SVCID (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-BASE (TM-EXECUTE-LOAD-BASE ADDR TM))
                                   (TM-LIMIT (TM-EXECUTE-LOAD-BASE ADDR TM)))))
 ((ENABLE TM-EXECUTE-LOAD-BASE TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-BASE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-LOAD-LIMIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (NOT (TM-IN-SUPERVISOR-MODE TM)))
      (EQUAL (TM-EXECUTE-LOAD-LIMIT ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-REGS (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-CC (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-ERROR (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-SVCFLAG (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-SVCID (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-BASE (TM-EXECUTE-LOAD-LIMIT ADDR TM))
                                  (TM-LIMIT (TM-EXECUTE-LOAD-LIMIT ADDR TM)))))
 ((ENABLE TM-EXECUTE-LOAD-LIMIT TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-LIMIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-LOAD-PSW-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
        (AND (GOOD-TM TM)
             (NOT (TM-IN-SUPERVISOR-MODE TM)))
        (EQUAL (TM-EXECUTE-LOAD-PSW ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
               (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-REGS (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-CC (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-ERROR (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-SVCFLAG (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-SVCID (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-BASE (TM-EXECUTE-LOAD-PSW ADDR TM))
                                    (TM-LIMIT (TM-EXECUTE-LOAD-PSW ADDR TM)))))
 ((ENABLE TM-EXECUTE-LOAD-PSW TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-LOAD-PSW-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                (AND (IF (LESSP '65536
                                (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                         '*1*FALSE
                         '*1*TRUE)
                     (AND (TM-GOOD-ADDRESS ADDR1 TM)
                          (TM-GOOD-ADDRESS ADDR2 TM)))))
      (EQUAL (TM-EXECUTE-MOD ADDR1 ADDR2
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-REGS (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-CC (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-ERROR (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-SVCFLAG (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-SVCID (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-BASE (TM-EXECUTE-MOD ADDR1 ADDR2 TM))
                                  (TM-LIMIT (TM-EXECUTE-MOD ADDR1 ADDR2 TM)))))
 ((ENABLE TM-EXECUTE-MOD PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
          FINITE-NUMBERP-TM-CC-VALUE TM-GOOD-ADDRESS-TM-SET-CC
          GOOD-TM-TM-SET-CC TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-IN-SUPERVISOR-MODE-TM-SET-CC
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-MOVE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
     (AND (GOOD-TM TM)
          (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
               (AND (IF (LESSP '65536
                               (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                        '*1*FALSE
                        '*1*TRUE)
                    (AND (TM-GOOD-ADDRESS ADDR1 TM)
                         (TM-GOOD-ADDRESS ADDR2 TM)))))
     (EQUAL (TM-EXECUTE-MOVE ADDR1 ADDR2
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
            (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-REGS (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-CC (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-ERROR (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-SVCFLAG (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-SVCID (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-BASE (TM-EXECUTE-MOVE ADDR1 ADDR2 TM))
                                 (TM-LIMIT (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)))))
 ((ENABLE TM-EXECUTE-MOVE TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MOVE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-MULTIPLY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
            (AND (IF (LESSP '65536
                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                     '*1*FALSE
                     '*1*TRUE)
                 (AND (TM-GOOD-ADDRESS ADDR1 TM)
                      (TM-GOOD-ADDRESS ADDR2 TM)))))
  (EQUAL (TM-EXECUTE-MULTIPLY ADDR1 ADDR2
                              (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                   (TM-REGS TM)
                                                   (TM-CC TM)
                                                   (TM-ERROR TM)
                                                   (TM-SVCFLAG TM)
                                                   (TM-SVCID TM)
                                                   (TM-BASE TM)
                                                   (TM-LIMIT TM)))
         (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-REGS (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-CC (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-ERROR (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-SVCFLAG (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-SVCID (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-BASE (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM))
                              (TM-LIMIT (TM-EXECUTE-MULTIPLY ADDR1 ADDR2
                                                             TM)))))
 ((ENABLE TM-EXECUTE-MULTIPLY PLUS-TM-BASE-TM-LIMIT-TM-SET-CC
          FINITE-NUMBERP-TM-CC-VALUE TM-GOOD-ADDRESS-TM-SET-CC
          GOOD-TM-TM-SET-CC TM-FETCH-MAPUP-ADDRESS-SPACE
          TM-IN-SUPERVISOR-MODE-TM-SET-CC
          TM-STORE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-CC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-MULTIPLY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
      TM-STACK-UNDERFLOWP-MAPUP-ADDRESS-SPACE
      (REWRITE)
      (IMPLIES (AND (GOOD-TM TM)
                    (AND (IF (LESSP '65536
                                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                             '*1*FALSE
                             '*1*TRUE)
                         (NOT (TM-IN-SUPERVISOR-MODE TM))))
               (EQUAL (TM-STACK-UNDERFLOWP (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                      (TM-STACK-UNDERFLOWP TM)))
      ((ENABLE TM-STACK-UNDERFLOWP FINITE-NUMBERP MIN
               TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
               TM-LIMIT-MAPUP-ADDRESS-SPACE TM-BASE-MAPUP-ADDRESS-SPACE
               TM-SP-MAPUP-ADDRESS-SPACE)
       (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
       (USE (FINITE-NUMBERP-TM-LIMIT (TM TM)))
       (DISABLE-THEORY T)))

(DISABLE TM-STACK-UNDERFLOWP-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
      TM-EXECUTE-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
      (REWRITE)
      (IMPLIES (AND (GOOD-TM TM)
                    (AND (IF (LESSP '65536
                                    (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                             '*1*FALSE
                             '*1*TRUE)
                         (NOT (TM-IN-SUPERVISOR-MODE TM))))
               (EQUAL (TM-EXECUTE-RETURN (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                      (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-RETURN TM))
                                           (TM-REGS (TM-EXECUTE-RETURN TM))
                                           (TM-CC (TM-EXECUTE-RETURN TM))
                                           (TM-ERROR (TM-EXECUTE-RETURN TM))
                                           (TM-SVCFLAG (TM-EXECUTE-RETURN TM))
                                           (TM-SVCID (TM-EXECUTE-RETURN TM))
                                           (TM-BASE (TM-EXECUTE-RETURN TM))
                                           (TM-LIMIT (TM-EXECUTE-RETURN TM)))))
      ((ENABLE TM-EXECUTE-RETURN TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS
               TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
               TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
               FINITE-NUMBERP-TM-INCR FINITE-NUMBERP-TM-SLIMIT
               TM-STACK-UNDERFLOWP-MAPUP-ADDRESS-SPACE
               TM-SP-MAPUP-ADDRESS-SPACE
               TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
               TM-SET-SP-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
               TM-FETCH-MAPUP-ADDRESS-SPACE
               TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS TM-INCR-SP-IS-ADD1-SP)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-SET-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
       (AND (GOOD-TM TM)
            (NOT (TM-IN-SUPERVISOR-MODE TM)))
       (EQUAL (TM-EXECUTE-SET-CLOCK ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
              (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-REGS (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-CC (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-ERROR (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-SVCFLAG (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-SVCID (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-BASE (TM-EXECUTE-SET-CLOCK ADDR TM))
                                   (TM-LIMIT (TM-EXECUTE-SET-CLOCK ADDR TM)))))
 ((ENABLE TM-EXECUTE-SET-CLOCK TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SET-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
         TM-EXECUTE-RUN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
         (REWRITE)
         (IMPLIES (AND (GOOD-TM TM)
                       (NOT (TM-IN-SUPERVISOR-MODE TM)))
                  (EQUAL (TM-EXECUTE-RUN (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                         (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-RUN TM))
                                              (TM-REGS (TM-EXECUTE-RUN TM))
                                              (TM-CC (TM-EXECUTE-RUN TM))
                                              (TM-ERROR (TM-EXECUTE-RUN TM))
                                              (TM-SVCFLAG (TM-EXECUTE-RUN TM))
                                              (TM-SVCID (TM-EXECUTE-RUN TM))
                                              (TM-BASE (TM-EXECUTE-RUN TM))
                                              (TM-LIMIT (TM-EXECUTE-RUN TM)))))
         ((ENABLE TM-EXECUTE-RUN TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
                  TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-RUN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
        TM-EXECUTE-WAIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
        (REWRITE)
        (IMPLIES (AND (GOOD-TM TM)
                      (NOT (TM-IN-SUPERVISOR-MODE TM)))
                 (EQUAL (TM-EXECUTE-WAIT (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                        (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-WAIT TM))
                                             (TM-REGS (TM-EXECUTE-WAIT TM))
                                             (TM-CC (TM-EXECUTE-WAIT TM))
                                             (TM-ERROR (TM-EXECUTE-WAIT TM))
                                             (TM-SVCFLAG (TM-EXECUTE-WAIT TM))
                                             (TM-SVCID (TM-EXECUTE-WAIT TM))
                                             (TM-BASE (TM-EXECUTE-WAIT TM))
                                             (TM-LIMIT (TM-EXECUTE-WAIT TM)))))
        ((ENABLE TM-EXECUTE-WAIT TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
                 TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-WAIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-TEST-IPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (NOT (TM-IN-SUPERVISOR-MODE TM)))
      (EQUAL (TM-EXECUTE-TEST-IPORT ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-REGS (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-CC (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-ERROR (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-SVCFLAG (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-SVCID (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-BASE (TM-EXECUTE-TEST-IPORT ADDR TM))
                                  (TM-LIMIT (TM-EXECUTE-TEST-IPORT ADDR TM)))))
 ((ENABLE TM-EXECUTE-TEST-IPORT TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-TEST-IPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-TEST-OPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (NOT (TM-IN-SUPERVISOR-MODE TM)))
      (EQUAL (TM-EXECUTE-TEST-OPORT ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-REGS (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-CC (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-ERROR (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-SVCFLAG (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-SVCID (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-BASE (TM-EXECUTE-TEST-OPORT ADDR TM))
                                  (TM-LIMIT (TM-EXECUTE-TEST-OPORT ADDR TM)))))
 ((ENABLE TM-EXECUTE-TEST-OPORT TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-TEST-OPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-START-OUTPUT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
         (AND (GOOD-TM TM)
              (NOT (TM-IN-SUPERVISOR-MODE TM)))
         (EQUAL (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2
                                         (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-START-OUTPUT ADDR1
                                                                         ADDR2
                                                                         TM))
                                     (TM-REGS (TM-EXECUTE-START-OUTPUT ADDR1
                                                                       ADDR2
                                                                       TM))
                                     (TM-CC (TM-EXECUTE-START-OUTPUT ADDR1
                                                                     ADDR2 TM))
                                     (TM-ERROR (TM-EXECUTE-START-OUTPUT ADDR1
                                                                        ADDR2
                                                                        TM))
                                     (TM-SVCFLAG (TM-EXECUTE-START-OUTPUT ADDR1
                                                                          ADDR2
                                                                          TM))
                                     (TM-SVCID (TM-EXECUTE-START-OUTPUT ADDR1
                                                                        ADDR2
                                                                        TM))
                                     (TM-BASE (TM-EXECUTE-START-OUTPUT ADDR1
                                                                       ADDR2
                                                                       TM))
                                     (TM-LIMIT (TM-EXECUTE-START-OUTPUT ADDR1
                                                                        ADDR2
                                                                        TM)))))
 ((ENABLE TM-EXECUTE-START-OUTPUT TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-START-OUTPUT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-POST-OUTPUT-INTERRUPT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM TM)
       (NOT (TM-IN-SUPERVISOR-MODE TM)))
  (EQUAL
       (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                         (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
       (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                         TM))
                            (TM-REGS (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                       TM))
                            (TM-CC (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM))
                            (TM-ERROR (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                        TM))
                            (TM-SVCFLAG (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                          TM))
                            (TM-SVCID (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                        TM))
                            (TM-BASE (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                       TM))
                            (TM-LIMIT (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR
                                                                        TM)))))
 ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT
          TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-SVC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                       (TM-GOOD-ADDRESS ADDR TM)))
             (EQUAL (TM-EXECUTE-SVC ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-SVC ADDR TM))
                                         (TM-REGS (TM-EXECUTE-SVC ADDR TM))
                                         (TM-CC (TM-EXECUTE-SVC ADDR TM))
                                         (TM-ERROR (TM-EXECUTE-SVC ADDR TM))
                                         (TM-SVCFLAG (TM-EXECUTE-SVC ADDR TM))
                                         (TM-SVCID (TM-EXECUTE-SVC ADDR TM))
                                         (TM-BASE (TM-EXECUTE-SVC ADDR TM))
                                         (TM-LIMIT (TM-EXECUTE-SVC ADDR TM)))))
    ((ENABLE TM-EXECUTE-SVC TM-FETCH-MAPUP-ADDRESS-SPACE
             TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
             TM-SET-SVCID-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-SET-SVCFLAG-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SVC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-SVC-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (NOT (TM-IN-SUPERVISOR-MODE TM)))
      (EQUAL (TM-EXECUTE-SVC-RETURN ADDR
                                    (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                         (TM-REGS TM)
                                                         (TM-CC TM)
                                                         (TM-ERROR TM)
                                                         (TM-SVCFLAG TM)
                                                         (TM-SVCID TM)
                                                         (TM-BASE TM)
                                                         (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-REGS (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-CC (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-ERROR (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-SVCFLAG (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-SVCID (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-BASE (TM-EXECUTE-SVC-RETURN ADDR TM))
                                  (TM-LIMIT (TM-EXECUTE-SVC-RETURN ADDR TM)))))
 ((ENABLE TM-EXECUTE-SVC-RETURN TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-SVC-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(DEFN TM-EXECUTE-NULLARY2
      (OPCODE TM)
      (IF (EQUAL OPCODE '8)
          (TM-EXECUTE-RUN TM)
          (IF (EQUAL OPCODE '4)
              (TM-EXECUTE-WAIT TM)
              (TM-SET-ERROR '2 TM)))
      NIL)

(DEFN TM-EXECUTE-NULLARY1
      (OPCODE TM)
      (IF (EQUAL OPCODE '0)
          (TM-EXECUTE-RETURN TM)
          (TM-EXECUTE-NULLARY2 OPCODE TM))
      NIL)

(PROVE-LEMMA TM-EXECUTE-NULLARY1-EQUALS-TM-EXECUTE-NULLARY
             (REWRITE)
             (EQUAL (TM-EXECUTE-NULLARY1 OPCODE TM)
                    (TM-EXECUTE-NULLARY OPCODE TM))
             ((ENABLE TM-EXECUTE-NULLARY1 TM-EXECUTE-NULLARY2
                      TM-EXECUTE-NULLARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-NULLARY1-EQUALS-TM-EXECUTE-NULLARY)

(PROVE-LEMMA
 TM-EXECUTE-NULLARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (AND (IF (LESSP '65536
                           (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                    '*1*FALSE
                    '*1*TRUE)
                (NOT (TM-IN-SUPERVISOR-MODE TM))))
      (EQUAL (TM-EXECUTE-NULLARY2 OPCODE
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-REGS (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-CC (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-ERROR (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-SVCFLAG (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-SVCID (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-BASE (TM-EXECUTE-NULLARY2 OPCODE TM))
                                  (TM-LIMIT (TM-EXECUTE-NULLARY2 OPCODE TM)))))
 ((ENABLE TM-EXECUTE-NULLARY2 TM-EXECUTE-RUN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-WAIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-NULLARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-NULLARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-TM TM)
           (AND (IF (LESSP '65536
                           (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                    '*1*FALSE
                    '*1*TRUE)
                (NOT (TM-IN-SUPERVISOR-MODE TM))))
      (EQUAL (TM-EXECUTE-NULLARY1 OPCODE
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
             (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-REGS (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-CC (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-ERROR (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-SVCFLAG (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-SVCID (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-BASE (TM-EXECUTE-NULLARY1 OPCODE TM))
                                  (TM-LIMIT (TM-EXECUTE-NULLARY1 OPCODE TM)))))
 ((ENABLE TM-EXECUTE-NULLARY1
          TM-EXECUTE-NULLARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-NULLARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-NULLARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
       (AND (GOOD-TM TM)
            (AND (IF (LESSP '65536
                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                     '*1*FALSE
                     '*1*TRUE)
                 (NOT (TM-IN-SUPERVISOR-MODE TM))))
       (EQUAL (TM-EXECUTE-NULLARY OPCODE
                                  (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                       (TM-REGS TM)
                                                       (TM-CC TM)
                                                       (TM-ERROR TM)
                                                       (TM-SVCFLAG TM)
                                                       (TM-SVCID TM)
                                                       (TM-BASE TM)
                                                       (TM-LIMIT TM)))
              (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-REGS (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-CC (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-ERROR (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-SVCFLAG (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-SVCID (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-BASE (TM-EXECUTE-NULLARY OPCODE TM))
                                   (TM-LIMIT (TM-EXECUTE-NULLARY OPCODE TM)))))
 ((USE (TM-EXECUTE-NULLARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (OPCODE OPCODE)
                                                              (TM TM)))
  (ENABLE TM-EXECUTE-NULLARY1-EQUALS-TM-EXECUTE-NULLARY)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-NULLARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(DEFN TM-EXECUTE-UNARY8
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '50)
          (TM-EXECUTE-TEST-IPORT ADDR TM)
          (IF (EQUAL OPCODE '54)
              (TM-EXECUTE-TEST-OPORT ADDR TM)
              (TM-SET-ERROR '2 TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY7
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '46)
          (TM-EXECUTE-SVC-RETURN ADDR TM)
          (IF (EQUAL OPCODE '38)
              (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR TM)
              (TM-EXECUTE-UNARY8 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY6
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '58)
          (TM-EXECUTE-SET-CLOCK ADDR TM)
          (IF (EQUAL OPCODE '42)
              (TM-EXECUTE-SVC ADDR TM)
              (TM-EXECUTE-UNARY7 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY5
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '30)
          (TM-EXECUTE-LOAD-LIMIT ADDR TM)
          (IF (EQUAL OPCODE '34)
              (TM-EXECUTE-LOAD-PSW ADDR TM)
              (TM-EXECUTE-UNARY6 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY4
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '22)
          (TM-EXECUTE-INCR ADDR TM)
          (IF (EQUAL OPCODE '26)
              (TM-EXECUTE-LOAD-BASE ADDR TM)
              (TM-EXECUTE-UNARY5 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY3
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '6)
          (TM-EXECUTE-BRANCH-NOT-ZERO ADDR TM)
          (IF (EQUAL OPCODE '18)
              (TM-EXECUTE-DECR ADDR TM)
              (TM-EXECUTE-UNARY4 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY2
      (OPCODE ADDR TM)
      (IF (EQUAL OPCODE '10)
          (TM-EXECUTE-BRANCH-ON-ZERO ADDR TM)
          (IF (EQUAL OPCODE '14)
              (TM-EXECUTE-CALL ADDR TM)
              (TM-EXECUTE-UNARY3 OPCODE ADDR TM)))
      NIL)

(DEFN TM-EXECUTE-UNARY1
      (OPCODE ADDR TM)
      (IF (NOT (TM-GOOD-ADDRESS ADDR TM))
          (TM-SET-ERROR '6 TM)
          (IF (EQUAL OPCODE '2)
              (TM-EXECUTE-BRANCH ADDR TM)
              (TM-EXECUTE-UNARY2 OPCODE ADDR TM)))
      NIL)

(PROVE-LEMMA TM-EXECUTE-UNARY1-EQUALS-TM-EXECUTE-UNARY
             (REWRITE)
             (EQUAL (TM-EXECUTE-UNARY1 OPCODE ADDR TM)
                    (TM-EXECUTE-UNARY OPCODE ADDR TM))
             ((ENABLE TM-EXECUTE-UNARY1 TM-EXECUTE-UNARY2 TM-EXECUTE-UNARY3
                      TM-EXECUTE-UNARY4 TM-EXECUTE-UNARY5 TM-EXECUTE-UNARY6
                      TM-EXECUTE-UNARY7 TM-EXECUTE-UNARY8 TM-EXECUTE-UNARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY1-EQUALS-TM-EXECUTE-UNARY)

(PROVE-LEMMA
 TM-EXECUTE-UNARY8-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY8 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY8 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY8 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY8 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-TEST-IPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-TEST-OPORT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY8-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY7-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY7 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY7 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY7 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY7 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-SVC-RETURN-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-POST-OUTPUT-INTERRUPT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY8-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY7-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY6 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY6 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY6 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY6 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-SVC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-SET-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY7-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY5 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY5 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY5 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY5 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-LOAD-PSW-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-LOAD-LIMIT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY4 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY4 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY4 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY4 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-LOAD-BASE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-INCR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY3 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY3 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY3 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY3 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-DECR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-BRANCH-NOT-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (TM-GOOD-ADDRESS ADDR TM)
             (AND (IF (LESSP '65536
                             (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                      '*1*FALSE
                      '*1*TRUE)
                  (NOT (TM-IN-SUPERVISOR-MODE TM)))))
   (EQUAL (TM-EXECUTE-UNARY2 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY2 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY2 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY2 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-CALL-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-BRANCH-ON-ZERO-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (IF (LESSP '65536
                        (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                 '*1*FALSE
                 '*1*TRUE)
             (NOT (TM-IN-SUPERVISOR-MODE TM))))
   (EQUAL (TM-EXECUTE-UNARY1 OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-REGS (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-CC (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-ERROR (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-SVCFLAG (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-SVCID (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-BASE (TM-EXECUTE-UNARY1 OPCODE ADDR TM))
                               (TM-LIMIT (TM-EXECUTE-UNARY1 OPCODE ADDR TM)))))
 ((ENABLE TM-EXECUTE-UNARY1 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-BRANCH-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-UNARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
    (AND (GOOD-TM TM)
         (AND (IF (LESSP '65536
                         (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                  '*1*FALSE
                  '*1*TRUE)
              (NOT (TM-IN-SUPERVISOR-MODE TM))))
    (EQUAL (TM-EXECUTE-UNARY OPCODE ADDR
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
           (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-REGS (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-CC (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-ERROR (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-SVCFLAG (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-SVCID (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-BASE (TM-EXECUTE-UNARY OPCODE ADDR TM))
                                (TM-LIMIT (TM-EXECUTE-UNARY OPCODE ADDR TM)))))
 ((USE (TM-EXECUTE-UNARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (OPCODE OPCODE)
                                                            (ADDR ADDR)
                                                            (TM TM)))
  (ENABLE TM-EXECUTE-UNARY1-EQUALS-TM-EXECUTE-UNARY)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-UNARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(DEFN TM-EXECUTE-BINARY6
      (OPCODE ADDR1 ADDR2 TM)
      (IF (EQUAL OPCODE '7)
          (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 TM)
          (TM-SET-ERROR '2 TM))
      NIL)

(DEFN TM-EXECUTE-BINARY5
      (OPCODE ADDR1 ADDR2 TM)
      (IF (EQUAL OPCODE '15)
          (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 TM)
          (IF (EQUAL OPCODE '5)
              (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 TM)
              (TM-EXECUTE-BINARY6 OPCODE ADDR1 ADDR2 TM)))
      NIL)

(DEFN TM-EXECUTE-BINARY4
      (OPCODE ADDR1 ADDR2 TM)
      (IF (EQUAL OPCODE '11)
          (TM-EXECUTE-MOVE ADDR1 ADDR2 TM)
          (IF (EQUAL OPCODE '13)
              (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 TM)
              (TM-EXECUTE-BINARY5 OPCODE ADDR1 ADDR2 TM)))
      NIL)

(DEFN TM-EXECUTE-BINARY3
      (OPCODE ADDR1 ADDR2 TM)
      (IF (EQUAL OPCODE '3)
          (TM-EXECUTE-COMPARE ADDR1 ADDR2 TM)
          (IF (EQUAL OPCODE '9)
              (TM-EXECUTE-MOD ADDR1 ADDR2 TM)
              (TM-EXECUTE-BINARY4 OPCODE ADDR1 ADDR2 TM)))
      NIL)

(DEFN TM-EXECUTE-BINARY2
      (OPCODE ADDR1 ADDR2 TM)
      (IF (EQUAL OPCODE '1)
          (TM-EXECUTE-ADD ADDR1 ADDR2 TM)
          (TM-EXECUTE-BINARY3 OPCODE ADDR1 ADDR2 TM))
      NIL)

(DEFN TM-EXECUTE-BINARY1
      (OPCODE ADDR1 ADDR2 TM)
      (IF (OR (NOT (TM-GOOD-ADDRESS ADDR1 TM))
              (NOT (TM-GOOD-ADDRESS ADDR2 TM)))
          (TM-SET-ERROR '6 TM)
          (TM-EXECUTE-BINARY2 OPCODE ADDR1 ADDR2 TM))
      NIL)

(PROVE-LEMMA TM-EXECUTE-BINARY1-EQUALS-TM-EXECUTE-BINARY
             (REWRITE)
             (EQUAL (TM-EXECUTE-BINARY1 OPCODE ADDR1 ADDR2 TM)
                    (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 TM))
             ((ENABLE TM-EXECUTE-BINARY1 TM-EXECUTE-BINARY2 TM-EXECUTE-BINARY3
                      TM-EXECUTE-BINARY4 TM-EXECUTE-BINARY5 TM-EXECUTE-BINARY6
                      TM-EXECUTE-BINARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY1-EQUALS-TM-EXECUTE-BINARY)

(PROVE-LEMMA
    TM-EXECUTE-BINARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (TM-GOOD-ADDRESS ADDR1 TM)
                       (AND (TM-GOOD-ADDRESS ADDR2 TM)
                            (AND (IF (LESSP '65536
                                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                     '*1*FALSE
                                     '*1*TRUE)
                                 (NOT (TM-IN-SUPERVISOR-MODE TM))))))
             (EQUAL (TM-EXECUTE-BINARY6 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY6 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY6 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY6 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY6 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY6 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY6 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY6 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY6 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY6 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-INCR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (TM-GOOD-ADDRESS ADDR1 TM)
                       (AND (TM-GOOD-ADDRESS ADDR2 TM)
                            (AND (IF (LESSP '65536
                                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                     '*1*FALSE
                                     '*1*TRUE)
                                 (NOT (TM-IN-SUPERVISOR-MODE TM))))))
             (EQUAL (TM-EXECUTE-BINARY5 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY5 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY5 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY5 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY5 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY5 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY5 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY5 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY5 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY5 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-START-OUTPUT-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-DECR-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-BINARY6-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (TM-GOOD-ADDRESS ADDR1 TM)
                       (AND (TM-GOOD-ADDRESS ADDR2 TM)
                            (AND (IF (LESSP '65536
                                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                     '*1*FALSE
                                     '*1*TRUE)
                                 (NOT (TM-IN-SUPERVISOR-MODE TM))))))
             (EQUAL (TM-EXECUTE-BINARY4 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY4 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY4 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY4 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY4 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY4 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY4 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY4 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY4 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY4 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-MOVE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-MULTIPLY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-BINARY5-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (TM-GOOD-ADDRESS ADDR1 TM)
                       (AND (TM-GOOD-ADDRESS ADDR2 TM)
                            (AND (IF (LESSP '65536
                                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                     '*1*FALSE
                                     '*1*TRUE)
                                 (NOT (TM-IN-SUPERVISOR-MODE TM))))))
             (EQUAL (TM-EXECUTE-BINARY3 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY3 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY3 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY3 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY3 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY3 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY3 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY3 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY3 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY3 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-COMPARE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-MOD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-BINARY4-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (TM-GOOD-ADDRESS ADDR1 TM)
                       (AND (TM-GOOD-ADDRESS ADDR2 TM)
                            (AND (IF (LESSP '65536
                                            (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                     '*1*FALSE
                                     '*1*TRUE)
                                 (NOT (TM-IN-SUPERVISOR-MODE TM))))))
             (EQUAL (TM-EXECUTE-BINARY2 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY2 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY2 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY2 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY2 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY2 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY2 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY2 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY2 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY2 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-ADD-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-BINARY3-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (IF (LESSP '65536
                                  (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                           '*1*FALSE
                           '*1*TRUE)
                       (NOT (TM-IN-SUPERVISOR-MODE TM))))
             (EQUAL (TM-EXECUTE-BINARY1 OPCODE ADDR1 ADDR2
                                        (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                             (TM-REGS TM)
                                                             (TM-CC TM)
                                                             (TM-ERROR TM)
                                                             (TM-SVCFLAG TM)
                                                             (TM-SVCID TM)
                                                             (TM-BASE TM)
                                                             (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY1 OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-REGS (TM-EXECUTE-BINARY1 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-CC (TM-EXECUTE-BINARY1 OPCODE
                                                                    ADDR1
                                                                    ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY1 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY1 OPCODE
                                                                         ADDR1
                                                                         ADDR2
                                                                         TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY1 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-BASE (TM-EXECUTE-BINARY1 OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY1 OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM)))))
    ((ENABLE TM-EXECUTE-BINARY1 TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE
             TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
             TM-EXECUTE-BINARY2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
    TM-EXECUTE-BINARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
    (REWRITE)
    (IMPLIES (AND (GOOD-TM TM)
                  (AND (IF (LESSP '65536
                                  (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                           '*1*FALSE
                           '*1*TRUE)
                       (NOT (TM-IN-SUPERVISOR-MODE TM))))
             (EQUAL (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2
                                       (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                            (TM-REGS TM)
                                                            (TM-CC TM)
                                                            (TM-ERROR TM)
                                                            (TM-SVCFLAG TM)
                                                            (TM-SVCID TM)
                                                            (TM-BASE TM)
                                                            (TM-LIMIT TM)))
                    (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-BINARY OPCODE
                                                                       ADDR1
                                                                       ADDR2
                                                                       TM))
                                         (TM-REGS (TM-EXECUTE-BINARY OPCODE
                                                                     ADDR1
                                                                     ADDR2 TM))
                                         (TM-CC (TM-EXECUTE-BINARY OPCODE
                                                                   ADDR1
                                                                   ADDR2 TM))
                                         (TM-ERROR (TM-EXECUTE-BINARY OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-SVCFLAG (TM-EXECUTE-BINARY OPCODE
                                                                        ADDR1
                                                                        ADDR2
                                                                        TM))
                                         (TM-SVCID (TM-EXECUTE-BINARY OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM))
                                         (TM-BASE (TM-EXECUTE-BINARY OPCODE
                                                                     ADDR1
                                                                     ADDR2 TM))
                                         (TM-LIMIT (TM-EXECUTE-BINARY OPCODE
                                                                      ADDR1
                                                                      ADDR2
                                                                      TM)))))
    ((USE (TM-EXECUTE-BINARY1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (OPCODE OPCODE)
                                                                (ADDR1 ADDR1)
                                                                (ADDR2 ADDR2)
                                                                (TM TM)))
     (ENABLE TM-EXECUTE-BINARY1-EQUALS-TM-EXECUTE-BINARY)
     (ENABLE-THEORY GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-BINARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
       TM-COMPUTE-ADDRESS-MAPUP-ADDRESS-SPACE
       (REWRITE)
       (IMPLIES (AND (GOOD-TM TM)
                     (NOT (TM-IN-SUPERVISOR-MODE TM)))
                (EQUAL (TM-COMPUTE-ADDRESS ARG
                                           (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                       (TM-COMPUTE-ADDRESS ARG TM)))
       ((ENABLE TM-COMPUTE-ADDRESS MAPUP-ADDRESS-SPACE TM-IN-SUPERVISOR-MODE)
        (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE TM-COMPUTE-ADDRESS-MAPUP-ADDRESS-SPACE)

(DEFN TM-EXECUTE-INSTRUCTION2
      (INSTRUCTION TM)
      (IF (EQUAL (LENGTH INSTRUCTION) '3)
          (TM-EXECUTE-BINARY (TM-OPCODE (CAR INSTRUCTION))
                             (TM-COMPUTE-ADDRESS (TM-ARG1 INSTRUCTION)
                                                 TM)
                             (TM-COMPUTE-ADDRESS (TM-ARG2 INSTRUCTION)
                                                 TM)
                             TM)
          (TM-SET-ERROR '2 TM))
      NIL)

(DEFN TM-EXECUTE-INSTRUCTION1
      (INSTRUCTION TM)
      (IF (EQUAL (LENGTH INSTRUCTION) '1)
          (TM-EXECUTE-NULLARY (TM-OPCODE (CAR INSTRUCTION))
                              TM)
          (IF (EQUAL (LENGTH INSTRUCTION) '2)
              (TM-EXECUTE-UNARY (TM-OPCODE (CAR INSTRUCTION))
                                (TM-COMPUTE-ADDRESS (TM-ARG1 INSTRUCTION)
                                                    TM)
                                TM)
              (TM-EXECUTE-INSTRUCTION2 INSTRUCTION TM)))
      NIL)

(PROVE-LEMMA TM-EXECUTE-INSTRUCTION1-EQUALS-TM-EXECUTE-INSTRUCTION
             (REWRITE)
             (EQUAL (TM-EXECUTE-INSTRUCTION1 INSTRUCTION TM)
                    (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
             ((ENABLE TM-EXECUTE-INSTRUCTION1 TM-EXECUTE-INSTRUCTION2
                      TM-EXECUTE-INSTRUCTION)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INSTRUCTION1-EQUALS-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA
 TM-EXECUTE-INSTRUCTION2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (IF (LESSP '65536
                        (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                 '*1*FALSE
                 '*1*TRUE)
             (NOT (TM-IN-SUPERVISOR-MODE TM))))
   (EQUAL (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                   (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                        (TM-REGS TM)
                                                        (TM-CC TM)
                                                        (TM-ERROR TM)
                                                        (TM-SVCFLAG TM)
                                                        (TM-SVCID TM)
                                                        (TM-BASE TM)
                                                        (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                   TM))
                               (TM-REGS (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                 TM))
                               (TM-CC (TM-EXECUTE-INSTRUCTION2 INSTRUCTION TM))
                               (TM-ERROR (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                  TM))
                               (TM-SVCFLAG (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                    TM))
                               (TM-SVCID (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                  TM))
                               (TM-BASE (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                 TM))
                               (TM-LIMIT (TM-EXECUTE-INSTRUCTION2 INSTRUCTION
                                                                  TM)))))
 ((ENABLE TM-EXECUTE-INSTRUCTION2 TM-COMPUTE-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-BINARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INSTRUCTION2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-INSTRUCTION1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-TM TM)
        (AND (IF (LESSP '65536
                        (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                 '*1*FALSE
                 '*1*TRUE)
             (NOT (TM-IN-SUPERVISOR-MODE TM))))
   (EQUAL (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                   (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                        (TM-REGS TM)
                                                        (TM-CC TM)
                                                        (TM-ERROR TM)
                                                        (TM-SVCFLAG TM)
                                                        (TM-SVCID TM)
                                                        (TM-BASE TM)
                                                        (TM-LIMIT TM)))
          (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                   TM))
                               (TM-REGS (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                 TM))
                               (TM-CC (TM-EXECUTE-INSTRUCTION1 INSTRUCTION TM))
                               (TM-ERROR (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                  TM))
                               (TM-SVCFLAG (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                    TM))
                               (TM-SVCID (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                  TM))
                               (TM-BASE (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                 TM))
                               (TM-LIMIT (TM-EXECUTE-INSTRUCTION1 INSTRUCTION
                                                                  TM)))))
 ((ENABLE TM-EXECUTE-INSTRUCTION1 TM-COMPUTE-ADDRESS-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-NULLARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-UNARY-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-INSTRUCTION2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INSTRUCTION1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-INSTRUCTION-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
    (AND (GOOD-TM TM)
         (AND (IF (LESSP '65536
                         (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                  '*1*FALSE
                  '*1*TRUE)
              (NOT (TM-IN-SUPERVISOR-MODE TM))))
    (EQUAL (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                   (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                        (TM-REGS TM)
                                                        (TM-CC TM)
                                                        (TM-ERROR TM)
                                                        (TM-SVCFLAG TM)
                                                        (TM-SVCID TM)
                                                        (TM-BASE TM)
                                                        (TM-LIMIT TM)))
           (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                   TM))
                                (TM-REGS (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                 TM))
                                (TM-CC (TM-EXECUTE-INSTRUCTION INSTRUCTION TM))
                                (TM-ERROR (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                  TM))
                                (TM-SVCFLAG (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                    TM))
                                (TM-SVCID (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                  TM))
                                (TM-BASE (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                 TM))
                                (TM-LIMIT (TM-EXECUTE-INSTRUCTION INSTRUCTION
                                                                  TM)))))
 ((USE
     (TM-EXECUTE-INSTRUCTION1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (OPCODE OPCODE)
                                                                (ADDR1 ADDR1)
                                                                (ADDR2 ADDR2)
                                                                (TM TM)))
  (ENABLE TM-EXECUTE-INSTRUCTION1-EQUALS-TM-EXECUTE-INSTRUCTION)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-INSTRUCTION-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
     TM-DECREMENT-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
     (REWRITE)
     (IMPLIES (AND (GOOD-TM TM)
                   (NOT (TM-IN-SUPERVISOR-MODE TM)))
              (EQUAL (TM-DECREMENT-CLOCK (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                     (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-DECREMENT-CLOCK TM))
                                          (TM-REGS (TM-DECREMENT-CLOCK TM))
                                          (TM-CC (TM-DECREMENT-CLOCK TM))
                                          (TM-ERROR (TM-DECREMENT-CLOCK TM))
                                          (TM-SVCFLAG (TM-DECREMENT-CLOCK TM))
                                          (TM-SVCID (TM-DECREMENT-CLOCK TM))
                                          (TM-BASE (TM-DECREMENT-CLOCK TM))
                                          (TM-LIMIT (TM-DECREMENT-CLOCK TM)))))
     ((ENABLE TM-DECREMENT-CLOCK TM-SET-CLOCK MAPUP-ADDRESS-SPACE TM-DECR
              TM-IN-SUPERVISOR-MODE)
      (USE (A-FINITE-NUMBER-IS-A-NUMBER (N (TM-LIMIT TM))
                                        (LUB '65536)))
      (ENABLE-THEORY GOOD-TM-PROPERTIES TM-SHELLS GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE TM-DECREMENT-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA TM-IN-SUPERVISOR-MODE-TM-DECREMENT-CLOCK
             (REWRITE)
             (EQUAL (TM-IN-SUPERVISOR-MODE (TM-DECREMENT-CLOCK TM))
                    (TM-IN-SUPERVISOR-MODE TM))
             ((ENABLE TM-DECREMENT-CLOCK TM-SET-CLOCK TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IN-SUPERVISOR-MODE-TM-DECREMENT-CLOCK)

(PROVE-LEMMA
      TM-FETCH-ARG1-MAPUP-ADDRESS-SPACE
      (REWRITE)
      (IMPLIES (AND (GOOD-TM TM)
                    (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                         (TM-GOOD-ADDRESS (REAL-ADDR '2
                                                     (TM-INCRN '1 (TM-PC TM)))
                                          TM)))
               (EQUAL (TM-FETCH-ARG1 (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                          (TM-REGS TM)
                                                          (TM-CC TM)
                                                          (TM-ERROR TM)
                                                          (TM-SVCFLAG TM)
                                                          (TM-SVCID TM)
                                                          (TM-BASE TM)
                                                          (TM-LIMIT TM)))
                      (TM-FETCH-ARG1 TM)))
      ((ENABLE TM-FETCH-MAPUP-ADDRESS-SPACE TM-FETCH-ARG1
               TM-PC-MAPUP-ADDRESS-SPACE)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-FETCH-ARG1-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
      TM-FETCH-ARG2-MAPUP-ADDRESS-SPACE
      (REWRITE)
      (IMPLIES (AND (GOOD-TM TM)
                    (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                         (TM-GOOD-ADDRESS (REAL-ADDR '2
                                                     (TM-INCRN '2 (TM-PC TM)))
                                          TM)))
               (EQUAL (TM-FETCH-ARG2 (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                          (TM-REGS TM)
                                                          (TM-CC TM)
                                                          (TM-ERROR TM)
                                                          (TM-SVCFLAG TM)
                                                          (TM-SVCID TM)
                                                          (TM-BASE TM)
                                                          (TM-LIMIT TM)))
                      (TM-FETCH-ARG2 TM)))
      ((ENABLE TM-FETCH-MAPUP-ADDRESS-SPACE TM-FETCH-ARG2
               TM-PC-MAPUP-ADDRESS-SPACE)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE TM-FETCH-ARG2-MAPUP-ADDRESS-SPACE)

(DEFN
  TM-EXECUTE2
  (OPCODE TM)
  (IF (TM-UNARY-INSTRUCTIONP OPCODE)
      (TM-EXECUTE-INSTRUCTION (CONS OPCODE
                                    (CONS (TM-FETCH-ARG1 TM) 'NIL))
                              (TM-SET-PC (TM-INCRN '2 (TM-PC TM))
                                         TM))
      (IF (TM-GOOD-ADDRESS (REAL-ADDR '2
                                      (TM-INCRN '2 (TM-PC TM)))
                           TM)
          (TM-EXECUTE-INSTRUCTION (CONS OPCODE
                                        (CONS (TM-FETCH-ARG1 TM)
                                              (CONS (TM-FETCH-ARG2 TM) 'NIL)))
                                  (TM-SET-PC (TM-INCRN '3 (TM-PC TM))
                                             TM))
          (TM-SET-ERROR '7 TM)))
  NIL)

(DEFN TM-EXECUTE1
      (OPCODE TM)
      (IF (TM-NULLARY-INSTRUCTIONP OPCODE)
          (TM-EXECUTE-INSTRUCTION (CONS OPCODE 'NIL)
                                  (TM-SET-PC (TM-INCRN '1 (TM-PC TM))
                                             TM))
          (IF (TM-GOOD-ADDRESS (REAL-ADDR '2
                                          (TM-INCRN '1 (TM-PC TM)))
                               TM)
              (TM-EXECUTE2 OPCODE TM)
              (TM-SET-ERROR '7 TM)))
      NIL)

(PROVE-LEMMA TM-EXECUTE1-EQUALS-TM-EXECUTE
             (REWRITE)
             (EQUAL (TM-EXECUTE1 OPCODE TM)
                    (TM-EXECUTE OPCODE TM))
             ((ENABLE TM-EXECUTE1 TM-EXECUTE2 TM-EXECUTE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE1-EQUALS-TM-EXECUTE)

(PROVE-LEMMA
 TM-EXECUTE2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
         (AND (GOOD-TM TM)
              (AND (IF (LESSP '65536
                              (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                       '*1*FALSE
                       '*1*TRUE)
                   (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                        (TM-GOOD-ADDRESS (REAL-ADDR '2
                                                    (TM-INCRN '1 (TM-PC TM)))
                                         TM))))
         (EQUAL (TM-EXECUTE2 INSTRUCTION
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
                (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-REGS (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-CC (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-ERROR (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-SVCFLAG (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-SVCID (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-BASE (TM-EXECUTE2 INSTRUCTION TM))
                                     (TM-LIMIT (TM-EXECUTE2 INSTRUCTION TM)))))
 ((ENABLE TM-EXECUTE2 TM-EXECUTE-INSTRUCTION-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE GOOD-TM-TM-SET-PC
          TM-PC-MAPUP-ADDRESS-SPACE PLUS-TM-BASE-TM-LIMIT-TM-SET-PC
          TM-IN-SUPERVISOR-MODE-TM-SET-PC TM-FETCH-ARG1-MAPUP-ADDRESS-SPACE
          TM-FETCH-ARG2-MAPUP-ADDRESS-SPACE
          TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE FINITE-NUMBERP-TM-INCR
          FINITE-NUMBERP-TM-INCRN)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES
         (AND (GOOD-TM TM)
              (AND (IF (LESSP '65536
                              (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                       '*1*FALSE
                       '*1*TRUE)
                   (NOT (TM-IN-SUPERVISOR-MODE TM))))
         (EQUAL (TM-EXECUTE1 INSTRUCTION
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
                (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-REGS (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-CC (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-ERROR (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-SVCFLAG (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-SVCID (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-BASE (TM-EXECUTE1 INSTRUCTION TM))
                                     (TM-LIMIT (TM-EXECUTE1 INSTRUCTION TM)))))
 ((ENABLE TM-EXECUTE1 TM-EXECUTE2-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-EXECUTE-INSTRUCTION-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
          TM-SET-PC-COMMUTES-WITH-MAPUP-ADDRESS-SPACE GOOD-TM-TM-SET-PC
          TM-PC-MAPUP-ADDRESS-SPACE PLUS-TM-BASE-TM-LIMIT-TM-SET-PC
          TM-IN-SUPERVISOR-MODE-TM-SET-PC TM-FETCH-ARG1-MAPUP-ADDRESS-SPACE
          TM-FETCH-ARG2-MAPUP-ADDRESS-SPACE
          TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE FINITE-NUMBERP-TM-INCR
          FINITE-NUMBERP-TM-INCRN)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
 TM-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
 (REWRITE)
 (IMPLIES (AND (GOOD-TM TM)
               (AND (IF (LESSP '65536
                               (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                        '*1*FALSE
                        '*1*TRUE)
                    (NOT (TM-IN-SUPERVISOR-MODE TM))))
          (EQUAL (TM-EXECUTE INSTRUCTION
                             (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                  (TM-REGS TM)
                                                  (TM-CC TM)
                                                  (TM-ERROR TM)
                                                  (TM-SVCFLAG TM)
                                                  (TM-SVCID TM)
                                                  (TM-BASE TM)
                                                  (TM-LIMIT TM)))
                 (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-EXECUTE INSTRUCTION TM))
                                      (TM-REGS (TM-EXECUTE INSTRUCTION TM))
                                      (TM-CC (TM-EXECUTE INSTRUCTION TM))
                                      (TM-ERROR (TM-EXECUTE INSTRUCTION TM))
                                      (TM-SVCFLAG (TM-EXECUTE INSTRUCTION TM))
                                      (TM-SVCID (TM-EXECUTE INSTRUCTION TM))
                                      (TM-BASE (TM-EXECUTE INSTRUCTION TM))
                                      (TM-LIMIT (TM-EXECUTE INSTRUCTION TM)))))
 ((ENABLE TM-EXECUTE1-EQUALS-TM-EXECUTE)
  (USE
     (TM-EXECUTE1-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (TM TM)
                                                    (INSTRUCTION INSTRUCTION)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
          TM-FETCH-OPCODE-MAPUP-ADDRESS-SPACE
          (REWRITE)
          (IMPLIES (AND (GOOD-TM TM)
                        (AND (IF (LESSP '65536
                                        (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                                 '*1*FALSE
                                 '*1*TRUE)
                             (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                                  (TM-GOOD-ADDRESS (REAL-ADDR '2 (TM-PC TM))
                                                   TM))))
                   (EQUAL (TM-FETCH-OPCODE (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                                (TM-REGS TM)
                                                                (TM-CC TM)
                                                                (TM-ERROR TM)
                                                                (TM-SVCFLAG TM)
                                                                (TM-SVCID TM)
                                                                (TM-BASE TM)
                                                                (TM-LIMIT TM)))
                          (TM-FETCH-OPCODE TM)))
          ((ENABLE TM-FETCH-MAPUP-ADDRESS-SPACE TM-FETCH-OPCODE
                   TM-PC-MAPUP-ADDRESS-SPACE)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE TM-FETCH-OPCODE-MAPUP-ADDRESS-SPACE)

(PROVE-LEMMA
       TM-FETCH-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
       (REWRITE)
       (IMPLIES (AND (GOOD-TM TM)
                     (AND (IF (LESSP '65536
                                     (PLUS (TM-BASE TM) (TM-LIMIT TM)))
                              '*1*FALSE
                              '*1*TRUE)
                          (NOT (TM-IN-SUPERVISOR-MODE TM))))
                (EQUAL (TM-FETCH-EXECUTE (MAPUP-ADDRESS-SPACE (TM-MEMORY TM)
                                                              (TM-REGS TM)
                                                              (TM-CC TM)
                                                              (TM-ERROR TM)
                                                              (TM-SVCFLAG TM)
                                                              (TM-SVCID TM)
                                                              (TM-BASE TM)
                                                              (TM-LIMIT TM)))
                       (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-FETCH-EXECUTE TM))
                                            (TM-REGS (TM-FETCH-EXECUTE TM))
                                            (TM-CC (TM-FETCH-EXECUTE TM))
                                            (TM-ERROR (TM-FETCH-EXECUTE TM))
                                            (TM-SVCFLAG (TM-FETCH-EXECUTE TM))
                                            (TM-SVCID (TM-FETCH-EXECUTE TM))
                                            (TM-BASE (TM-FETCH-EXECUTE TM))
                                            (TM-LIMIT (TM-FETCH-EXECUTE TM)))))
       ((ENABLE TM-FETCH-EXECUTE TM-GOOD-PC-ADDRESS
                TM-FETCH-OPCODE-MAPUP-ADDRESS-SPACE
                TM-GOOD-ADDRESS-MAPUP-ADDRESS-SPACE TM-PC-MAPUP-ADDRESS-SPACE
                TM-SET-ERROR-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
                TM-IN-SUPERVISOR-MODE-TM-DECREMENT-CLOCK
                GOOD-TM-TM-DECREMENT-CLOCK
                PLUS-TM-BASE-TM-LIMIT-TM-DECREMENT-CLOCK
                TM-DECREMENT-CLOCK-COMMUTES-WITH-MAPUP-ADDRESS-SPACE
                ACCESS-TM-SET-ERROR TM-GOOD-ADDRESS-TM-DECREMENT-CLOCK
                TM-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)
        (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE TM-FETCH-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE)

(DEFN DEQ-ITH-BUFFER
      (ID BUFFERS)
      (PUTNTH (DEQ (GETNTH ID BUFFERS))
              ID BUFFERS)
      NIL)

(DEFN ENQ-ITH-BUFFER
      (ITEM ID BUFFERS)
      (PUTNTH (ENQ ITEM (GETNTH ID BUFFERS))
              ID BUFFERS)
      NIL)

(DEFN QREPLACE-ITH-BUFFER
      (ITEM ID BUFFERS)
      (PUTNTH (QREPLACE ITEM (GETNTH ID BUFFERS))
              ID BUFFERS)
      NIL)

(ADD-SHELL TASK NIL TASK-SHELLP
           ((TASK-PSTATE (NONE-OF) ZERO)
            (TASK-CHANNELS (NONE-OF) ZERO)))

(DEFTHEORY TASK-SHELL (TASK))

(DEFN TASK-IBUFFERS
      (TASK)
      (CAR (TASK-CHANNELS TASK))
      NIL)

(DEFN TASK-OBUFFERS
      (TASK)
      (CAR (CDR (TASK-CHANNELS TASK)))
      NIL)

(DEFN TASK-MBUFFERS
      (TASK)
      (CAR (CDR (CDR (TASK-CHANNELS TASK))))
      NIL)

(DEFN TASK-IBUFFER-CAPACITY NIL '4
      NIL)

(DEFN TASK-OBUFFER-CAPACITY NIL '4
      NIL)

(DEFN TASK-MBUFFER-CAPACITY NIL '4
      NIL)

(DEFN OS-SVC-SEND-ID NIL '0 NIL)

(DEFN OS-SVC-RECEIVE-ID NIL '1 NIL)

(DEFN OS-SVC-TYO-ID NIL '2 NIL)

(DEFN OS-SVC-TYI-ID NIL '3 NIL)

(DEFN TASK-SEND-INSTRUCTIONP
      (TASK)
      (EQUAL (REMAINDER (TM-SVCID (TASK-PSTATE TASK))
                        '4)
             '0)
      NIL)

(DEFN TASK-RECEIVE-INSTRUCTIONP
      (TASK)
      (EQUAL (REMAINDER (TM-SVCID (TASK-PSTATE TASK))
                        '4)
             '1)
      NIL)

(DEFN TASK-TYO-INSTRUCTIONP
      (TASK)
      (EQUAL (REMAINDER (TM-SVCID (TASK-PSTATE TASK))
                        '4)
             '2)
      NIL)

(DEFN TASK-TYI-INSTRUCTIONP
      (TASK)
      (EQUAL (REMAINDER (TM-SVCID (TASK-PSTATE TASK))
                        '4)
             '3)
      NIL)

(DEFN TASK-UPDATE-CONTROL
      (PSTATE)
      (TM-SET-SVCFLAG '0 PSTATE)
      NIL)

(DEFN TASK-COMMUNICATIONP
      (TASK)
      (TM-SVC-INTERRUPTP (TASK-PSTATE TASK))
      NIL)

(DEFN OS-SRCID
      (TASK MAX)
      (REMAINDER (TM-R2 TASK) MAX)
      NIL)

(DEFN OS-DESTID
      (TASK MAX)
      (REMAINDER (TM-R2 TASK) MAX)
      NIL)

(DEFN OS-IDEVID
      (TASK MAX)
      (REMAINDER (TM-R2 TASK) MAX)
      NIL)

(DEFN OS-ODEVID
      (TASK MAX)
      (REMAINDER (TM-R2 TASK) MAX)
      NIL)

(DEFN OS-MESSAGE
      (TASK)
      (TM-R3 TASK)
      NIL)

(DEFN OS-STORE-MESSAGE
      (MSG TASK)
      (TM-STORE MSG '(1 3) TASK)
      NIL)

(DEFN TASK-SRCID
      (TASK)
      (OS-SRCID (TASK-PSTATE TASK)
                (LENGTH (TASK-MBUFFERS TASK)))
      NIL)

(DEFN TASK-DESTID
      (TASK)
      (OS-DESTID (TASK-PSTATE TASK)
                 (LENGTH (TASK-MBUFFERS TASK)))
      NIL)

(DEFN TASK-IDEVID
      (TASK)
      (OS-IDEVID (TASK-PSTATE TASK)
                 (LENGTH (TASK-IBUFFERS TASK)))
      NIL)

(DEFN TASK-ODEVID
      (TASK)
      (OS-ODEVID (TASK-PSTATE TASK)
                 (LENGTH (TASK-IBUFFERS TASK)))
      NIL)

(DEFN TASK-MESSAGE
      (TASK)
      (OS-MESSAGE (TASK-PSTATE TASK))
      NIL)

(DEFN TASK-STORE-MESSAGE
      (MSG PSTATE)
      (OS-STORE-MESSAGE MSG PSTATE)
      NIL)

(DEFN TASK-FETCH-EXECUTE
      (PSTATE)
      (TM-FETCH-EXECUTE PSTATE)
      NIL)

(DEFN TASK-EXECUTE-SEND
      (MSG SRCID DESTID TASK)
      (IF (QFULLP2 SRCID DESTID
                   (TASK-MBUFFERS TASK)
                   '4)
          TASK
          (TASK (TASK-UPDATE-CONTROL (TASK-PSTATE TASK))
                (CONS (TASK-IBUFFERS TASK)
                      (CONS (TASK-OBUFFERS TASK)
                            (CONS (ENQ2 MSG SRCID DESTID
                                        (TASK-MBUFFERS TASK))
                                  'NIL)))))
      NIL)

(DEFN TASK-EXECUTE-RECEIVE
 (SRCID DESTID TASK)
 (IF
  (QEMPTYP2 SRCID DESTID
            (TASK-MBUFFERS TASK))
  TASK
  (TASK (TASK-UPDATE-CONTROL (TASK-STORE-MESSAGE (QFIRST2 SRCID DESTID
                                                          (TASK-MBUFFERS TASK))
                                                 (TASK-PSTATE TASK)))
        (CONS (TASK-IBUFFERS TASK)
              (CONS (TASK-OBUFFERS TASK)
                    (CONS (DEQ2 SRCID DESTID
                                (TASK-MBUFFERS TASK))
                          'NIL)))))
 NIL)

(DEFN TASK-EXECUTE-OUTPUT
      (CHAR ID TASK)
      (IF (QFULLP (GETNTH ID (TASK-OBUFFERS TASK))
                  '4)
          TASK
          (TASK (TASK-UPDATE-CONTROL (TASK-PSTATE TASK))
                (CONS (TASK-IBUFFERS TASK)
                      (CONS (ENQ-ITH-BUFFER CHAR ID
                                            (TASK-OBUFFERS TASK))
                            (CONS (TASK-MBUFFERS TASK) 'NIL)))))
      NIL)

(DEFN TASK-EXECUTE-INPUT
 (ID TASK)
 (IF
  (QEMPTYP (GETNTH ID (TASK-IBUFFERS TASK)))
  TASK
  (TASK
   (TASK-UPDATE-CONTROL
                  (TASK-STORE-MESSAGE (QFIRST (GETNTH ID (TASK-IBUFFERS TASK)))
                                      (TASK-PSTATE TASK)))
   (CONS (DEQ-ITH-BUFFER ID
                         (TASK-IBUFFERS TASK))
         (CONS (TASK-OBUFFERS TASK)
               (CONS (TASK-MBUFFERS TASK) 'NIL)))))
 NIL)

(DEFN TASK-COMMUNICATION-STEP
      (TASK I)
      (IF (TASK-SEND-INSTRUCTIONP TASK)
          (TASK-EXECUTE-SEND (TASK-MESSAGE TASK)
                             I
                             (TASK-DESTID TASK)
                             TASK)
          (IF (TASK-RECEIVE-INSTRUCTIONP TASK)
              (TASK-EXECUTE-RECEIVE (TASK-SRCID TASK)
                                    I TASK)
              (IF (TASK-TYO-INSTRUCTIONP TASK)
                  (TASK-EXECUTE-OUTPUT (TASK-MESSAGE TASK)
                                       I TASK)
                  (TASK-EXECUTE-INPUT I TASK))))
      NIL)

(DEFN TASK-PRIVATE-STEP
      (TASK)
      (TASK (TASK-FETCH-EXECUTE (TASK-PSTATE TASK))
            (TASK-CHANNELS TASK))
      NIL)

(DEFN TASK-STEP
      (TASK I)
      (IF (TASK-COMMUNICATIONP TASK)
          (TASK-COMMUNICATION-STEP TASK I)
          (TASK-PRIVATE-STEP TASK))
      NIL)

(DEFN TASK-UPDATE-CHANNELS
      (TASK CHANNELS)
      (TASK (TASK-PSTATE TASK) CHANNELS)
      NIL)

(DEFN TASK-ACTIVEP
      (X)
      (EQUAL X '*1*TRUE)
      NIL)

(DEFN TASK-PROCESSOR
      (TASK I ORACLE)
      (IF (LISTP ORACLE)
          (IF (TASK-ACTIVEP (CAR ORACLE))
              (TASK-PROCESSOR (TASK-STEP TASK I)
                              I
                              (CDR ORACLE))
              (TASK-PROCESSOR (TASK-UPDATE-CHANNELS TASK
                                                    (CAR ORACLE))
                              I
                              (CDR ORACLE)))
          TASK)
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-OS-MESSAGE
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE MACHINE MEMLENGTH)
                      (FINITE-NUMBERP (OS-MESSAGE MACHINE)
                                      '65536))
             ((ENABLE OS-MESSAGE TM-R3 FINITE-NUMBERP-GETNTH)
              (ENABLE-THEORY GOOD-ADDRESS-SPACE-PROPERTIES TASK-SHELL
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-OS-MESSAGE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE TM MEMLENGTH)
                           (FINITE-NUMBERP MSG '65536))
                      (GOOD-ADDRESS-SPACE (OS-STORE-MESSAGE MSG TM)
                                          MEMLENGTH))
             ((ENABLE GOOD-ADDRESS-SPACE-TM-STORE OS-STORE-MESSAGE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE1
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE TASK
                                               (LENGTH (TM-MEMORY TASK)))
                           (FINITE-NUMBERP MSG '65536))
                      (GOOD-ADDRESS-SPACE (OS-STORE-MESSAGE MSG TASK)
                                          (LENGTH (TM-MEMORY TASK))))
             ((ENABLE GOOD-ADDRESS-SPACE-TM-STORE OS-STORE-MESSAGE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE1)

(PROVE-LEMMA LENGTH-TM-MEMORY-OS-STORE-MESSAGE
             (REWRITE)
             (EQUAL (LENGTH (TM-MEMORY (OS-STORE-MESSAGE MSG TASK)))
                    (LENGTH (TM-MEMORY TASK)))
             ((ENABLE OS-STORE-MESSAGE TM-STORE TM-STORE-IN-REGMEM TM-SET-REGS
                      TM-STORE-IN-MEMORY TM-SET-MEMORY LENGTH-PUTNTH)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-OS-STORE-MESSAGE)

(DEFN GOOD-TASK-BUFFER
      (BUFFER CAPACITY)
      (AND (PLISTP BUFFER)
           (AND (LESSP (LENGTH BUFFER)
                       (ADD1 CAPACITY))
                (FINITE-NUMBER-LISTP BUFFER '65536)))
      NIL)

(DEFN GOOD-TASK-BUFFER-LIST
      (L CAPACITY)
      (IF (LISTP L)
          (AND (GOOD-TASK-BUFFER (CAR L) CAPACITY)
               (GOOD-TASK-BUFFER-LIST (CDR L)
                                      CAPACITY))
          (EQUAL L 'NIL))
      NIL)

(DEFN GOOD-TASK-BUFFER-TABLE
      (L LENGTH CAPACITY)
      (IF (LISTP L)
          (AND (PLISTP (CAR L))
               (AND (EQUAL (LENGTH (CAR L)) LENGTH)
                    (AND (GOOD-TASK-BUFFER-LIST (CAR L)
                                                CAPACITY)
                         (GOOD-TASK-BUFFER-TABLE (CDR L)
                                                 LENGTH CAPACITY))))
          (EQUAL L 'NIL))
      NIL)

(DEFN GOOD-TASK
 (TASK ILENGTH OLENGTH MLENGTH)
 (AND
     (TASK-SHELLP TASK)
     (AND (GOOD-ADDRESS-SPACE (TASK-PSTATE TASK)
                              (LENGTH (TM-MEMORY (TASK-PSTATE TASK))))
          (AND (EQUAL (LENGTH (TASK-IBUFFERS TASK))
                      ILENGTH)
               (AND (GOOD-TASK-BUFFER-LIST (TASK-IBUFFERS TASK)
                                           '4)
                    (AND (EQUAL (LENGTH (TASK-OBUFFERS TASK))
                                OLENGTH)
                         (AND (GOOD-TASK-BUFFER-LIST (TASK-OBUFFERS TASK)
                                                     '4)
                              (AND (EQUAL (LENGTH (TASK-MBUFFERS TASK))
                                          MLENGTH)
                                   (GOOD-TASK-BUFFER-TABLE (TASK-MBUFFERS TASK)
                                                           MLENGTH
                                                           '4))))))))
 NIL)

(PROVE-LEMMA GOOD-TASK-BUFFER-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-TASK-BUFFER BUFFER CAPACITY)
                      (AND (PLISTP BUFFER)
                           (AND (LESSP (LENGTH BUFFER)
                                       (ADD1 CAPACITY))
                                (FINITE-NUMBER-LISTP BUFFER '65536))))
             ((ENABLE GOOD-TASK-BUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-PROPERTIES)

(PROVE-LEMMA GOOD-TASK-BUFFER-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-LIST L CAPACITY)
                           (LESSP I (LENGTH L)))
                      (GOOD-TASK-BUFFER (GETNTH I L)
                                        CAPACITY))
             ((ENABLE GOOD-TASK-BUFFER-LIST GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-GETNTH)

(PROVE-LEMMA PLISTP-GOOD-TASK-BUFFER-LIST
             (REWRITE)
             (IMPLIES (GOOD-TASK-BUFFER-LIST L CAPACITY)
                      (PLISTP L))
             ((ENABLE GOOD-TASK-BUFFER-LIST PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GOOD-TASK-BUFFER-LIST)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-LIST L CAPACITY)
                           (AND (PLISTP BUFFER)
                                (AND (LESSP (LENGTH BUFFER)
                                            (ADD1 CAPACITY))
                                     (FINITE-NUMBER-LISTP BUFFER
                                                          '65536))))
                      (GOOD-TASK-BUFFER-LIST (PUTNTH BUFFER I L)
                                             CAPACITY))
             ((ENABLE PUTNTH GOOD-TASK-BUFFER-LIST GOOD-TASK-BUFFER LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-PUTNTH)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-TABLE L LENGTH CAPACITY)
                           (LESSP I (LENGTH L)))
                      (AND (PLISTP (GETNTH I L))
                           (AND (EQUAL (LENGTH (GETNTH I L)) LENGTH)
                                (GOOD-TASK-BUFFER-LIST (GETNTH I L)
                                                       CAPACITY))))
             ((ENABLE GOOD-TASK-BUFFER-TABLE GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-GETNTH)

(PROVE-LEMMA GOOD-TASK-BUFFER-GETNTH2
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-TABLE L LENGTH CAPACITY)
                           (AND (LESSP I (LENGTH L))
                                (LESSP J LENGTH)))
                      (GOOD-TASK-BUFFER (GETNTH2 I J L)
                                        CAPACITY))
             ((ENABLE GETNTH2 LENGTH GOOD-TASK-BUFFER-LIST-GETNTH
                      GOOD-TASK-BUFFER-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-GETNTH2)

(PROVE-LEMMA GOOD-TASK-BUFFER-TABLE-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-TABLE L LENGTH CAPACITY)
                           (AND (PLISTP X)
                                (AND (EQUAL (LENGTH X) LENGTH)
                                     (GOOD-TASK-BUFFER-LIST X CAPACITY))))
                      (GOOD-TASK-BUFFER-TABLE (PUTNTH X I L)
                                              LENGTH CAPACITY))
             ((ENABLE GOOD-TASK-BUFFER-TABLE PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-TABLE-PUTNTH)

(PROVE-LEMMA GOOD-TASK-BUFFER-TABLE-PUTNTH2
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-TABLE L LENGTH CAPACITY)
                           (AND (LESSP I (LENGTH L))
                                (AND (PLISTP BUFFER)
                                     (AND (LESSP (LENGTH BUFFER)
                                                 (ADD1 CAPACITY))
                                          (FINITE-NUMBER-LISTP BUFFER
                                                               '65536)))))
                      (GOOD-TASK-BUFFER-TABLE (PUTNTH2 BUFFER I J L)
                                              LENGTH CAPACITY))
             ((ENABLE GOOD-TASK PLISTP-PUTNTH LENGTH-PUTNTH PUTNTH2 LENGTH
                      GOOD-TASK-BUFFER-TABLE-PUTNTH
                      GOOD-TASK-BUFFER-LIST-GETNTH
                      GOOD-TASK-BUFFER-LIST-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-TABLE-PUTNTH2)

(PROVE-LEMMA PLISTP-GOOD-TASK-BUFFER-TABLE
             (REWRITE)
             (IMPLIES (GOOD-TASK-BUFFER-TABLE L LENGTH CAPACITY)
                      (PLISTP L))
             ((ENABLE GOOD-TASK-BUFFER-TABLE PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GOOD-TASK-BUFFER-TABLE)

(ADD-SHELL AK
           NIL AK-SHELLP
           ((AK-PSTATES (NONE-OF) ZERO)
            (AK-IBUFFERS (NONE-OF) ZERO)
            (AK-OBUFFERS (NONE-OF) ZERO)
            (AK-MBUFFERS (NONE-OF) ZERO)
            (AK-READYQ (NONE-OF) ZERO)
            (AK-STATUS (NONE-OF) ZERO)
            (AK-RWSTATE (NONE-OF) ZERO)
            (AK-CLOCK (NONE-OF) ZERO)
            (AK-IPORTS (NONE-OF) ZERO)
            (AK-OPORTS (NONE-OF) ZERO)))

(DEFTHEORY AK-SHELL (AK))

(DEFN AK-TASKIDLUB NIL '16 NIL)

(DEFN AK-TIME-SLICE NIL '1000 NIL)

(DEFN AK-TASKID
      (AK)
      (QFIRST (AK-READYQ AK))
      NIL)

(DEFN AK-SEND-INSTRUCTIONP
      (AK)
      (EQUAL (REMAINDER (TM-SVCID (GETNTH (AK-TASKID AK)
                                          (AK-PSTATES AK)))
                        '4)
             '0)
      NIL)

(DEFN AK-RECEIVE-INSTRUCTIONP
      (AK)
      (EQUAL (REMAINDER (TM-SVCID (GETNTH (AK-TASKID AK)
                                          (AK-PSTATES AK)))
                        '4)
             '1)
      NIL)

(DEFN AK-TYO-INSTRUCTIONP
      (AK)
      (EQUAL (REMAINDER (TM-SVCID (GETNTH (AK-TASKID AK)
                                          (AK-PSTATES AK)))
                        '4)
             '2)
      NIL)

(DEFN AK-TYI-INSTRUCTIONP
      (AK)
      (EQUAL (REMAINDER (TM-SVCID (GETNTH (AK-TASKID AK)
                                          (AK-PSTATES AK)))
                        '4)
             '3)
      NIL)

(DEFN AK-UPDATE-CONTROL
      (ID PSTATES)
      (PUTNTH (TM-SET-SVCFLAG '0
                              (GETNTH ID PSTATES))
              ID PSTATES)
      NIL)

(DEFN AK-COMMUNICATIONP
      (AK)
      (TM-SVC-INTERRUPTP (GETNTH (AK-TASKID AK)
                                 (AK-PSTATES AK)))
      NIL)

(DEFN AK-ERRORP
      (AK)
      (TM-ERRORP (GETNTH (AK-TASKID AK)
                         (AK-PSTATES AK)))
      NIL)

(DEFN AK-SVC-INTERRUPTP
      (AK)
      (TM-SVC-INTERRUPTP (GETNTH (AK-TASKID AK)
                                 (AK-PSTATES AK)))
      NIL)

(DEFN AK-DESTID
      (AK)
      (OS-DESTID (GETNTH (AK-TASKID AK)
                         (AK-PSTATES AK))
                 '16)
      NIL)

(DEFN AK-SRCID
      (AK)
      (OS-SRCID (GETNTH (AK-TASKID AK)
                        (AK-PSTATES AK))
                '16)
      NIL)

(DEFN AK-IDEVID
      (AK)
      (OS-IDEVID (GETNTH (AK-TASKID AK)
                         (AK-PSTATES AK))
                 '16)
      NIL)

(DEFN AK-ODEVID
      (AK)
      (OS-ODEVID (GETNTH (AK-TASKID AK)
                         (AK-PSTATES AK))
                 '16)
      NIL)

(DEFN AK-MESSAGE
      (AK)
      (OS-MESSAGE (GETNTH (AK-TASKID AK)
                          (AK-PSTATES AK)))
      NIL)

(DEFN AK-STORE-MESSAGE
      (MSG TASKID PSTATES)
      (PUTNTH (OS-STORE-MESSAGE MSG
                                (GETNTH TASKID PSTATES))
              TASKID PSTATES)
      NIL)

(DEFN AK-FETCH-EXECUTE
      (ID PSTATES)
      (PUTNTH (TM-FETCH-EXECUTE (GETNTH ID PSTATES))
              ID PSTATES)
      NIL)

(DEFN AK-OPORT-IDLEP
      (ID OPORTS)
      (TM-OPORT-IDLEP ID OPORTS)
      NIL)

(DEFN AK-POST-OUTPUT-INTERRUPT
      (ID OPORTS)
      (TM-POST-OUTPUT-INTERRUPT ID OPORTS)
      NIL)

(DEFN AK-CLEAR-INPUT-INTERRUPT
      (ID IPORTS)
      (TM-CLEAR-INPUT-INTERRUPT ID IPORTS)
      NIL)

(DEFN AK-CLEAR-OUTPUT-INTERRUPT
      (ID OPORTS)
      (TM-CLEAR-OUTPUT-INTERRUPT ID OPORTS)
      NIL)

(DEFN AK-START-OUTPUT
      (CHAR ID OPORTS)
      (TM-START-OUTPUT CHAR ID OPORTS)
      NIL)

(DEFN AK-INPUT-INTERRUPTP
      (AK)
      (TM-SOME-INPUT-INTERRUPTP (AK-IPORTS AK))
      NIL)

(DEFN AK-OUTPUT-INTERRUPTP
      (AK)
      (TM-SOME-OUTPUT-INTERRUPTP (AK-OPORTS AK))
      NIL)

(DEFN AK-INTERRUPTING-INPUT-PORT
      (IPORTS)
      (TM-INTERRUPTING-INPUT-PORT IPORTS)
      NIL)

(DEFN AK-INTERRUPTING-OUTPUT-PORT
      (OPORTS)
      (TM-INTERRUPTING-OUTPUT-PORT OPORTS)
      NIL)

(DEFN AK-STATUS-FLAG-FIELD NIL '0
      NIL)

(DEFN AK-STATUS-TASKID-FIELD NIL '1
      NIL)

(DEFN AK-READY-STATUS NIL '0 NIL)

(DEFN AK-ERROR-STATUS NIL '1 NIL)

(DEFN AK-SEND-STATUS NIL '2 NIL)

(DEFN AK-RECEIVE-STATUS NIL '3 NIL)

(DEFN AK-OUTPUT-STATUS NIL '4 NIL)

(DEFN AK-INPUT-STATUS NIL '5 NIL)

(DEFN AK-STATUS-LUB NIL '6 NIL)

(DEFN AK-STATUS-LENGTH NIL '2 NIL)

(DEFN AK-READY-STATUSP
      (TASKID AK)
      (EQUAL (GETNTH '0
                     (GETNTH TASKID (AK-STATUS AK)))
             '0)
      NIL)

(DEFN AK-WAITING-TO-SENDP
      (SRCID DESTID AK)
      (AND (EQUAL (GETNTH '0
                          (GETNTH SRCID (AK-STATUS AK)))
                  '2)
           (EQUAL (GETNTH '1
                          (GETNTH SRCID (AK-STATUS AK)))
                  DESTID))
      NIL)

(DEFN AK-WAITING-TO-RECEIVEP
      (SRCID DESTID AK)
      (AND (EQUAL (GETNTH '0
                          (GETNTH DESTID (AK-STATUS AK)))
                  '3)
           (EQUAL (GETNTH '1
                          (GETNTH DESTID (AK-STATUS AK)))
                  SRCID))
      NIL)

(DEFN AK-WAITING-TO-OUTPUTP
      (ID AK)
      (EQUAL (GETNTH '0
                     (GETNTH ID (AK-STATUS AK)))
             '4)
      NIL)

(DEFN AK-WAITING-TO-INPUTP
      (ID AK)
      (EQUAL (GETNTH '0
                     (GETNTH ID (AK-STATUS AK)))
             '5)
      NIL)

(DEFN AK-WAIT-STATE NIL '1 NIL)

(DEFN AK-RUN-STATE NIL '0 NIL)

(DEFN AK-WAITING
      (AK)
      (EQUAL (AK-RWSTATE AK) '1)
      NIL)

(DEFN AK-DISPATCHER
      (AK)
      (AK (AK-PSTATES AK)
          (AK-IBUFFERS AK)
          (AK-OBUFFERS AK)
          (AK-MBUFFERS AK)
          (AK-READYQ AK)
          (AK-STATUS AK)
          (IF (QEMPTYP (AK-READYQ AK)) '1 '0)
          (IF (QEMPTYP (AK-READYQ AK))
              (AK-CLOCK AK)
              '1000)
          (AK-IPORTS AK)
          (AK-OPORTS AK))
      NIL)

(DEFN AK-CLOCK-INTERRUPT-HANDLER
      (AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (ENQ (AK-TASKID AK)
                              (DEQ (AK-READYQ AK)))
                         (AK-STATUS AK)
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-ERROR-HANDLER
      (AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (DEQ (AK-READYQ AK))
                         (PUTNTH '(1 0)
                                 (AK-TASKID AK)
                                 (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-BLOCK-SEND
      (SRCID DESTID AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (DEQ (AK-READYQ AK))
                         (PUTNTH (CONS '2 (CONS DESTID 'NIL))
                                 SRCID
                                 (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-EXECUTE-SEND-TO-BUFFER
      (MSG SRCID DESTID AK)
      (AK (AK-UPDATE-CONTROL SRCID
                             (AK-PSTATES AK))
          (AK-IBUFFERS AK)
          (AK-OBUFFERS AK)
          (ENQ2 MSG SRCID DESTID
                (AK-MBUFFERS AK))
          (IF (AK-WAITING-TO-RECEIVEP SRCID DESTID AK)
              (ENQ DESTID (AK-READYQ AK))
              (AK-READYQ AK))
          (IF (AK-WAITING-TO-RECEIVEP SRCID DESTID AK)
              (PUTNTH '(0 0) DESTID (AK-STATUS AK))
              (AK-STATUS AK))
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (AK-IPORTS AK)
          (AK-OPORTS AK))
      NIL)

(DEFN AK-EXECUTE-SEND
      (MSG SRCID DESTID AK)
      (IF (QFULLP2 SRCID DESTID
                   (AK-MBUFFERS AK)
                   '4)
          (AK-BLOCK-SEND SRCID DESTID AK)
          (AK-EXECUTE-SEND-TO-BUFFER MSG SRCID DESTID AK))
      NIL)

(DEFN AK-BLOCK-RECEIVE
      (SRCID DESTID AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (DEQ (AK-READYQ AK))
                         (PUTNTH (CONS '3 (CONS SRCID 'NIL))
                                 DESTID
                                 (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-EXECUTE-RECEIVE-FROM-BUFFER
      (SRCID DESTID AK)
      (AK (AK-UPDATE-CONTROL DESTID
                             (AK-STORE-MESSAGE (QFIRST2 SRCID DESTID
                                                        (AK-MBUFFERS AK))
                                               DESTID
                                               (AK-PSTATES AK)))
          (AK-IBUFFERS AK)
          (AK-OBUFFERS AK)
          (DEQ2 SRCID DESTID (AK-MBUFFERS AK))
          (IF (AK-WAITING-TO-SENDP SRCID DESTID AK)
              (ENQ SRCID (AK-READYQ AK))
              (AK-READYQ AK))
          (IF (AK-WAITING-TO-SENDP SRCID DESTID AK)
              (PUTNTH '(0 0) SRCID (AK-STATUS AK))
              (AK-STATUS AK))
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (AK-IPORTS AK)
          (AK-OPORTS AK))
      NIL)

(DEFN AK-EXECUTE-RECEIVE
      (SRCID DESTID AK)
      (IF (QEMPTYP2 SRCID DESTID
                    (AK-MBUFFERS AK))
          (AK-BLOCK-RECEIVE SRCID DESTID AK)
          (AK-EXECUTE-RECEIVE-FROM-BUFFER SRCID DESTID AK))
      NIL)

(DEFN AK-BLOCK-OUTPUT
      (ID AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (DEQ (AK-READYQ AK))
                         (PUTNTH '(4 0) ID (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-EXECUTE-OUTPUT-TO-BUFFER
      (CHAR ID AK)
      (AK (AK-UPDATE-CONTROL ID (AK-PSTATES AK))
          (AK-IBUFFERS AK)
          (ENQ-ITH-BUFFER CHAR ID
                          (AK-OBUFFERS AK))
          (AK-MBUFFERS AK)
          (AK-READYQ AK)
          (AK-STATUS AK)
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (AK-IPORTS AK)
          (IF (AK-OPORT-IDLEP ID (AK-OPORTS AK))
              (AK-POST-OUTPUT-INTERRUPT ID
                                        (AK-OPORTS AK))
              (AK-OPORTS AK)))
      NIL)

(DEFN AK-EXECUTE-OUTPUT
      (CHAR ID AK)
      (IF (QFULLP (GETNTH ID (AK-OBUFFERS AK))
                  '4)
          (AK-BLOCK-OUTPUT ID AK)
          (AK-EXECUTE-OUTPUT-TO-BUFFER CHAR ID AK))
      NIL)

(DEFN AK-BLOCK-INPUT
      (ID AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-IBUFFERS AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (DEQ (AK-READYQ AK))
                         (PUTNTH '(5 0) ID (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-IPORTS AK)
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-EXECUTE-INPUT-FROM-BUFFER
 (ID AK)
 (AK (AK-UPDATE-CONTROL ID
                        (AK-STORE-MESSAGE (QFIRST (GETNTH ID (AK-IBUFFERS AK)))
                                          ID
                                          (AK-PSTATES AK)))
     (PUTNTH (DEQ (GETNTH ID (AK-IBUFFERS AK)))
             ID
             (AK-IBUFFERS AK))
     (AK-OBUFFERS AK)
     (AK-MBUFFERS AK)
     (AK-READYQ AK)
     (AK-STATUS AK)
     (AK-RWSTATE AK)
     (AK-CLOCK AK)
     (AK-IPORTS AK)
     (AK-OPORTS AK))
 NIL)

(DEFN AK-EXECUTE-INPUT
      (ID AK)
      (IF (QEMPTYP (GETNTH ID (AK-IBUFFERS AK)))
          (AK-BLOCK-INPUT ID AK)
          (AK-EXECUTE-INPUT-FROM-BUFFER ID AK))
      NIL)

(DEFN AK-SVC-HANDLER
      (AK)
      (IF (AK-SEND-INSTRUCTIONP AK)
          (AK-EXECUTE-SEND (AK-MESSAGE AK)
                           (AK-TASKID AK)
                           (AK-DESTID AK)
                           AK)
          (IF (AK-RECEIVE-INSTRUCTIONP AK)
              (AK-EXECUTE-RECEIVE (AK-SRCID AK)
                                  (AK-TASKID AK)
                                  AK)
              (IF (AK-TYO-INSTRUCTIONP AK)
                  (AK-EXECUTE-OUTPUT (AK-MESSAGE AK)
                                     (AK-TASKID AK)
                                     AK)
                  (AK-EXECUTE-INPUT (AK-TASKID AK)
                                    AK))))
      NIL)

(DEFN AK-PRIVATE-STEP
      (AK)
      (AK (AK-FETCH-EXECUTE (AK-TASKID AK)
                            (AK-PSTATES AK))
          (AK-IBUFFERS AK)
          (AK-OBUFFERS AK)
          (AK-MBUFFERS AK)
          (AK-READYQ AK)
          (AK-STATUS AK)
          (AK-RWSTATE AK)
          (SUB1 (AK-CLOCK AK))
          (AK-IPORTS AK)
          (AK-OPORTS AK))
      NIL)

(DEFN AK-UPDATE-IBUFFER
 (ID AK)
 (IF
  (QFULLP (GETNTH ID (AK-IBUFFERS AK))
          '4)
  (QREPLACE-ITH-BUFFER (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                       ID
                       (AK-IBUFFERS AK))
  (IF (TM-IPORT-ERRORP ID (AK-IPORTS AK))
      (ENQ-ITH-BUFFER (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                      ID
                      (AK-IBUFFERS AK))
      (ENQ-ITH-BUFFER (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))
                      ID
                      (AK-IBUFFERS AK))))
 NIL)

(DEFN AK-WAITING-INPUT-INTERRUPT-HANDLER
      (ID AK)
      (AK-DISPATCHER (AK (AK-PSTATES AK)
                         (AK-UPDATE-IBUFFER ID AK)
                         (AK-OBUFFERS AK)
                         (AK-MBUFFERS AK)
                         (IF (AK-WAITING-TO-INPUTP ID AK)
                             (ENQ ID (AK-READYQ AK))
                             (AK-READYQ AK))
                         (IF (AK-WAITING-TO-INPUTP ID AK)
                             (PUTNTH '(0 0) ID (AK-STATUS AK))
                             (AK-STATUS AK))
                         (AK-RWSTATE AK)
                         (AK-CLOCK AK)
                         (AK-CLEAR-INPUT-INTERRUPT ID
                                                   (AK-IPORTS AK))
                         (AK-OPORTS AK)))
      NIL)

(DEFN AK-RUNNING-INPUT-INTERRUPT-HANDLER
      (ID AK)
      (AK (AK-PSTATES AK)
          (AK-UPDATE-IBUFFER ID AK)
          (AK-OBUFFERS AK)
          (AK-MBUFFERS AK)
          (IF (AK-WAITING-TO-INPUTP ID AK)
              (ENQ ID (AK-READYQ AK))
              (AK-READYQ AK))
          (IF (AK-WAITING-TO-INPUTP ID AK)
              (PUTNTH '(0 0) ID (AK-STATUS AK))
              (AK-STATUS AK))
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (AK-CLEAR-INPUT-INTERRUPT ID
                                    (AK-IPORTS AK))
          (AK-OPORTS AK))
      NIL)

(DEFN AK-INPUT-INTERRUPT-HANDLER
      (ID AK)
      (IF (AK-WAITING AK)
          (AK-WAITING-INPUT-INTERRUPT-HANDLER ID AK)
          (AK-RUNNING-INPUT-INTERRUPT-HANDLER ID AK))
      NIL)

(DEFN AK-WAITING-OUTPUT-INTERRUPT-HANDLER
  (ID AK)
  (AK-DISPATCHER (AK (AK-PSTATES AK)
                     (AK-IBUFFERS AK)
                     (IF (QEMPTYP (GETNTH ID (AK-OBUFFERS AK)))
                         (AK-OBUFFERS AK)
                         (DEQ-ITH-BUFFER ID (AK-OBUFFERS AK)))
                     (AK-MBUFFERS AK)
                     (IF (AK-WAITING-TO-OUTPUTP ID AK)
                         (ENQ ID (AK-READYQ AK))
                         (AK-READYQ AK))
                     (IF (AK-WAITING-TO-OUTPUTP ID AK)
                         (PUTNTH '(0 0) ID (AK-STATUS AK))
                         (AK-STATUS AK))
                     (AK-RWSTATE AK)
                     (AK-CLOCK AK)
                     (AK-IPORTS AK)
                     (IF (QEMPTYP (GETNTH ID (AK-OBUFFERS AK)))
                         (AK-CLEAR-OUTPUT-INTERRUPT ID
                                                    (AK-OPORTS AK))
                         (AK-START-OUTPUT (QFIRST (GETNTH ID (AK-OBUFFERS AK)))
                                          ID
                                          (AK-OPORTS AK)))))
  NIL)

(DEFN AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
      (ID AK)
      (AK (AK-PSTATES AK)
          (AK-IBUFFERS AK)
          (IF (QEMPTYP (GETNTH ID (AK-OBUFFERS AK)))
              (AK-OBUFFERS AK)
              (DEQ-ITH-BUFFER ID (AK-OBUFFERS AK)))
          (AK-MBUFFERS AK)
          (IF (AK-WAITING-TO-OUTPUTP ID AK)
              (ENQ ID (AK-READYQ AK))
              (AK-READYQ AK))
          (IF (AK-WAITING-TO-OUTPUTP ID AK)
              (PUTNTH '(0 0) ID (AK-STATUS AK))
              (AK-STATUS AK))
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (AK-IPORTS AK)
          (IF (QEMPTYP (GETNTH ID (AK-OBUFFERS AK)))
              (AK-CLEAR-OUTPUT-INTERRUPT ID
                                         (AK-OPORTS AK))
              (AK-START-OUTPUT (QFIRST (GETNTH ID (AK-OBUFFERS AK)))
                               ID
                               (AK-OPORTS AK))))
      NIL)

(DEFN AK-OUTPUT-INTERRUPT-HANDLER
      (ID AK)
      (IF (AK-WAITING AK)
          (AK-WAITING-OUTPUT-INTERRUPT-HANDLER ID AK)
          (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER ID AK))
      NIL)

(DEFN AK-CLOCK-INTERRUPTP
      (AK)
      (ZEROP (AK-CLOCK AK))
      NIL)

(DEFN AK-STEP
 (AK)
 (IF
  (AK-INPUT-INTERRUPTP AK)
  (AK-INPUT-INTERRUPT-HANDLER (AK-INTERRUPTING-INPUT-PORT (AK-IPORTS AK))
                              AK)
  (IF (AK-OUTPUT-INTERRUPTP AK)
      (AK-OUTPUT-INTERRUPT-HANDLER (AK-INTERRUPTING-OUTPUT-PORT (AK-OPORTS AK))
                                   AK)
      (IF (AK-WAITING AK)
          AK
          (IF (AK-ERRORP AK)
              (AK-ERROR-HANDLER AK)
              (IF (AK-CLOCK-INTERRUPTP AK)
                  (AK-CLOCK-INTERRUPT-HANDLER AK)
                  (IF (AK-SVC-INTERRUPTP AK)
                      (AK-SVC-HANDLER AK)
                      (AK-PRIVATE-STEP AK)))))))
 NIL)

(DEFN AK-POST-INTERRUPT
      (INTERRUPT AK)
      (AK (AK-PSTATES AK)
          (AK-IBUFFERS AK)
          (AK-OBUFFERS AK)
          (AK-MBUFFERS AK)
          (AK-READYQ AK)
          (AK-STATUS AK)
          (AK-RWSTATE AK)
          (AK-CLOCK AK)
          (IF (TM-DEVICE-INPUT-EVENTP INTERRUPT)
              (TM-POST-INPUT-INTERRUPT (REMAINDER (TM-IDATUM INTERRUPT)
                                                  '256)
                                       (REMAINDER (TM-IDEVID INTERRUPT) '16)
                                       (AK-IPORTS AK))
              (AK-IPORTS AK))
          (IF (TM-DEVICE-OUTPUT-EVENTP INTERRUPT)
              (TM-POST-OUTPUT-INTERRUPT (REMAINDER (TM-ODEVID INTERRUPT) '16)
                                        (AK-OPORTS AK))
              (AK-OPORTS AK)))
      NIL)

(DEFN AK-PROCESSOR
      (AK ORACLE)
      (IF (LISTP ORACLE)
          (AK-PROCESSOR (AK-STEP (AK-POST-INTERRUPT (CAR ORACLE) AK))
                        (CDR ORACLE))
          AK)
      NIL)

(PROVE-LEMMA GOOD-TM-IPORT-ARRAY-PUTNTH1
            (REWRITE)
            (IMPLIES (AND (GOOD-TM-IPORT-ARRAY L)
                          (AND (TM-IPORTP IPORT)
                               (AND (FINITE-NUMBERP (TM-IINTERRUPT-FLAG IPORT)
                                                    '2)
                                    (AND (FINITE-NUMBERP (TM-IERROR-FLAG IPORT)
                                                         '2)
                                         (FINITE-NUMBERP (TM-ICHAR IPORT)
                                                         '256)))))
                     (GOOD-TM-IPORT-ARRAY (PUTNTH IPORT N L)))
            ((ENABLE GOOD-TM-IPORT-ARRAY PUTNTH GOOD-TM-IPORT)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-ARRAY-PUTNTH1)

(PROVE-LEMMA GOOD-TM-OPORT-ARRAY-PUTNTH1
             (REWRITE)
             (IMPLIES (AND (GOOD-TM-OPORT-ARRAY L)
                           (AND (TM-OPORTP OPORT)
                                (AND (FINITE-NUMBERP (TM-OINTERRUPT-FLAG OPORT)
                                                     '2)
                                     (AND (FINITE-NUMBERP (TM-OBUSY-FLAG OPORT)
                                                          '2)
                                          (FINITE-NUMBERP (TM-OCHAR OPORT)
                                                          '256)))))
                      (GOOD-TM-OPORT-ARRAY (PUTNTH OPORT N L)))
             ((ENABLE GOOD-TM-OPORT-ARRAY PUTNTH GOOD-TM-OPORT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-ARRAY-PUTNTH1)

(DEFN GOOD-ADDRESS-SPACE-LIST
      (L)
      (IF (LISTP L)
          (AND (GOOD-ADDRESS-SPACE (CAR L)
                                   (LENGTH (TM-MEMORY (CAR L))))
               (GOOD-ADDRESS-SPACE-LIST (CDR L)))
          (EQUAL L 'NIL))
      NIL)

(PROVE-LEMMA PLISTP-GOOD-ADDRESS-SPACE-LIST
             (REWRITE)
             (IMPLIES (GOOD-ADDRESS-SPACE-LIST L)
                      (PLISTP L))
             ((ENABLE GOOD-ADDRESS-SPACE-LIST PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GOOD-ADDRESS-SPACE-LIST)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE-LIST L)
                           (LESSP I (LENGTH L)))
                      (GOOD-ADDRESS-SPACE (GETNTH I L)
                                          (LENGTH (TM-MEMORY (GETNTH I L)))))
             ((ENABLE GOOD-ADDRESS-SPACE-LIST GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-GETNTH)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-LIST-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-ADDRESS-SPACE-LIST L)
                           (GOOD-ADDRESS-SPACE TASK
                                               (LENGTH (TM-MEMORY TASK))))
                      (GOOD-ADDRESS-SPACE-LIST (PUTNTH TASK I L)))
             ((ENABLE GOOD-ADDRESS-SPACE-LIST PUTNTH LENGTH
                      LENGTH-ADDRESS-SPACE-MEMORY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-LIST-PUTNTH)

(DEFN GOOD-STATUS
      (TASK-STATUS)
      (AND (PLISTP TASK-STATUS)
           (AND (EQUAL (LENGTH TASK-STATUS) '2)
                (AND (FINITE-NUMBERP (GETNTH '0 TASK-STATUS)
                                     '6)
                     (FINITE-NUMBERP (GETNTH '1 TASK-STATUS)
                                     '16))))
      NIL)

(DEFN GOOD-STATUS-LIST
      (STATUS)
      (IF (LISTP STATUS)
          (AND (GOOD-STATUS (CAR STATUS))
               (GOOD-STATUS-LIST (CDR STATUS)))
          (EQUAL STATUS 'NIL))
      NIL)

(PROVE-LEMMA PLISTP-GOOD-STATUS-LIST
             (REWRITE)
             (IMPLIES (GOOD-STATUS-LIST L)
                      (PLISTP L))
             ((ENABLE GOOD-STATUS-LIST PLISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-GOOD-STATUS-LIST)

(PROVE-LEMMA GOOD-STATUS-GETNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-STATUS-LIST L)
                           (LESSP I (LENGTH L)))
                      (GOOD-STATUS (GETNTH I L)))
             ((ENABLE GOOD-STATUS-LIST GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-GETNTH)

(PROVE-LEMMA GOOD-STATUS-LIST-PUTNTH
             (REWRITE)
             (IMPLIES (AND (GOOD-STATUS-LIST L)
                           (AND (PLISTP STATUS)
                                (AND (EQUAL (LENGTH STATUS) '2)
                                     (AND (FINITE-NUMBERP (GETNTH '0 STATUS)
                                                          '6)
                                          (FINITE-NUMBERP (GETNTH '1 STATUS)
                                                          '16)))))
                      (GOOD-STATUS-LIST (PUTNTH STATUS I L)))
             ((ENABLE GOOD-STATUS GOOD-STATUS-LIST PUTNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-PUTNTH)

(DEFTHEORY
          GOOD-AK-CONSTRUCTION
          (GOOD-TASK-BUFFER-TABLE-PUTNTH2 GOOD-TASK-BUFFER-TABLE-PUTNTH
                                          GOOD-TASK-BUFFER-GETNTH2
                                          GOOD-TASK-BUFFER-LIST-GETNTH
                                          GOOD-TASK-BUFFER-LIST-PUTNTH
                                          PLISTP-GOOD-TASK-BUFFER-LIST
                                          GOOD-TASK-BUFFER-GETNTH
                                          GOOD-STATUS-LIST-PUTNTH
                                          GOOD-STATUS-GETNTH
                                          PLISTP-GOOD-STATUS-LIST
                                          GOOD-TM-IPORT-GETNTH
                                          GOOD-TM-OPORT-GETNTH
                                          GOOD-TM-IPORT-ARRAY-PUTNTH1
                                          GOOD-TM-OPORT-ARRAY-PUTNTH1
                                          GOOD-ADDRESS-SPACE-GETNTH
                                          GOOD-ADDRESS-SPACE-LIST-PUTNTH
                                          PLISTP-GOOD-ADDRESS-SPACE-LIST
                                          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                                          LENGTH-PUTNTH LENGTH-PUTNTH2
                                          PLISTP-PUTNTH PLISTP-PUTNTH2))

(DEFN STATUS-FLAG-READYP
      (TASK-STATUS)
      (EQUAL (GETNTH '0 TASK-STATUS) '0)
      NIL)

(DEFN INDEX-READY-SET
      (N STATUS)
      (IF (LISTP STATUS)
          (IF (STATUS-FLAG-READYP (CAR STATUS))
              (CONS (FIX N)
                    (INDEX-READY-SET (ADD1 N)
                                     (CDR STATUS)))
              (INDEX-READY-SET (ADD1 N)
                               (CDR STATUS)))
          'NIL)
      NIL)

(DEFN AK-READY-SET
      (AK)
      (INDEX-READY-SET '0 (AK-STATUS AK))
      NIL)

(DEFN GOOD-AK
 (AK)
 (AND
  (AK-SHELLP AK)
  (AND
   (EQUAL (LENGTH (AK-PSTATES AK)) '16)
   (AND
    (GOOD-ADDRESS-SPACE-LIST (AK-PSTATES AK))
    (AND
     (EQUAL (LENGTH (AK-IBUFFERS AK)) '16)
     (AND
      (GOOD-TASK-BUFFER-LIST (AK-IBUFFERS AK)
                             '4)
      (AND
       (EQUAL (LENGTH (AK-OBUFFERS AK)) '16)
       (AND
        (GOOD-TASK-BUFFER-LIST (AK-OBUFFERS AK)
                               '4)
        (AND
         (EQUAL (LENGTH (AK-MBUFFERS AK)) '16)
         (AND
          (GOOD-TASK-BUFFER-TABLE (AK-MBUFFERS AK)
                                  '16
                                  '4)
          (AND
           (PLISTP (AK-READYQ AK))
           (AND
            (LESSP (LENGTH (AK-READYQ AK)) '17)
            (AND
             (FINITE-NUMBER-LISTP (AK-READYQ AK)
                                  '16)
             (AND
              (EQUAL (LENGTH (AK-STATUS AK)) '16)
              (AND
               (GOOD-STATUS-LIST (AK-STATUS AK))
               (AND
                (FINITE-NUMBERP (AK-RWSTATE AK) '2)
                (AND
                 (FINITE-NUMBERP (AK-CLOCK AK) '65536)
                 (AND
                  (PLISTP (AK-IPORTS AK))
                  (AND
                   (EQUAL (LENGTH (AK-IPORTS AK)) '16)
                   (AND
                    (GOOD-TM-IPORT-ARRAY (AK-IPORTS AK))
                    (AND
                     (PLISTP (AK-OPORTS AK))
                     (AND
                      (EQUAL (LENGTH (AK-OPORTS AK)) '16)
                      (AND
                       (GOOD-TM-OPORT-ARRAY (AK-OPORTS AK))
                       (AND
                          (PERMUTATION (AK-READYQ AK)
                                       (AK-READY-SET AK))
                          (IFF (AK-WAITING AK)
                               (QEMPTYP (AK-READYQ AK))))))))))))))))))))))))))
 NIL)

(PROVE-LEMMA AK-SHELLP-AK
             (REWRITE)
             (IMPLIES (GOOD-AK AK) (AK-SHELLP AK))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-SHELLP-AK)

(PROVE-LEMMA LENGTH-AK-PSTATES
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-PSTATES AK)) '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-LIST-AK-PSTATES
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-ADDRESS-SPACE-LIST (AK-PSTATES AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-LIST-AK-PSTATES)

(PROVE-LEMMA
 GOOD-ADDRESS-SPACE-GETNTH-FROM-AK
 (REWRITE)
 (IMPLIES (AND (GOOD-AK AK) (LESSP I '16))
          (GOOD-ADDRESS-SPACE (GETNTH I (AK-PSTATES AK))
                              (LENGTH (TM-MEMORY (GETNTH I (AK-PSTATES AK))))))
 ((ENABLE GOOD-AK GOOD-ADDRESS-SPACE-GETNTH)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-GETNTH-FROM-AK)

(PROVE-LEMMA LENGTH-AK-IBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-IBUFFERS AK))
                             '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-IBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-AK-IBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-TASK-BUFFER-LIST (AK-IBUFFERS AK)
                                             '4))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-AK-IBUFFERS)

(PROVE-LEMMA PLISTP-AK-IBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-IBUFFERS AK)))
             ((ENABLE GOOD-TASK-BUFFER-LIST-AK-IBUFFERS)
              (USE (PLISTP-GOOD-TASK-BUFFER-LIST (L (AK-IBUFFERS AK))
                                                 (CAPACITY '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-IBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-GETNTH-FROM-AK-IBUFFERS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (FINITE-NUMBERP ID '16))
                      (GOOD-TASK-BUFFER (GETNTH ID (AK-IBUFFERS AK))
                                        '4))
             ((ENABLE GOOD-AK GOOD-TASK-BUFFER-GETNTH
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-GETNTH-FROM-AK-IBUFFERS)

(PROVE-LEMMA LENGTH-AK-OBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-OBUFFERS AK))
                             '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-OBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-AK-OBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-TASK-BUFFER-LIST (AK-OBUFFERS AK)
                                             '4))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-AK-OBUFFERS)

(PROVE-LEMMA PLISTP-AK-OBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-OBUFFERS AK)))
             ((ENABLE GOOD-TASK-BUFFER-LIST-AK-OBUFFERS)
              (USE (PLISTP-GOOD-TASK-BUFFER-LIST (L (AK-OBUFFERS AK))
                                                 (CAPACITY '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-OBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-GETNTH-FROM-AK-OBUFFERS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (FINITE-NUMBERP ID '16))
                      (GOOD-TASK-BUFFER (GETNTH ID (AK-OBUFFERS AK))
                                        '4))
             ((ENABLE GOOD-AK GOOD-TASK-BUFFER-GETNTH
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-GETNTH-FROM-AK-OBUFFERS)

(PROVE-LEMMA LENGTH-AK-MBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-MBUFFERS AK))
                             '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-MBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-TABLE-AK-MBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-TASK-BUFFER-TABLE (AK-MBUFFERS AK)
                                              '16
                                              '4))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-TABLE-AK-MBUFFERS)

(PROVE-LEMMA PLISTP-AK-MBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-MBUFFERS AK)))
             ((ENABLE GOOD-TASK-BUFFER-TABLE-AK-MBUFFERS)
              (USE (PLISTP-GOOD-TASK-BUFFER-TABLE (L (AK-MBUFFERS AK))
                                                  (LENGTH '16)
                                                  (CAPACITY '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-MBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-GETNTH2-FROM-AK-MBUFFERS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (LESSP I '16) (LESSP J '16)))
                      (GOOD-TASK-BUFFER (GETNTH2 I J (AK-MBUFFERS AK))
                                        '4))
             ((ENABLE GOOD-AK GOOD-TASK-BUFFER-LIST-GETNTH
                      GOOD-TASK-BUFFER-GETNTH2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-GETNTH2-FROM-AK-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBERP-AK-TASKID
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (FINITE-NUMBERP (AK-TASKID AK) '16))
             ((ENABLE GOOD-AK FINITE-NUMBERP-QFIRST AK-TASKID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-TASKID)

(PROVE-LEMMA PLISTP-AK-READYQ
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-READYQ AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-READYQ)

(PROVE-LEMMA LENGTH-AK-READYQ
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (LESSP (LENGTH (AK-READYQ AK)) '17))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-READYQ)

(PROVE-LEMMA FINITE-NUMBER-LISTP-AK-READYQ
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (FINITE-NUMBER-LISTP (AK-READYQ AK)
                                           '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-AK-READYQ)

(PROVE-LEMMA LENGTH-AK-STATUS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-STATUS AK)) '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-STATUS)

(PROVE-LEMMA GOOD-STATUS-LIST-AK-STATUS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-STATUS-LIST (AK-STATUS AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-AK-STATUS)

(PROVE-LEMMA PLISTP-AK-STATUS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-STATUS AK)))
             ((ENABLE GOOD-STATUS-LIST-AK-STATUS PLISTP-GOOD-STATUS-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-STATUS)

(PROVE-LEMMA GOOD-STATUS-GETNTH-FROM-AK-STATUS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK) (LESSP I '16))
                      (GOOD-STATUS (GETNTH I (AK-STATUS AK))))
             ((ENABLE GOOD-AK GOOD-STATUS-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-GETNTH-FROM-AK-STATUS)

(PROVE-LEMMA FINITE-NUMBERP-AK-RWSTATE
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (FINITE-NUMBERP (AK-RWSTATE AK) '2))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-RWSTATE)

(PROVE-LEMMA FINITE-NUMBERP-AK-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (FINITE-NUMBERP (AK-CLOCK AK)
                                      '65536))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-CLOCK)

(PROVE-LEMMA PLISTP-AK-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-IPORTS AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-IPORTS)

(PROVE-LEMMA LENGTH-AK-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-IPORTS AK)) '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-IPORTS)

(PROVE-LEMMA GOOD-TM-IPORT-ARRAY-AK-IPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-TM-IPORT-ARRAY (AK-IPORTS AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-ARRAY-AK-IPORTS)

(PROVE-LEMMA GOOD-TM-IPORT-GETNTH-FROM-AK-IPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK) (LESSP I '16))
                      (GOOD-TM-IPORT (GETNTH I (AK-IPORTS AK))))
             ((ENABLE GOOD-AK GOOD-TM-IPORT-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-GETNTH-FROM-AK-IPORTS)

(PROVE-LEMMA PLISTP-AK-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PLISTP (AK-OPORTS AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-AK-OPORTS)

(PROVE-LEMMA LENGTH-AK-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (EQUAL (LENGTH (AK-OPORTS AK)) '16))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-OPORTS)

(PROVE-LEMMA GOOD-TM-OPORT-ARRAY-AK-OPORTS
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-TM-OPORT-ARRAY (AK-OPORTS AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-ARRAY-AK-OPORTS)

(PROVE-LEMMA GOOD-TM-OPORT-GETNTH-FROM-AK-OPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK) (LESSP I '16))
                      (GOOD-TM-OPORT (GETNTH I (AK-OPORTS AK))))
             ((ENABLE GOOD-AK GOOD-TM-OPORT-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-GETNTH-FROM-AK-OPORTS)

(PROVE-LEMMA PERMUTATION-AK-READYQ-AK-READY-SET
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (PERMUTATION (AK-READYQ AK)
                                   (AK-READY-SET AK)))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-AK-READYQ-AK-READY-SET)

(PROVE-LEMMA AK-WAITING-IFF-QEMPTYP-AK-READYQ
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (IFF (AK-WAITING AK)
                           (QEMPTYP (AK-READYQ AK))))
             ((ENABLE GOOD-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-WAITING-IFF-QEMPTYP-AK-READYQ)

(DEFTHEORY
    GOOD-AK-PROPERTIES
    (AK-WAITING-IFF-QEMPTYP-AK-READYQ PERMUTATION-AK-READYQ-AK-READY-SET
                                      GOOD-TM-OPORT-GETNTH-FROM-AK-OPORTS
                                      GOOD-TM-OPORT-ARRAY-AK-OPORTS
                                      LENGTH-AK-OPORTS PLISTP-AK-OPORTS
                                      GOOD-TM-IPORT-GETNTH-FROM-AK-IPORTS
                                      GOOD-TM-IPORT-ARRAY-AK-IPORTS
                                      LENGTH-AK-IPORTS PLISTP-AK-IPORTS
                                      FINITE-NUMBERP-AK-CLOCK
                                      FINITE-NUMBERP-AK-RWSTATE
                                      GOOD-STATUS-GETNTH-FROM-AK-STATUS
                                      PLISTP-AK-STATUS
                                      GOOD-STATUS-LIST-AK-STATUS
                                      LENGTH-AK-STATUS
                                      FINITE-NUMBER-LISTP-AK-READYQ
                                      LENGTH-AK-READYQ PLISTP-AK-READYQ
                                      FINITE-NUMBERP-AK-TASKID
                                      GOOD-TASK-BUFFER-GETNTH2-FROM-AK-MBUFFERS
                                      PLISTP-AK-MBUFFERS
                                      PLISTP-GOOD-TASK-BUFFER-TABLE
                                      GOOD-TASK-BUFFER-TABLE-AK-MBUFFERS
                                      LENGTH-AK-MBUFFERS
                                      GOOD-TASK-BUFFER-GETNTH-FROM-AK-OBUFFERS
                                      PLISTP-AK-OBUFFERS
                                      GOOD-TASK-BUFFER-LIST-AK-OBUFFERS
                                      LENGTH-AK-OBUFFERS
                                      GOOD-TASK-BUFFER-GETNTH-FROM-AK-IBUFFERS
                                      PLISTP-AK-IBUFFERS
                                      GOOD-TASK-BUFFER-LIST-AK-IBUFFERS
                                      LENGTH-AK-IBUFFERS
                                      GOOD-ADDRESS-SPACE-GETNTH-FROM-AK
                                      GOOD-ADDRESS-SPACE-LIST-AK-PSTATES
                                      LENGTH-AK-PSTATES AK-SHELLP-AK))

(DEFTHEORY QUEUE-FACTS
           (NOT-QEMPTYP-ENQ NOT-QFULLP-DEQ LENGTH-ENQ LENGTH-DEQ
                            LENGTH-QREPLACE QFIRST-ENQ PLISTP-ENQ PLISTP-DEQ
                            PLISTP-QREPLACE FINITE-NUMBERP-QFIRST
                            FINITE-NUMBER-LISTP-ENQ FINITE-NUMBER-LISTP-DEQ
                            FINITE-NUMBER-LISTP-QREPLACE))

(PROVE-LEMMA NOT-MEMBER-INDEX-READY-SET
             (REWRITE)
             (IMPLIES (LESSP I N)
                      (NOT (MEMBER I
                                   (INDEX-READY-SET N STATUS))))
             ((ENABLE INDEX-READY-SET MEMBER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-MEMBER-INDEX-READY-SET)

(PROVE-LEMMA SETP-INDEX-READY-SET
             (REWRITE)
             (SETP (INDEX-READY-SET N STATUS))
             ((ENABLE SETP INDEX-READY-SET NOT-MEMBER-INDEX-READY-SET)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SETP-INDEX-READY-SET)

(DEFN SET-STATUS-INDUCTION
      (I N L)
      (IF (ZEROP I)
          '0
          (IF (LISTP L)
              (SET-STATUS-INDUCTION (SUB1 I)
                                    (ADD1 N)
                                    (CDR L))
              '0))
      NIL)

(PROVE-LEMMA INDEX-READY-SET-PUTNTH-UNREADY-STATUS
             (REWRITE)
             (IMPLIES (AND (LESSP I (LENGTH L))
                           (AND (STATUS-FLAG-READYP (GETNTH I L))
                                (NOT (STATUS-FLAG-READYP V))))
                      (EQUAL (INDEX-READY-SET N (PUTNTH V I L))
                             (REMOVE (PLUS N I)
                                     (INDEX-READY-SET N L))))
             ((ENABLE INDEX-READY-SET GETNTH PUTNTH REMOVE LENGTH PLUS-0
                      PLUS-RIGHT-ID2 PLUS-ADD1)
              (INDUCT (SET-STATUS-INDUCTION I N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE INDEX-READY-SET-PUTNTH-UNREADY-STATUS)

(PROVE-LEMMA
           NOT-STATUS-FLAG-READYP-LIST
           (REWRITE)
           (IMPLIES (NOT (EQUAL FLAG '0))
                    (NOT (STATUS-FLAG-READYP (CONS FLAG (CONS TASKID 'NIL)))))
           ((ENABLE STATUS-FLAG-READYP GETNTH)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE NOT-STATUS-FLAG-READYP-LIST)

(PROVE-LEMMA STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET1
             NIL
             (IMPLIES (LESSP I (LENGTH STATUS))
                      (EQUAL (STATUS-FLAG-READYP (GETNTH I STATUS))
                             (MEMBER (PLUS N I)
                                     (INDEX-READY-SET N STATUS))))
             ((ENABLE INDEX-READY-SET GETNTH PLUS-0 PLUS-RIGHT-ID2 PLUS-ADD1
                      NOT-MEMBER-INDEX-READY-SET LENGTH)
              (INDUCT (SET-STATUS-INDUCTION I N STATUS))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA
        STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET
        (REWRITE)
        (IMPLIES (AND (NUMBERP I)
                      (LESSP I (LENGTH STATUS)))
                 (EQUAL (STATUS-FLAG-READYP (GETNTH I STATUS))
                        (MEMBER I
                                (INDEX-READY-SET '0 STATUS))))
        ((USE (STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET1 (N '0)
                                                              (I I)
                                                              (STATUS STATUS)))
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET)

(PROVE-LEMMA STATUS-FLAG-READYP-GETNTH
             (REWRITE)
             (IMPLIES (AND (PERMUTATION QUEUE
                                        (INDEX-READY-SET '0 STATUS))
                           (AND (NOT (QEMPTYP QUEUE))
                                (AND (NUMBER-LISTP QUEUE)
                                     (LESSP (QFIRST QUEUE)
                                            (LENGTH STATUS)))))
                      (STATUS-FLAG-READYP (GETNTH (QFIRST QUEUE) STATUS)))
             ((ENABLE NUMBERP-QFIRST LENGTH MEMBER-QFIRST-QUEUE
                      COMMUTATIVITY-OF-PERMUTATION
                      STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET)
              (USE (MEMBER-PERMUTATION (A (INDEX-READY-SET '0 STATUS))
                                       (B QUEUE)
                                       (X (QFIRST QUEUE))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE STATUS-FLAG-READYP-GETNTH)

(PROVE-LEMMA
    PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
    (REWRITE)
    (IMPLIES (AND (PERMUTATION QUEUE
                               (INDEX-READY-SET '0 STATUS))
                  (AND (NUMBER-LISTP QUEUE)
                       (AND (PLISTP QUEUE)
                            (AND (NOT (QEMPTYP QUEUE))
                                 (AND (EQUAL TASKID (QFIRST QUEUE))
                                      (AND (NOT (EQUAL FLAG '0))
                                           (LESSP TASKID (LENGTH STATUS))))))))
             (PERMUTATION (DEQ QUEUE)
                          (INDEX-READY-SET '0
                                           (PUTNTH (CONS FLAG (CONS X 'NIL))
                                                   TASKID STATUS))))
    ((ENABLE QEMPTYP LENGTH NUMBERP-QFIRST DEQ-IS-REMOVE MEMBER-QFIRST-QUEUE
             NOT-STATUS-FLAG-READYP-LIST PERMUTATION-REMOVE-REMOVE
             INDEX-READY-SET-PUTNTH-UNREADY-STATUS SETP-INDEX-READY-SET
             STATUS-FLAG-READYP-GETNTH)
     (ENABLE-THEORY QUEUE-FACTS GROUND-ZERO)
     (USE (SETP-PERMUTATION (A QUEUE)
                            (B (INDEX-READY-SET '0 STATUS)))
          (MEMBER-PERMUTATION2 (X (QFIRST QUEUE))
                               (A (INDEX-READY-SET '0 STATUS))
                               (B QUEUE)))
     (DISABLE-THEORY T)))

(DISABLE PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)

(DEFN NUMBER-OF-READY-TASKS
      (STATUS)
      (IF (LISTP STATUS)
          (IF (STATUS-FLAG-READYP (CAR STATUS))
              (ADD1 (NUMBER-OF-READY-TASKS (CDR STATUS)))
              (NUMBER-OF-READY-TASKS (CDR STATUS)))
          '0)
      NIL)

(DEFN NUMBER-OF-UNREADY-TASKS
      (STATUS)
      (IF (LISTP STATUS)
          (IF (STATUS-FLAG-READYP (CAR STATUS))
              (NUMBER-OF-UNREADY-TASKS (CDR STATUS))
              (ADD1 (NUMBER-OF-UNREADY-TASKS (CDR STATUS))))
          '0)
      NIL)

(PROVE-LEMMA EQUAL-LENGTH-STATUS-SUM-OF-READY-AND-UNREADY-TASKS NIL
             (EQUAL (LENGTH STATUS)
                    (PLUS (NUMBER-OF-READY-TASKS STATUS)
                          (NUMBER-OF-UNREADY-TASKS STATUS)))
             ((ENABLE NUMBER-OF-READY-TASKS LENGTH NUMBER-OF-UNREADY-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-NUMBER-OF-READY-TASKS-LENGTH-STATUS
             NIL
             (IF (LESSP (LENGTH STATUS)
                        (NUMBER-OF-READY-TASKS STATUS))
                 '*1*FALSE
                 '*1*TRUE)
             ((ENABLE NUMBER-OF-READY-TASKS LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA NUMBER-OF-UNREADY-TASKS-NON-ZERO
             (REWRITE)
             (IMPLIES (AND (LESSP I (LENGTH STATUS))
                           (NOT (STATUS-FLAG-READYP (GETNTH I STATUS))))
                      (LESSP '0
                             (NUMBER-OF-UNREADY-TASKS STATUS)))
             ((ENABLE GETNTH LENGTH NUMBER-OF-UNREADY-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBER-OF-UNREADY-TASKS-NON-ZERO)

(PROVE-LEMMA
     NOT-EQUAL-NUMBER-OF-READY-TASKS-LENGTH-STATUS NIL
     (IMPLIES (AND (LESSP I (LENGTH STATUS))
                   (NOT (STATUS-FLAG-READYP (GETNTH I STATUS))))
              (NOT (EQUAL (NUMBER-OF-READY-TASKS STATUS)
                          (LENGTH STATUS))))
     ((USE (EQUAL-LENGTH-STATUS-SUM-OF-READY-AND-UNREADY-TASKS (STATUS STATUS))
           (NUMBER-OF-UNREADY-TASKS-NON-ZERO (I I)
                                             (STATUS STATUS)))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(PROVE-LEMMA
         LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS NIL
         (IMPLIES (AND (LESSP I (LENGTH STATUS))
                       (NOT (STATUS-FLAG-READYP (GETNTH I STATUS))))
                  (LESSP (NUMBER-OF-READY-TASKS STATUS)
                         (LENGTH STATUS)))
         ((USE (LEQ-NUMBER-OF-READY-TASKS-LENGTH-STATUS (STATUS STATUS))
               (NOT-EQUAL-NUMBER-OF-READY-TASKS-LENGTH-STATUS (I I)
                                                              (STATUS STATUS)))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(PROVE-LEMMA NUMBER-OF-READY-TASKS-EQUALS-LENGTH-INDEX-READY-SET
             NIL
             (EQUAL (NUMBER-OF-READY-TASKS STATUS)
                    (LENGTH (INDEX-READY-SET N STATUS)))
             ((ENABLE LENGTH NUMBER-OF-READY-TASKS INDEX-READY-SET)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA STATUS-FLAG-READYP-LIST
             (REWRITE)
             (STATUS-FLAG-READYP (CONS '0 (CONS X 'NIL)))
             ((ENABLE STATUS-FLAG-READYP GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE STATUS-FLAG-READYP-LIST)

(PROVE-LEMMA LESSP-CAR-INDEX-READY-SET
             NIL
             (IMPLIES (AND (LESSP I N)
                           (LISTP (INDEX-READY-SET N L)))
                      (LESSP I (CAR (INDEX-READY-SET N L))))
             ((ENABLE INDEX-READY-SET)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LESSP-CAR-INDEX-READY-SET-INSTANCE
             (REWRITE)
             (IMPLIES (LISTP (INDEX-READY-SET (ADD1 N) L))
                      (LESSP N
                             (CAR (INDEX-READY-SET (ADD1 N) L))))
             ((USE (LESSP-CAR-INDEX-READY-SET (I N)
                                              (N (ADD1 N))
                                              (L L)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-CAR-INDEX-READY-SET-INSTANCE)

(PROVE-LEMMA REWRITE-INSERT-TO-CONS-CROCK1
             NIL
             (IMPLIES (LISTP (INDEX-READY-SET (ADD1 N) Z))
                      (EQUAL (INSERT N
                                     (INDEX-READY-SET (ADD1 N) Z))
                             (CONS N
                                   (INDEX-READY-SET (ADD1 N) Z))))
             ((ENABLE LESSP-CAR-INDEX-READY-SET-INSTANCE)
              (EXPAND (INSERT N
                              (INDEX-READY-SET (ADD1 N) Z)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REWRITE-INSERT-TO-CONS-CROCK2
             NIL
             (IMPLIES (NOT (LISTP (INDEX-READY-SET (ADD1 N) Z)))
                      (EQUAL (INSERT N
                                     (INDEX-READY-SET (ADD1 N) Z))
                             (CONS N
                                   (INDEX-READY-SET (ADD1 N) Z))))
             ((EXPAND (INSERT N
                              (INDEX-READY-SET (ADD1 N) Z)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REWRITE-INSERT-TO-CONS-CROCK
             (REWRITE)
             (EQUAL (INSERT N
                            (INDEX-READY-SET (ADD1 N) Z))
                    (CONS N (INDEX-READY-SET (ADD1 N) Z)))
             ((USE (REWRITE-INSERT-TO-CONS-CROCK1 (N N)
                                                  (Z Z))
                   (REWRITE-INSERT-TO-CONS-CROCK2 (N N)
                                                  (Z Z)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-INSERT-TO-CONS-CROCK)

(PROVE-LEMMA INDEX-READY-SET-PUTNTH-READY-STATUS
             (REWRITE)
             (IMPLIES (AND (LESSP I (LENGTH L))
                           (AND (NOT (STATUS-FLAG-READYP (GETNTH I L)))
                                (STATUS-FLAG-READYP V)))
                      (EQUAL (INDEX-READY-SET N (PUTNTH V I L))
                             (INSERT (PLUS N I)
                                     (INDEX-READY-SET N L))))
             ((ENABLE INDEX-READY-SET GETNTH PUTNTH INSERT LENGTH PLUS-0
                      PLUS-RIGHT-ID2 PLUS-ADD1 REWRITE-INSERT-TO-CONS-CROCK)
              (INDUCT (SET-STATUS-INDUCTION I N L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE INDEX-READY-SET-PUTNTH-READY-STATUS)

(PROVE-LEMMA SORTED-INDEX-READY-SET
             (REWRITE)
             (SORTED (INDEX-READY-SET N L))
             ((ENABLE SORTED INDEX-READY-SET
                      LESSP-CAR-INDEX-READY-SET-INSTANCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE SORTED-INDEX-READY-SET)

(PROVE-LEMMA
       PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
       (REWRITE)
       (IMPLIES (AND (PERMUTATION QUEUE
                                  (INDEX-READY-SET '0 STATUS))
                     (AND (NOT (STATUS-FLAG-READYP (GETNTH TASKID STATUS)))
                          (AND (PLISTP QUEUE)
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID (LENGTH STATUS))))))
                (PERMUTATION (ENQ TASKID QUEUE)
                             (INDEX-READY-SET '0
                                              (PUTNTH (CONS '0 (CONS X 'NIL))
                                                      TASKID STATUS))))
       ((ENABLE QEMPTYP ENQ LENGTH NUMBERP-QFIRST STATUS-FLAG-READYP-LIST
                PERMUTATION-APPEND-INSERT INDEX-READY-SET-PUTNTH-READY-STATUS
                STATUS-FLAG-READYP-IFF-MEMBER-INDEX-READY-SET
                SETP-INDEX-READY-SET SORTED-INDEX-READY-SET)
        (USE (SETP-PERMUTATION (A QUEUE)
                               (B (INDEX-READY-SET '0 STATUS)))
             (NOT-MEMBER-PERMUTATION (X TASKID)
                                     (A QUEUE)
                                     (B (INDEX-READY-SET '0 STATUS))))
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH)

(PROVE-LEMMA
 NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ
 (REWRITE)
 (IMPLIES (PERMUTATION (AK-READYQ AK)
                       (AK-READY-SET AK))
          (EQUAL (NUMBER-OF-READY-TASKS (AK-STATUS AK))
                 (LENGTH (AK-READYQ AK))))
 ((ENABLE AK-READY-SET LENGTH)
  (USE
   (LENGTH-PERMUTATION (A (AK-READYQ AK))
                       (B (AK-READY-SET AK)))
   (NUMBER-OF-READY-TASKS-EQUALS-LENGTH-INDEX-READY-SET
                                                      (N '0)
                                                      (STATUS (AK-STATUS AK))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ)

(PROVE-LEMMA
     AK-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL NIL
     (IMPLIES (AND (GOOD-AK AK)
                   (AND (AK-WAITING-TO-SENDP SRCID DESTID AK)
                        (FINITE-NUMBERP SRCID '16)))
              (NOT (QFULLP (AK-READYQ AK) '16)))
     ((ENABLE GOOD-AK AK-WAITING-TO-SENDP QFULLP FINITE-NUMBERP AK-READY-SET
              STATUS-FLAG-READYP NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ)
      (USE (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS (I SRCID)
                                                      (STATUS (AK-STATUS AK))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(PROVE-LEMMA
     AK-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL NIL
     (IMPLIES (AND (GOOD-AK AK)
                   (AND (AK-WAITING-TO-RECEIVEP SRCID DESTID AK)
                        (FINITE-NUMBERP DESTID '16)))
              (NOT (QFULLP (AK-READYQ AK) '16)))
     ((ENABLE GOOD-AK AK-WAITING-TO-RECEIVEP QFULLP FINITE-NUMBERP
              AK-READY-SET STATUS-FLAG-READYP
              NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ)
      (USE (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS (I DESTID)
                                                      (STATUS (AK-STATUS AK))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(PROVE-LEMMA
     AK-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL NIL
     (IMPLIES (AND (GOOD-AK AK)
                   (AND (AK-WAITING-TO-OUTPUTP ID AK)
                        (FINITE-NUMBERP ID '16)))
              (NOT (QFULLP (AK-READYQ AK) '16)))
     ((ENABLE GOOD-AK AK-WAITING-TO-OUTPUTP QFULLP FINITE-NUMBERP AK-READY-SET
              STATUS-FLAG-READYP NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ)
      (USE (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS (I ID)
                                                      (STATUS (AK-STATUS AK))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(PROVE-LEMMA
     AK-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL NIL
     (IMPLIES (AND (GOOD-AK AK)
                   (AND (AK-WAITING-TO-INPUTP ID AK)
                        (FINITE-NUMBERP ID '16)))
              (NOT (QFULLP (AK-READYQ AK) '16)))
     ((ENABLE GOOD-AK AK-WAITING-TO-INPUTP QFULLP FINITE-NUMBERP AK-READY-SET
              STATUS-FLAG-READYP NUMBER-OF-READY-TASKS-EQUALS-LENGTH-AK-READYQ)
      (USE (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS (I ID)
                                                      (STATUS (AK-STATUS AK))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-ERROR-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (GOOD-AK (AK-ERROR-HANDLER AK)))
             ((ENABLE FINITE-NUMBERP GETNTH PLISTP LENGTH GOOD-AK
                      AK-ERROR-HANDLER AK-DISPATCHER AK-WAITING AK-READY-SET
                      AK-TASKID PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)
              (USE (NUMBER-LISTP-FINITE-NUMBER-LISTP (L (AK-READYQ AK))
                                                     (LUB '16)))
              (ENABLE-THEORY QUEUE-FACTS AK-SHELL GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-ERROR-HANDLER)

(PROVE-LEMMA GOOD-AK-AK-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (GOOD-AK (AK-CLOCK-INTERRUPT-HANDLER AK)))
             ((ENABLE GOOD-AK AK-CLOCK-INTERRUPT-HANDLER AK-DISPATCHER
                      FINITE-NUMBERP AK-WAITING AK-READY-SET AK-TASKID
                      PERMUTATION-ENQ-DEQ)
              (ENABLE-THEORY QUEUE-FACTS AK-SHELL GROUND-ZERO)
              (USE (TRANSITIVITY-OF-PERMUTATION (A (ENQ (QFIRST (AK-READYQ AK))
                                                        (DEQ (AK-READYQ AK))))
                                                (B (AK-READYQ AK))
                                                (C (AK-READY-SET AK))))
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-AK-AK-BLOCK-SEND
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (AND (EQUAL SRCID (AK-TASKID AK))
                                     (FINITE-NUMBERP DESTID '16))))
                      (GOOD-AK (AK-BLOCK-SEND SRCID DESTID AK)))
             ((ENABLE FINITE-NUMBERP GETNTH PLISTP LENGTH GOOD-AK
                      AK-DISPATCHER AK-BLOCK-SEND PLISTP OPEN-UP-GETNTH
                      OPEN-UP-GETNTH-ON-ZERO AK-WAITING AK-READY-SET AK-TASKID
                      PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)
              (USE (NUMBER-LISTP-FINITE-NUMBER-LISTP (L (AK-READYQ AK))
                                                     (LUB '16)))
              (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-BLOCK-SEND)

(PROVE-LEMMA
            AK-WAITING-TO-RECEIVEP-IMPLIES-NOT-STATUS-FLAG-READYP NIL
            (IMPLIES (AK-WAITING-TO-RECEIVEP SRCID DESTID AK)
                     (NOT (STATUS-FLAG-READYP (GETNTH DESTID (AK-STATUS AK)))))
            ((ENABLE AK-WAITING-TO-RECEIVEP STATUS-FLAG-READYP)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-EXECUTE-SEND-TO-BUFFER
   (REWRITE)
   (IMPLIES (AND (GOOD-AK AK)
                 (AND (NOT (AK-WAITING AK))
                      (AND (NOT (QFULLP2 SRCID DESTID
                                         (AK-MBUFFERS AK)
                                         '4))
                           (AND (FINITE-NUMBERP SRCID '16)
                                (AND (FINITE-NUMBERP DESTID '16)
                                     (FINITE-NUMBERP MSG '65536))))))
            (GOOD-AK (AK-EXECUTE-SEND-TO-BUFFER MSG SRCID DESTID AK)))
   ((ENABLE GOOD-AK AK-EXECUTE-SEND-TO-BUFFER FINITE-NUMBERP GETNTH PLISTP
            LENGTH AK-UPDATE-CONTROL QFULLP2 QFULLP ENQ2 AK-WAITING
            AK-READY-SET AK-TASKID ACCESS-TM-SET-SVCFLAG
            GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG
            PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ)
    (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION GROUND-ZERO)
    (USE (AK-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL (SRCID SRCID)
                                                         (DESTID DESTID)
                                                         (AK AK))
         (AK-WAITING-TO-RECEIVEP-IMPLIES-NOT-STATUS-FLAG-READYP (SRCID SRCID)
                                                                (DESTID DESTID)
                                                                (AK AK))
         (A-FINITE-NUMBER-IS-A-NUMBER (N DESTID)
                                      (LUB '16))
         (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH2 SRCID DESTID
                                                       (AK-MBUFFERS AK)))
                                      (CAPACITY '4)))
    (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-SEND-TO-BUFFER)

(PROVE-LEMMA GOOD-AK-AK-EXECUTE-SEND
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (AND (FINITE-NUMBERP DESTID '16)
                                     (FINITE-NUMBERP MSG '65536))))
                      (GOOD-AK (AK-EXECUTE-SEND MSG
                                                (AK-TASKID AK)
                                                DESTID AK)))
             ((ENABLE AK-EXECUTE-SEND FINITE-NUMBERP-AK-TASKID
                      GOOD-AK-AK-EXECUTE-SEND-TO-BUFFER GOOD-AK-AK-BLOCK-SEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-SEND)

(PROVE-LEMMA GOOD-AK-AK-BLOCK-RECEIVE
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (AND (EQUAL DESTID (AK-TASKID AK))
                                     (FINITE-NUMBERP SRCID '16))))
                      (GOOD-AK (AK-BLOCK-RECEIVE SRCID DESTID AK)))
             ((ENABLE GOOD-AK AK-BLOCK-RECEIVE AK-DISPATCHER PLISTP
                      FINITE-NUMBERP GETNTH LENGTH OPEN-UP-GETNTH
                      OPEN-UP-GETNTH-ON-ZERO AK-WAITING AK-READY-SET AK-TASKID
                      PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)
              (USE (NUMBER-LISTP-FINITE-NUMBER-LISTP (L (AK-READYQ AK))
                                                     (LUB '16)))
              (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-BLOCK-RECEIVE)

(PROVE-LEMMA AK-WAITING-TO-SENDP-IMPLIES-NOT-STATUS-FLAG-READYP
             NIL
             (IMPLIES (AK-WAITING-TO-SENDP SRCID DESTID AK)
                      (NOT (STATUS-FLAG-READYP (GETNTH SRCID (AK-STATUS AK)))))
             ((ENABLE AK-WAITING-TO-SENDP STATUS-FLAG-READYP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-STATUS-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-STATUS STATUS)
                      (AND (PLISTP STATUS)
                           (AND (EQUAL (LENGTH STATUS) '2)
                                (AND (FINITE-NUMBERP (GETNTH '0 STATUS)
                                                     '6)
                                     (FINITE-NUMBERP (GETNTH '1 STATUS)
                                                     '16)))))
             ((ENABLE GOOD-STATUS LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-PROPERTIES)

(PROVE-LEMMA
 GOOD-AK-AK-EXECUTE-RECEIVE-FROM-BUFFER
 (REWRITE)
 (IMPLIES (AND (GOOD-AK AK)
               (AND (NOT (AK-WAITING AK))
                    (AND (NOT (QEMPTYP2 SRCID DESTID
                                        (AK-MBUFFERS AK)))
                         (AND (FINITE-NUMBERP SRCID '16)
                              (FINITE-NUMBERP DESTID '16)))))
          (GOOD-AK (AK-EXECUTE-RECEIVE-FROM-BUFFER SRCID DESTID AK)))
 ((ENABLE GOOD-AK AK-EXECUTE-RECEIVE-FROM-BUFFER FINITE-NUMBERP GETNTH PLISTP
          LENGTH AK-UPDATE-CONTROL AK-STORE-MESSAGE QFULLP QEMPTYP ENQ2 DEQ2
          QEMPTYP2 AK-WAITING AK-READY-SET QFIRST2 AK-TASKID
          LENGTH-TM-MEMORY-OS-STORE-MESSAGE ACCESS-TM-SET-SVCFLAG
          GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION GROUND-ZERO)
  (USE
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH2 SRCID DESTID
                                                 (AK-MBUFFERS AK)))
                                (CAPACITY '4))
   (A-FINITE-NUMBER-IS-A-NUMBER (N SRCID)
                                (LUB '16))
   (AK-WAITING-TO-SENDP-IMPLIES-NOT-STATUS-FLAG-READYP (SRCID SRCID)
                                                       (DESTID DESTID)
                                                       (AK AK))
   (AK-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (SRCID SRCID)
                                                (DESTID DESTID)
                                                (AK AK))
   (GOOD-STATUS-PROPERTIES (STATUS (GETNTH SRCID (AK-STATUS AK))))
   (GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE1
                                      (MSG (QFIRST (GETNTH2 SRCID DESTID
                                                            (AK-MBUFFERS AK))))
                                      (TASK (GETNTH DESTID (AK-PSTATES AK)))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-RECEIVE-FROM-BUFFER)

(PROVE-LEMMA GOOD-AK-AK-EXECUTE-RECEIVE
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (FINITE-NUMBERP SRCID '16)))
                      (GOOD-AK (AK-EXECUTE-RECEIVE SRCID
                                                   (AK-TASKID AK)
                                                   AK)))
             ((ENABLE AK-EXECUTE-RECEIVE FINITE-NUMBERP-AK-TASKID
                      GOOD-AK-AK-EXECUTE-RECEIVE-FROM-BUFFER
                      GOOD-AK-AK-BLOCK-RECEIVE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-RECEIVE)

(PROVE-LEMMA GOOD-AK-AK-BLOCK-OUTPUT
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (EQUAL ID (AK-TASKID AK))))
                      (GOOD-AK (AK-BLOCK-OUTPUT ID AK)))
             ((ENABLE GOOD-AK AK-DISPATCHER AK-BLOCK-OUTPUT FINITE-NUMBERP
                      GETNTH PLISTP LENGTH OPEN-UP-GETNTH
                      OPEN-UP-GETNTH-ON-ZERO AK-WAITING AK-READY-SET AK-TASKID
                      PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)
              (USE (NUMBER-LISTP-FINITE-NUMBER-LISTP (L (AK-READYQ AK))
                                                     (LUB '16)))
              (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-BLOCK-OUTPUT)

(PROVE-LEMMA GOOD-AK-OBUFFERS-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (AND (PLISTP (AK-OBUFFERS AK))
                           (EQUAL (LENGTH (AK-OBUFFERS AK))
                                  '16)))
             ((ENABLE GOOD-AK PLISTP-GOOD-TASK-BUFFER-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-OBUFFERS-PROPERTIES)

(PROVE-LEMMA
       GOOD-AK-AK-EXECUTE-OUTPUT-TO-BUFFER
       (REWRITE)
       (IMPLIES (AND (GOOD-AK AK)
                     (AND (NOT (AK-WAITING AK))
                          (AND (NOT (QFULLP (GETNTH ID (AK-OBUFFERS AK))
                                            '4))
                               (AND (FINITE-NUMBERP ID '16)
                                    (FINITE-NUMBERP CHAR '65536)))))
                (GOOD-AK (AK-EXECUTE-OUTPUT-TO-BUFFER CHAR ID AK)))
       ((ENABLE GOOD-AK AK-EXECUTE-OUTPUT-TO-BUFFER QFULLP AK-TASKID
                FINITE-NUMBERP GETNTH PLISTP LENGTH AK-UPDATE-CONTROL
                AK-POST-OUTPUT-INTERRUPT AK-WAITING AK-READY-SET
                TM-POST-OUTPUT-INTERRUPT
                PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
                ENQ-ITH-BUFFER ACCESS-TM-SET-SVCFLAG
                GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG GOOD-TASK-BUFFER-LIST-PUTNTH
                GOOD-TASK-BUFFER-GETNTH-FROM-AK-OBUFFERS)
        (ENABLE-THEORY AK-SHELL TM-SHELLS QUEUE-FACTS GOOD-AK-CONSTRUCTION
                       GROUND-ZERO)
        (USE (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                          (LUB '16))
             (GOOD-AK-OBUFFERS-PROPERTIES (AK AK))
             (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-OBUFFERS AK)))
                                          (CAPACITY '4)))
        (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-OUTPUT-TO-BUFFER)

(PROVE-LEMMA GOOD-AK-AK-EXECUTE-OUTPUT
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (FINITE-NUMBERP CHAR '65536)))
                      (GOOD-AK (AK-EXECUTE-OUTPUT CHAR
                                                  (AK-TASKID AK)
                                                  AK)))
             ((ENABLE AK-EXECUTE-OUTPUT FINITE-NUMBERP-AK-TASKID
                      GOOD-AK-AK-EXECUTE-OUTPUT-TO-BUFFER
                      GOOD-AK-AK-BLOCK-OUTPUT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-OUTPUT)

(PROVE-LEMMA GOOD-AK-AK-BLOCK-INPUT
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (AK-WAITING AK))
                                (EQUAL ID (AK-TASKID AK))))
                      (GOOD-AK (AK-BLOCK-INPUT ID AK)))
             ((ENABLE GOOD-AK AK-BLOCK-INPUT AK-DISPATCHER FINITE-NUMBERP
                      GETNTH PLISTP LENGTH OPEN-UP-GETNTH
                      OPEN-UP-GETNTH-ON-ZERO AK-WAITING AK-READY-SET AK-TASKID
                      PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH)
              (USE (NUMBER-LISTP-FINITE-NUMBER-LISTP (L (AK-READYQ AK))
                                                     (LUB '16)))
              (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-BLOCK-INPUT)

(PROVE-LEMMA GOOD-AK-IBUFFERS-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (AND (PLISTP (AK-IBUFFERS AK))
                           (EQUAL (LENGTH (AK-IBUFFERS AK))
                                  '16)))
             ((ENABLE GOOD-AK PLISTP-GOOD-TASK-BUFFER-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-IBUFFERS-PROPERTIES)

(PROVE-LEMMA
 GOOD-AK-AK-EXECUTE-INPUT-FROM-BUFFER
 (REWRITE)
 (IMPLIES (AND (GOOD-AK AK)
               (AND (NOT (AK-WAITING AK))
                    (AND (FINITE-NUMBERP ID '16)
                         (NOT (QEMPTYP (GETNTH ID (AK-IBUFFERS AK)))))))
          (GOOD-AK (AK-EXECUTE-INPUT-FROM-BUFFER ID AK)))
 ((ENABLE GOOD-AK AK-EXECUTE-INPUT-FROM-BUFFER FINITE-NUMBERP GETNTH PLISTP
          LENGTH AK-UPDATE-CONTROL AK-STORE-MESSAGE QFULLP QEMPTYP QFIRST-ENQ
          AK-WAITING AK-READY-SET AK-TASKID
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
          LENGTH-TM-MEMORY-OS-STORE-MESSAGE ACCESS-TM-SET-SVCFLAG
          GOOD-ADDRESS-SPACE-TM-SET-SVCFLAG
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TASK-BUFFER-LIST-PUTNTH
          GOOD-TASK-BUFFER-GETNTH-FROM-AK-IBUFFERS)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION GROUND-ZERO)
  (USE
   (GOOD-AK-IBUFFERS-PROPERTIES (AK AK))
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-IBUFFERS AK)))
                                (CAPACITY '4))
   (GOOD-ADDRESS-SPACE-OS-STORE-MESSAGE1
                                    (MSG (QFIRST (GETNTH ID (AK-IBUFFERS AK))))
                                    (TASK (GETNTH ID (AK-PSTATES AK)))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-INPUT-FROM-BUFFER)

(PROVE-LEMMA GOOD-AK-AK-EXECUTE-INPUT
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (GOOD-AK (AK-EXECUTE-INPUT (AK-TASKID AK) AK)))
             ((ENABLE AK-EXECUTE-INPUT FINITE-NUMBERP-AK-TASKID
                      GOOD-AK-AK-EXECUTE-INPUT-FROM-BUFFER
                      GOOD-AK-AK-BLOCK-INPUT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-EXECUTE-INPUT)

(PROVE-LEMMA FINITE-NUMBERP-AK-SRCID
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (FINITE-NUMBERP (AK-SRCID AK) '16))
             ((ENABLE AK-SRCID FINITE-NUMBERP-REMAINDER OS-SRCID)
              (ENABLE-THEORY GOOD-AK-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-SRCID)

(PROVE-LEMMA FINITE-NUMBERP-AK-DESTID
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (FINITE-NUMBERP (AK-DESTID AK) '16))
             ((ENABLE AK-DESTID FINITE-NUMBERP-REMAINDER OS-DESTID)
              (ENABLE-THEORY GOOD-AK-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-DESTID)

(PROVE-LEMMA FINITE-NUMBERP-AK-MESSAGE
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (FINITE-NUMBERP (AK-MESSAGE AK)
                                      '65536))
             ((ENABLE AK-MESSAGE FINITE-NUMBERP-OS-MESSAGE GOOD-AK
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB AK-TASKID)
              (ENABLE-THEORY QUEUE-FACTS GROUND-ZERO)
              (USE (GOOD-ADDRESS-SPACE-GETNTH (L (AK-PSTATES AK))
                                              (I (AK-TASKID AK))))
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-AK-MESSAGE)

(PROVE-LEMMA GOOD-AK-AK-SVC-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (GOOD-AK (AK-SVC-HANDLER AK)))
             ((ENABLE AK-SVC-HANDLER GOOD-AK-AK-EXECUTE-INPUT
                      GOOD-AK-AK-EXECUTE-OUTPUT GOOD-AK-AK-EXECUTE-SEND
                      GOOD-AK-AK-EXECUTE-RECEIVE FINITE-NUMBERP-AK-MESSAGE
                      FINITE-NUMBERP-AK-SRCID FINITE-NUMBERP-AK-DESTID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-SVC-HANDLER)

(PROVE-LEMMA GOOD-AK-AK-PRIVATE-STEP
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (NOT (AK-WAITING AK)))
                      (GOOD-AK (AK-PRIVATE-STEP AK)))
             ((ENABLE GOOD-AK AK-PRIVATE-STEP AK-TASKID AK-FETCH-EXECUTE
                      FINITE-NUMBER-SUB1 LENGTH-TM-MEMORY-TM-FETCH-EXECUTE
                      GOOD-ADDRESS-SPACE-TM-FETCH-EXECUTE AK-WAITING
                      AK-READY-SET)
              (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-PRIVATE-STEP)

(PROVE-LEMMA AK-WAITING-TO-INPUTP-IMPLIES-NOT-STATUS-FLAG-READYP
             NIL
             (IMPLIES (AK-WAITING-TO-INPUTP ID AK)
                      (NOT (STATUS-FLAG-READYP (GETNTH ID (AK-STATUS AK)))))
             ((ENABLE AK-WAITING-TO-INPUTP STATUS-FLAG-READYP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA AK-WAITING-TO-OUTPUTP-IMPLIES-NOT-STATUS-FLAG-READYP
             NIL
             (IMPLIES (AK-WAITING-TO-OUTPUTP ID AK)
                      (NOT (STATUS-FLAG-READYP (GETNTH ID (AK-STATUS AK)))))
             ((ENABLE AK-WAITING-TO-OUTPUTP STATUS-FLAG-READYP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-TM-IPORT-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-TM-IPORT PORT)
                      (AND (TM-IPORTP PORT)
                           (AND (FINITE-NUMBERP (TM-IINTERRUPT-FLAG PORT)
                                                '2)
                                (AND (FINITE-NUMBERP (TM-IERROR-FLAG PORT)
                                                     '2)
                                     (FINITE-NUMBERP (TM-ICHAR PORT)
                                                     '256)))))
             ((ENABLE GOOD-TM-IPORT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-IPORT-PROPERTIES)

(PROVE-LEMMA
 GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER-CASE1 NIL
 (IMPLIES (AND (GOOD-AK AK)
               (AND (FINITE-NUMBERP ID '16)
                    (AND (AK-WAITING AK)
                         (AK-WAITING-TO-INPUTP ID AK))))
          (GOOD-AK (AK-WAITING-INPUT-INTERRUPT-HANDLER ID AK)))
 ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
          FINITE-NUMBERP GETNTH PLISTP LENGTH AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT AK-DISPATCHER
          AK-WAITING-INPUT-INTERRUPT-HANDLER ENQ-ITH-BUFFER
          QREPLACE-ITH-BUFFER TM-CLEAR-INPUT-INTERRUPT TM-IPORT-ERRORP
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TASK-BUFFER-LIST-PUTNTH
          GOOD-TASK-BUFFER-GETNTH GOOD-TM-IPORT-GETNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH1)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                 GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                (LUB '16))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
                                  (CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
   (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                                    (I '256)
                                    (J '65536))
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                   (N (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
                   (I '512)
                   (J '65536))
   (GOOD-TM-IPORT-PROPERTIES (PORT (GETNTH ID (AK-IPORTS AK))))
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-IBUFFERS AK)))
                                (CAPACITY '4))
   (AK-WAITING-TO-INPUTP-IMPLIES-NOT-STATUS-FLAG-READYP (ID ID)
                                                        (AK AK))
   (AK-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL (ID ID)
                                                 (AK AK))
   (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
  (DISABLE-THEORY T)))

(PROVE-LEMMA
 GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER-CASE2 NIL
 (IMPLIES (AND (GOOD-AK AK)
               (AND (FINITE-NUMBERP ID '16)
                    (AND (AK-WAITING AK)
                         (NOT (AK-WAITING-TO-INPUTP ID AK)))))
          (GOOD-AK (AK-WAITING-INPUT-INTERRUPT-HANDLER ID AK)))
 ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
          FINITE-NUMBERP GETNTH PLISTP LENGTH AK-DISPATCHER
          AK-WAITING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT ENQ-ITH-BUFFER QREPLACE-ITH-BUFFER
          TM-CLEAR-INPUT-INTERRUPT TM-IPORT-ERRORP
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TASK-BUFFER-LIST-PUTNTH
          GOOD-TASK-BUFFER-GETNTH GOOD-TM-IPORT-GETNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH1)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                 GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                (LUB '16))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
                                  (CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
   (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                                    (I '256)
                                    (J '65536))
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                   (N (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
                   (I '512)
                   (J '65536))
   (GOOD-TM-IPORT-PROPERTIES (PORT (GETNTH ID (AK-IPORTS AK))))
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-IBUFFERS AK)))
                                (CAPACITY '4))
   (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
  (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP ID '16)
                                (AK-WAITING AK)))
                      (GOOD-AK (AK-WAITING-INPUT-INTERRUPT-HANDLER ID AK)))
             ((USE (GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER-CASE2 (AK AK)
                                                                     (ID ID))
                   (GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER-CASE1 (AK AK)
                                                                     (ID ID)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA
 GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER-CASE1 NIL
 (IMPLIES (AND (GOOD-AK AK)
               (AND (FINITE-NUMBERP ID '16)
                    (AND (NOT (AK-WAITING AK))
                         (AK-WAITING-TO-INPUTP ID AK))))
          (GOOD-AK (AK-RUNNING-INPUT-INTERRUPT-HANDLER ID AK)))
 ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
          FINITE-NUMBERP GETNTH PLISTP LENGTH
          AK-RUNNING-INPUT-INTERRUPT-HANDLER ENQ-ITH-BUFFER
          QREPLACE-ITH-BUFFER AK-UPDATE-IBUFFER AK-CLEAR-INPUT-INTERRUPT
          TM-CLEAR-INPUT-INTERRUPT TM-IPORT-ERRORP
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TASK-BUFFER-LIST-PUTNTH
          GOOD-TASK-BUFFER-GETNTH GOOD-TM-IPORT-GETNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH1)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                 GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                (LUB '16))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
                                  (CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
   (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                                    (I '256)
                                    (J '65536))
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                   (N (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
                   (I '512)
                   (J '65536))
   (GOOD-TM-IPORT-PROPERTIES (PORT (GETNTH ID (AK-IPORTS AK))))
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-IBUFFERS AK)))
                                (CAPACITY '4))
   (AK-WAITING-TO-INPUTP-IMPLIES-NOT-STATUS-FLAG-READYP (ID ID)
                                                        (AK AK))
   (AK-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL (ID ID)
                                                 (AK AK))
   (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
  (DISABLE-THEORY T)))

(PROVE-LEMMA
 GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER-CASE2 NIL
 (IMPLIES (AND (GOOD-AK AK)
               (AND (FINITE-NUMBERP ID '16)
                    (AND (NOT (AK-WAITING AK))
                         (NOT (AK-WAITING-TO-INPUTP ID AK)))))
          (GOOD-AK (AK-RUNNING-INPUT-INTERRUPT-HANDLER ID AK)))
 ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
          FINITE-NUMBERP GETNTH PLISTP LENGTH
          AK-RUNNING-INPUT-INTERRUPT-HANDLER ENQ-ITH-BUFFER
          QREPLACE-ITH-BUFFER AK-UPDATE-IBUFFER AK-CLEAR-INPUT-INTERRUPT
          TM-CLEAR-INPUT-INTERRUPT TM-IPORT-ERRORP
          PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB GOOD-TASK-BUFFER-LIST-PUTNTH
          GOOD-TASK-BUFFER-GETNTH GOOD-TM-IPORT-GETNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH1)
  (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                 GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                (LUB '16))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
                                  (CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
   (FINITE-NUMBERP-FROM-SMALLER-LUB (N (TM-ICHAR (GETNTH ID (AK-IPORTS AK))))
                                    (I '256)
                                    (J '65536))
   (FINITE-NUMBERP-FROM-SMALLER-LUB
                   (N (TM-OVERFLOW-CHAR (TM-ICHAR (GETNTH ID (AK-IPORTS AK)))))
                   (I '512)
                   (J '65536))
   (GOOD-TM-IPORT-PROPERTIES (PORT (GETNTH ID (AK-IPORTS AK))))
   (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-IBUFFERS AK)))
                                (CAPACITY '4))
   (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
  (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP ID '16)
                                (NOT (AK-WAITING AK))))
                      (GOOD-AK (AK-RUNNING-INPUT-INTERRUPT-HANDLER ID AK)))
             ((USE (GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER-CASE2 (AK AK)
                                                                     (ID ID))
                   (GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER-CASE1 (AK AK)
                                                                     (ID ID)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA
           FINITE-NUMBERP-INTERRUPTING-AK-INPUT-PORT
           (REWRITE)
           (IMPLIES (AND (GOOD-AK AK)
                         (TM-SOME-INPUT-INTERRUPTP (AK-IPORTS AK)))
                    (FINITE-NUMBERP (TM-INTERRUPTING-INPUT-PORT (AK-IPORTS AK))
                                    '16))
           ((ENABLE FINITE-NUMBERP GOOD-AK)
            (USE (SIZE-OF-TM-INTERRUPTING-INPUT-PORT (L (AK-IPORTS AK))))
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-INTERRUPTING-AK-INPUT-PORT)

(PROVE-LEMMA
 GOOD-AK-AK-INPUT-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-AK AK)
       (AK-INPUT-INTERRUPTP AK))
  (GOOD-AK
        (AK-INPUT-INTERRUPT-HANDLER (AK-INTERRUPTING-INPUT-PORT (AK-IPORTS AK))
                                    AK)))
 ((ENABLE AK-INPUT-INTERRUPTP AK-INPUT-INTERRUPT-HANDLER
          AK-INTERRUPTING-INPUT-PORT
          GOOD-AK-AK-WAITING-INPUT-INTERRUPT-HANDLER
          GOOD-AK-AK-RUNNING-INPUT-INTERRUPT-HANDLER
          FINITE-NUMBERP-INTERRUPTING-AK-INPUT-PORT)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-TM-OPORT-PROPERTIES
             (REWRITE)
             (IMPLIES (GOOD-TM-OPORT PORT)
                      (AND (TM-OPORTP PORT)
                           (AND (FINITE-NUMBERP (TM-OINTERRUPT-FLAG PORT)
                                                '2)
                                (AND (FINITE-NUMBERP (TM-OBUSY-FLAG PORT)
                                                     '2)
                                     (FINITE-NUMBERP (TM-OCHAR PORT)
                                                     '256)))))
             ((ENABLE GOOD-TM-OPORT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OPORT-PROPERTIES)

(PROVE-LEMMA
       GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER-CASE1 NIL
       (IMPLIES (AND (GOOD-AK AK)
                     (AND (FINITE-NUMBERP ID '16)
                          (AND (AK-WAITING AK)
                               (AK-WAITING-TO-OUTPUTP ID AK))))
                (GOOD-AK (AK-WAITING-OUTPUT-INTERRUPT-HANDLER ID AK)))
       ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
                FINITE-NUMBERP GETNTH PLISTP LENGTH AK-CLEAR-OUTPUT-INTERRUPT
                AK-START-OUTPUT AK-DISPATCHER
                AK-WAITING-OUTPUT-INTERRUPT-HANDLER DEQ-ITH-BUFFER
                TM-CLEAR-OUTPUT-INTERRUPT TM-START-OUTPUT
                PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
                FINITE-NUMBERP-REMAINDER A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                GOOD-TASK-BUFFER-LIST-PUTNTH GOOD-TASK-BUFFER-GETNTH
                GOOD-TM-OPORT-GETNTH GOOD-TM-OPORT-ARRAY-PUTNTH1)
        (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                       GROUND-ZERO)
        (USE (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                          (LUB '16))
             (GOOD-TM-OPORT-PROPERTIES (PORT (GETNTH ID (AK-OPORTS AK))))
             (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-OBUFFERS AK)))
                                          (CAPACITY '4))
             (AK-WAITING-TO-OUTPUTP-IMPLIES-NOT-STATUS-FLAG-READYP (ID ID)
                                                                   (AK AK))
             (AK-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL (ID ID)
                                                            (AK AK))
             (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
        (DISABLE-THEORY T)))

(PROVE-LEMMA
       GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER-CASE2 NIL
       (IMPLIES (AND (GOOD-AK AK)
                     (AND (FINITE-NUMBERP ID '16)
                          (AND (AK-WAITING AK)
                               (NOT (AK-WAITING-TO-OUTPUTP ID AK)))))
                (GOOD-AK (AK-WAITING-OUTPUT-INTERRUPT-HANDLER ID AK)))
       ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
                FINITE-NUMBERP GETNTH PLISTP LENGTH AK-CLEAR-OUTPUT-INTERRUPT
                AK-START-OUTPUT AK-DISPATCHER
                AK-WAITING-OUTPUT-INTERRUPT-HANDLER DEQ-ITH-BUFFER
                TM-CLEAR-OUTPUT-INTERRUPT TM-START-OUTPUT
                PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
                FINITE-NUMBERP-REMAINDER A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                GOOD-TASK-BUFFER-LIST-PUTNTH GOOD-TASK-BUFFER-GETNTH
                GOOD-TM-OPORT-GETNTH GOOD-TM-OPORT-ARRAY-PUTNTH1)
        (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                       GROUND-ZERO)
        (USE (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                          (LUB '16))
             (GOOD-TM-OPORT-PROPERTIES (PORT (GETNTH ID (AK-OPORTS AK))))
             (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-OBUFFERS AK)))
                                          (CAPACITY '4))
             (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
        (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP ID '16)
                                (AK-WAITING AK)))
                      (GOOD-AK (AK-WAITING-OUTPUT-INTERRUPT-HANDLER ID AK)))
             ((USE (GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER-CASE2 (AK AK)
                                                                      (ID ID))
                   (GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER-CASE1 (AK AK)
                                                                      (ID ID)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA
       GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER-CASE1 NIL
       (IMPLIES (AND (GOOD-AK AK)
                     (AND (FINITE-NUMBERP ID '16)
                          (AND (NOT (AK-WAITING AK))
                               (AK-WAITING-TO-OUTPUTP ID AK))))
                (GOOD-AK (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER ID AK)))
       ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
                FINITE-NUMBERP GETNTH PLISTP LENGTH AK-CLEAR-OUTPUT-INTERRUPT
                AK-START-OUTPUT AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                DEQ-ITH-BUFFER TM-CLEAR-OUTPUT-INTERRUPT TM-START-OUTPUT
                PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
                FINITE-NUMBERP-REMAINDER A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                GOOD-TASK-BUFFER-LIST-PUTNTH GOOD-TASK-BUFFER-GETNTH
                GOOD-TM-OPORT-GETNTH GOOD-TM-OPORT-ARRAY-PUTNTH1)
        (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                       GROUND-ZERO)
        (USE (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                          (LUB '16))
             (GOOD-TM-OPORT-PROPERTIES (PORT (GETNTH ID (AK-OPORTS AK))))
             (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-OBUFFERS AK)))
                                          (CAPACITY '4))
             (AK-WAITING-TO-OUTPUTP-IMPLIES-NOT-STATUS-FLAG-READYP (ID ID)
                                                                   (AK AK))
             (AK-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL (ID ID)
                                                            (AK AK))
             (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
        (DISABLE-THEORY T)))

(PROVE-LEMMA
       GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER-CASE2 NIL
       (IMPLIES (AND (GOOD-AK AK)
                     (AND (FINITE-NUMBERP ID '16)
                          (AND (NOT (AK-WAITING AK))
                               (NOT (AK-WAITING-TO-OUTPUTP ID AK)))))
                (GOOD-AK (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER ID AK)))
       ((ENABLE GOOD-AK AK-WAITING AK-READY-SET QFULLP QEMPTYP AK-TASKID
                FINITE-NUMBERP GETNTH PLISTP LENGTH AK-CLEAR-OUTPUT-INTERRUPT
                AK-START-OUTPUT AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                DEQ-ITH-BUFFER TM-CLEAR-OUTPUT-INTERRUPT TM-START-OUTPUT
                PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH QFIRST-ENQ
                FINITE-NUMBERP-REMAINDER A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                GOOD-TASK-BUFFER-LIST-PUTNTH GOOD-TASK-BUFFER-GETNTH
                GOOD-TM-OPORT-GETNTH GOOD-TM-OPORT-ARRAY-PUTNTH1)
        (ENABLE-THEORY AK-SHELL QUEUE-FACTS GOOD-AK-CONSTRUCTION TM-SHELLS
                       GROUND-ZERO)
        (USE (A-FINITE-NUMBER-IS-A-NUMBER (N ID)
                                          (LUB '16))
             (GOOD-TM-OPORT-PROPERTIES (PORT (GETNTH ID (AK-OPORTS AK))))
             (GOOD-TASK-BUFFER-PROPERTIES (BUFFER (GETNTH ID (AK-OBUFFERS AK)))
                                          (CAPACITY '4))
             (GOOD-STATUS-PROPERTIES (STATUS (GETNTH ID (AK-STATUS AK)))))
        (DISABLE-THEORY T)))

(PROVE-LEMMA GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP ID '16)
                                (NOT (AK-WAITING AK))))
                      (GOOD-AK (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER ID AK)))
             ((USE (GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER-CASE2 (AK AK)
                                                                      (ID ID))
                   (GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER-CASE1 (AK AK)
                                                                      (ID ID)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA
          FINITE-NUMBERP-INTERRUPTING-AK-OUTPUT-PORT
          (REWRITE)
          (IMPLIES (AND (GOOD-AK AK)
                        (TM-SOME-OUTPUT-INTERRUPTP (AK-OPORTS AK)))
                   (FINITE-NUMBERP (TM-INTERRUPTING-OUTPUT-PORT (AK-OPORTS AK))
                                   '16))
          ((ENABLE FINITE-NUMBERP GOOD-AK)
           (USE (SIZE-OF-TM-INTERRUPTING-OUTPUT-PORT (L (AK-OPORTS AK))))
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-INTERRUPTING-AK-OUTPUT-PORT)

(PROVE-LEMMA
 GOOD-AK-AK-OUTPUT-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-AK AK)
       (AK-OUTPUT-INTERRUPTP AK))
  (GOOD-AK
      (AK-OUTPUT-INTERRUPT-HANDLER (AK-INTERRUPTING-OUTPUT-PORT (AK-OPORTS AK))
                                   AK)))
 ((ENABLE AK-OUTPUT-INTERRUPTP AK-OUTPUT-INTERRUPT-HANDLER
          AK-INTERRUPTING-OUTPUT-PORT
          GOOD-AK-AK-WAITING-OUTPUT-INTERRUPT-HANDLER
          GOOD-AK-AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
          FINITE-NUMBERP-INTERRUPTING-AK-OUTPUT-PORT)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-AK-AK-STEP
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-AK (AK-STEP AK)))
             ((ENABLE AK-STEP GOOD-AK-AK-OUTPUT-INTERRUPT-HANDLER
                      GOOD-AK-AK-INPUT-INTERRUPT-HANDLER
                      GOOD-AK-AK-PRIVATE-STEP GOOD-AK-AK-SVC-HANDLER
                      GOOD-AK-AK-CLOCK-INTERRUPT-HANDLER
                      GOOD-AK-AK-ERROR-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-STEP)

(PROVE-LEMMA
 GOOD-AK-AK-POST-INPUT-INTERRUPT
 (REWRITE)
 (IMPLIES (AND (GOOD-AK AK)
               (TM-DEVICE-INPUT-EVENTP INTERRUPT))
          (GOOD-AK (AK-POST-INTERRUPT INTERRUPT AK)))
 ((ENABLE GOOD-AK TM-POST-INPUT-INTERRUPT FINITE-NUMBERP GETNTH PLISTP LENGTH
          AK-POST-INTERRUPT AK-READY-SET AK-WAITING GOOD-TM-IPORT-GETNTH
          GOOD-TM-IPORT-ARRAY-PUTNTH1 FINITE-NUMBERP-REMAINDER
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
  (ENABLE-THEORY GOOD-AK-CONSTRUCTION AK-SHELL TM-SHELLS GROUND-ZERO)
  (USE
   (GOOD-TM-IPORT-PROPERTIES
                           (PORT (GETNTH (REMAINDER (TM-IDEVID INTERRUPT) '16)
                                         (AK-IPORTS AK)))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-POST-INPUT-INTERRUPT)

(PROVE-LEMMA
 GOOD-AK-AK-POST-OUTPUT-INTERRUPT
 (REWRITE)
 (IMPLIES (AND (GOOD-AK AK)
               (TM-DEVICE-OUTPUT-EVENTP INTERRUPT))
          (GOOD-AK (AK-POST-INTERRUPT INTERRUPT AK)))
 ((ENABLE GOOD-AK TM-POST-OUTPUT-INTERRUPT FINITE-NUMBERP GETNTH PLISTP LENGTH
          AK-POST-INTERRUPT AK-READY-SET AK-WAITING GOOD-TM-OPORT-GETNTH
          GOOD-TM-OPORT-ARRAY-PUTNTH1 FINITE-NUMBERP-REMAINDER
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB)
  (ENABLE-THEORY GOOD-AK-CONSTRUCTION AK-SHELL TM-SHELLS GROUND-ZERO)
  (USE
   (GOOD-TM-OPORT-PROPERTIES
                           (PORT (GETNTH (REMAINDER (TM-ODEVID INTERRUPT) '16)
                                         (AK-OPORTS AK)))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA GOOD-AK-AK-POST-INTERRUPT-NOOP
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (NOT (TM-DEVICE-INPUT-EVENTP INTERRUPT))
                                (NOT (TM-DEVICE-OUTPUT-EVENTP INTERRUPT))))
                      (GOOD-AK (AK-POST-INTERRUPT INTERRUPT AK)))
             ((ENABLE GOOD-AK AK-POST-INTERRUPT)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-POST-INTERRUPT-NOOP)

(PROVE-LEMMA GOOD-AK-AK-POST-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-AK (AK-POST-INTERRUPT INTERRUPT AK)))
             ((USE (GOOD-AK-AK-POST-INPUT-INTERRUPT (AK AK)
                                                    (INTERRUPT INTERRUPT))
                   (GOOD-AK-AK-POST-OUTPUT-INTERRUPT (AK AK)
                                                     (INTERRUPT INTERRUPT))
                   (GOOD-AK-AK-POST-INTERRUPT-NOOP (AK AK)
                                                   (INTERRUPT INTERRUPT)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-POST-INTERRUPT)

(PROVE-LEMMA GOOD-AK-AK-PROCESSOR
             (REWRITE)
             (IMPLIES (GOOD-AK AK)
                      (GOOD-AK (AK-PROCESSOR AK ORACLE)))
             ((ENABLE AK-PROCESSOR GOOD-AK-AK-POST-INTERRUPT GOOD-AK-AK-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-AK-PROCESSOR)

(PROVE-LEMMA AK-PSTATES-AK-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-CLOCK-INTERRUPT-HANDLER AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-CLOCK-INTERRUPT-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA AK-PSTATES-AK-ERROR-HANDLER
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-ERROR-HANDLER AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-ERROR-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-ERROR-HANDLER)

(PROVE-LEMMA AK-PSTATES-AK-BLOCK-SEND
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-BLOCK-SEND SRCID DESTID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-BLOCK-SEND AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-BLOCK-SEND)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-SEND-TO-BUFFER
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-SEND-TO-BUFFER MSG SRCID
                                                                   DESTID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-SEND-TO-BUFFER AK-UPDATE-CONTROL
                      LENGTH-PUTNTH)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-SEND-TO-BUFFER)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-SEND
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-SEND MSG SRCID DESTID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-SEND AK-PSTATES-AK-BLOCK-SEND
                      LENGTH-AK-PSTATES-AK-EXECUTE-SEND-TO-BUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-SEND)

(PROVE-LEMMA AK-PSTATES-AK-BLOCK-RECEIVE
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-BLOCK-RECEIVE SRCID DESTID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-BLOCK-RECEIVE AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-BLOCK-RECEIVE)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE-FROM-BUFFER
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-RECEIVE-FROM-BUFFER SRCID
                                                                        DESTID
                                                                        AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-RECEIVE-FROM-BUFFER AK-UPDATE-CONTROL
                      AK-STORE-MESSAGE LENGTH-PUTNTH)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE-FROM-BUFFER)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-RECEIVE SRCID DESTID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-RECEIVE AK-PSTATES-AK-BLOCK-RECEIVE
                      LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE-FROM-BUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE)

(PROVE-LEMMA AK-PSTATES-AK-BLOCK-OUTPUT
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-BLOCK-OUTPUT ID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-BLOCK-OUTPUT AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-BLOCK-OUTPUT)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT-TO-BUFFER
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-OUTPUT-TO-BUFFER CHAR ID
                                                                     AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-OUTPUT-TO-BUFFER AK-UPDATE-CONTROL
                      LENGTH-PUTNTH)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT-TO-BUFFER)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-OUTPUT CHAR ID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-OUTPUT AK-PSTATES-AK-BLOCK-OUTPUT
                      LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT-TO-BUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT)

(PROVE-LEMMA AK-PSTATES-AK-BLOCK-INPUT
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-BLOCK-INPUT ID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-BLOCK-INPUT AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-BLOCK-INPUT)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-INPUT-FROM-BUFFER
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-INPUT-FROM-BUFFER ID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-INPUT-FROM-BUFFER AK-UPDATE-CONTROL
                      AK-STORE-MESSAGE LENGTH-PUTNTH)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-INPUT-FROM-BUFFER)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-EXECUTE-INPUT
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-EXECUTE-INPUT ID AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-EXECUTE-INPUT AK-PSTATES-AK-BLOCK-INPUT
                      LENGTH-AK-PSTATES-AK-EXECUTE-INPUT-FROM-BUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-EXECUTE-INPUT)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-SVC-HANDLER
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-SVC-HANDLER AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-SVC-HANDLER LENGTH-AK-PSTATES-AK-EXECUTE-INPUT
                      LENGTH-AK-PSTATES-AK-EXECUTE-OUTPUT
                      LENGTH-AK-PSTATES-AK-EXECUTE-RECEIVE
                      LENGTH-AK-PSTATES-AK-EXECUTE-SEND)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-SVC-HANDLER)

(PROVE-LEMMA AK-PSTATES-AK-INPUT-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-INPUT-INTERRUPT-HANDLER ID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-INPUT-INTERRUPT-HANDLER
                      AK-WAITING-INPUT-INTERRUPT-HANDLER
                      AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA AK-PSTATES-AK-OUTPUT-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (AK-PSTATES (AK-OUTPUT-INTERRUPT-HANDLER ID AK))
                    (AK-PSTATES AK))
             ((ENABLE AK-OUTPUT-INTERRUPT-HANDLER
                      AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                      AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PSTATES-AK-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-PRIVATE-STEP
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-PRIVATE-STEP AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-PRIVATE-STEP AK-FETCH-EXECUTE LENGTH-PUTNTH)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-PRIVATE-STEP)

(PROVE-LEMMA LENGTH-AK-PSTATES-AK-STEP
             (REWRITE)
             (EQUAL (LENGTH (AK-PSTATES (AK-STEP AK)))
                    (LENGTH (AK-PSTATES AK)))
             ((ENABLE AK-STEP AK-PSTATES-AK-INPUT-INTERRUPT-HANDLER
                      AK-PSTATES-AK-OUTPUT-INTERRUPT-HANDLER
                      AK-PSTATES-AK-ERROR-HANDLER
                      AK-PSTATES-AK-CLOCK-INTERRUPT-HANDLER
                      LENGTH-AK-PSTATES-AK-SVC-HANDLER
                      LENGTH-AK-PSTATES-AK-PRIVATE-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-AK-PSTATES-AK-STEP)

(DEFN AK-CHANNELS
      (AK)
      (CONS (AK-IBUFFERS AK)
            (CONS (AK-OBUFFERS AK)
                  (CONS (AK-MBUFFERS AK) 'NIL)))
      NIL)

(DEFN PROJECT
      (I AK)
      (TASK (GETNTH I (AK-PSTATES AK))
            (AK-CHANNELS AK))
      NIL)

(DEFN CONTROL-ORACLE-STEP
 (I AK)
 (IF
  (AK-INPUT-INTERRUPTP AK)
  (AK-CHANNELS
        (AK-INPUT-INTERRUPT-HANDLER (TM-INTERRUPTING-INPUT-PORT (AK-IPORTS AK))
                                    AK))
  (IF
   (AK-OUTPUT-INTERRUPTP AK)
   (AK-CHANNELS
      (AK-OUTPUT-INTERRUPT-HANDLER (TM-INTERRUPTING-OUTPUT-PORT (AK-OPORTS AK))
                                   AK))
   (IF (AK-WAITING AK)
       (AK-CHANNELS AK)
       (IF (AK-ERRORP AK)
           (AK-CHANNELS (AK-ERROR-HANDLER AK))
           (IF (AK-CLOCK-INTERRUPTP AK)
               (AK-CHANNELS (AK-CLOCK-INTERRUPT-HANDLER AK))
               (IF (AK-SVC-INTERRUPTP AK)
                   (IF (EQUAL I (AK-TASKID AK))
                       '*1*TRUE
                       (AK-CHANNELS (AK-SVC-HANDLER AK)))
                   (IF (EQUAL I (AK-TASKID AK))
                       '*1*TRUE
                       (AK-CHANNELS (AK-PRIVATE-STEP AK)))))))))
 NIL)

(DEFN CONTROL-ORACLE
      (I AK ORACLE)
      (IF (LISTP ORACLE)
          (CONS (CONTROL-ORACLE-STEP I
                                     (AK-POST-INTERRUPT (CAR ORACLE) AK))
                (CONTROL-ORACLE I
                                (AK-STEP (AK-POST-INTERRUPT (CAR ORACLE) AK))
                                (CDR ORACLE)))
          'NIL)
      NIL)

(PROVE-LEMMA ACCESS-AK-POST-INTERRUPT
      (REWRITE)
      (AND (EQUAL (AK-PSTATES (AK-POST-INTERRUPT INTERRUPT AK))
                  (AK-PSTATES AK))
           (AND (EQUAL (AK-IBUFFERS (AK-POST-INTERRUPT INTERRUPT AK))
                       (AK-IBUFFERS AK))
                (AND (EQUAL (AK-OBUFFERS (AK-POST-INTERRUPT INTERRUPT AK))
                            (AK-OBUFFERS AK))
                     (AND (EQUAL (AK-MBUFFERS (AK-POST-INTERRUPT INTERRUPT AK))
                                 (AK-MBUFFERS AK))
                          (EQUAL (AK-TASKID (AK-POST-INTERRUPT INTERRUPT AK))
                                 (AK-TASKID AK))))))
      ((ENABLE AK-POST-INTERRUPT AK-TASKID)
       (ENABLE-THEORY AK-SHELL GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE ACCESS-AK-POST-INTERRUPT)

(PROVE-LEMMA ACCESS-AK-INPUT-INTERRUPT-HANDLER
             (REWRITE)
             (AND (EQUAL (AK-PSTATES (AK-INPUT-INTERRUPT-HANDLER ID AK))
                         (AK-PSTATES AK))
                  (AND (EQUAL (AK-OBUFFERS (AK-INPUT-INTERRUPT-HANDLER ID AK))
                              (AK-OBUFFERS AK))
                       (EQUAL (AK-MBUFFERS (AK-INPUT-INTERRUPT-HANDLER ID AK))
                              (AK-MBUFFERS AK))))
             ((ENABLE AK-INPUT-INTERRUPT-HANDLER
                      AK-WAITING-INPUT-INTERRUPT-HANDLER
                      AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-AK-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA ACCESS-AK-OUTPUT-INTERRUPT-HANDLER
             (REWRITE)
             (AND (EQUAL (AK-PSTATES (AK-OUTPUT-INTERRUPT-HANDLER ID AK))
                         (AK-PSTATES AK))
                  (AND (EQUAL (AK-IBUFFERS (AK-OUTPUT-INTERRUPT-HANDLER ID AK))
                              (AK-IBUFFERS AK))
                       (EQUAL (AK-MBUFFERS (AK-OUTPUT-INTERRUPT-HANDLER ID AK))
                              (AK-MBUFFERS AK))))
             ((ENABLE AK-OUTPUT-INTERRUPT-HANDLER
                      AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                      AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-AK-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA ACCESS-AK-ERROR-HANDLER
             (REWRITE)
             (AND (EQUAL (AK-PSTATES (AK-ERROR-HANDLER AK))
                         (AK-PSTATES AK))
                  (AND (EQUAL (AK-IBUFFERS (AK-ERROR-HANDLER AK))
                              (AK-IBUFFERS AK))
                       (AND (EQUAL (AK-OBUFFERS (AK-ERROR-HANDLER AK))
                                   (AK-OBUFFERS AK))
                            (EQUAL (AK-MBUFFERS (AK-ERROR-HANDLER AK))
                                   (AK-MBUFFERS AK)))))
             ((ENABLE AK-ERROR-HANDLER AK-DISPATCHER)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-AK-ERROR-HANDLER)

(PROVE-LEMMA AK-PRIVATE-STEP-NON-INTERFERENCE
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP I
                                                (LENGTH (AK-PSTATES AK)))
                                (AND (NOT (EQUAL I (AK-TASKID AK)))
                                     (NOT (AK-WAITING AK)))))
                      (EQUAL (GETNTH I
                                     (AK-PSTATES (AK-PRIVATE-STEP AK)))
                             (GETNTH I (AK-PSTATES AK))))
             ((ENABLE FINITE-NUMBERP GETNTH-PUTNTH-NON-INTERFERENCE AK-TASKID
                      AK-FETCH-EXECUTE AK-PRIVATE-STEP)
              (USE (FINITE-NUMBERP-AK-TASKID (AK AK)))
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-PRIVATE-STEP-NON-INTERFERENCE)

(PROVE-LEMMA AK-SVC-HANDLER-NON-INTERFERENCE
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (AND (FINITE-NUMBERP I
                                                (LENGTH (AK-PSTATES AK)))
                                (AND (NOT (EQUAL I (AK-TASKID AK)))
                                     (NOT (AK-WAITING AK)))))
                      (EQUAL (GETNTH I
                                     (AK-PSTATES (AK-SVC-HANDLER AK)))
                             (GETNTH I (AK-PSTATES AK))))
             ((ENABLE FINITE-NUMBERP GETNTH-PUTNTH-NON-INTERFERENCE
                      ACCESS-AK-ERROR-HANDLER AK-TASKID AK-SVC-HANDLER
                      AK-BLOCK-SEND AK-UPDATE-CONTROL
                      AK-EXECUTE-SEND-TO-BUFFER AK-EXECUTE-SEND
                      AK-BLOCK-RECEIVE AK-EXECUTE-RECEIVE-FROM-BUFFER
                      AK-EXECUTE-RECEIVE AK-BLOCK-INPUT
                      AK-EXECUTE-INPUT-FROM-BUFFER AK-EXECUTE-INPUT
                      AK-BLOCK-OUTPUT AK-EXECUTE-OUTPUT-TO-BUFFER
                      AK-EXECUTE-OUTPUT AK-DISPATCHER AK-STORE-MESSAGE)
              (USE (FINITE-NUMBERP-AK-TASKID (AK AK)))
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-SVC-HANDLER-NON-INTERFERENCE)

(PROVE-LEMMA
 AK-IMPLEMENTS-NON-ACTIVE-TASK-STEP
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-AK AK)
   (AND (FINITE-NUMBERP I
                        (LENGTH (AK-PSTATES AK)))
        (NOT (TASK-ACTIVEP (CONTROL-ORACLE-STEP I
                                                (AK-POST-INTERRUPT (CAR ORACLE)
                                                                   AK))))))
  (EQUAL
     (PROJECT I
              (AK-STEP (AK-POST-INTERRUPT (CAR ORACLE) AK)))
     (TASK-UPDATE-CHANNELS (PROJECT I AK)
                           (CONTROL-ORACLE-STEP I
                                                (AK-POST-INTERRUPT (CAR ORACLE)
                                                                   AK)))))
 ((ENABLE CONTROL-ORACLE-STEP PROJECT GOOD-AK-AK-POST-INTERRUPT GETNTH
          TASK-ACTIVEP AK-CHANNELS TASK-UPDATE-CHANNELS AK-STEP AK-CHANNELS
          AK-INTERRUPTING-OUTPUT-PORT AK-INTERRUPTING-INPUT-PORT
          ACCESS-AK-POST-INTERRUPT ACCESS-AK-INPUT-INTERRUPT-HANDLER
          ACCESS-AK-OUTPUT-INTERRUPT-HANDLER
          AK-PSTATES-AK-CLOCK-INTERRUPT-HANDLER ACCESS-AK-ERROR-HANDLER
          AK-PRIVATE-STEP-NON-INTERFERENCE AK-SVC-HANDLER-NON-INTERFERENCE)
  (ENABLE-THEORY TASK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE AK-IMPLEMENTS-NON-ACTIVE-TASK-STEP)

(PROVE-LEMMA
 AK-EXECUTE-RECEIVE-IMPLEMENTS-TASK-EXECUTE-RECEIVE
 (REWRITE)
 (IMPLIES
        (AND (GOOD-AK AK)
             (NOT (AK-WAITING AK)))
        (EQUAL (TASK (GETNTH (AK-TASKID AK)
                             (AK-PSTATES (AK-EXECUTE-RECEIVE (AK-SRCID AK)
                                                             (AK-TASKID AK)
                                                             AK)))
                     (AK-CHANNELS (AK-EXECUTE-RECEIVE (AK-SRCID AK)
                                                      (AK-TASKID AK)
                                                      AK)))
               (TASK-EXECUTE-RECEIVE (TASK-SRCID (TASK (GETNTH (AK-TASKID AK)
                                                               (AK-PSTATES AK))
                                                       (AK-CHANNELS AK)))
                                     (AK-TASKID AK)
                                     (TASK (GETNTH (AK-TASKID AK)
                                                   (AK-PSTATES AK))
                                           (AK-CHANNELS AK)))))
 ((ENABLE-THEORY GOOD-AK-PROPERTIES AK-SHELL TASK-SHELL GROUND-ZERO)
  (ENABLE GETNTH-PUTNTH-COINCIDENCE A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
          AK-EXECUTE-RECEIVE AK-EXECUTE-RECEIVE-FROM-BUFFER AK-BLOCK-RECEIVE
          AK-CHANNELS AK-DISPATCHER AK-SRCID AK-DESTID AK-MESSAGE
          AK-UPDATE-CONTROL AK-STORE-MESSAGE TASK-IBUFFERS TASK-OBUFFERS
          TASK-MBUFFERS TASK-EXECUTE-RECEIVE TASK-UPDATE-CONTROL
          TASK-STORE-MESSAGE TASK-SRCID)
  (USE
   (FINITE-NUMBERP-AK-TASKID (AK AK))
   (PUTNTH-COINCIDENCE
    (I (AK-TASKID AK))
    (J (AK-TASKID AK))
    (A (OS-STORE-MESSAGE (QFIRST2 (OS-SRCID (GETNTH (AK-TASKID AK)
                                                    (AK-PSTATES AK))
                                            '16)
                                  (AK-TASKID AK)
                                  (AK-MBUFFERS AK))
                         (GETNTH (AK-TASKID AK)
                                 (AK-PSTATES AK))))
    (B
     (TM-SET-SVCFLAG '0
                  (OS-STORE-MESSAGE (QFIRST2 (OS-SRCID (GETNTH (AK-TASKID AK)
                                                               (AK-PSTATES AK))
                                                       '16)
                                             (AK-TASKID AK)
                                             (AK-MBUFFERS AK))
                                    (GETNTH (AK-TASKID AK)
                                            (AK-PSTATES AK)))))
    (L (AK-PSTATES AK))))
  (DISABLE-THEORY T)))

(DISABLE AK-EXECUTE-RECEIVE-IMPLEMENTS-TASK-EXECUTE-RECEIVE)

(PROVE-LEMMA
 AK-EXECUTE-SEND-IMPLEMENTS-TASK-EXECUTE-SEND
 (REWRITE)
 (IMPLIES
         (AND (GOOD-AK AK)
              (NOT (AK-WAITING AK)))
         (EQUAL (TASK (GETNTH (AK-TASKID AK)
                              (AK-PSTATES (AK-EXECUTE-SEND (AK-MESSAGE AK)
                                                           (AK-TASKID AK)
                                                           (AK-DESTID AK)
                                                           AK)))
                      (AK-CHANNELS (AK-EXECUTE-SEND (AK-MESSAGE AK)
                                                    (AK-TASKID AK)
                                                    (AK-DESTID AK)
                                                    AK)))
                (TASK-EXECUTE-SEND (TASK-MESSAGE (TASK (GETNTH (AK-TASKID AK)
                                                               (AK-PSTATES AK))
                                                       (AK-CHANNELS AK)))
                                   (AK-TASKID AK)
                                   (TASK-DESTID (TASK (GETNTH (AK-TASKID AK)
                                                              (AK-PSTATES AK))
                                                      (AK-CHANNELS AK)))
                                   (TASK (GETNTH (AK-TASKID AK)
                                                 (AK-PSTATES AK))
                                         (AK-CHANNELS AK)))))
 ((ENABLE-THEORY GOOD-AK-PROPERTIES AK-SHELL TASK-SHELL GROUND-ZERO)
  (ENABLE GETNTH-PUTNTH-COINCIDENCE A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
          AK-EXECUTE-SEND AK-EXECUTE-SEND-TO-BUFFER AK-BLOCK-SEND AK-CHANNELS
          AK-DISPATCHER AK-SRCID AK-DESTID AK-MESSAGE AK-UPDATE-CONTROL
          TASK-IBUFFERS TASK-OBUFFERS TASK-MBUFFERS TASK-EXECUTE-SEND
          TASK-UPDATE-CONTROL TASK-DESTID TASK-MESSAGE)
  (USE (FINITE-NUMBERP-AK-TASKID (AK AK)))
  (DISABLE-THEORY T)))

(DISABLE AK-EXECUTE-SEND-IMPLEMENTS-TASK-EXECUTE-SEND)

(PROVE-LEMMA
 AK-EXECUTE-INPUT-IMPLEMENTS-TASK-EXECUTE-INPUT
 (REWRITE)
 (IMPLIES
        (AND (GOOD-AK AK)
             (NOT (AK-WAITING AK)))
        (EQUAL (TASK (GETNTH (AK-TASKID AK)
                             (AK-PSTATES (AK-EXECUTE-INPUT (AK-TASKID AK) AK)))
                     (AK-CHANNELS (AK-EXECUTE-INPUT (AK-TASKID AK) AK)))
               (TASK-EXECUTE-INPUT (AK-TASKID AK)
                                   (TASK (GETNTH (AK-TASKID AK)
                                                 (AK-PSTATES AK))
                                         (AK-CHANNELS AK)))))
 ((ENABLE-THEORY GOOD-AK-PROPERTIES AK-SHELL TASK-SHELL GROUND-ZERO)
  (ENABLE GETNTH-PUTNTH-COINCIDENCE DEQ-ITH-BUFFER
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB AK-EXECUTE-INPUT
          AK-EXECUTE-INPUT-FROM-BUFFER AK-BLOCK-INPUT AK-CHANNELS
          AK-DISPATCHER AK-SRCID AK-DESTID AK-MESSAGE AK-UPDATE-CONTROL
          AK-STORE-MESSAGE TASK-IBUFFERS TASK-OBUFFERS TASK-MBUFFERS
          TASK-UPDATE-CONTROL TASK-STORE-MESSAGE TASK-EXECUTE-INPUT TASK-SRCID)
  (USE
   (FINITE-NUMBERP-AK-TASKID (AK AK))
   (PUTNTH-COINCIDENCE
        (I (AK-TASKID AK))
        (J (AK-TASKID AK))
        (A (OS-STORE-MESSAGE (QFIRST (GETNTH (AK-TASKID AK)
                                             (AK-IBUFFERS AK)))
                             (GETNTH (AK-TASKID AK)
                                     (AK-PSTATES AK))))
        (B (TM-SET-SVCFLAG '0
                           (OS-STORE-MESSAGE (QFIRST (GETNTH (AK-TASKID AK)
                                                             (AK-IBUFFERS AK)))
                                             (GETNTH (AK-TASKID AK)
                                                     (AK-PSTATES AK)))))
        (L (AK-PSTATES AK))))
  (DISABLE-THEORY T)))

(DISABLE AK-EXECUTE-INPUT-IMPLEMENTS-TASK-EXECUTE-INPUT)

(PROVE-LEMMA
 AK-EXECUTE-OUTPUT-IMPLEMENTS-TASK-EXECUTE-OUTPUT
 (REWRITE)
 (IMPLIES
       (AND (GOOD-AK AK)
            (NOT (AK-WAITING AK)))
       (EQUAL (TASK (GETNTH (AK-TASKID AK)
                            (AK-PSTATES (AK-EXECUTE-OUTPUT (AK-MESSAGE AK)
                                                           (AK-TASKID AK)
                                                           AK)))
                    (AK-CHANNELS (AK-EXECUTE-OUTPUT (AK-MESSAGE AK)
                                                    (AK-TASKID AK)
                                                    AK)))
              (TASK-EXECUTE-OUTPUT (TASK-MESSAGE (TASK (GETNTH (AK-TASKID AK)
                                                               (AK-PSTATES AK))
                                                       (AK-CHANNELS AK)))
                                   (AK-TASKID AK)
                                   (TASK (GETNTH (AK-TASKID AK)
                                                 (AK-PSTATES AK))
                                         (AK-CHANNELS AK)))))
 ((ENABLE-THEORY GOOD-AK-PROPERTIES AK-SHELL TASK-SHELL GROUND-ZERO)
  (ENABLE GETNTH-PUTNTH-COINCIDENCE ENQ-ITH-BUFFER
          A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB AK-EXECUTE-OUTPUT
          AK-EXECUTE-OUTPUT-TO-BUFFER AK-BLOCK-OUTPUT AK-CHANNELS
          AK-DISPATCHER AK-SRCID AK-DESTID AK-MESSAGE AK-UPDATE-CONTROL
          TASK-IBUFFERS TASK-OBUFFERS TASK-MBUFFERS TASK-EXECUTE-OUTPUT
          TASK-UPDATE-CONTROL TASK-MESSAGE)
  (USE (FINITE-NUMBERP-AK-TASKID (AK AK)))
  (DISABLE-THEORY T)))

(DISABLE AK-EXECUTE-OUTPUT-IMPLEMENTS-TASK-EXECUTE-OUTPUT)

(PROVE-LEMMA
        AK-SVC-HANDLER-IMPLEMENTS-TASK-COMMUNICATION-STEP
        (REWRITE)
        (IMPLIES (AND (GOOD-AK AK)
                      (NOT (AK-WAITING AK)))
                 (EQUAL (TASK (GETNTH (AK-TASKID AK)
                                      (AK-PSTATES (AK-SVC-HANDLER AK)))
                              (AK-CHANNELS (AK-SVC-HANDLER AK)))
                        (TASK-COMMUNICATION-STEP (TASK (GETNTH (AK-TASKID AK)
                                                               (AK-PSTATES AK))
                                                       (AK-CHANNELS AK))
                                                 (AK-TASKID AK))))
        ((ENABLE-THEORY GOOD-AK-PROPERTIES TASK-SHELL GROUND-ZERO)
         (ENABLE AK-SVC-HANDLER AK-SEND-INSTRUCTIONP AK-RECEIVE-INSTRUCTIONP
                 AK-TYO-INSTRUCTIONP AK-TYI-INSTRUCTIONP
                 TASK-COMMUNICATION-STEP TASK-SEND-INSTRUCTIONP
                 TASK-RECEIVE-INSTRUCTIONP TASK-TYO-INSTRUCTIONP
                 TASK-TYI-INSTRUCTIONP
                 AK-EXECUTE-RECEIVE-IMPLEMENTS-TASK-EXECUTE-RECEIVE
                 AK-EXECUTE-INPUT-IMPLEMENTS-TASK-EXECUTE-INPUT
                 AK-EXECUTE-OUTPUT-IMPLEMENTS-TASK-EXECUTE-OUTPUT
                 AK-EXECUTE-SEND-IMPLEMENTS-TASK-EXECUTE-SEND
                 ACCESS-AK-ERROR-HANDLER)
         (DISABLE-THEORY T)))

(DISABLE AK-SVC-HANDLER-IMPLEMENTS-TASK-COMMUNICATION-STEP)

(PROVE-LEMMA
            AK-PRIVATE-STEP-IMPLEMENTS-TASK-FETCH-EXECUTE
            (REWRITE)
            (IMPLIES (AND (GOOD-AK AK)
                          (AND (NOT (AK-WAITING AK))
                               (AND (FINITE-NUMBERP I
                                                    (LENGTH (AK-PSTATES AK)))
                                    (EQUAL I (AK-TASKID AK)))))
                     (EQUAL (TASK (GETNTH I
                                          (AK-PSTATES (AK-PRIVATE-STEP AK)))
                                  (AK-CHANNELS (AK-PRIVATE-STEP AK)))
                            (TASK (TM-FETCH-EXECUTE (GETNTH I (AK-PSTATES AK)))
                                  (AK-CHANNELS AK))))
            ((ENABLE FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE AK-CHANNELS
                     AK-FETCH-EXECUTE AK-PRIVATE-STEP)
             (ENABLE-THEORY GOOD-AK-PROPERTIES AK-SHELL TASK-SHELL GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE AK-PRIVATE-STEP-IMPLEMENTS-TASK-FETCH-EXECUTE)

(PROVE-LEMMA
 AK-IMPLEMENTS-ACTIVE-TASK-STEP
 (REWRITE)
 (IMPLIES
   (AND (GOOD-AK AK)
        (AND (FINITE-NUMBERP I
                             (LENGTH (AK-PSTATES AK)))
             (TASK-ACTIVEP (CONTROL-ORACLE-STEP I
                                                (AK-POST-INTERRUPT (CAR ORACLE)
                                                                   AK)))))
   (EQUAL (PROJECT I
                   (AK-STEP (AK-POST-INTERRUPT (CAR ORACLE) AK)))
          (TASK-STEP (PROJECT I AK) I)))
 ((ENABLE CONTROL-ORACLE-STEP PROJECT GETNTH TASK-ACTIVEP AK-CHANNELS
          TASK-UPDATE-CHANNELS TASK-COMMUNICATIONP TASK-PRIVATE-STEP
          AK-SVC-INTERRUPTP TASK-STEP TASK-FETCH-EXECUTE AK-STEP
          GOOD-AK-AK-POST-INTERRUPT ACCESS-AK-POST-INTERRUPT)
  (ENABLE-THEORY TASK-SHELL GROUND-ZERO)
  (USE
   (AK-SVC-HANDLER-IMPLEMENTS-TASK-COMMUNICATION-STEP
                                      (AK (AK-POST-INTERRUPT (CAR ORACLE) AK)))
   (AK-PRIVATE-STEP-IMPLEMENTS-TASK-FETCH-EXECUTE
                                     (AK (AK-POST-INTERRUPT (CAR ORACLE) AK))))
  (DISABLE-THEORY T)))

(DISABLE AK-IMPLEMENTS-ACTIVE-TASK-STEP)

(PROVE-LEMMA AK-IMPLEMENTS-PARALLEL-TASKS
             (REWRITE)
             (IMPLIES (AND (GOOD-AK AK)
                           (FINITE-NUMBERP I
                                           (LENGTH (AK-PSTATES AK))))
                      (EQUAL (PROJECT I (AK-PROCESSOR AK ORACLE))
                             (TASK-PROCESSOR (PROJECT I AK)
                                             I
                                             (CONTROL-ORACLE I AK ORACLE))))
             ((ENABLE AK-PROCESSOR CONTROL-ORACLE TASK-PROCESSOR
                      FINITE-NUMBERP GOOD-AK-AK-STEP GOOD-AK-AK-POST-INTERRUPT
                      FINITE-NUMBERP-AK-TASKID AK-IMPLEMENTS-ACTIVE-TASK-STEP
                      AK-IMPLEMENTS-NON-ACTIVE-TASK-STEP
                      LENGTH-AK-PSTATES-AK-STEP ACCESS-AK-POST-INTERRUPT)
              (INDUCT (AK-PROCESSOR AK ORACLE))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-IMPLEMENTS-PARALLEL-TASKS)

(DEFN ASM-OPCODE-ALIST
      NIL
      '((RETURN . 0)
        (WAIT . 4)
        (RUN . 8)
        (BR . 2)
        (BRZ . 10)
        (BRNZ . 6)
        (CALL . 14)
        (DECR . 18)
        (DECRM . 5)
        (INCR . 22)
        (INCRM . 7)
        (LBASE . 26)
        (LLIMIT . 30)
        (LPSW . 34)
        (POST . 38)
        (SVC . 42)
        (SVCR . 46)
        (TIME . 58)
        (ADD . 1)
        (COMPARE . 3)
        (MOD . 9)
        (MOVE . 11)
        (MULT . 13)
        (STOUT . 15)
        (TESTI . 50)
        (TESTO . 54))
      NIL)

(DEFN APPEND-N-TIMES
      (N LIST)
      (IF (ZEROP N)
          'NIL
          (APPEND LIST
                  (APPEND-N-TIMES (SUB1 N) LIST)))
      NIL)

(DEFN LOOKUP
      (X ALIST)
      (IF (LISTP ALIST)
          (IF (AND (LISTP (CAR ALIST))
                   (EQUAL X (CAR (CAR ALIST))))
              (CDR (CAR ALIST))
              (LOOKUP X (CDR ALIST)))
          'NIL)
      NIL)

(DEFN BOUNDP
      (X ALIST)
      (IF (LISTP ALIST)
          (IF (LISTP (CAR ALIST))
              (IF (EQUAL X (CAR (CAR ALIST)))
                  '*1*TRUE
                  (BOUNDP X (CDR ALIST)))
              (BOUNDP X (CDR ALIST)))
          '*1*FALSE)
      NIL)

(DEFN NUMBER-AND-LITATOM-LISTP
      (X)
      (IF (LISTP X)
          (AND (OR (NUMBERP (CAR X))
                   (LITATOM (CAR X)))
               (NUMBER-AND-LITATOM-LISTP (CDR X)))
          '*1*TRUE)
      NIL)

(DEFN DC-FORMP
 (X)
 (AND
     (LISTP X)
     (AND (EQUAL (CAR X) 'DC)
          (AND (NUMBERP (CAR (CDR X)))
               (OR (NUMBERP (CAR (CDR (CDR X))))
                   (OR (LITATOM (CAR (CDR (CDR X))))
                       (OR (LISTP (CAR (CDR (CDR X))))
                           (NUMBER-AND-LITATOM-LISTP (CAR (CDR (CDR X))))))))))
 NIL)

(DEFN TRANSLATE-DC-ARG
      (ARG SYMTAB)
      (IF (NUMBERP ARG)
          ARG
          (IF (LITATOM ARG)
              (IF (BOUNDP ARG SYMTAB)
                  (LOOKUP ARG SYMTAB)
                  ARG)
              ARG))
      NIL)

(DEFN TRANSLATE-DC-ARGLIST
      (ARGLIST SYMTAB)
      (IF (LISTP ARGLIST)
          (CONS (TRANSLATE-DC-ARG (CAR ARGLIST)
                                  SYMTAB)
                (TRANSLATE-DC-ARGLIST (CDR ARGLIST)
                                      SYMTAB))
          'NIL)
      NIL)

(DEFN TRANSLATE-DC
 (DC-FORM SYMTAB)
 (IF
    (DC-FORMP DC-FORM)
    (APPEND-N-TIMES (CAR (CDR DC-FORM))
                    (TRANSLATE-DC-ARGLIST (IF (LISTP (CAR (CDR (CDR DC-FORM))))
                                              (CAR (CDR (CDR DC-FORM)))
                                              (CONS (CAR (CDR (CDR DC-FORM)))
                                                    'NIL))
                                          SYMTAB))
    DC-FORM)
 NIL)

(DEFN ASM-INSTRUCTION-OPCODE
      (INSTRUCTION)
      (LOOKUP (CAR INSTRUCTION)
              '((RETURN . 0)
                (WAIT . 4)
                (RUN . 8)
                (BR . 2)
                (BRZ . 10)
                (BRNZ . 6)
                (CALL . 14)
                (DECR . 18)
                (DECRM . 5)
                (INCR . 22)
                (INCRM . 7)
                (LBASE . 26)
                (LLIMIT . 30)
                (LPSW . 34)
                (POST . 38)
                (SVC . 42)
                (SVCR . 46)
                (TIME . 58)
                (ADD . 1)
                (COMPARE . 3)
                (MOD . 9)
                (MOVE . 11)
                (MULT . 13)
                (STOUT . 15)
                (TESTI . 50)
                (TESTO . 54)))
      NIL)

(DEFN ASM-INSTRUCTION-MODE1
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR INSTRUCTION)))
          (IF (BOUNDP (CAR (CAR (CDR INSTRUCTION)))
                      SYMTAB)
              (LOOKUP (CAR (CAR (CDR INSTRUCTION)))
                      SYMTAB)
              (CAR (CAR (CDR INSTRUCTION))))
          '0)
      NIL)

(DEFN ASM-INSTRUCTION-ARG1
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR INSTRUCTION)))
          (IF (BOUNDP (CAR (CDR (CAR (CDR INSTRUCTION))))
                      SYMTAB)
              (LOOKUP (CAR (CDR (CAR (CDR INSTRUCTION))))
                      SYMTAB)
              (CAR (CDR (CAR (CDR INSTRUCTION)))))
          (IF (BOUNDP (CAR (CDR INSTRUCTION))
                      SYMTAB)
              (LOOKUP (CAR (CDR INSTRUCTION))
                      SYMTAB)
              (CAR (CDR INSTRUCTION))))
      NIL)

(DEFN ASM-INSTRUCTION-INDEX1
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR INSTRUCTION)))
          (IF (BOUNDP (CAR (CDR (CDR (CAR (CDR INSTRUCTION)))))
                      SYMTAB)
              (LOOKUP (CAR (CDR (CDR (CAR (CDR INSTRUCTION)))))
                      SYMTAB)
              (CAR (CDR (CDR (CAR (CDR INSTRUCTION))))))
          '0)
      NIL)

(DEFN ASM-INSTRUCTION-MODE2
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR (CDR INSTRUCTION))))
          (IF (BOUNDP (CAR (CAR (CDR (CDR INSTRUCTION))))
                      SYMTAB)
              (LOOKUP (CAR (CAR (CDR (CDR INSTRUCTION))))
                      SYMTAB)
              (CAR (CAR (CDR (CDR INSTRUCTION)))))
          '0)
      NIL)

(DEFN ASM-INSTRUCTION-ARG2
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR (CDR INSTRUCTION))))
          (IF (BOUNDP (CAR (CDR (CAR (CDR (CDR INSTRUCTION)))))
                      SYMTAB)
              (LOOKUP (CAR (CDR (CAR (CDR (CDR INSTRUCTION)))))
                      SYMTAB)
              (CAR (CDR (CAR (CDR (CDR INSTRUCTION))))))
          (IF (BOUNDP (CAR (CDR (CDR INSTRUCTION)))
                      SYMTAB)
              (LOOKUP (CAR (CDR (CDR INSTRUCTION)))
                      SYMTAB)
              (CAR (CDR (CDR INSTRUCTION)))))
      NIL)

(DEFN ASM-INSTRUCTION-INDEX2
      (INSTRUCTION SYMTAB)
      (IF (LISTP (CAR (CDR (CDR INSTRUCTION))))
          (IF (BOUNDP (CAR (CDR (CDR (CAR (CDR (CDR INSTRUCTION))))))
                      SYMTAB)
              (LOOKUP (CAR (CDR (CDR (CAR (CDR (CDR INSTRUCTION))))))
                      SYMTAB)
              (CAR (CDR (CDR (CAR (CDR (CDR INSTRUCTION)))))))
          '0)
      NIL)

(DEFN ASM-GOOD-ARG
      (ARG MODE)
      (IF (OR (EQUAL MODE '0) (EQUAL MODE '2))
          (FINITE-NUMBERP ARG '65536)
          (FINITE-NUMBERP ARG '8))
      NIL)

(DEFN ASM-GOOD-INSTRUCTION
 (INSTRUCTION SYMTAB)
 (AND
  (BOUNDP (CAR INSTRUCTION)
          '((RETURN . 0)
            (WAIT . 4)
            (RUN . 8)
            (BR . 2)
            (BRZ . 10)
            (BRNZ . 6)
            (CALL . 14)
            (DECR . 18)
            (DECRM . 5)
            (INCR . 22)
            (INCRM . 7)
            (LBASE . 26)
            (LLIMIT . 30)
            (LPSW . 34)
            (POST . 38)
            (SVC . 42)
            (SVCR . 46)
            (TIME . 58)
            (ADD . 1)
            (COMPARE . 3)
            (MOD . 9)
            (MOVE . 11)
            (MULT . 13)
            (STOUT . 15)
            (TESTI . 50)
            (TESTO . 54)))
  (AND
   (EQUAL (LENGTH INSTRUCTION)
          (IF (TM-NULLARY-INSTRUCTIONP (LOOKUP (CAR INSTRUCTION)
                                               '((RETURN . 0)
                                                 (WAIT . 4)
                                                 (RUN . 8)
                                                 (BR . 2)
                                                 (BRZ . 10)
                                                 (BRNZ . 6)
                                                 (CALL . 14)
                                                 (DECR . 18)
                                                 (DECRM . 5)
                                                 (INCR . 22)
                                                 (INCRM . 7)
                                                 (LBASE . 26)
                                                 (LLIMIT . 30)
                                                 (LPSW . 34)
                                                 (POST . 38)
                                                 (SVC . 42)
                                                 (SVCR . 46)
                                                 (TIME . 58)
                                                 (ADD . 1)
                                                 (COMPARE . 3)
                                                 (MOD . 9)
                                                 (MOVE . 11)
                                                 (MULT . 13)
                                                 (STOUT . 15)
                                                 (TESTI . 50)
                                                 (TESTO . 54))))
              '1
              (IF (TM-UNARY-INSTRUCTIONP (LOOKUP (CAR INSTRUCTION)
                                                 '((RETURN . 0)
                                                   (WAIT . 4)
                                                   (RUN . 8)
                                                   (BR . 2)
                                                   (BRZ . 10)
                                                   (BRNZ . 6)
                                                   (CALL . 14)
                                                   (DECR . 18)
                                                   (DECRM . 5)
                                                   (INCR . 22)
                                                   (INCRM . 7)
                                                   (LBASE . 26)
                                                   (LLIMIT . 30)
                                                   (LPSW . 34)
                                                   (POST . 38)
                                                   (SVC . 42)
                                                   (SVCR . 46)
                                                   (TIME . 58)
                                                   (ADD . 1)
                                                   (COMPARE . 3)
                                                   (MOD . 9)
                                                   (MOVE . 11)
                                                   (MULT . 13)
                                                   (STOUT . 15)
                                                   (TESTI . 50)
                                                   (TESTO . 54))))
                  '2
                  '3)))
   (AND (FINITE-NUMBERP (ASM-INSTRUCTION-MODE1 INSTRUCTION SYMTAB)
                        '4)
        (AND (FINITE-NUMBERP (ASM-INSTRUCTION-MODE2 INSTRUCTION SYMTAB)
                             '4)
             (AND (ASM-GOOD-ARG (ASM-INSTRUCTION-ARG1 INSTRUCTION SYMTAB)
                                (ASM-INSTRUCTION-MODE1 INSTRUCTION SYMTAB))
                  (AND (ASM-GOOD-ARG (ASM-INSTRUCTION-ARG2 INSTRUCTION SYMTAB)
                                     (ASM-INSTRUCTION-MODE2 INSTRUCTION
                                                            SYMTAB))
                       (AND (FINITE-NUMBERP (ASM-INSTRUCTION-INDEX1 INSTRUCTION
                                                                    SYMTAB)
                                            '8)
                            (FINITE-NUMBERP (ASM-INSTRUCTION-INDEX2 INSTRUCTION
                                                                    SYMTAB)
                                            '8))))))))
 NIL)

(DEFN ASM-PACK-WORD1
     (INSTRUCTION SYMTAB)
     (IF (EQUAL (LENGTH INSTRUCTION) '1)
         (ASM-INSTRUCTION-OPCODE INSTRUCTION)
         (IF (EQUAL (LENGTH INSTRUCTION) '2)
             (PLUS (ASM-INSTRUCTION-OPCODE INSTRUCTION)
                   (PLUS (TIMES (ASM-INSTRUCTION-MODE1 INSTRUCTION SYMTAB)
                                '64)
                         (TIMES (ASM-INSTRUCTION-INDEX1 INSTRUCTION SYMTAB)
                                '256)))
             (PLUS (ASM-INSTRUCTION-OPCODE INSTRUCTION)
                   (PLUS (TIMES (ASM-INSTRUCTION-MODE1 INSTRUCTION SYMTAB)
                                '64)
                         (PLUS (TIMES (ASM-INSTRUCTION-INDEX1 INSTRUCTION
                                                              SYMTAB)
                                      '256)
                               (PLUS (TIMES (ASM-INSTRUCTION-MODE2 INSTRUCTION
                                                                   SYMTAB)
                                            '2048)
                                     (TIMES (ASM-INSTRUCTION-INDEX2 INSTRUCTION
                                                                    SYMTAB)
                                            '8192)))))))
     NIL)

(DEFN ASM-PACK-INSTRUCTION
      (INSTRUCTION SYMTAB)
      (IF (EQUAL (LENGTH INSTRUCTION) '1)
          (CONS (ASM-PACK-WORD1 INSTRUCTION SYMTAB)
                'NIL)
          (IF (EQUAL (LENGTH INSTRUCTION) '2)
              (CONS (ASM-PACK-WORD1 INSTRUCTION SYMTAB)
                    (CONS (ASM-INSTRUCTION-ARG1 INSTRUCTION SYMTAB)
                          'NIL))
              (CONS (ASM-PACK-WORD1 INSTRUCTION SYMTAB)
                    (CONS (ASM-INSTRUCTION-ARG1 INSTRUCTION SYMTAB)
                          (CONS (ASM-INSTRUCTION-ARG2 INSTRUCTION SYMTAB)
                                'NIL)))))
      NIL)

(DEFN TRANSLATE-INSTRUCTION
      (INSTRUCTION SYMTAB)
      (IF (ASM-GOOD-INSTRUCTION INSTRUCTION SYMTAB)
          (ASM-PACK-INSTRUCTION INSTRUCTION SYMTAB)
          INSTRUCTION)
      NIL)

(DEFN TRANSLATE-SOURCE
      (SOURCE SYMTAB)
      (IF (LISTP SOURCE)
          (IF (LITATOM (CAR SOURCE))
              (TRANSLATE-SOURCE (CDR SOURCE) SYMTAB)
              (IF (AND (LISTP (CAR SOURCE))
                       (EQUAL (CAR (CAR SOURCE)) 'DCL))
                  (TRANSLATE-SOURCE (CDR SOURCE) SYMTAB)
                  (IF (AND (LISTP (CAR SOURCE))
                           (EQUAL (CAR (CAR SOURCE)) 'DC))
                      (APPEND (TRANSLATE-DC (CAR SOURCE) SYMTAB)
                              (TRANSLATE-SOURCE (CDR SOURCE)
                                                SYMTAB))
                      (APPEND (TRANSLATE-INSTRUCTION (CAR SOURCE)
                                                     SYMTAB)
                              (TRANSLATE-SOURCE (CDR SOURCE)
                                                SYMTAB)))))
          'NIL)
      NIL)

(DEFN INCR-DC-POSITION
      (DC-FORM)
      (IF (LISTP (CAR (CDR (CDR DC-FORM))))
          (TIMES (CAR (CDR DC-FORM))
                 (LENGTH (CAR (CDR (CDR DC-FORM)))))
          (CAR (CDR DC-FORM)))
      NIL)

(DEFN INCR-INSTRUCTION-POSITION
      (INSTRUCTION)
      (IF (BOUNDP (CAR INSTRUCTION)
                  '((RETURN . 0)
                    (WAIT . 4)
                    (RUN . 8)
                    (BR . 2)
                    (BRZ . 10)
                    (BRNZ . 6)
                    (CALL . 14)
                    (DECR . 18)
                    (DECRM . 5)
                    (INCR . 22)
                    (INCRM . 7)
                    (LBASE . 26)
                    (LLIMIT . 30)
                    (LPSW . 34)
                    (POST . 38)
                    (SVC . 42)
                    (SVCR . 46)
                    (TIME . 58)
                    (ADD . 1)
                    (COMPARE . 3)
                    (MOD . 9)
                    (MOVE . 11)
                    (MULT . 13)
                    (STOUT . 15)
                    (TESTI . 50)
                    (TESTO . 54)))
          (IF (TM-NULLARY-INSTRUCTIONP (LOOKUP (CAR INSTRUCTION)
                                               '((RETURN . 0)
                                                 (WAIT . 4)
                                                 (RUN . 8)
                                                 (BR . 2)
                                                 (BRZ . 10)
                                                 (BRNZ . 6)
                                                 (CALL . 14)
                                                 (DECR . 18)
                                                 (DECRM . 5)
                                                 (INCR . 22)
                                                 (INCRM . 7)
                                                 (LBASE . 26)
                                                 (LLIMIT . 30)
                                                 (LPSW . 34)
                                                 (POST . 38)
                                                 (SVC . 42)
                                                 (SVCR . 46)
                                                 (TIME . 58)
                                                 (ADD . 1)
                                                 (COMPARE . 3)
                                                 (MOD . 9)
                                                 (MOVE . 11)
                                                 (MULT . 13)
                                                 (STOUT . 15)
                                                 (TESTI . 50)
                                                 (TESTO . 54))))
              '1
              (IF (TM-UNARY-INSTRUCTIONP (LOOKUP (CAR INSTRUCTION)
                                                 '((RETURN . 0)
                                                   (WAIT . 4)
                                                   (RUN . 8)
                                                   (BR . 2)
                                                   (BRZ . 10)
                                                   (BRNZ . 6)
                                                   (CALL . 14)
                                                   (DECR . 18)
                                                   (DECRM . 5)
                                                   (INCR . 22)
                                                   (INCRM . 7)
                                                   (LBASE . 26)
                                                   (LLIMIT . 30)
                                                   (LPSW . 34)
                                                   (POST . 38)
                                                   (SVC . 42)
                                                   (SVCR . 46)
                                                   (TIME . 58)
                                                   (ADD . 1)
                                                   (COMPARE . 3)
                                                   (MOD . 9)
                                                   (MOVE . 11)
                                                   (MULT . 13)
                                                   (STOUT . 15)
                                                   (TESTI . 50)
                                                   (TESTO . 54))))
                  '2
                  '3))
          '0)
      NIL)

(DEFN BUILD-SYMTAB
 (SOURCE SYMTAB POSITION)
 (IF
  (LISTP SOURCE)
  (IF (LITATOM (CAR SOURCE))
      (BUILD-SYMTAB (CDR SOURCE)
                    (CONS (CONS (CAR SOURCE) POSITION)
                          SYMTAB)
                    POSITION)
      (IF (AND (LISTP (CAR SOURCE))
               (EQUAL (CAR (CAR SOURCE)) 'DCL))
          (BUILD-SYMTAB (CDR SOURCE)
                        (CONS (CONS (CAR (CDR (CAR SOURCE)))
                                    (CAR (CDR (CDR (CAR SOURCE)))))
                              SYMTAB)
                        POSITION)
          (IF (AND (LISTP (CAR SOURCE))
                   (EQUAL (CAR (CAR SOURCE)) 'DC))
              (BUILD-SYMTAB (CDR SOURCE)
                            SYMTAB
                            (PLUS POSITION
                                  (INCR-DC-POSITION (CAR SOURCE))))
              (BUILD-SYMTAB (CDR SOURCE)
                            SYMTAB
                            (PLUS POSITION
                                  (INCR-INSTRUCTION-POSITION (CAR SOURCE)))))))
  SYMTAB)
 NIL)

(DEFN FIND-DUPLICATE-SYMBOL
      (SYMTAB ALREADY-SEEN)
      (IF (LISTP SYMTAB)
          (IF (LISTP (CAR SYMTAB))
              (IF (MEMBER (CAR (CAR SYMTAB))
                          ALREADY-SEEN)
                  (CAR (CAR SYMTAB))
                  (FIND-DUPLICATE-SYMBOL (CDR SYMTAB)
                                         (CONS (CAR (CAR SYMTAB))
                                               ALREADY-SEEN)))
              (FIND-DUPLICATE-SYMBOL (CDR SYMTAB)
                                     ALREADY-SEEN))
          '*1*FALSE)
      NIL)

(DEFN ASSEMBLY-ERRORP
      (ASSEMBLER-RESULT)
      (NOT (AND (PLISTP ASSEMBLER-RESULT)
                (AND (EQUAL (LENGTH ASSEMBLER-RESULT) '2)
                     (EQUAL (CAR (CDR ASSEMBLER-RESULT))
                            '*1*TRUE))))
      NIL)

(DEFN FIND-NON-FINITE-NUMBER
      (L)
      (IF (LISTP L)
          (IF (FINITE-NUMBERP (CAR L) '65536)
              (FIND-NON-FINITE-NUMBER (CDR L))
              (CAR L))
          'NIL)
      NIL)

(DEFN ASSEMBLE2
      (MEMORY)
      (IF (FINITE-NUMBER-TABLEP '100
                                (TABLE '100 MEMORY)
                                '65536)
          (CONS MEMORY '(*1*TRUE))
          (CONS 'NIL
                (CONS (CONS 'ASSEMBLY
                            (CONS 'ERROR
                                  (CONS (FIND-NON-FINITE-NUMBER MEMORY)
                                        'NIL)))
                      'NIL)))
      NIL)

(DEFN ASSEMBLE1
 (SOURCE SYMTAB)
 (IF
  (FIND-DUPLICATE-SYMBOL SYMTAB 'NIL)
  (CONS 'NIL
       (CONS (CONS 'ASSEMBLY
                   (CONS 'ERROR
                         (CONS 'DUPLICATE
                               (CONS 'LABEL
                                     (CONS (FIND-DUPLICATE-SYMBOL SYMTAB 'NIL)
                                           'NIL)))))
             'NIL))
  (ASSEMBLE2 (TRANSLATE-SOURCE SOURCE SYMTAB)))
 NIL)

(DEFN ASSEMBLE
      (SOURCE)
      (ASSEMBLE1 SOURCE
                 (BUILD-SYMTAB SOURCE 'NIL '0))
      NIL)

(DEFTHEORY ASSEMBLER
           (ASSEMBLE ASSEMBLE1 ASSEMBLE2 FIND-NON-FINITE-NUMBER
                     ASSEMBLY-ERRORP FIND-DUPLICATE-SYMBOL BUILD-SYMTAB
                     INCR-INSTRUCTION-POSITION INCR-DC-POSITION
                     TRANSLATE-SOURCE TRANSLATE-INSTRUCTION
                     ASM-PACK-INSTRUCTION ASM-PACK-WORD1 ASM-GOOD-INSTRUCTION
                     ASM-GOOD-ARG ASM-INSTRUCTION-INDEX2 ASM-INSTRUCTION-ARG2
                     ASM-INSTRUCTION-MODE2 ASM-INSTRUCTION-INDEX1
                     ASM-INSTRUCTION-ARG1 ASM-INSTRUCTION-MODE1
                     ASM-INSTRUCTION-OPCODE TRANSLATE-DC TRANSLATE-DC-ARGLIST
                     TRANSLATE-DC-ARG DC-FORMP NUMBER-AND-LITATOM-LISTP BOUNDP
                     APPEND-N-TIMES ASM-OPCODE-ALIST))

(DEFN REVERSE-ALIST
      (ALIST)
      (IF (LISTP ALIST)
          (CONS (CONS (CDR (CAR ALIST))
                      (CAR (CAR ALIST)))
                (REVERSE-ALIST (CDR ALIST)))
          ALIST)
      NIL)

(DEFN ASM-REVERSE-OPCODE-ALIST NIL
      '((0 . RETURN)
        (4 . WAIT)
        (8 . RUN)
        (2 . BR)
        (10 . BRZ)
        (6 . BRNZ)
        (14 . CALL)
        (18 . DECR)
        (5 . DECRM)
        (22 . INCR)
        (7 . INCRM)
        (26 . LBASE)
        (30 . LLIMIT)
        (34 . LPSW)
        (38 . POST)
        (42 . SVC)
        (46 . SVCR)
        (58 . TIME)
        (1 . ADD)
        (3 . COMPARE)
        (9 . MOD)
        (11 . MOVE)
        (13 . MULT)
        (15 . STOUT)
        (50 . TESTI)
        (54 . TESTO))
      NIL)

(DEFN ASM-SYMBOLIC-OPCODE
      (N)
      (LOOKUP (TM-OPCODE N)
              '((0 . RETURN)
                (4 . WAIT)
                (8 . RUN)
                (2 . BR)
                (10 . BRZ)
                (6 . BRNZ)
                (14 . CALL)
                (18 . DECR)
                (5 . DECRM)
                (22 . INCR)
                (7 . INCRM)
                (26 . LBASE)
                (30 . LLIMIT)
                (34 . LPSW)
                (38 . POST)
                (42 . SVC)
                (46 . SVCR)
                (58 . TIME)
                (1 . ADD)
                (3 . COMPARE)
                (9 . MOD)
                (11 . MOVE)
                (13 . MULT)
                (15 . STOUT)
                (50 . TESTI)
                (54 . TESTO)))
      NIL)

(DEFN OS-READYQ-LENGTH NIL '20 NIL)

(DEFN OS-TASK-TABLE-LENGTH NIL
      '144
      NIL)

(DEFN OS-SEGMENT-TABLE-LENGTH NIL '32
      NIL)

(DEFN OS-STATUS-TABLE-LENGTH NIL '32
      NIL)

(DEFN OS-IBUFFER-LENGTH NIL '8 NIL)

(DEFN OS-IBUFFERS-LENGTH NIL
      '128
      NIL)

(DEFN OS-OBUFFER-LENGTH NIL '8 NIL)

(DEFN OS-OBUFFERS-LENGTH NIL
      '128
      NIL)

(DEFN OS-MBUFFER-LENGTH NIL '8 NIL)

(DEFN OS-MBUFFERS-LENGTH NIL
      '2048
      NIL)

(DEFN OS-MBUFFERS-LENGTH-QUARTER NIL '512
      NIL)

(PROVE-LEMMA OS-MBUFFERS-LENGTH-IS-DIVISIBLE-BY-4 NIL '*1*TRUE
             ((ENABLE DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN OS-SOURCE NIL
      '((DCL R0 0)
        (DCL R1 1)
        (DCL R2 2)
        (DCL R3 3)
        (DCL R4 4)
        (DCL R5 5)
        (DCL R6 6)
        (DCL R7 7)
        (DCL INTERRUPT-PC-FIELD 0)
        (DCL INTERRUPT-SP-FIELD 1)
        (DCL INTERRUPT-FLAG-FIELD 2)
        (DCL SVCID-ADDR 8)
        (DCL INPUT-DEVID-ADDR 8)
        (DCL INPUT-CHAR-ADDR 9)
        (DCL OUTPUT-DEVID-ADDR 9)
        (DCL CHARLUB 256)
        (DCL SEND-SVCID 0)
        (DCL RECEIVE-SVCID 1)
        (DCL TYO-SVCID 2)
        (DCL TYI-SVCID 3)
        (DCL TASK-TABLE-LENGTH 144)
        (DCL TASK-TABLE-ENTRY-LENGTH 9)
        (DCL PC-FIELD 0)
        (DCL SP-FIELD 1)
        (DCL R2-FIELD 2)
        (DCL R3-FIELD 3)
        (DCL R4-FIELD 4)
        (DCL R5-FIELD 5)
        (DCL R6-FIELD 6)
        (DCL R7-FIELD 7)
        (DCL FLAG-FIELD 8)
        (DCL READYQ-LENGTH 20)
        (DCL QHEAD-FIELD 0)
        (DCL QTAIL-FIELD 1)
        (DCL QCURRLENGTH-FIELD 2)
        (DCL QMAXLENGTH-FIELD 3)
        (DCL QARRAY-FIELD 4)
        (DCL SEGMENT-TABLE-LENGTH 32)
        (DCL BASE-FIELD 0)
        (DCL LIMIT-FIELD 1)
        (DCL STATUS-ENTRY-LENGTH 2)
        (DCL STATUS-FLAG-FIELD 0)
        (DCL STATUS-TASKID-FIELD 1)
        (DCL READY-STATUS 0)
        (DCL ERROR-STATUS 1)
        (DCL SEND-STATUS 2)
        (DCL RECEIVE-STATUS 3)
        (DCL OUTPUT-STATUS 4)
        (DCL INPUT-STATUS 5)
        (DCL INPUT-BUFFER-LENGTH 8)
        (DCL OUTPUT-BUFFER-LENGTH 8)
        (DCL MESSAGE-BUFFER-LENGTH 8)
        (DCL SOURCE-MULTIPLIER 128)
        (DCL DEST-MULTIPLIER 8)
        (DCL TASKIDLUB 16)
        REG-SAVE-AREA
        (DC 3 0)
        CLOCK-NEW-PC
        (DC 1 CLOCK-INTERRUPT-HANDLER)
        ERROR-NEW-PC
        (DC 1 ERROR-INTERRUPT-HANDLER)
        SVC-NEW-PC
        (DC 1 SVC-INTERRUPT-HANDLER)
        INPUT-NEW-PC
        (DC 1 INPUT-INTERRUPT-HANDLER)
        OUTPUT-NEW-PC
        (DC 1 OUTPUT-INTERRUPT-HANDLER)
        INTERRUPT-DATA
        (DC 2 0)
        BRANCH-ADDRESS
        (DC 1 0)
        TIME-SLICE
        (DC 1 1000)
        CURRENT-TASKID
        (DC 1 0)
        TEMP-R2
        (DC 1 0)
        TEMP-R3
        (DC 1 0)
        TASK-TABLE
        (DC 144 0)
        SEGMENT-TABLE
        (DC 32 0)
        READYQ
        (DC 20 0)
        STATUS-TABLE
        (DC 32 0)
        IBUFFERS
        (DC 128 0)
        OBUFFERS
        (DC 128 0)
        MBUFFERS
        (DC 512 0)
        (DC 512 0)
        (DC 512 0)
        (DC 512 0)
        SAVE-STATE
        (MOVE (2 TEMP-R2) (1 R2))
        (MOVE (2 TEMP-R3) (1 R3))
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        SAVE-STATE-RETURN
        (MULT (1 R2) TASK-TABLE-ENTRY-LENGTH)
        (ADD (1 R2) TASK-TABLE)
        (MOVE (3 R2 PC-FIELD)
              (2 REG-SAVE-AREA INTERRUPT-PC-FIELD))
        (MOVE (3 R2 SP-FIELD)
              (2 REG-SAVE-AREA INTERRUPT-SP-FIELD))
        (MOVE (3 R2 R2-FIELD) (2 TEMP-R2))
        (MOVE (3 R2 R3-FIELD) (2 TEMP-R3))
        (MOVE (3 R2 R4-FIELD) (1 R4))
        (MOVE (3 R2 R5-FIELD) (1 R5))
        (MOVE (3 R2 R6-FIELD) (1 R6))
        (MOVE (3 R2 R7-FIELD) (1 R7))
        (ADD (1 R2) FLAG-FIELD)
        (MOVE (3 R2)
              (2 REG-SAVE-AREA INTERRUPT-FLAG-FIELD))
        (MOVE (1 R2) (2 TEMP-R2))
        (MOVE (1 R3) (2 TEMP-R3))
        (RETURN)
        RESTORE-STATE
        (MOVE (1 R3) (1 R2))
        (MULT (1 R2) TASK-TABLE-ENTRY-LENGTH)
        (ADD (1 R2) TASK-TABLE)
        (MULT (1 R3) 2)
        (ADD (1 R3) SEGMENT-TABLE)
        (LBASE (3 R3 BASE-FIELD))
        (LLIMIT (3 R3 LIMIT-FIELD))
        (MOVE (1 R3) (1 R2))
        (ADD (1 R3) FLAG-FIELD)
        (MOVE (2 REG-SAVE-AREA INTERRUPT-PC-FIELD)
              (3 R2 PC-FIELD))
        (MOVE (2 REG-SAVE-AREA INTERRUPT-SP-FIELD)
              (3 R2 SP-FIELD))
        (MOVE (2 REG-SAVE-AREA INTERRUPT-FLAG-FIELD)
              (3 R3))
        (MOVE (1 R7) (3 R2 R7-FIELD))
        (MOVE (1 R6) (3 R2 R6-FIELD))
        (MOVE (1 R5) (3 R2 R5-FIELD))
        (MOVE (1 R4) (3 R2 R4-FIELD))
        (MOVE (1 R3) (3 R2 R3-FIELD))
        (MOVE (1 R2) (3 R2 R2-FIELD))
        (RETURN)
        CLOCK-INTERRUPT-HANDLER
        (CALL SAVE-STATE)
        TRACE-LABEL1
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        (CALL DEQUEUE)
        (CALL ENQUEUE)
        TRACE-LABEL2
        (BR DISPATCHER)
        ERROR-INTERRUPT-HANDLER
        (CALL SAVE-STATE)
        TRACE-LABEL3
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        (CALL DEQUEUE)
        TRACE-LABEL4
        (MULT (1 R2) STATUS-ENTRY-LENGTH)
        (ADD (1 R2) STATUS-TABLE)
        (MOVE (3 R2 STATUS-FLAG-FIELD)
              ERROR-STATUS)
        (MOVE (3 R2 STATUS-TASKID-FIELD) 0)
        (BR DISPATCHER)
        SVC-INTERRUPT-HANDLER
        (CALL SAVE-STATE)
        TRACE-LABEL5
        (MOD (2 SVCID-ADDR) 4)
        (COMPARE (2 SVCID-ADDR) SEND-SVCID)
        (BRZ SEND-SVC-HANDLER)
        (COMPARE (2 SVCID-ADDR) RECEIVE-SVCID)
        (BRZ RECEIVE-SVC-HANDLER)
        (COMPARE (2 SVCID-ADDR) TYO-SVCID)
        (BRZ TYO-SVC-HANDLER)
        (BR TYI-SVC-HANDLER)
        SEND-SVC-HANDLER
        (MOVE (1 R6) (1 R2))
        (MOD (1 R6) TASKIDLUB)
        (MOVE (1 R7) (1 R3))
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        TRACE-LABEL6
        (MOVE (2 CURRENT-TASKID) (1 R2))
        (MOVE (1 R4) (1 R6))
        (MULT (1 R4) DEST-MULTIPLIER)
        (MOVE (1 R3) (1 R2))
        (MULT (1 R3) SOURCE-MULTIPLIER)
        (ADD (1 R3) (1 R4))
        (ADD (1 R3) MBUFFERS)
        TRACE-LABEL7
        (CALL QFULLP)
        (BRZ BLOCK-SEND)
        (MOVE (1 R2) (1 R7))
        (CALL ENQUEUE)
        TRACE-LABEL8
        (MOVE (1 R3) (1 R6))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (COMPARE (3 R3 STATUS-FLAG-FIELD)
                 RECEIVE-STATUS)
        (BRNZ SVC-RESUME-TASK)
        (COMPARE (3 R3 STATUS-TASKID-FIELD)
                 (2 CURRENT-TASKID))
        (BRNZ SVC-RESUME-TASK)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              READY-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD) 0)
        (MOVE (1 R2) (1 R6))
        (MOVE (1 R3) READYQ)
        (CALL ENQUEUE)
        TRACE-LABEL9
        (BR SVC-RESUME-TASK)
        BLOCK-SEND
        (MOVE (1 R3) READYQ)
        (CALL DEQUEUE)
        TRACE-LABEL10
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              SEND-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD)
              (1 R6))
        (BR DISPATCHER)
        RECEIVE-SVC-HANDLER
        (MOVE (1 R6) (1 R2))
        (MOD (1 R6) TASKIDLUB)
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        TRACE-LABEL11
        (MOVE (2 CURRENT-TASKID) (1 R2))
        (MOVE (1 R4) (1 R2))
        (MULT (1 R4) DEST-MULTIPLIER)
        (MOVE (1 R3) (1 R6))
        (MULT (1 R3) SOURCE-MULTIPLIER)
        (ADD (1 R3) (1 R4))
        (ADD (1 R3) MBUFFERS)
        TRACE-LABEL12
        (CALL QEMPTYP)
        (BRZ BLOCK-RECEIVE)
        (CALL QFIRST)
        (CALL DEQUEUE)
        TRACE-LABEL13
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) TASK-TABLE-ENTRY-LENGTH)
        (ADD (1 R3) TASK-TABLE)
        (MOVE (3 R3 R3-FIELD) (1 R2))
        TRACE-LABEL14
        (MOVE (1 R3) (1 R6))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (COMPARE (3 R3 STATUS-FLAG-FIELD)
                 SEND-STATUS)
        (BRNZ SVC-RESUME-TASK)
        (COMPARE (3 R3 STATUS-TASKID-FIELD)
                 (2 CURRENT-TASKID))
        (BRNZ SVC-RESUME-TASK)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              READY-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD) 0)
        (MOVE (1 R2) (1 R6))
        (MOVE (1 R3) READYQ)
        (CALL ENQUEUE)
        TRACE-LABEL15
        (BR SVC-RESUME-TASK)
        BLOCK-RECEIVE
        (MOVE (1 R3) READYQ)
        (CALL DEQUEUE)
        TRACE-LABEL16
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              RECEIVE-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD)
              (1 R6))
        (BR DISPATCHER)
        TYO-SVC-HANDLER
        (MOVE (1 R7) (1 R3))
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        TRACE-LABEL17
        (MOVE (2 CURRENT-TASKID) (1 R2))
        (MOVE (1 R3) (1 R2))
        (MULT (1 R3) OUTPUT-BUFFER-LENGTH)
        (ADD (1 R3) OBUFFERS)
        TRACE-LABEL18
        (CALL QFULLP)
        (BRZ BLOCK-TYO)
        (MOVE (1 R2) (1 R7))
        (CALL ENQUEUE)
        TRACE-LABEL19
        (TESTO (2 CURRENT-TASKID))
        (BRNZ SVC-RESUME-TASK)
        (POST (2 CURRENT-TASKID))
        (BR SVC-RESUME-TASK)
        BLOCK-TYO
        (MOVE (1 R3) READYQ)
        (CALL DEQUEUE)
        TRACE-LABEL20
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              OUTPUT-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD) 0)
        (BR DISPATCHER)
        TYI-SVC-HANDLER
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        TRACE-LABEL21
        (MOVE (2 CURRENT-TASKID) (1 R2))
        (MOVE (1 R3) (1 R2))
        (MULT (1 R3) INPUT-BUFFER-LENGTH)
        (ADD (1 R3) IBUFFERS)
        TRACE-LABEL22
        (CALL QEMPTYP)
        (BRZ BLOCK-TYI)
        (CALL QFIRST)
        (CALL DEQUEUE)
        TRACE-LABEL23
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) TASK-TABLE-ENTRY-LENGTH)
        (ADD (1 R3) TASK-TABLE)
        (MOVE (3 R3 R3-FIELD) (1 R2))
        (BR SVC-RESUME-TASK)
        BLOCK-TYI
        (MOVE (1 R3) READYQ)
        (CALL DEQUEUE)
        TRACE-LABEL24
        (MOVE (1 R3) (2 CURRENT-TASKID))
        (MULT (1 R3) STATUS-ENTRY-LENGTH)
        (ADD (1 R3) STATUS-TABLE)
        (MOVE (3 R3 STATUS-FLAG-FIELD)
              INPUT-STATUS)
        (MOVE (3 R3 STATUS-TASKID-FIELD) 0)
        (BR DISPATCHER)
        INPUT-INTERRUPT-HANDLER
        (MOVE (2 BRANCH-ADDRESS) DISPATCHER)
        (MOVE (2 TEMP-R3) (1 R3))
        (MOVE (1 R3) READYQ)
        (CALL QEMPTYP)
        TRACE-LABEL25
        (BRZ IIH-SKIP-SAVE-STATE)
        (MOVE (2 BRANCH-ADDRESS) RESUME-TASK)
        (MOVE (1 R3) (2 TEMP-R3))
        (CALL SAVE-STATE)
        TRACE-LABEL26 IIH-SKIP-SAVE-STATE
        (MOVE (1 R5) (2 INPUT-DEVID-ADDR))
        (MULT (1 R5) STATUS-ENTRY-LENGTH)
        (ADD (1 R5) STATUS-TABLE)
        (COMPARE (3 R5 STATUS-FLAG-FIELD)
                 INPUT-STATUS)
        (BRNZ CHECK-FOR-FULL-INPUT-BUFFER)
        (MOVE (1 R2) (2 INPUT-DEVID-ADDR))
        (MOVE (1 R3) READYQ)
        (CALL ENQUEUE)
        TRACE-LABEL27
        (MOVE (3 R5 STATUS-FLAG-FIELD)
              READY-STATUS)
        (MOVE (3 R5 STATUS-TASKID-FIELD) 0)
        TRACE-LABEL28 CHECK-FOR-FULL-INPUT-BUFFER
        (MOVE (1 R3) (2 INPUT-DEVID-ADDR))
        (MULT (1 R3) INPUT-BUFFER-LENGTH)
        (ADD (1 R3) IBUFFERS)
        (CALL QFULLP)
        (BRNZ CHECK-FOR-IPORT-ERROR)
        (MOVE (1 R2) (2 INPUT-CHAR-ADDR))
        (ADD (1 R2) CHARLUB)
        (CALL QREPLACE)
        TRACE-LABEL29
        (BR (2 BRANCH-ADDRESS))
        CHECK-FOR-IPORT-ERROR
        (TESTI (2 INPUT-DEVID-ADDR))
        (BRNZ ENQUEUE-INPUT-CHARACTER)
        (MOVE (1 R2) (2 INPUT-CHAR-ADDR))
        (ADD (1 R2) CHARLUB)
        (CALL ENQUEUE)
        TRACE-LABEL30
        (BR (2 BRANCH-ADDRESS))
        ENQUEUE-INPUT-CHARACTER
        (MOVE (1 R2) (2 INPUT-CHAR-ADDR))
        (CALL ENQUEUE)
        TRACE-LABEL31
        (BR (2 BRANCH-ADDRESS))
        OUTPUT-INTERRUPT-HANDLER
        (MOVE (2 BRANCH-ADDRESS) DISPATCHER)
        (MOVE (2 TEMP-R3) (1 R3))
        (MOVE (1 R3) READYQ)
        (CALL QEMPTYP)
        TRACE-LABEL32
        (BRZ OIH-SKIP-SAVE-STATE)
        (MOVE (2 BRANCH-ADDRESS) RESUME-TASK)
        (MOVE (1 R3) (2 TEMP-R3))
        (CALL SAVE-STATE)
        TRACE-LABEL33 OIH-SKIP-SAVE-STATE
        (MOVE (1 R5) (2 OUTPUT-DEVID-ADDR))
        (MULT (1 R5) STATUS-ENTRY-LENGTH)
        (ADD (1 R5) STATUS-TABLE)
        (COMPARE (3 R5 STATUS-FLAG-FIELD)
                 OUTPUT-STATUS)
        (BRNZ CHECK-FOR-EMPTY-OUTPUT-BUFFER)
        (MOVE (1 R2) (2 OUTPUT-DEVID-ADDR))
        (MOVE (1 R3) READYQ)
        (CALL ENQUEUE)
        TRACE-LABEL34
        (MOVE (3 R5 STATUS-FLAG-FIELD)
              READY-STATUS)
        (MOVE (3 R5 STATUS-TASKID-FIELD) 0)
        TRACE-LABEL35 CHECK-FOR-EMPTY-OUTPUT-BUFFER
        (MOVE (1 R3) (2 OUTPUT-DEVID-ADDR))
        (MULT (1 R3) OUTPUT-BUFFER-LENGTH)
        (ADD (1 R3) OBUFFERS)
        (CALL QEMPTYP)
        (BRZ (2 BRANCH-ADDRESS))
        (CALL QFIRST)
        (STOUT (2 OUTPUT-DEVID-ADDR) (1 R2))
        (CALL DEQUEUE)
        TRACE-LABEL36
        (BR (2 BRANCH-ADDRESS))
        DISPATCHER
        (MOVE (1 R3) READYQ)
        (CALL QEMPTYP)
        DISPATCHER-TRACE-LABEL1
        (BRZ READYQ-EMPTY)
        (CALL QFIRST)
        (CALL RESTORE-STATE)
        DISPATCHER-TRACE-LABEL2
        (TIME (2 TIME-SLICE 0))
        (LPSW (2 REG-SAVE-AREA))
        READYQ-EMPTY
        (WAIT)
        PC-AFTER-WAIT SVC-RESUME-TASK
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        (CALL RESTORE-STATE)
        SVC-RESUME-TASK-TRACE-LABEL1
        (SVCR (2 REG-SAVE-AREA))
        RESUME-TASK
        (MOVE (1 R3) READYQ)
        (CALL QFIRST)
        (CALL RESTORE-STATE)
        RESUME-TASK-TRACE-LABEL1
        (LPSW (2 REG-SAVE-AREA))
        ENQUEUE
        (MOVE (1 R4) (1 R3))
        (ADD (1 R4) QARRAY-FIELD)
        (ADD (1 R4) (3 R3 QTAIL-FIELD))
        (MOVE (3 R4) (1 R2))
        (INCR (3 R3 QCURRLENGTH-FIELD))
        (INCRM (3 R3 QTAIL-FIELD)
               (3 R3 QMAXLENGTH-FIELD))
        (RETURN)
        QREPLACE
        (MOVE (1 R4) (3 R3 QTAIL-FIELD))
        (DECRM (1 R4) (3 R3 QMAXLENGTH-FIELD))
        (ADD (1 R4) (1 R3))
        (ADD (1 R4) QARRAY-FIELD)
        (MOVE (3 R4) (1 R2))
        (RETURN)
        DEQUEUE
        (DECR (3 R3 QCURRLENGTH-FIELD))
        (INCRM (3 R3 QHEAD-FIELD)
               (3 R3 QMAXLENGTH-FIELD))
        (RETURN)
        QFIRST
        (MOVE (1 R2) (1 R3))
        (ADD (1 R2) QARRAY-FIELD)
        (ADD (1 R2) (3 R3 QHEAD-FIELD))
        (MOVE (1 R2) (3 R2))
        (RETURN)
        QEMPTYP
        (COMPARE (3 R3 QCURRLENGTH-FIELD) 0)
        (RETURN)
        QFULLP
        (COMPARE (3 R3 QCURRLENGTH-FIELD)
                 (3 R3 QMAXLENGTH-FIELD))
        (RETURN)
        END-OF-OS-SOURCE)
      NIL)

(PROVE-LEMMA CLEAN-ASSEMBLY NIL '*1*TRUE
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFN OS-SYMTAB NIL
      '((END-OF-OS-SOURCE . 3301)
        (QFULLP . 3297)
        (QEMPTYP . 3293)
        (QFIRST . 3280)
        (DEQUEUE . 3274)
        (QREPLACE . 3258)
        (ENQUEUE . 3240)
        (RESUME-TASK-TRACE-LABEL1 . 3238)
        (RESUME-TASK . 3231)
        (SVC-RESUME-TASK-TRACE-LABEL1 . 3229)
        (SVC-RESUME-TASK . 3222)
        (PC-AFTER-WAIT . 3222)
        (READYQ-EMPTY . 3221)
        (DISPATCHER-TRACE-LABEL2 . 3217)
        (DISPATCHER-TRACE-LABEL1 . 3211)
        (DISPATCHER . 3206)
        (TRACE-LABEL36 . 3204)
        (CHECK-FOR-EMPTY-OUTPUT-BUFFER . 3184)
        (TRACE-LABEL35 . 3184)
        (TRACE-LABEL34 . 3178)
        (OIH-SKIP-SAVE-STATE . 3156)
        (TRACE-LABEL33 . 3156)
        (TRACE-LABEL32 . 3146)
        (OUTPUT-INTERRUPT-HANDLER . 3135)
        (TRACE-LABEL31 . 3133)
        (ENQUEUE-INPUT-CHARACTER . 3128)
        (TRACE-LABEL30 . 3126)
        (CHECK-FOR-IPORT-ERROR . 3114)
        (TRACE-LABEL29 . 3112)
        (CHECK-FOR-FULL-INPUT-BUFFER . 3091)
        (TRACE-LABEL28 . 3091)
        (TRACE-LABEL27 . 3085)
        (IIH-SKIP-SAVE-STATE . 3063)
        (TRACE-LABEL26 . 3063)
        (TRACE-LABEL25 . 3053)
        (INPUT-INTERRUPT-HANDLER . 3042)
        (TRACE-LABEL24 . 3025)
        (BLOCK-TYI . 3020)
        (TRACE-LABEL23 . 3006)
        (TRACE-LABEL22 . 2998)
        (TRACE-LABEL21 . 2986)
        (TYI-SVC-HANDLER . 2981)
        (TRACE-LABEL20 . 2964)
        (BLOCK-TYO . 2959)
        (TRACE-LABEL19 . 2951)
        (TRACE-LABEL18 . 2942)
        (TRACE-LABEL17 . 2930)
        (TYO-SVC-HANDLER . 2922)
        (TRACE-LABEL16 . 2905)
        (BLOCK-RECEIVE . 2900)
        (TRACE-LABEL15 . 2898)
        (TRACE-LABEL14 . 2865)
        (TRACE-LABEL13 . 2853)
        (TRACE-LABEL12 . 2845)
        (TRACE-LABEL11 . 2824)
        (RECEIVE-SVC-HANDLER . 2813)
        (TRACE-LABEL10 . 2796)
        (BLOCK-SEND . 2791)
        (TRACE-LABEL9 . 2789)
        (TRACE-LABEL8 . 2756)
        (TRACE-LABEL7 . 2747)
        (TRACE-LABEL6 . 2726)
        (SEND-SVC-HANDLER . 2712)
        (TRACE-LABEL5 . 2692)
        (SVC-INTERRUPT-HANDLER . 2690)
        (TRACE-LABEL4 . 2676)
        (TRACE-LABEL3 . 2669)
        (ERROR-INTERRUPT-HANDLER . 2667)
        (TRACE-LABEL2 . 2665)
        (TRACE-LABEL1 . 2656)
        (CLOCK-INTERRUPT-HANDLER . 2654)
        (RESTORE-STATE . 2601)
        (SAVE-STATE-RETURN . 2558)
        (SAVE-STATE . 2547)
        (MBUFFERS . 499)
        (OBUFFERS . 371)
        (IBUFFERS . 243)
        (STATUS-TABLE . 211)
        (READYQ . 191)
        (SEGMENT-TABLE . 159)
        (TASK-TABLE . 15)
        (TEMP-R3 . 14)
        (TEMP-R2 . 13)
        (CURRENT-TASKID . 12)
        (TIME-SLICE . 11)
        (BRANCH-ADDRESS . 10)
        (INTERRUPT-DATA . 8)
        (OUTPUT-NEW-PC . 7)
        (INPUT-NEW-PC . 6)
        (SVC-NEW-PC . 5)
        (ERROR-NEW-PC . 4)
        (CLOCK-NEW-PC . 3)
        (REG-SAVE-AREA . 0)
        (TASKIDLUB . 16)
        (DEST-MULTIPLIER . 8)
        (SOURCE-MULTIPLIER . 128)
        (MESSAGE-BUFFER-LENGTH . 8)
        (OUTPUT-BUFFER-LENGTH . 8)
        (INPUT-BUFFER-LENGTH . 8)
        (INPUT-STATUS . 5)
        (OUTPUT-STATUS . 4)
        (RECEIVE-STATUS . 3)
        (SEND-STATUS . 2)
        (ERROR-STATUS . 1)
        (READY-STATUS . 0)
        (STATUS-TASKID-FIELD . 1)
        (STATUS-FLAG-FIELD . 0)
        (STATUS-ENTRY-LENGTH . 2)
        (LIMIT-FIELD . 1)
        (BASE-FIELD . 0)
        (SEGMENT-TABLE-LENGTH . 32)
        (QARRAY-FIELD . 4)
        (QMAXLENGTH-FIELD . 3)
        (QCURRLENGTH-FIELD . 2)
        (QTAIL-FIELD . 1)
        (QHEAD-FIELD . 0)
        (READYQ-LENGTH . 20)
        (FLAG-FIELD . 8)
        (R7-FIELD . 7)
        (R6-FIELD . 6)
        (R5-FIELD . 5)
        (R4-FIELD . 4)
        (R3-FIELD . 3)
        (R2-FIELD . 2)
        (SP-FIELD . 1)
        (PC-FIELD . 0)
        (TASK-TABLE-ENTRY-LENGTH . 9)
        (TASK-TABLE-LENGTH . 144)
        (TYI-SVCID . 3)
        (TYO-SVCID . 2)
        (RECEIVE-SVCID . 1)
        (SEND-SVCID . 0)
        (CHARLUB . 256)
        (OUTPUT-DEVID-ADDR . 9)
        (INPUT-CHAR-ADDR . 9)
        (INPUT-DEVID-ADDR . 8)
        (SVCID-ADDR . 8)
        (INTERRUPT-FLAG-FIELD . 2)
        (INTERRUPT-SP-FIELD . 1)
        (INTERRUPT-PC-FIELD . 0)
        (R7 . 7)
        (R6 . 6)
        (R5 . 5)
        (R4 . 4)
        (R3 . 3)
        (R2 . 2)
        (R1 . 1)
        (R0 . 0))
      NIL)

(DEFN OS-TASK-TABLE-ADDRESS NIL '15
      NIL)

(DEFN OS-READYQ-ADDRESS NIL '191 NIL)

(DEFN OS-SEGMENT-TABLE-ADDRESS
      NIL '159
      NIL)

(DEFN OS-STATUS-TABLE-ADDRESS NIL '211
      NIL)

(DEFN OS-IBUFFERS-ADDRESS NIL '243
      NIL)

(DEFN OS-OBUFFERS-ADDRESS NIL '371
      NIL)

(DEFN OS-MBUFFERS-ADDRESS NIL '499
      NIL)

(DEFN OS-CLOCK-INTERRUPT-HANDLER-ADDRESS NIL '2654
      NIL)

(DEFN OS-ERROR-HANDLER-ADDRESS NIL '2667
      NIL)

(DEFN OS-SVC-HANDLER-ADDRESS NIL '2690
      NIL)

(DEFN OS-INPUT-INTERRUPT-HANDLER-ADDRESS NIL '3042
      NIL)

(DEFN OS-OUTPUT-INTERRUPT-HANDLER-ADDRESS NIL '3135
      NIL)

(DEFN OS-CODE-ADDRESS NIL '2547 NIL)

(DEFN OS-SAVE-STATE-RETURN-ADDRESS
      NIL '2558
      NIL)

(DEFN OS-DISPATCHER-RETURN-ADDRESS NIL 'NIL
      NIL)

(DEFN OS-TIME-SLICE-ADDRESS NIL '11
      NIL)

(DEFN OS-CODE-LENGTH NIL '754 NIL)

(DEFN NTHCDR-N-TIMES
      (N K L)
      (IF (ZEROP N)
          L
          (NTHCDR-N-TIMES (SUB1 N)
                          K
                          (NTHCDR K L)))
      NIL)

(DEFN FIRSTN-N-TIMES
      (N K L)
      (IF (ZEROP N)
          'NIL
          (APPEND (FIRSTN K L)
                  (FIRSTN-N-TIMES (SUB1 N)
                                  K
                                  (NTHCDR K L))))
      NIL)

(DEFN FIRSTN-WITH-SMALL-RECURSION
      (N L MAX)
      (APPEND (FIRSTN (REMAINDER N MAX) L)
              (FIRSTN-N-TIMES (QUOTIENT N MAX)
                              MAX
                              (NTHCDR (REMAINDER N MAX) L)))
      NIL)

(DEFN NTHCDR-WITH-SMALL-RECURSION
      (N L MAX)
      (NTHCDR (REMAINDER N MAX)
              (NTHCDR-N-TIMES (QUOTIENT N MAX)
                              MAX L))
      NIL)

(DEFN GETSEG-WITH-SMALL-RECURSION
      (N K L MAX)
      (FIRSTN-WITH-SMALL-RECURSION K
                                   (NTHCDR-WITH-SMALL-RECURSION N L MAX)
                                   MAX)
      NIL)

(DEFN OS-MACHINE-CODE NIL
      '(2187 13 2 2187 14 3 75 3 191 14 3280 77 2 9 65 2 15 4299 2 0 12747 2 0
             4811 2 13 5067 2 14 3275 2 4 3531 2 5 3787 2 6 4043 2 7 65 2 8
             20683 2 0 4171 2 13 4171 3 14 0 2123 3 2 77 2 9 65 2 15 77 3 2 65
             3 159 218 3 478 3 2123 3 2 65 3 8 6283 0 2 14731 0 2 6795 0 3
             63563 7 2 55371 6 2 47179 5 2 38987 4 2 30795 3 2 22603 2 2 0 14
             2547 75 3 191 14 3280 14 3274 14 3240 2 3206 14 2547 75 3 191 14
             3280 14 3274 77 2 2 65 2 211 203 2 1 459 2 0 2 3206 14 2547 137 8
             4 131 8 0 10 2712 131 8 1 10 2813 131 8 2 10 2922 2 2981 2123 6 2
             73 6 16 2123 7 3 75 3 191 14 3280 2187 12 2 2123 4 6 77 4 8 2123
             3 2 77 3 128 2113 3 4 65 3 499 14 3297 10 2791 2123 2 7 14 3240
             2123 3 6 77 3 2 65 3 211 195 3 3 6 3222 4547 3 12 6 3222 203 3 0
             459 3 0 2123 2 6 75 3 191 14 3240 2 3222 75 3 191 14 3274 4171 3
             12 77 3 2 65 3 211 203 3 2 2507 3 6 2 3206 2123 6 2 73 6 16 75 3
             191 14 3280 2187 12 2 2123 4 2 77 4 8 2123 3 6 77 3 128 2113 3 4
             65 3 499 14 3293 10 2900 14 3280 14 3274 4171 3 12 77 3 9 65 3 15
             3019 3 2 2123 3 6 77 3 2 65 3 211 195 3 2 6 3222 4547 3 12 6 3222
             203 3 0 459 3 0 2123 2 6 75 3 191 14 3240 2 3222 75 3 191 14 3274
             4171 3 12 77 3 2 65 3 211 203 3 3 2507 3 6 2 3206 2123 7 3 75 3
             191 14 3280 2187 12 2 2123 3 2 77 3 8 65 3 371 14 3297 10 2959
             2123 2 7 14 3240 182 12 6 3222 166 12 2 3222 75 3 191 14 3274
             4171 3 12 77 3 2 65 3 211 203 3 4 459 3 0 2 3206 75 3 191 14 3280
             2187 12 2 2123 3 2 77 3 8 65 3 243 14 3293 10 3020 14 3280 14
             3274 4171 3 12 77 3 9 65 3 15 3019 3 2 2 3222 75 3 191 14 3274
             4171 3 12 77 3 2 65 3 211 203 3 5 459 3 0 2 3206 139 10 3206 2187
             14 3 75 3 191 14 3293 10 3063 139 10 3231 4171 3 14 14 2547 4171
             5 8 77 5 2 65 5 211 195 5 5 6 3091 4171 2 8 75 3 191 14 3240 203
             5 0 459 5 0 4171 3 8 77 3 8 65 3 243 14 3297 6 3114 4171 2 9 65 2
             256 14 3258 130 10 178 8 6 3128 4171 2 9 65 2 256 14 3240 130 10
             4171 2 9 14 3240 130 10 139 10 3206 2187 14 3 75 3 191 14 3293 10
             3156 139 10 3231 4171 3 14 14 2547 4171 5 9 77 5 2 65 5 211 195 5
             4 6 3184 4171 2 9 75 3 191 14 3240 203 5 0 459 5 0 4171 3 9 77 3
             8 65 3 371 14 3293 138 10 14 3280 2191 9 2 14 3274 130 10 75 3
             191 14 3293 10 3221 14 3280 14 2601 186 11 162 0 4 75 3 191 14
             3280 14 2601 174 0 75 3 191 14 3280 14 2601 162 0 2123 4 3 65 4 4
             14401 4 3 2251 4 2 726 3 31175 3 3 0 14411 4 3 30789 4 3 2113 4 3
             65 4 4 2251 4 2 0 722 3 30919 3 3 0 2123 2 3 65 2 4 6209 2 3 6219
             2 2 0 707 3 0 0 31427 3 3 0)
      NIL)

(DEFN OS-LIMIT NIL '3311 NIL)

(DEFN OS-TASK-TABLE
      (OS)
      (GETSEG '15 '144 (TM-MEMORY OS))
      NIL)

(DEFN OS-READYQ
      (OS)
      (GETSEG '191 '20 (TM-MEMORY OS))
      NIL)

(DEFN OS-SEGMENT-TABLE
      (OS)
      (GETSEG '159 '32 (TM-MEMORY OS))
      NIL)

(DEFN OS-STATUS-TABLE
      (OS)
      (GETSEG '211 '32 (TM-MEMORY OS))
      NIL)

(DEFN OS-IBUFFERS
      (OS)
      (GETSEG '243 '128 (TM-MEMORY OS))
      NIL)

(DEFN OS-OBUFFERS
      (OS)
      (GETSEG '371 '128 (TM-MEMORY OS))
      NIL)

(DEFN OS-MBUFFERS
      (OS)
      (GETSEG '499 '2048 (TM-MEMORY OS))
      NIL)

(DEFN OS-CODE
      (OS)
      (GETSEG '2547 '754 (TM-MEMORY OS))
      NIL)

(PROVE-LEMMA LENGTH-OS-TASK-TABLE
             (REWRITE)
             (EQUAL (LENGTH (OS-TASK-TABLE OS))
                    '144)
             ((ENABLE OS-TASK-TABLE LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-TASK-TABLE)

(PROVE-LEMMA PLISTP-OS-TASK-TABLE
             (REWRITE)
             (PLISTP (OS-TASK-TABLE OS))
             ((ENABLE OS-TASK-TABLE PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-TASK-TABLE)

(PROVE-LEMMA LENGTH-OS-READYQ
             (REWRITE)
             (EQUAL (LENGTH (OS-READYQ OS)) '20)
             ((ENABLE OS-READYQ LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-READYQ)

(PROVE-LEMMA PLISTP-OS-READYQ
             (REWRITE)
             (PLISTP (OS-READYQ OS))
             ((ENABLE OS-READYQ PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-READYQ)

(PROVE-LEMMA LENGTH-OS-SEGMENT-TABLE
             (REWRITE)
             (EQUAL (LENGTH (OS-SEGMENT-TABLE OS))
                    '32)
             ((ENABLE OS-SEGMENT-TABLE LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-SEGMENT-TABLE)

(PROVE-LEMMA PLISTP-OS-SEGMENT-TABLE
             (REWRITE)
             (PLISTP (OS-SEGMENT-TABLE OS))
             ((ENABLE OS-SEGMENT-TABLE PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-SEGMENT-TABLE)

(PROVE-LEMMA LENGTH-OS-STATUS-TABLE
             (REWRITE)
             (EQUAL (LENGTH (OS-STATUS-TABLE OS))
                    '32)
             ((ENABLE OS-STATUS-TABLE LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-STATUS-TABLE)

(PROVE-LEMMA PLISTP-OS-STATUS-TABLE
             (REWRITE)
             (PLISTP (OS-STATUS-TABLE OS))
             ((ENABLE OS-STATUS-TABLE PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-STATUS-TABLE)

(PROVE-LEMMA LENGTH-OS-IBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (OS-IBUFFERS OS))
                    '128)
             ((ENABLE OS-IBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-IBUFFERS)

(PROVE-LEMMA PLISTP-OS-IBUFFERS
             (REWRITE)
             (PLISTP (OS-IBUFFERS OS))
             ((ENABLE OS-IBUFFERS PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-IBUFFERS)

(PROVE-LEMMA LENGTH-OS-OBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (OS-OBUFFERS OS))
                    '128)
             ((ENABLE OS-OBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-OBUFFERS)

(PROVE-LEMMA PLISTP-OS-OBUFFERS
             (REWRITE)
             (PLISTP (OS-OBUFFERS OS))
             ((ENABLE OS-OBUFFERS PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-OBUFFERS)

(PROVE-LEMMA LENGTH-OS-MBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (OS-MBUFFERS OS))
                    '2048)
             ((ENABLE OS-MBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-MBUFFERS)

(PROVE-LEMMA PLISTP-OS-MBUFFERS
             (REWRITE)
             (PLISTP (OS-MBUFFERS OS))
             ((ENABLE OS-MBUFFERS PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-MBUFFERS)

(DEFN OS-CURRENT-TASKID-ADDRESS
      NIL '12
      NIL)

(DEFN OS-TRACE-LABEL1 NIL '2656 NIL)

(DEFN OS-TRACE-LABEL2 NIL '2665 NIL)

(DEFN OS-TRACE-LABEL3 NIL '2669 NIL)

(DEFN OS-TRACE-LABEL4 NIL '2676 NIL)

(DEFN OS-TRACE-LABEL5 NIL '2692 NIL)

(DEFN OS-TRACE-LABEL6 NIL '2726 NIL)

(DEFN OS-TRACE-LABEL7 NIL '2747 NIL)

(DEFN OS-TRACE-LABEL8 NIL '2756 NIL)

(DEFN OS-TRACE-LABEL9 NIL '2789 NIL)

(DEFN OS-TRACE-LABEL10 NIL '2796 NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-ADDRESS
      NIL '2813
      NIL)

(DEFN OS-TRACE-LABEL11 NIL '2824 NIL)

(DEFN OS-TRACE-LABEL12 NIL '2845 NIL)

(DEFN OS-TRACE-LABEL13 NIL '2853 NIL)

(DEFN OS-TRACE-LABEL14 NIL '2865 NIL)

(DEFN OS-TRACE-LABEL15 NIL '2898 NIL)

(DEFN OS-TRACE-LABEL16 NIL '2905 NIL)

(DEFN OS-SVC-TYO-HANDLER-ADDRESS
      NIL '2922
      NIL)

(DEFN OS-TRACE-LABEL17 NIL '2930 NIL)

(DEFN OS-TRACE-LABEL18 NIL '2942 NIL)

(DEFN OS-TRACE-LABEL19 NIL '2951 NIL)

(DEFN OS-TRACE-LABEL20 NIL '2964 NIL)

(DEFN OS-SVC-TYI-HANDLER-ADDRESS
      NIL '2981
      NIL)

(DEFN OS-TRACE-LABEL21 NIL '2986 NIL)

(DEFN OS-TRACE-LABEL22 NIL '2998 NIL)

(DEFN OS-TRACE-LABEL23 NIL '3006 NIL)

(DEFN OS-TRACE-LABEL24 NIL '3025 NIL)

(DEFN OS-TRACE-LABEL25 NIL '3053 NIL)

(DEFN OS-TRACE-LABEL26 NIL '3063 NIL)

(DEFN OS-TRACE-LABEL27 NIL '3085 NIL)

(DEFN OS-TRACE-LABEL28 NIL '3091 NIL)

(DEFN OS-TRACE-LABEL29 NIL '3112 NIL)

(DEFN OS-TRACE-LABEL30 NIL '3126 NIL)

(DEFN OS-TRACE-LABEL31 NIL '3133 NIL)

(DEFN OS-TRACE-LABEL32 NIL '3146 NIL)

(DEFN OS-TRACE-LABEL33 NIL '3156 NIL)

(DEFN OS-TRACE-LABEL34 NIL '3178 NIL)

(DEFN OS-TRACE-LABEL35 NIL '3184 NIL)

(DEFN OS-TRACE-LABEL36 NIL '3204 NIL)

(DEFN OS-DISPATCHER-TRACE-LABEL1
      NIL '3211
      NIL)

(DEFN OS-DISPATCHER-TRACE-LABEL2 NIL '3217
      NIL)

(DEFN OS-SVC-RESUME-TASK-ADDRESS NIL '3222
      NIL)

(DEFN OS-SVC-RESUME-TASK-TRACE-LABEL1 NIL '3229
      NIL)

(DEFN OS-RESUME-TASK-ADDRESS NIL '3231
      NIL)

(DEFN OS-RESUME-TASK-TRACE-LABEL1 NIL '3238
      NIL)

(DEFN OS-PC-AFTER-WAIT NIL '3222 NIL)

(DEFN OS-TEMP-R2-ADDRESS NIL '13 NIL)

(DEFN OS-TEMP-R3-ADDRESS NIL '14 NIL)

(DEFN OS-DISPATCHER-ADDRESS
      NIL '3206
      NIL)

(DEFN OS-DISPATCHER-PC-AFTER-WAIT NIL '3222
      NIL)

(DEFN OS-DISPATCHER-QEMPTYP-RETURN-ADDRESS NIL '3211
      NIL)

(DEFN OS-RESTORE-STATE-ADDRESS NIL '2601
      NIL)

(PROVE-LEMMA LENGTH-OS-CODE
             (REWRITE)
             (EQUAL (LENGTH (OS-CODE OS)) '754)
             ((ENABLE OS-CODE LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-CODE)

(PROVE-LEMMA PLISTP-OS-CODE
             (REWRITE)
             (PLISTP (OS-CODE OS))
             ((ENABLE OS-CODE PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-CODE)

(DEFN FINITE-NUMBER-QUEUEP
      (QUEUE CAPACITY LUB)
      (AND (ARRAY-QUEUEP QUEUE)
           (AND (EQUAL (GETNTH '3 QUEUE) CAPACITY)
                (FINITE-NUMBER-LISTP (GETSEG '4 CAPACITY QUEUE)
                                     LUB)))
      NIL)

(PROVE-LEMMA ARRAY-QUEUEP-FINITE-NUMBER-QUEUE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (ARRAY-QUEUEP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-FIELD
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (GETNTH '3 QUEUE) CAPACITY))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-FIELD)

(PROVE-LEMMA FINITE-NUMBER-LISTP-QARRAY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (FINITE-NUMBER-LISTP (GETSEG '4 CAPACITY QUEUE)
                                           LUB))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-QARRAY)

(PROVE-LEMMA LENGTH-FINITE-NUMBER-QUEUE
             NIL
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (LENGTH QUEUE)
                             (PLUS '4 CAPACITY)))
             ((ENABLE FINITE-NUMBER-QUEUEP ARRAY-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA PLISTP-FINITE-NUMBER-QUEUE NIL
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (PLISTP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP PLISTP-ARRAY-QUEUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QHEAD-SIZE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (AND (NUMBERP (GETNTH '0 QUEUE))
                           (LESSP (GETNTH '0 QUEUE) CAPACITY)))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QHEAD-SIZE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QTAIL-SIZE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (AND (NUMBERP (GETNTH '1 QUEUE))
                           (LESSP (GETNTH '1 QUEUE) CAPACITY)))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QTAIL-SIZE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (AND (NUMBERP (GETNTH '2 QUEUE))
                           (LESSP (GETNTH '2 QUEUE)
                                  (ADD1 CAPACITY))))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (GETNTH '3 QUEUE) CAPACITY))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QARRAY-AFTER-ENQ
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (GETSEG '4
                                     CAPACITY
                                     (ARRAY-ENQ ITEM QUEUE))
                             (PUTNTH ITEM
                                     (GETNTH '1 QUEUE)
                                     (GETSEG '4 CAPACITY QUEUE))))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (USE (ARRAY-QARRAY-ARRAY-ENQ (ITEM ITEM)
                                           (QUEUE QUEUE)))
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QARRAY-AFTER-ENQ)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-ARRAY-ENQ
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                           (AND (NOT (ARRAY-QFULLP QUEUE))
                                (FINITE-NUMBERP ITEM LUB)))
                      (FINITE-NUMBER-QUEUEP (ARRAY-ENQ ITEM QUEUE)
                                            CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUEP ARRAY-QUEUEP-ARRAY-ENQ)
              (USE (FINITE-NUMBER-QUEUE-QARRAY-AFTER-ENQ (QUEUE QUEUE)
                                                         (CAPACITY CAPACITY)
                                                         (LUB LUB)
                                                         (ITEM ITEM))
                   (FINITE-NUMBER-LISTP-PUTNTH (V ITEM)
                                               (N (GETNTH '1 QUEUE))
                                               (L (GETSEG '4 CAPACITY QUEUE))
                                               (LUB LUB)))
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QARRAY-AFTER-DEQ
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (GETSEG '4
                                     CAPACITY
                                     (ARRAY-DEQ QUEUE))
                             (GETSEG '4 CAPACITY QUEUE)))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (USE (ARRAY-QARRAY-ARRAY-DEQ (QUEUE QUEUE)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QARRAY-AFTER-DEQ)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (FINITE-NUMBER-QUEUEP (ARRAY-DEQ QUEUE)
                                            CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUEP ARRAY-QUEUEP-ARRAY-DEQ
                      ARRAY-QMAXLENGTH-ARRAY-DEQ)
              (USE (FINITE-NUMBER-QUEUE-QARRAY-AFTER-DEQ (QUEUE QUEUE)
                                                         (CAPACITY CAPACITY)
                                                         (LUB LUB)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-DEQ)

(PROVE-LEMMA ARRAY-QFIRST-FINITE-NUMBER-QUEUE
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (AND (NUMBERP (ARRAY-QFIRST QUEUE))
                           (LESSP (ARRAY-QFIRST QUEUE) LUB)))
             ((ENABLE FINITE-NUMBER-QUEUEP ARRAY-QFIRST
                      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE LENGTH-GETSEG
                      A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB
                      ELEMENT-OF-NON-ZERO-LIST-IS-NON-ZERO)
              (DISABLE PLUS)
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (USE (NUMBERP-GETNTH (I (GETNTH '0 QUEUE))
                                   (L (GETSEG '4 CAPACITY QUEUE))
                                   (LUB LUB))
                   (FINITE-NUMBERP-GETNTH (I (GETNTH '0 QUEUE))
                                          (L (GETSEG '4 CAPACITY QUEUE))
                                          (LUB LUB))
                   (GETNTH-GETSEG-INVERSE (N '4)
                                          (K CAPACITY)
                                          (I (GETNTH '0 QUEUE))
                                          (L QUEUE)))
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE)

(PROVE-LEMMA REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (REMAINDER (ARRAY-QFIRST QUEUE) LUB)
                             (ARRAY-QFIRST QUEUE)))
             ((ENABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE REMAINDER-NOOP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE)

(DEFTHEORY
 FINITE-NUMBER-QUEUEP-FACTS
 (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE
                                     FINITE-NUMBER-QUEUE-QTAIL-SIZE
                                     FINITE-NUMBER-QUEUE-QHEAD-SIZE
                                     REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE
                                     ARRAY-QFIRST-FINITE-NUMBER-QUEUE
                                     FINITE-NUMBER-QUEUEP-ARRAY-DEQ
                                     FINITE-NUMBER-QUEUE-QARRAY-AFTER-DEQ
                                     FINITE-NUMBER-QUEUEP-ARRAY-ENQ
                                     FINITE-NUMBER-QUEUE-QARRAY-AFTER-ENQ
                                     PLISTP-FINITE-NUMBER-QUEUE
                                     LENGTH-FINITE-NUMBER-QUEUE
                                     FINITE-NUMBER-LISTP-QARRAY
                                     FINITE-NUMBER-QUEUE-QMAXLENGTH-FIELD
                                     ARRAY-QUEUEP-FINITE-NUMBER-QUEUE))

(DEFN FINITE-NUMBER-QUEUE-LISTP
      (LIST CAPACITY LUB)
      (IF (LISTP LIST)
          (AND (FINITE-NUMBER-QUEUEP (CAR LIST)
                                     CAPACITY LUB)
               (FINITE-NUMBER-QUEUE-LISTP (CDR LIST)
                                          CAPACITY LUB))
          '*1*TRUE)
      NIL)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)
                           (LESSP I (LENGTH L)))
                      (FINITE-NUMBER-QUEUEP (GETNTH I L)
                                            CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-LISTP GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-GETNTH)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-PUTNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)
                           (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB))
                      (FINITE-NUMBER-QUEUE-LISTP (PUTNTH QUEUE I L)
                                                 CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-LISTP PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-PUTNTH)

(DEFN FINITE-NUMBER-QUEUE-TABLEP
      (N L CAPACITY LUB)
      (IF (LISTP L)
          (AND (PLISTP (CAR L))
               (AND (EQUAL (LENGTH (CAR L)) N)
                    (AND (FINITE-NUMBER-QUEUE-LISTP (CAR L)
                                                    CAPACITY LUB)
                         (FINITE-NUMBER-QUEUE-TABLEP N
                                                     (CDR L)
                                                     CAPACITY LUB))))
          '*1*TRUE)
      NIL)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP N L CAPACITY LUB)
                           (LESSP I (LENGTH L)))
                      (AND (PLISTP (GETNTH I L))
                           (AND (EQUAL (LENGTH (GETNTH I L)) N)
                                (FINITE-NUMBER-QUEUE-LISTP (GETNTH I L)
                                                           CAPACITY LUB))))
             ((ENABLE FINITE-NUMBER-QUEUE-TABLEP GETNTH LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-GETNTH)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-GETNTH2
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP N L CAPACITY LUB)
                           (AND (LESSP I (LENGTH L))
                                (LESSP J N)))
                      (FINITE-NUMBER-QUEUEP (GETNTH2 I J L)
                                            CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-TABLEP GETNTH2
                      FINITE-NUMBER-QUEUEP-GETNTH
                      FINITE-NUMBER-QUEUE-LISTP-GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-GETNTH2)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-TABLEP-PUTNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP N L CAPACITY LUB)
                           (AND (FINITE-NUMBER-QUEUE-LISTP S CAPACITY LUB)
                                (AND (PLISTP S)
                                     (EQUAL (LENGTH S) N))))
                      (FINITE-NUMBER-QUEUE-TABLEP N
                                                  (PUTNTH S I L)
                                                  CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-TABLEP PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-PUTNTH)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP N L CAPACITY LUB)
                           (AND (LESSP I (LENGTH L))
                                (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)))
                      (FINITE-NUMBER-QUEUE-TABLEP N
                                                  (PUTNTH2 QUEUE I J L)
                                                  CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-TABLEP PUTNTH2 PLISTP-PUTNTH
                      LENGTH-PUTNTH FINITE-NUMBER-QUEUE-LISTP-PUTNTH
                      FINITE-NUMBER-QUEUE-LISTP-GETNTH
                      FINITE-NUMBER-QUEUE-TABLEP-PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-NTHCDR
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)
                      (FINITE-NUMBER-QUEUE-LISTP (NTHCDR N L)
                                                 CAPACITY LUB))
             ((ENABLE NTHCDR FINITE-NUMBER-QUEUE-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-NTHCDR)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-FIRSTN
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)
                      (FINITE-NUMBER-QUEUE-LISTP (FIRSTN N L)
                                                 CAPACITY LUB))
             ((ENABLE FIRSTN FINITE-NUMBER-QUEUE-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-FIRSTN)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-GETSEG
             (REWRITE)
             (IMPLIES (AND (IF (LESSP (LENGTH L) (PLUS N K))
                               '*1*FALSE
                               '*1*TRUE)
                           (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB))
                      (FINITE-NUMBER-QUEUE-LISTP (GETSEG N K L)
                                                 CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-LISTP-FIRSTN
                      FINITE-NUMBER-QUEUE-LISTP-NTHCDR
                      GETSEG-EQUALS-FIRSTN-NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-GETSEG)

(PROVE-LEMMA DIVISOR-NOT-LESSP
             NIL
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (NOT (ZEROP A)) (DIVIDES N A)))
                      (NOT (LESSP A N)))
             ((ENABLE DIVIDES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA DIVIDES-NOT-LESSP-INSTANCE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (LISTP L)
                                (EQUAL (REMAINDER (LENGTH L) N) '0)))
                      (EQUAL (LESSP (LENGTH L) N)
                             '*1*FALSE))
             ((USE (DIVISOR-NOT-LESSP (A (LENGTH L))
                                      (N N)))
              (ENABLE DIVIDES LISTP-IMPLIES-NON-ZERO-LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIVIDES-NOT-LESSP-INSTANCE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-TABLEP-TABLE
             (REWRITE)
             (IMPLIES (AND (NOT (ZEROP N))
                           (AND (EQUAL (REMAINDER (LENGTH L) N) '0)
                                (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)))
                      (FINITE-NUMBER-QUEUE-TABLEP N
                                                  (TABLE N L)
                                                  CAPACITY LUB))
             ((ENABLE FINITE-NUMBER-QUEUE-TABLEP TABLE
                      DIVIDES-NOT-LESSP-INSTANCE PLISTP-GETSEG LENGTH-GETSEG
                      LENGTH-NTHCDR ZEROP-REMAINDER-DIFFERENCE
                      FINITE-NUMBER-QUEUE-LISTP-NTHCDR
                      FINITE-NUMBER-QUEUE-LISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-TABLE)

(DEFN OS-CURRENT-TASKID
      (OS)
      (ARRAY-QFIRST (OS-READYQ OS))
      NIL)

(DEFN OS-READY-SET
      (OS)
      (INDEX-READY-SET '0
                       (TABLE '2 (OS-STATUS-TABLE OS)))
      NIL)

(DEFN OS-READYQ-QARRAY
      (OS)
      (GETSEG '4
              (GETNTH '3 (OS-READYQ OS))
              (OS-READYQ OS))
      NIL)

(DEFN GOOD-OS
 (OS)
 (AND
  (GOOD-TM OS)
  (AND
   (EQUAL (TM-SLIMIT OS) '3311)
   (AND
    (EQUAL (OS-CODE OS)
           '(2187 13 2 2187 14 3 75 3 191 14 3280 77 2 9 65 2 15 4299 2 0
                  12747 2 0 4811 2 13 5067 2 14 3275 2 4 3531 2 5 3787 2 6
                  4043 2 7 65 2 8 20683 2 0 4171 2 13 4171 3 14 0 2123 3 2 77
                  2 9 65 2 15 77 3 2 65 3 159 218 3 478 3 2123 3 2 65 3 8
                  6283 0 2 14731 0 2 6795 0 3 63563 7 2 55371 6 2 47179 5 2
                  38987 4 2 30795 3 2 22603 2 2 0 14 2547 75 3 191 14 3280 14
                  3274 14 3240 2 3206 14 2547 75 3 191 14 3280 14 3274 77 2 2
                  65 2 211 203 2 1 459 2 0 2 3206 14 2547 137 8 4 131 8 0 10
                  2712 131 8 1 10 2813 131 8 2 10 2922 2 2981 2123 6 2 73 6
                  16 2123 7 3 75 3 191 14 3280 2187 12 2 2123 4 6 77 4 8 2123
                  3 2 77 3 128 2113 3 4 65 3 499 14 3297 10 2791 2123 2 7 14
                  3240 2123 3 6 77 3 2 65 3 211 195 3 3 6 3222 4547 3 12 6
                  3222 203 3 0 459 3 0 2123 2 6 75 3 191 14 3240 2 3222 75 3
                  191 14 3274 4171 3 12 77 3 2 65 3 211 203 3 2 2507 3 6 2
                  3206 2123 6 2 73 6 16 75 3 191 14 3280 2187 12 2 2123 4 2
                  77 4 8 2123 3 6 77 3 128 2113 3 4 65 3 499 14 3293 10 2900
                  14 3280 14 3274 4171 3 12 77 3 9 65 3 15 3019 3 2 2123 3 6
                  77 3 2 65 3 211 195 3 2 6 3222 4547 3 12 6 3222 203 3 0 459
                  3 0 2123 2 6 75 3 191 14 3240 2 3222 75 3 191 14 3274 4171
                  3 12 77 3 2 65 3 211 203 3 3 2507 3 6 2 3206 2123 7 3 75 3
                  191 14 3280 2187 12 2 2123 3 2 77 3 8 65 3 371 14 3297 10
                  2959 2123 2 7 14 3240 182 12 6 3222 166 12 2 3222 75 3 191
                  14 3274 4171 3 12 77 3 2 65 3 211 203 3 4 459 3 0 2 3206 75
                  3 191 14 3280 2187 12 2 2123 3 2 77 3 8 65 3 243 14 3293 10
                  3020 14 3280 14 3274 4171 3 12 77 3 9 65 3 15 3019 3 2 2
                  3222 75 3 191 14 3274 4171 3 12 77 3 2 65 3 211 203 3 5 459
                  3 0 2 3206 139 10 3206 2187 14 3 75 3 191 14 3293 10 3063
                  139 10 3231 4171 3 14 14 2547 4171 5 8 77 5 2 65 5 211 195
                  5 5 6 3091 4171 2 8 75 3 191 14 3240 203 5 0 459 5 0 4171 3
                  8 77 3 8 65 3 243 14 3297 6 3114 4171 2 9 65 2 256 14 3258
                  130 10 178 8 6 3128 4171 2 9 65 2 256 14 3240 130 10 4171 2
                  9 14 3240 130 10 139 10 3206 2187 14 3 75 3 191 14 3293 10
                  3156 139 10 3231 4171 3 14 14 2547 4171 5 9 77 5 2 65 5 211
                  195 5 4 6 3184 4171 2 9 75 3 191 14 3240 203 5 0 459 5 0
                  4171 3 9 77 3 8 65 3 371 14 3293 138 10 14 3280 2191 9 2 14
                  3274 130 10 75 3 191 14 3293 10 3221 14 3280 14 2601 186 11
                  162 0 4 75 3 191 14 3280 14 2601 174 0 75 3 191 14 3280 14
                  2601 162 0 2123 4 3 65 4 4 14401 4 3 2251 4 2 726 3 31175 3
                  3 0 14411 4 3 30789 4 3 2113 4 3 65 4 4 2251 4 2 0 722 3
                  30919 3 3 0 2123 2 3 65 2 4 6209 2 3 6219 2 2 0 707 3 0 0
                  31427 3 3 0))
    (AND
     (EQUAL (GETNTH '3 (TM-MEMORY OS))
            '2654)
     (AND
      (EQUAL (GETNTH '4 (TM-MEMORY OS))
             '2667)
      (AND
       (EQUAL (GETNTH '5 (TM-MEMORY OS))
              '2690)
       (AND
        (EQUAL (GETNTH '6 (TM-MEMORY OS))
               '3042)
        (AND
         (EQUAL (GETNTH '7 (TM-MEMORY OS))
                '3135)
         (AND
          (EQUAL (GETNTH '11 (TM-MEMORY OS))
                 '1000)
          (AND
           (NOT (TM-IN-SUPERVISOR-MODE OS))
           (AND
            (GOOD-CPU-LIST (TABLE '9 (OS-TASK-TABLE OS)))
            (AND
             (GOOD-STATUS-LIST (TABLE '2 (OS-STATUS-TABLE OS)))
             (AND
              (FINITE-NUMBER-QUEUEP (OS-READYQ OS)
                                    '16
                                    '16)
              (AND
               (MUTUALLY-DISJOINT (TABLE '2 (OS-SEGMENT-TABLE OS)))
               (AND
                (DISJOINT-EVERYWHERE '0
                                     '3311
                                     (TABLE '2 (OS-SEGMENT-TABLE OS)))
                (AND
                 (FINITE-SEGMENT-TABLEP (TABLE '2 (OS-SEGMENT-TABLE OS))
                                        '65536)
                 (AND
                  (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-IBUFFERS OS))
                                             '4
                                             '65536)
                  (AND
                   (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-OBUFFERS OS))
                                              '4
                                              '65536)
                   (AND
                    (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-MBUFFERS OS))
                                               '4
                                               '65536)
                    (AND
                     (PERMUTATION (MAPUP-QUEUE (OS-READYQ OS))
                                  (OS-READY-SET OS))
                     (AND
                      (IFF (TM-WAITING OS)
                           (ARRAY-QEMPTYP (OS-READYQ OS)))
                      (IMPLIES
                       (NOT (TM-WAITING OS))
                       (AND
                        (EQUAL
                             (TM-BASE OS)
                             (BASE (GETNTH (OS-CURRENT-TASKID OS)
                                           (TABLE '2 (OS-SEGMENT-TABLE OS)))))
                        (EQUAL
                         (TM-LIMIT OS)
                         (LIMIT
                          (GETNTH
                           (OS-CURRENT-TASKID OS)
                           (TABLE '2
                               (OS-SEGMENT-TABLE OS))))))))))))))))))))))))))))
 NIL)

(PROVE-LEMMA GOOD-TM-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS) (GOOD-TM OS))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS)

(PROVE-LEMMA TM-SLIMIT-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TM-SLIMIT OS) '3311))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS)

(PROVE-LEMMA OS-CODE-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (OS-CODE OS)
                             '(2187 13 2 2187 14 3 75 3 191 14 3280 77 2 9
                                    65 2 15 4299 2 0 12747 2 0 4811 2 13
                                    5067 2 14 3275 2 4 3531 2 5 3787 2 6
                                    4043 2 7 65 2 8 20683 2 0 4171 2 13 4171
                                    3 14 0 2123 3 2 77 2 9 65 2 15 77 3 2 65
                                    3 159 218 3 478 3 2123 3 2 65 3 8 6283 0
                                    2 14731 0 2 6795 0 3 63563 7 2 55371 6 2
                                    47179 5 2 38987 4 2 30795 3 2 22603 2 2
                                    0 14 2547 75 3 191 14 3280 14 3274 14
                                    3240 2 3206 14 2547 75 3 191 14 3280 14
                                    3274 77 2 2 65 2 211 203 2 1 459 2 0 2
                                    3206 14 2547 137 8 4 131 8 0 10 2712 131
                                    8 1 10 2813 131 8 2 10 2922 2 2981 2123
                                    6 2 73 6 16 2123 7 3 75 3 191 14 3280
                                    2187 12 2 2123 4 6 77 4 8 2123 3 2 77 3
                                    128 2113 3 4 65 3 499 14 3297 10 2791
                                    2123 2 7 14 3240 2123 3 6 77 3 2 65 3
                                    211 195 3 3 6 3222 4547 3 12 6 3222 203
                                    3 0 459 3 0 2123 2 6 75 3 191 14 3240 2
                                    3222 75 3 191 14 3274 4171 3 12 77 3 2
                                    65 3 211 203 3 2 2507 3 6 2 3206 2123 6
                                    2 73 6 16 75 3 191 14 3280 2187 12 2
                                    2123 4 2 77 4 8 2123 3 6 77 3 128 2113 3
                                    4 65 3 499 14 3293 10 2900 14 3280 14
                                    3274 4171 3 12 77 3 9 65 3 15 3019 3 2
                                    2123 3 6 77 3 2 65 3 211 195 3 2 6 3222
                                    4547 3 12 6 3222 203 3 0 459 3 0 2123 2
                                    6 75 3 191 14 3240 2 3222 75 3 191 14
                                    3274 4171 3 12 77 3 2 65 3 211 203 3 3
                                    2507 3 6 2 3206 2123 7 3 75 3 191 14
                                    3280 2187 12 2 2123 3 2 77 3 8 65 3 371
                                    14 3297 10 2959 2123 2 7 14 3240 182 12
                                    6 3222 166 12 2 3222 75 3 191 14 3274
                                    4171 3 12 77 3 2 65 3 211 203 3 4 459 3
                                    0 2 3206 75 3 191 14 3280 2187 12 2 2123
                                    3 2 77 3 8 65 3 243 14 3293 10 3020 14
                                    3280 14 3274 4171 3 12 77 3 9 65 3 15
                                    3019 3 2 2 3222 75 3 191 14 3274 4171 3
                                    12 77 3 2 65 3 211 203 3 5 459 3 0 2
                                    3206 139 10 3206 2187 14 3 75 3 191 14
                                    3293 10 3063 139 10 3231 4171 3 14 14
                                    2547 4171 5 8 77 5 2 65 5 211 195 5 5 6
                                    3091 4171 2 8 75 3 191 14 3240 203 5 0
                                    459 5 0 4171 3 8 77 3 8 65 3 243 14 3297
                                    6 3114 4171 2 9 65 2 256 14 3258 130 10
                                    178 8 6 3128 4171 2 9 65 2 256 14 3240
                                    130 10 4171 2 9 14 3240 130 10 139 10
                                    3206 2187 14 3 75 3 191 14 3293 10 3156
                                    139 10 3231 4171 3 14 14 2547 4171 5 9
                                    77 5 2 65 5 211 195 5 4 6 3184 4171 2 9
                                    75 3 191 14 3240 203 5 0 459 5 0 4171 3
                                    9 77 3 8 65 3 371 14 3293 138 10 14 3280
                                    2191 9 2 14 3274 130 10 75 3 191 14 3293
                                    10 3221 14 3280 14 2601 186 11 162 0 4
                                    75 3 191 14 3280 14 2601 174 0 75 3 191
                                    14 3280 14 2601 162 0 2123 4 3 65 4 4
                                    14401 4 3 2251 4 2 726 3 31175 3 3 0
                                    14411 4 3 30789 4 3 2113 4 3 65 4 4 2251
                                    4 2 0 722 3 30919 3 3 0 2123 2 3 65 2 4
                                    6209 2 3 6219 2 2 0 707 3 0 0 31427 3 3
                                    0)))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS)

(PROVE-LEMMA OS-CLOCK-NEW-PC
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '3 (TM-MEMORY OS))
                             '2654))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CLOCK-NEW-PC)

(PROVE-LEMMA OS-ERROR-NEW-PC
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '4 (TM-MEMORY OS))
                             '2667))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-ERROR-NEW-PC)

(PROVE-LEMMA OS-SVC-NEW-PC
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '5 (TM-MEMORY OS))
                             '2690))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SVC-NEW-PC)

(PROVE-LEMMA OS-INPUT-NEW-PC
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '6 (TM-MEMORY OS))
                             '3042))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-INPUT-NEW-PC)

(PROVE-LEMMA OS-OUTPUT-NEW-PC
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '7 (TM-MEMORY OS))
                             '3135))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OUTPUT-NEW-PC)

(PROVE-LEMMA OS-TIME-SLICE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH '11 (TM-MEMORY OS))
                             '1000))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TIME-SLICE)

(PROVE-LEMMA OS-NOT-IN-SUPERVISOR-MODE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (NOT (TM-IN-SUPERVISOR-MODE OS)))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-NOT-IN-SUPERVISOR-MODE)

(PROVE-LEMMA
            TM-BASE-OS
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (NOT (TM-WAITING OS)))
                     (EQUAL (TM-BASE OS)
                            (BASE (GETNTH (OS-CURRENT-TASKID OS)
                                          (TABLE '2 (OS-SEGMENT-TABLE OS))))))
            ((ENABLE GOOD-OS)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS)

(PROVE-LEMMA TM-LIMIT-OS
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (NOT (TM-WAITING OS)))
                    (EQUAL (TM-LIMIT OS)
                           (LIMIT (GETNTH (OS-CURRENT-TASKID OS)
                                          (TABLE '2 (OS-SEGMENT-TABLE OS))))))
           ((ENABLE GOOD-OS)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS)

(PROVE-LEMMA GOOD-CPU-LIST-OS-TASK-TABLE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-CPU-LIST (TABLE '9 (OS-TASK-TABLE OS))))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-LIST-OS-TASK-TABLE)

(PROVE-LEMMA GOOD-STATUS-LIST-OS-STATUS-TABLE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-STATUS-LIST (TABLE '2 (OS-STATUS-TABLE OS))))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-OS-READYQ
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (FINITE-NUMBER-QUEUEP (OS-READYQ OS)
                                            '16
                                            '16))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-OS-READYQ)

(PROVE-LEMMA MUTUALLY-DISJOINT-OS-SEGMENT-TABLE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (MUTUALLY-DISJOINT (TABLE '2 (OS-SEGMENT-TABLE OS))))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MUTUALLY-DISJOINT-OS-SEGMENT-TABLE)

(PROVE-LEMMA DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (DISJOINT-EVERYWHERE '0
                                           '3311
                                           (TABLE '2 (OS-SEGMENT-TABLE OS))))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE)

(PROVE-LEMMA FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (FINITE-SEGMENT-TABLEP (TABLE '2 (OS-SEGMENT-TABLE OS))
                                             '65536))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-IBUFFERS OS))
                                                 '4
                                                 '65536))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-OBUFFERS OS))
                                                 '4
                                                 '65536))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (FINITE-NUMBER-QUEUE-LISTP (TABLE '8 (OS-MBUFFERS OS))
                                                 '4
                                                 '65536))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUE-TABLEP-OS-MBUFFERS
      (REWRITE)
      (IMPLIES (GOOD-OS OS)
               (FINITE-NUMBER-QUEUE-TABLEP '16
                                           (TABLE '16
                                                  (TABLE '8 (OS-MBUFFERS OS)))
                                           '4
                                           '65536))
      ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
               FINITE-NUMBER-QUEUE-TABLEP-TABLE LENGTH-TABLE
               LENGTH-OS-MBUFFERS)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-OS-MBUFFERS)

(PROVE-LEMMA PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (PERMUTATION (MAPUP-QUEUE (OS-READYQ OS))
                                   (OS-READY-SET OS)))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET)

(PROVE-LEMMA TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (IFF (TM-WAITING OS)
                           (ARRAY-QEMPTYP (OS-READYQ OS))))
             ((ENABLE GOOD-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)

(DEFN OS-TASKID
      (OS)
      (ARRAY-QFIRST (OS-READYQ OS))
      NIL)

(PROVE-LEMMA FINITE-NUMBERP-OS-TASKID
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (FINITE-NUMBERP (OS-TASKID OS) '16))
             ((ENABLE OS-TASKID FINITE-NUMBERP)
              (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE (OS-READYQ OS))
                                                     (CAPACITY '16)
                                                     (LUB '16))
                   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
                   (FINITE-NUMBER-QUEUEP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-OS-TASKID)

(DEFTHEORY GOOD-OS-PROPERTIES
           (FINITE-NUMBERP-OS-TASKID TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
                                     PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET
                                     FINITE-NUMBER-QUEUE-TABLEP-OS-MBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS
                                     FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE
                                     DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE
                                     MUTUALLY-DISJOINT-OS-SEGMENT-TABLE
                                     FINITE-NUMBER-QUEUEP-OS-READYQ
                                     GOOD-STATUS-LIST-OS-STATUS-TABLE
                                     GOOD-CPU-LIST-OS-TASK-TABLE TM-LIMIT-OS
                                     TM-BASE-OS OS-NOT-IN-SUPERVISOR-MODE
                                     OS-TIME-SLICE OS-OUTPUT-NEW-PC
                                     OS-INPUT-NEW-PC OS-SVC-NEW-PC
                                     OS-ERROR-NEW-PC OS-CLOCK-NEW-PC
                                     OS-CODE-OS TM-SLIMIT-OS GOOD-TM-OS))

(PROVE-LEMMA LENGTH-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (EQUAL (LENGTH QUEUE) '20))
             ((USE (LENGTH-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '16)
                                               (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA PLISTP-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (PLISTP QUEUE))
             ((USE (PLISTP-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '16)
                                               (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (ARRAY-QUEUEP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (AND (NUMBERP (GETNTH '0 QUEUE))
                           (LESSP (GETNTH '0 QUEUE) '16)))
             ((USE (FINITE-NUMBER-QUEUE-QHEAD-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '16)
                                                   (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (AND (NUMBERP (GETNTH '1 QUEUE))
                           (LESSP (GETNTH '1 QUEUE) '16)))
             ((USE (FINITE-NUMBER-QUEUE-QTAIL-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '16)
                                                   (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (AND (NUMBERP (GETNTH '2 QUEUE))
                           (LESSP (GETNTH '2 QUEUE) '17)))
             ((USE (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE (QUEUE QUEUE)
                                                         (CAPACITY '16)
                                                         (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (EQUAL (GETNTH '3 QUEUE) '16))
             ((USE (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE (QUEUE QUEUE)
                                                         (CAPACITY '16)
                                                         (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                           (AND (NOT (ARRAY-QFULLP QUEUE))
                                (AND (NUMBERP ITEM)
                                     (LESSP ITEM '16))))
                      (FINITE-NUMBER-QUEUEP (ARRAY-ENQ ITEM QUEUE)
                                            '16
                                            '16))
             ((USE (FINITE-NUMBER-QUEUEP-ARRAY-ENQ (ITEM ITEM)
                                                   (QUEUE QUEUE)
                                                   (CAPACITY '16)
                                                   (LUB '16)))
              (ENABLE FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (FINITE-NUMBER-QUEUEP (ARRAY-DEQ QUEUE)
                                            '16
                                            '16))
             ((USE (FINITE-NUMBER-QUEUEP-ARRAY-DEQ (QUEUE QUEUE)
                                                   (CAPACITY '16)
                                                   (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (AND (NUMBERP (ARRAY-QFIRST QUEUE))
                           (LESSP (ARRAY-QFIRST QUEUE) '16)))
             ((USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                     (CAPACITY '16)
                                                     (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (REMAINDER (ARRAY-QFIRST QUEUE) '16)
                             (ARRAY-QFIRST QUEUE)))
             ((USE (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                               (CAPACITY '16)
                                                               (LUB '16)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY)

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY
                   FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                   FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY
                   FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY
                   ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY
                   PLISTP-FINITE-NUMBER-QUEUE-COROLLARY
                   LENGTH-FINITE-NUMBER-QUEUE-COROLLARY))

(PROVE-LEMMA LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (LENGTH QUEUE) '8))
             ((USE (LENGTH-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (PLISTP QUEUE))
             ((USE (PLISTP-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (ARRAY-QUEUEP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '0 QUEUE))
                           (LESSP (GETNTH '0 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QHEAD-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '1 QUEUE))
                           (LESSP (GETNTH '1 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QTAIL-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '2 QUEUE))
                           (LESSP (GETNTH '2 QUEUE) '5)))
             ((USE (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (GETNTH '3 QUEUE) '4))
             ((USE (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (AND (NOT (ARRAY-QFULLP QUEUE))
                         (AND (NUMBERP ITEM)
                              (LESSP ITEM '65536))))
               (FINITE-NUMBER-QUEUEP (ARRAY-ENQ ITEM QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-ENQ (ITEM ITEM)
                                            (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE FINITE-NUMBERP)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (NOT (ARRAY-QEMPTYP QUEUE)))
               (FINITE-NUMBER-QUEUEP (ARRAY-DEQ QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-DEQ (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (AND (NUMBERP (ARRAY-QFIRST QUEUE))
                           (LESSP (ARRAY-QFIRST QUEUE) '65536)))
             ((USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                     (CAPACITY '4)
                                                     (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (REMAINDER (ARRAY-QFIRST QUEUE)
                                        '65536)
                             (ARRAY-QFIRST QUEUE)))
             ((USE (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                               (CAPACITY '4)
                                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-LISTP-GETNTH-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP '16
                                                       L '4
                                                       '65536)
                           (LESSP I (LENGTH L)))
                      (AND (PLISTP (GETNTH I L))
                           (AND (EQUAL (LENGTH (GETNTH I L)) '16)
                                (FINITE-NUMBER-QUEUE-LISTP (GETNTH I L)
                                                           '4
                                                           '65536))))
             ((USE (FINITE-NUMBER-QUEUE-LISTP-GETNTH (N '16)
                                                     (I I)
                                                     (L L)
                                                     (CAPACITY '4)
                                                     (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-GETNTH-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-GETNTH2-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP '16
                                                       L '4
                                                       '65536)
                           (AND (LESSP I (LENGTH L))
                                (LESSP J '16)))
                      (FINITE-NUMBER-QUEUEP (GETNTH2 I J L)
                                            '4
                                            '65536))
             ((USE (FINITE-NUMBER-QUEUEP-GETNTH2 (N '16)
                                                 (I I)
                                                 (J J)
                                                 (L L)
                                                 (CAPACITY '4)
                                                 (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-GETNTH2-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-TABLEP-PUTNTH-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP '16
                                                       L '4
                                                       '65536)
                           (AND (FINITE-NUMBER-QUEUE-LISTP S '4
                                                           '65536)
                                (AND (PLISTP S)
                                     (EQUAL (LENGTH S) '16))))
                      (FINITE-NUMBER-QUEUE-TABLEP '16
                                                  (PUTNTH S I L)
                                                  '4
                                                  '65536))
             ((USE (FINITE-NUMBER-QUEUE-TABLEP-PUTNTH (N '16)
                                                      (S S)
                                                      (L L)
                                                      (CAPACITY '4)
                                                      (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-PUTNTH-COROLLARY)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-TABLEP '16
                                                       L '4
                                                       '65536)
                           (AND (LESSP I (LENGTH L))
                                (FINITE-NUMBER-QUEUEP QUEUE '4
                                                      '65536)))
                      (FINITE-NUMBER-QUEUE-TABLEP '16
                                                  (PUTNTH2 QUEUE I J L)
                                                  '4
                                                  '65536))
             ((USE (FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2 (N '16)
                                                       (I I)
                                                       (J J)
                                                       (QUEUE QUEUE)
                                                       (L L)
                                                       (CAPACITY '4)
                                                       (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2-COROLLARY)

(DEFTHEORY
 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES
 (FINITE-NUMBER-QUEUE-TABLEP-PUTNTH2-COROLLARY
      FINITE-NUMBER-QUEUE-TABLEP-PUTNTH-COROLLARY
      FINITE-NUMBER-QUEUEP-GETNTH2-COROLLARY
      FINITE-NUMBER-QUEUE-LISTP-GETNTH-COROLLARY
      REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-MBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS))

(PROVE-LEMMA
 NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ
 (REWRITE)
 (IMPLIES (PERMUTATION (MAPUP-QUEUE (OS-READYQ OS))
                       (OS-READY-SET OS))
          (EQUAL (NUMBER-OF-READY-TASKS (TABLE '2 (OS-STATUS-TABLE OS)))
                 (LENGTH (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE OS-READY-SET)
  (USE
   (LENGTH-PERMUTATION (A (MAPUP-QUEUE (OS-READYQ OS)))
                       (B (OS-READY-SET OS)))
   (NUMBER-OF-READY-TASKS-EQUALS-LENGTH-INDEX-READY-SET
                                    (N '0)
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ)

(PROVE-LEMMA
 OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (EQUAL (GETNTH (TIMES '2 DESTID)
                                   (OS-STATUS-TABLE OS))
                           '2)
                    (FINITE-NUMBERP DESTID '16)))
          (NOT (ARRAY-QFULLP (OS-READYQ OS))))
 ((ENABLE ARRAY-QFULLP FINITE-NUMBERP LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH
          LENGTH-TABLE GETNTH-TABLE GETNTH-GETSEG COMMUTATIVITY-OF-TIMES
          LENGTH-OS-STATUS-TABLE PLUS-0 FINITE-NUMBER-QUEUEP-OS-READYQ
          OS-READY-SET STATUS-FLAG-READYP
          NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY)
  (USE
   (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS
                                     (I DESTID)
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET (OS OS))
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA
 OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (EQUAL (GETNTH (TIMES '2 DESTID)
                                   (OS-STATUS-TABLE OS))
                           '3)
                    (FINITE-NUMBERP DESTID '16)))
          (NOT (ARRAY-QFULLP (OS-READYQ OS))))
 ((ENABLE ARRAY-QFULLP FINITE-NUMBERP LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH
          LENGTH-TABLE GETNTH-TABLE GETNTH-GETSEG COMMUTATIVITY-OF-TIMES
          LENGTH-OS-STATUS-TABLE PLUS-0 FINITE-NUMBER-QUEUEP-OS-READYQ
          OS-READY-SET STATUS-FLAG-READYP
          NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY)
  (USE
   (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS
                                     (I DESTID)
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET (OS OS))
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
 NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (EQUAL (GETNTH (TIMES '2 DESTID)
                                   (OS-STATUS-TABLE OS))
                           '5)
                    (FINITE-NUMBERP DESTID '16)))
          (NOT (ARRAY-QFULLP (OS-READYQ OS))))
 ((ENABLE ARRAY-QFULLP FINITE-NUMBERP LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH
          LENGTH-TABLE GETNTH-TABLE GETNTH-GETSEG COMMUTATIVITY-OF-TIMES
          LENGTH-OS-STATUS-TABLE PLUS-0 FINITE-NUMBER-QUEUEP-OS-READYQ
          OS-READY-SET STATUS-FLAG-READYP
          NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY)
  (USE
   (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS
                                     (I DESTID)
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET (OS OS))
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA
 OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (EQUAL (GETNTH (TIMES '2 DESTID)
                                   (OS-STATUS-TABLE OS))
                           '4)
                    (FINITE-NUMBERP DESTID '16)))
          (NOT (ARRAY-QFULLP (OS-READYQ OS))))
 ((ENABLE ARRAY-QFULLP FINITE-NUMBERP LENGTH-MAPUP-QUEUE-IS-QCURRLENGTH
          LENGTH-TABLE GETNTH-TABLE GETNTH-GETSEG COMMUTATIVITY-OF-TIMES
          LENGTH-OS-STATUS-TABLE PLUS-0 FINITE-NUMBER-QUEUEP-OS-READYQ
          OS-READY-SET STATUS-FLAG-READYP
          NUMBER-OF-READY-TASKS-EQUALS-LENGTH-OS-READYQ
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY)
  (USE
   (LESSP-NUMBER-OF-READY-TASKS-LENGTH-STATUS
                                     (I DESTID)
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET (OS OS))
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QARRAY-AFTER-QREPLACE
             NIL
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (EQUAL (GETSEG '4
                                     CAPACITY
                                     (ARRAY-QREPLACE ITEM QUEUE))
                             (PUTNTH ITEM
                                     (DECR-MOD (GETNTH '1 QUEUE)
                                               (GETNTH '3 QUEUE))
                                     (GETSEG '4 CAPACITY QUEUE))))
             ((ENABLE ARRAY-ENQ ARRAY-NONLAST ARRAY-QREPLACE ARRAY-QUEUEP
                      DIFFERENCE-PLUS1 FINITE-NUMBER-QUEUEP
                      GETNTH-PUTNTH-COINCIDENCE GETSEG-AFTER-PUTNTH
                      GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTNTH
                      PUTNTH-NON-INTERFERENCE-COROLLARY2)
              (DISABLE PLUS)
              (USE (DECR-MOD-SIZE (A (GETNTH '1 QUEUE))
                                  (N (GETNTH '3 QUEUE))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA
           FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE
           (REWRITE)
           (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                         (AND (NOT (ARRAY-QEMPTYP QUEUE))
                              (FINITE-NUMBERP ITEM LUB)))
                    (FINITE-NUMBER-QUEUEP (ARRAY-QREPLACE ITEM QUEUE)
                                          CAPACITY LUB))
           ((ENABLE ARRAY-QUEUEP-ARRAY-QREPLACE FINITE-NUMBER-QUEUEP)
            (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
            (USE (FINITE-NUMBER-QUEUE-QARRAY-AFTER-QREPLACE (QUEUE QUEUE)
                                                            (CAPACITY CAPACITY)
                                                            (LUB LUB)
                                                            (ITEM ITEM))
                 (FINITE-NUMBER-LISTP-PUTNTH (V ITEM)
                                             (N (DECR-MOD (GETNTH '1 QUEUE)
                                                          (GETNTH '3 QUEUE)))
                                             (L (GETSEG '4 CAPACITY QUEUE))
                                             (LUB LUB)))
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE)

(PROVE-LEMMA
     PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
     (REWRITE)
     (IMPLIES (GOOD-OS OS)
              (PERMUTATION (MAPUP-QUEUE (OS-READYQ OS))
                           (INDEX-READY-SET '0
                                            (TABLE '2 (OS-STATUS-TABLE OS)))))
     ((ENABLE OS-READY-SET)
      (USE (PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET (OS OS)))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY)

(DEFN MAPUP-CPU
      (TASKID OS)
      (IF (TM-WAITING OS)
          (GETNTH TASKID
                  (TABLE '9 (OS-TASK-TABLE OS)))
          (IF (EQUAL TASKID (OS-CURRENT-TASKID OS))
              (TM-CPU OS)
              (GETNTH TASKID
                      (TABLE '9 (OS-TASK-TABLE OS)))))
      NIL)

(DEFN MAPUP-REGS
      (TASKID OS)
      (GETSEG '0 '8 (MAPUP-CPU TASKID OS))
      NIL)

(DEFN MAPUP-CC
      (TASKID OS)
      (TM-UNPACK-CC (GETNTH '8 (MAPUP-CPU TASKID OS)))
      NIL)

(DEFN MAPUP-ERROR
      (TASKID OS)
      (TM-UNPACK-ERROR (GETNTH '8 (MAPUP-CPU TASKID OS)))
      NIL)

(DEFN MAPUP-SVCFLAG
      (TASKID OS)
      (TM-UNPACK-SVCFLAG (GETNTH '8 (MAPUP-CPU TASKID OS)))
      NIL)

(DEFN MAPUP-SVCID
      (TASKID OS)
      (TM-UNPACK-SVCID (GETNTH '8 (MAPUP-CPU TASKID OS)))
      NIL)

(DEFN MAPUP-BASE
      (TASKID OS)
      (BASE (GETNTH TASKID
                    (TABLE '2 (OS-SEGMENT-TABLE OS))))
      NIL)

(DEFN MAPUP-LIMIT
      (TASKID OS)
      (LIMIT (GETNTH TASKID
                     (TABLE '2 (OS-SEGMENT-TABLE OS))))
      NIL)

(DEFN MAPUP-TASK
      (TASKID OS)
      (MAPUP-ADDRESS-SPACE (TM-MEMORY OS)
                           (MAPUP-REGS TASKID OS)
                           (MAPUP-CC TASKID OS)
                           (MAPUP-ERROR TASKID OS)
                           (MAPUP-SVCFLAG TASKID OS)
                           (MAPUP-SVCID TASKID OS)
                           (MAPUP-BASE TASKID OS)
                           (MAPUP-LIMIT TASKID OS))
      NIL)

(DEFN MAPUP-TASKS
      (TASKID OS)
      (IF (LESSP TASKID '16)
          (CONS (MAPUP-TASK TASKID OS)
                (MAPUP-TASKS (ADD1 TASKID) OS))
          'NIL)
      ((LESSP (DIFFERENCE (AK-TASKIDLUB) TASKID))))

(DEFN MAPUP-OS-TASKS
      (OS)
      (MAPUP-TASKS '0 OS)
      NIL)

(DEFN MAPUP-QUEUE-LIST
      (L)
      (IF (LISTP L)
          (CONS (MAPUP-QUEUE (CAR L))
                (MAPUP-QUEUE-LIST (CDR L)))
          'NIL)
      NIL)

(DEFN MAPUP-OS-IBUFFERS
      (OS)
      (MAPUP-QUEUE-LIST (TABLE '8 (OS-IBUFFERS OS)))
      NIL)

(DEFN MAPUP-OS-OBUFFERS
      (OS)
      (MAPUP-QUEUE-LIST (TABLE '8 (OS-OBUFFERS OS)))
      NIL)

(DEFN MAPUP-OS-MBUFFERS
      (OS)
      (TABLE '16
             (MAPUP-QUEUE-LIST (TABLE '8 (OS-MBUFFERS OS))))
      NIL)

(DEFN MAPUP-OS
      (OS)
      (AK (MAPUP-OS-TASKS OS)
          (MAPUP-OS-IBUFFERS OS)
          (MAPUP-OS-OBUFFERS OS)
          (MAPUP-OS-MBUFFERS OS)
          (MAPUP-QUEUE (OS-READYQ OS))
          (TABLE '2 (OS-STATUS-TABLE OS))
          (TM-RWSTATE OS)
          (TM-CLOCK OS)
          (TM-IPORTS OS)
          (TM-OPORTS OS))
      NIL)

(PROVE-LEMMA LENGTH-MAPUP-QUEUE-LIST
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-QUEUE-LIST L))
                    (LENGTH L))
             ((ENABLE MAPUP-QUEUE-LIST LENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-QUEUE-LIST)

(PROVE-LEMMA GETNTH-MAPUP-QUEUE-LIST
             (REWRITE)
             (IMPLIES (LESSP I (LENGTH L))
                      (EQUAL (GETNTH I (MAPUP-QUEUE-LIST L))
                             (MAPUP-QUEUE (GETNTH I L))))
             ((ENABLE GETNTH LENGTH MAPUP-QUEUE-LIST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-MAPUP-QUEUE-LIST)

(PROVE-LEMMA MAPUP-QUEUE-LIST-PUTNTH
             (REWRITE)
             (EQUAL (MAPUP-QUEUE-LIST (PUTNTH V I L))
                    (PUTNTH (MAPUP-QUEUE V)
                            I
                            (MAPUP-QUEUE-LIST L)))
             ((ENABLE MAPUP-QUEUE-LIST PUTNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-LIST-PUTNTH)

(PROVE-LEMMA MAPUP-QUEUE-GETNTH
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUE-LISTP L CAPACITY LUB)
                           (LESSP ID (LENGTH L)))
                      (EQUAL (MAPUP-QUEUE (GETNTH ID L))
                             (GETNTH ID (MAPUP-QUEUE-LIST L))))
             ((ENABLE MAPUP-QUEUE-LIST GETNTH LENGTH FINITE-NUMBER-QUEUE-LISTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-GETNTH)

(PROVE-LEMMA LENGTH-MAPUP-TASKS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-TASKS TASKID OS))
                    (DIFFERENCE '16 TASKID))
             ((ENABLE MAPUP-TASKS LENGTH DIFFERENCE-0 AK-TASKIDLUB)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-TASKS)

(PROVE-LEMMA LENGTH-MAPUP-OS-TASKS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-OS-TASKS OS))
                    '16)
             ((ENABLE LENGTH-MAPUP-TASKS MAPUP-OS-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-OS-TASKS)

(PROVE-LEMMA LENGTH-MAPUP-CPU
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (LENGTH (MAPUP-CPU TASKID OS))
                             '9))
             ((ENABLE MAPUP-CPU COMMUTATIVITY-OF-TIMES LENGTH-TM-CPU
                      LENGTH-OS-TASK-TABLE LENGTH-GETSEG GETNTH-TABLE)
              (USE (LESSP-TIMES (A '9)
                                (B TASKID)
                                (C '16)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-CPU)

(PROVE-LEMMA FINITE-NUMBER-LISTP-MAPUP-CPU
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (FINITE-NUMBER-LISTP (MAPUP-CPU TASKID OS)
                                           '65536))
             ((ENABLE MAPUP-CPU OS-TASK-TABLE COMMUTATIVITY-OF-TIMES
                      LENGTH-TM-CPU LENGTH-OS-TASK-TABLE
                      FINITE-NUMBER-LISTP-GETSEG LENGTH-GETSEG GETNTH-TABLE)
              (USE (LESSP-TIMES (A '9)
                                (B TASKID)
                                (C '16)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-MAPUP-CPU)

(PROVE-LEMMA
            NUMBERP-MAPUP-BASE
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (NUMBERP (MAPUP-BASE TASKID OS)))
            ((ENABLE MAPUP-BASE BASE FINITE-NUMBERP OS-SEGMENT-TABLE
                     COMMUTATIVITY-OF-TIMES FINITE-NUMBER-LISTP-GETSEG
                     LENGTH-GETSEG GETNTH-TABLE CAR-GETSEG)
             (USE (LESSP-TIMES (A '9)
                               (B TASKID)
                               (C '16))
                  (FINITE-NUMBERP-GETNTH (I (TIMES '2 TASKID))
                                         (L (GETSEG '159 '32 (TM-MEMORY OS)))
                                         (LUB '65536)))
             (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE NUMBERP-MAPUP-BASE)

(PROVE-LEMMA
            NUMBERP-MAPUP-LIMIT
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (NUMBERP (MAPUP-LIMIT TASKID OS)))
            ((ENABLE MAPUP-LIMIT LIMIT FINITE-NUMBERP OS-SEGMENT-TABLE
                     COMMUTATIVITY-OF-TIMES FINITE-NUMBER-LISTP-GETSEG
                     LENGTH-GETSEG GETNTH-TABLE
                     GETNTH-PLUS-1-IS-CADR-GETSEG-INVERSE)
             (USE (LESSP-TIMES (A '9)
                               (B TASKID)
                               (C '16))
                  (FINITE-NUMBERP-GETNTH (I (PLUS '1 (TIMES '2 TASKID)))
                                         (L (GETSEG '159 '32 (TM-MEMORY OS)))
                                         (LUB '65536)))
             (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE NUMBERP-MAPUP-LIMIT)

(PROVE-LEMMA PLISTP-MAPUP-REGS
             (REWRITE)
             (PLISTP (MAPUP-REGS TASKID OS))
             ((ENABLE MAPUP-REGS PLISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-MAPUP-REGS)

(PROVE-LEMMA LENGTH-MAPUP-REGS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-REGS TASKID OS))
                    '8)
             ((ENABLE MAPUP-REGS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-REGS)

(PROVE-LEMMA FINITE-NUMBER-LISTP-MAPUP-REGS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (FINITE-NUMBER-LISTP (MAPUP-REGS TASKID OS)
                                           '65536))
             ((ENABLE MAPUP-REGS LENGTH-MAPUP-CPU
                      FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBER-LISTP-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-MAPUP-REGS)

(PROVE-LEMMA FINITE-NUMBERP-MAPUP-CC
             (REWRITE)
             (FINITE-NUMBERP (MAPUP-CC TASKID OS)
                             '4)
             ((ENABLE MAPUP-CC FINITE-NUMBERP-TM-UNPACK-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MAPUP-CC)

(PROVE-LEMMA FINITE-NUMBERP-MAPUP-ERROR
             (REWRITE)
             (FINITE-NUMBERP (MAPUP-ERROR TASKID OS)
                             '64)
             ((ENABLE MAPUP-ERROR FINITE-NUMBERP-TM-UNPACK-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MAPUP-ERROR)

(PROVE-LEMMA FINITE-NUMBERP-MAPUP-SVCFLAG
             (REWRITE)
             (FINITE-NUMBERP (MAPUP-SVCFLAG TASKID OS)
                             '2)
             ((ENABLE MAPUP-SVCFLAG FINITE-NUMBERP-TM-UNPACK-SVCFLAG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MAPUP-SVCFLAG)

(PROVE-LEMMA FINITE-NUMBERP-MAPUP-SVCID
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (FINITE-NUMBERP (MAPUP-SVCID TASKID OS)
                                      '128))
             ((ENABLE MAPUP-SVCID LENGTH-MAPUP-CPU
                      FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-MAPUP-SVCID)

(PROVE-LEMMA LEQ-PLUS-BASE-LIMIT-GETNTH
             NIL
             (IMPLIES (AND (FINITE-SEGMENT-TABLEP L MAX)
                           (LESSP I (LENGTH L)))
                      (IF (LESSP MAX
                                 (PLUS (BASE (GETNTH I L))
                                       (LIMIT (GETNTH I L))))
                          '*1*FALSE
                          '*1*TRUE))
             ((ENABLE FINITE-SEGMENT-TABLEP BASE LIMIT LENGTH GETNTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA LEQ-PLUS-BASE-LIMIT-GETNTH-COROLLARY
             (REWRITE)
             (IMPLIES (AND (FINITE-SEGMENT-TABLEP L '65536)
                           (LESSP I (LENGTH L)))
                      (NOT (LESSP '65536
                                  (PLUS (BASE (GETNTH I L))
                                        (LIMIT (GETNTH I L))))))
             ((USE (LEQ-PLUS-BASE-LIMIT-GETNTH (I I)
                                               (L L)
                                               (MAX '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LEQ-PLUS-BASE-LIMIT-GETNTH-COROLLARY)

(PROVE-LEMMA LEQ-PLUS-MAPUP-BASE-MAPUP-LIMIT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (NOT (LESSP '65536
                                  (PLUS (MAPUP-BASE TASKID OS)
                                        (MAPUP-LIMIT TASKID OS)))))
             ((ENABLE MAPUP-BASE MAPUP-LIMIT LENGTH-OS-SEGMENT-TABLE
                      LENGTH-TABLE LEQ-PLUS-BASE-LIMIT-GETNTH-COROLLARY)
              (USE (FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE (OS OS)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LEQ-PLUS-MAPUP-BASE-MAPUP-LIMIT)

(PROVE-LEMMA LENGTH-TM-MEMORY-MAPUP-TASK
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (LENGTH (TM-MEMORY (MAPUP-TASK TASKID OS)))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-TASK LENGTH MAPUP-ADDRESS-SPACE LENGTH-GETSEG
                      MAPUP-LIMIT)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (USE (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE LENGTH-TM-MEMORY-MAPUP-TASK)

(PROVE-LEMMA
 GOOD-ADDRESS-SPACE-MAPUP-TASK
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (FINITE-NUMBERP TASKID '16))
          (GOOD-ADDRESS-SPACE (MAPUP-TASK TASKID OS)
                              (LENGTH (TM-MEMORY (MAPUP-TASK TASKID OS)))))
 ((ENABLE MAPUP-TASK A-FINITE-NUMBER-IS-LESSP-THAN-ITS-LUB NUMBERP-MAPUP-LIMIT
          PLISTP-MAPUP-REGS LENGTH-MAPUP-REGS FINITE-NUMBER-LISTP-MAPUP-REGS
          FINITE-NUMBERP-MAPUP-CC FINITE-NUMBERP-MAPUP-ERROR
          FINITE-NUMBERP-MAPUP-SVCFLAG FINITE-NUMBERP-MAPUP-SVCID
          LEQ-PLUS-MAPUP-BASE-MAPUP-LIMIT)
  (USE
    (GOOD-ADDRESS-SPACE-MAPUP-ADDRESS-SPACE (MEMORY (TM-MEMORY OS))
                                            (REGS (MAPUP-REGS TASKID OS))
                                            (CC (MAPUP-CC TASKID OS))
                                            (ERROR (MAPUP-ERROR TASKID OS))
                                            (SVCFLAG (MAPUP-SVCFLAG TASKID OS))
                                            (SVCID (MAPUP-SVCID TASKID OS))
                                            (BASE (MAPUP-BASE TASKID OS))
                                            (LIMIT (MAPUP-LIMIT TASKID OS)))
    (TM-SHELLP-TM (TM OS))
    (LENGTH-TM-MEMORY-MAPUP-TASK (TASKID TASKID)
                                 (OS OS)))
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-MAPUP-TASK)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-LIST-MAPUP-TASKS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP TASKID '16))
                      (GOOD-ADDRESS-SPACE-LIST (MAPUP-TASKS TASKID OS)))
             ((ENABLE GOOD-ADDRESS-SPACE-LIST AK-TASKIDLUB FINITE-NUMBERP
                      MAPUP-TASKS GOOD-ADDRESS-SPACE-MAPUP-TASK)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-LIST-MAPUP-TASKS)

(PROVE-LEMMA GOOD-ADDRESS-SPACE-LIST-MAPUP-OS-TASKS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-ADDRESS-SPACE-LIST (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP AK-TASKIDLUB
                      GOOD-ADDRESS-SPACE-LIST-MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-ADDRESS-SPACE-LIST-MAPUP-OS-TASKS)

(PROVE-LEMMA LENGTH-MAPUP-OS-IBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-OS-IBUFFERS OS))
                    '16)
             ((ENABLE MAPUP-OS-IBUFFERS LENGTH-MAPUP-QUEUE-LIST LENGTH-TABLE
                      OS-IBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-OS-IBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-MAPUP-QUEUE
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY '65536)
                      (GOOD-TASK-BUFFER (MAPUP-QUEUE QUEUE)
                                        CAPACITY))
             ((ENABLE FINITE-NUMBER-QUEUEP GOOD-TASK-BUFFER PLISTP-MAPUP-QUEUE
                      FINITE-NUMBER-LISTP-MAPUP-QUEUE)
              (USE (LENGTH-MAPUP-QUEUE (QUEUE QUEUE)))
              (ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-MAPUP-QUEUE)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-MAPUP-QUEUE-LIST
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUE-LISTP L CAPACITY '65536)
                      (GOOD-TASK-BUFFER-LIST (MAPUP-QUEUE-LIST L)
                                             CAPACITY))
             ((ENABLE FINITE-NUMBER-QUEUE-LISTP GOOD-TASK-BUFFER-LIST
                      MAPUP-QUEUE-LIST GOOD-TASK-BUFFER-MAPUP-QUEUE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-MAPUP-QUEUE-LIST)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-MAPUP-OS-IBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-TASK-BUFFER-LIST (MAPUP-OS-IBUFFERS OS)
                                             '4))
             ((ENABLE MAPUP-OS-IBUFFERS GOOD-TASK-BUFFER-LIST-MAPUP-QUEUE-LIST)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-MAPUP-OS-IBUFFERS)

(PROVE-LEMMA LENGTH-MAPUP-OS-OBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-OS-OBUFFERS OS))
                    '16)
             ((ENABLE MAPUP-OS-OBUFFERS LENGTH-MAPUP-QUEUE-LIST LENGTH-TABLE
                      OS-OBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-OS-OBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-MAPUP-OS-OBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-TASK-BUFFER-LIST (MAPUP-OS-OBUFFERS OS)
                                             '4))
             ((ENABLE MAPUP-OS-OBUFFERS GOOD-TASK-BUFFER-LIST-MAPUP-QUEUE-LIST)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-MAPUP-OS-OBUFFERS)

(PROVE-LEMMA LENGTH-MAPUP-OS-MBUFFERS
             (REWRITE)
             (EQUAL (LENGTH (MAPUP-OS-MBUFFERS OS))
                    '16)
             ((ENABLE MAPUP-OS-MBUFFERS LENGTH-MAPUP-QUEUE-LIST LENGTH-TABLE
                      OS-MBUFFERS LENGTH-GETSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-MAPUP-OS-MBUFFERS)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-NTHCDR
             (REWRITE)
             (IMPLIES (GOOD-TASK-BUFFER-LIST L CAPACITY)
                      (GOOD-TASK-BUFFER-LIST (NTHCDR N L)
                                             CAPACITY))
             ((ENABLE GOOD-TASK-BUFFER-LIST NTHCDR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-NTHCDR)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-FIRSTN
             (REWRITE)
             (IMPLIES (GOOD-TASK-BUFFER-LIST L CAPACITY)
                      (GOOD-TASK-BUFFER-LIST (FIRSTN N L)
                                             CAPACITY))
             ((ENABLE GOOD-TASK-BUFFER-LIST FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-FIRSTN)

(PROVE-LEMMA GOOD-TASK-BUFFER-LIST-GETSEG
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-LIST L CAPACITY)
                           (AND (IF (LESSP (LENGTH L) N)
                                    '*1*FALSE
                                    '*1*TRUE)
                                (IF (LESSP (DIFFERENCE (LENGTH L) N) K)
                                    '*1*FALSE
                                    '*1*TRUE)))
                      (GOOD-TASK-BUFFER-LIST (GETSEG N K L)
                                             CAPACITY))
             ((ENABLE GETSEG-EQUALS-FIRSTN-NTHCDR GOOD-TASK-BUFFER-LIST-NTHCDR
                      GOOD-TASK-BUFFER-LIST-FIRSTN)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-LIST-GETSEG)

(PROVE-LEMMA GOOD-TASK-BUFFER-TABLE-TABLE
             (REWRITE)
             (IMPLIES (AND (GOOD-TASK-BUFFER-LIST L CAPACITY)
                           (AND (EQUAL (REMAINDER (LENGTH L) N) '0)
                                (NOT (ZEROP N))))
                      (GOOD-TASK-BUFFER-TABLE (TABLE N L)
                                              N CAPACITY))
             ((ENABLE GOOD-TASK-BUFFER-TABLE TABLE PLISTP-GETSEG LENGTH-GETSEG
                      LENGTH-NTHCDR ZEROP-REMAINDER-DIFFERENCE
                      GOOD-TASK-BUFFER-LIST-NTHCDR
                      GOOD-TASK-BUFFER-LIST-GETSEG
                      LISTP-IMPLIES-NON-ZERO-LENGTH
                      REMAINDER-ZERO-IMPLIES-LEQ-FACT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-TABLE-TABLE)

(PROVE-LEMMA GOOD-TASK-BUFFER-TABLE-MAPUP-OS-MBUFFERS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-TASK-BUFFER-TABLE (MAPUP-OS-MBUFFERS OS)
                                              '16
                                              '4))
             ((ENABLE MAPUP-OS-MBUFFERS LENGTH-MAPUP-QUEUE-LIST LENGTH-TABLE
                      LENGTH-OS-MBUFFERS GOOD-TASK-BUFFER-TABLE-TABLE
                      FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
                      GOOD-TASK-BUFFER-LIST-MAPUP-QUEUE-LIST)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TASK-BUFFER-TABLE-MAPUP-OS-MBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-LISTP-MAPUP-FINITE-NUMBER-QUEUE
             NIL
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE CAPACITY LUB)
                      (FINITE-NUMBER-LISTP (MAPUP-QUEUE QUEUE)
                                           LUB))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-QUEUE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA
    FINITE-NUMBER-LISTP-MAPUP-FINITE-NUMBER-QUEUE-COROLLARY
    (REWRITE)
    (IMPLIES (GOOD-OS OS)
             (FINITE-NUMBER-LISTP (MAPUP-QUEUE (OS-READYQ OS))
                                  '16))
    ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
     (USE (FINITE-NUMBER-LISTP-MAPUP-FINITE-NUMBER-QUEUE (QUEUE (OS-READYQ OS))
                                                         (CAPACITY '16)
                                                         (LUB '16)))
     (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-LISTP-MAPUP-FINITE-NUMBER-QUEUE-COROLLARY)

(PROVE-LEMMA AK-READY-SET-MAPUP-OS
             (REWRITE)
             (EQUAL (AK-READY-SET (MAPUP-OS OS))
                    (OS-READY-SET OS))
             ((ENABLE MAPUP-OS AK-READY-SET OS-READY-SET)
              (ENABLE-THEORY AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-READY-SET-MAPUP-OS)

(PROVE-LEMMA GOOD-AK-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-AK (MAPUP-OS OS)))
             ((ENABLE GOOD-AK MAPUP-OS QEMPTYP FINITE-NUMBERP TM-WAITING
                      AK-WAITING LENGTH-MAPUP-OS-TASKS LENGTH-TABLE
                      LENGTH-OS-STATUS-TABLE
                      GOOD-ADDRESS-SPACE-LIST-MAPUP-OS-TASKS
                      LENGTH-MAPUP-OS-OBUFFERS LENGTH-MAPUP-OS-IBUFFERS
                      LENGTH-MAPUP-OS-MBUFFERS
                      GOOD-TASK-BUFFER-LIST-MAPUP-OS-OBUFFERS
                      GOOD-TASK-BUFFER-LIST-MAPUP-OS-IBUFFERS
                      GOOD-TASK-BUFFER-TABLE-MAPUP-OS-MBUFFERS
                      PLISTP-MAPUP-QUEUE
                      FINITE-NUMBER-LISTP-MAPUP-FINITE-NUMBER-QUEUE-COROLLARY
                      CORRECTNESS-OF-ARRAY-QEMPTYP)
              (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
              (USE (LENGTH-MAPUP-QUEUE (QUEUE (OS-READYQ OS)))
                   (AK-READY-SET-MAPUP-OS (OS OS))
                   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GOOD-AK-MAPUP-OS)

(PROVE-LEMMA NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (NOT (QEMPTYP (MAPUP-QUEUE (OS-READYQ OS)))))
             ((ENABLE CORRECTNESS-OF-ARRAY-QEMPTYP)
              (ENABLE-THEORY GOOD-OS-PROPERTIES
                             FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ)

(PROVE-LEMMA LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (LESSP (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                             '16))
             ((ENABLE FINITE-NUMBERP FINITE-NUMBER-LISTP-QARRAY
                      FINITE-NUMBER-LISTP-MAPUP-QUEUE
                      CORRECTNESS-OF-ARRAY-QFIRST CORRECTNESS-OF-ARRAY-QEMPTYP)
              (USE (FINITE-NUMBERP-QFIRST (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16)))
              (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                             GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ)

(PROVE-LEMMA GOOD-OS-TM-SET-ERROR
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP ERROR '64))
                      (GOOD-OS (TM-SET-ERROR ERROR OS)))
             ((ENABLE ACCESS-TM-SET-ERROR TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-ERROR)

(PROVE-LEMMA GOOD-OS-TM-SET-PC
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP PC '65536))
                      (GOOD-OS (TM-SET-PC PC OS)))
             ((ENABLE ACCESS-TM-SET-PC TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET GOOD-TM-TM-SET-PC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-PC)

(PROVE-LEMMA GOOD-OS-TM-SET-SP
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP SP '65536))
                      (GOOD-OS (TM-SET-SP SP OS)))
             ((ENABLE ACCESS-TM-SET-SP TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET GOOD-TM-TM-SET-SP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-SP)

(PROVE-LEMMA GOOD-OS-TM-SET-CC
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP CC '4))
                      (GOOD-OS (TM-SET-CC CC OS)))
             ((ENABLE ACCESS-TM-SET-CC TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET GOOD-TM-TM-SET-CC)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-CC)

(PROVE-LEMMA GOOD-OS-TM-SET-SVCFLAG
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP SVCFLAG '2))
                      (GOOD-OS (TM-SET-SVCFLAG SVCFLAG OS)))
             ((ENABLE ACCESS-TM-SET-SVCFLAG TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-SVCFLAG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-SVCFLAG)

(PROVE-LEMMA GOOD-OS-TM-SET-SVCID
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP SVCID '128))
                      (GOOD-OS (TM-SET-SVCID SVCID OS)))
             ((ENABLE ACCESS-TM-SET-SVCID TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-SVCID)

(PROVE-LEMMA GOOD-OS-TM-STORE-IN-REGMEM
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (FINITE-NUMBERP VALUE '65536))
                      (GOOD-OS (TM-STORE-IN-REGMEM VALUE ADDR OS)))
             ((ENABLE ACCESS-TM-SET-REGS TM-STORE-IN-REGMEM PLISTP-PUTNTH
                      LENGTH-PUTNTH FINITE-NUMBER-LISTP-PUTNTH TM-WAITING
                      TM-IN-SUPERVISOR-MODE GOOD-OS OS-CODE OS-CURRENT-TASKID
                      OS-SEGMENT-TABLE OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ
                      OS-IBUFFERS OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-REGS)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-STORE-IN-REGMEM)

(PROVE-LEMMA NOT-EQUAL-PLUS-BASE-LIMIT-0
             NIL
             (IMPLIES (AND (GOOD-TM TM)
                           (AND (NOT (TM-IN-SUPERVISOR-MODE TM))
                                (AND (TM-GOOD-ADDRESS ADDR TM)
                                     (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                                          (NOT (EQUAL (REAL-ADDR-SOURCE ADDR)
                                                      '1))))))
                      (NOT (EQUAL (PLUS (TM-BASE TM) (TM-LIMIT TM))
                                  '0)))
             ((ENABLE TM-GOOD-ADDRESS FINITE-NUMBERP MIN)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA
 EQUALITY-OF-GETSEG-BACKCHAIN-COROLLARY
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-TM OS)
   (AND
    (NOT (TM-IN-SUPERVISOR-MODE OS))
    (AND
     (NESTED-INTERVALS '0 '3311 I J)
     (AND
      (DISJOINT-EVERYWHERE '0
                           '3311
                           (TABLE '2 (OS-SEGMENT-TABLE OS)))
      (AND (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                  (LENGTH (TABLE '2 (OS-SEGMENT-TABLE OS))))
           (AND (EQUAL (TM-BASE OS)
                       (BASE (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                     (TABLE '2 (OS-SEGMENT-TABLE OS)))))
                (AND (EQUAL (TM-LIMIT OS)
                            (LIMIT (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-SEGMENT-TABLE OS)))))
                     (AND (TM-GOOD-ADDRESS ADDR OS)
                          (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                               (NOT (EQUAL (REAL-ADDR-SOURCE ADDR)
                                           '1)))))))))))
  (EQUAL (GETSEG I J
                 (PUTNTH VALUE
                         (PLUS (TM-BASE OS)
                               (REAL-ADDR-NUM ADDR))
                         (TM-MEMORY OS)))
         (GETSEG I J (TM-MEMORY OS))))
 ((ENABLE GETSEG-BEFORE-PUTNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE DISJOINT)
  (USE (EQUALITY-OF-GETSEG-BACKCHAIN (I I)
                                     (J J)
                                     (N '0)
                                     (K '3311)
                                     (L1 (PUTNTH VALUE
                                                 (PLUS (TM-BASE OS)
                                                       (REAL-ADDR-NUM ADDR))
                                                 (TM-MEMORY OS)))
                                     (L2 (TM-MEMORY OS)))
       (DISJOINT-GETNTH (I (ARRAY-QFIRST (OS-READYQ OS)))
                        (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS)))
                        (B '0)
                        (L '3311))
       (NOT-EQUAL-PLUS-BASE-LIMIT-0 (ADDR ADDR)
                                    (TM OS)))
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE EQUALITY-OF-GETSEG-BACKCHAIN-COROLLARY)

(PROVE-LEMMA
 EQUALITY-OF-GETNTH-BACKCHAIN-COROLLARY
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-TM OS)
   (AND
    (NOT (TM-IN-SUPERVISOR-MODE OS))
    (AND
     (IF (LESSP I '0)
         '*1*FALSE
         '*1*TRUE)
     (AND
      (LESSP (DIFFERENCE I '0) '3311)
      (AND
       (DISJOINT-EVERYWHERE '0
                            '3311
                            (TABLE '2 (OS-SEGMENT-TABLE OS)))
       (AND
           (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                  (LENGTH (TABLE '2 (OS-SEGMENT-TABLE OS))))
           (AND (EQUAL (TM-BASE OS)
                       (BASE (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                     (TABLE '2 (OS-SEGMENT-TABLE OS)))))
                (AND (EQUAL (TM-LIMIT OS)
                            (LIMIT (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-SEGMENT-TABLE OS)))))
                     (AND (TM-GOOD-ADDRESS ADDR OS)
                          (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                               (NOT (EQUAL (REAL-ADDR-SOURCE ADDR)
                                           '1))))))))))))
  (EQUAL (GETNTH I
                 (PUTNTH VALUE
                         (PLUS (TM-BASE OS)
                               (REAL-ADDR-NUM ADDR))
                         (TM-MEMORY OS)))
         (GETNTH I (TM-MEMORY OS))))
 ((ENABLE GETSEG-BEFORE-PUTNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE DISJOINT)
  (USE
    (EQUALITY-OF-GETNTH-BACKCHAIN-PROOF (I I)
                                        (N '0)
                                        (K '3311)
                                        (L1 (PUTNTH VALUE
                                                    (PLUS (TM-BASE OS)
                                                          (REAL-ADDR-NUM ADDR))
                                                    (TM-MEMORY OS)))
                                        (L2 (TM-MEMORY OS)))
    (DISJOINT-GETNTH (I (ARRAY-QFIRST (OS-READYQ OS)))
                     (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS)))
                     (B '0)
                     (L '3311))
    (NOT-EQUAL-PLUS-BASE-LIMIT-0 (ADDR ADDR)
                                 (TM OS)))
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE EQUALITY-OF-GETNTH-BACKCHAIN-COROLLARY)

(PROVE-LEMMA
         GOOD-OS-TM-STORE-IN-MEMORY
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (NOT (TM-WAITING OS))
                            (AND (NOT (ZEROP (REAL-ADDR-SOURCE ADDR)))
                                 (AND (NOT (EQUAL (REAL-ADDR-SOURCE ADDR) '1))
                                      (AND (TM-GOOD-ADDRESS ADDR OS)
                                           (FINITE-NUMBERP VALUE '65536))))))
                  (GOOD-OS (TM-STORE-IN-MEMORY VALUE
                                               (REAL-ADDR-NUM ADDR)
                                               OS)))
         ((ENABLE ACCESS-TM-SET-MEMORY EQUALITY-OF-GETSEG-BACKCHAIN-COROLLARY
                  EQUALITY-OF-GETNTH-BACKCHAIN-COROLLARY TM-STORE-IN-MEMORY
                  TM-GOOD-ADDRESS PLISTP-PUTNTH LENGTH-PUTNTH LENGTH-GETSEG
                  LENGTH-TABLE FINITE-NUMBER-LISTP-PUTNTH TM-WAITING
                  TM-IN-SUPERVISOR-MODE GOOD-OS OS-CODE OS-CURRENT-TASKID
                  OS-SEGMENT-TABLE OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ
                  OS-IBUFFERS OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                  GOOD-TM-TM-SET-MEMORY LENGTH AK-TASKIDLUB NESTED-INTERVALS)
          (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-TM-PROPERTIES
                         GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-STORE-IN-MEMORY)

(PROVE-LEMMA GOOD-OS-TM-STORE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-GOOD-ADDRESS ADDR OS)
                                     (FINITE-NUMBERP VALUE '65536))))
                      (GOOD-OS (TM-STORE VALUE ADDR OS)))
             ((ENABLE GOOD-OS-TM-STORE-IN-REGMEM GOOD-OS-TM-STORE-IN-MEMORY
                      TM-STORE TM-GOOD-ADDRESS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-STORE)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-ADD
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR1 OS)))
                      (GOOD-OS (TM-EXECUTE-ADD ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-ADD GOOD-OS-TM-STORE GOOD-OS-TM-SET-CC
                      ACCESS-TM-SET-CC OS-READYQ TM-WAITING
                      TM-GOOD-ADDRESS-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-PLUS)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-ADD)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-BRANCH
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-GOOD-ADDRESS ADDR OS))
                      (GOOD-OS (TM-EXECUTE-BRANCH ADDR OS)))
             ((ENABLE TM-EXECUTE-BRANCH GOOD-OS-TM-SET-PC
                      FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-BRANCH)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-BRANCH-ON-ZERO
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-GOOD-ADDRESS ADDR OS))
                      (GOOD-OS (TM-EXECUTE-BRANCH-ON-ZERO ADDR OS)))
             ((ENABLE TM-EXECUTE-BRANCH-ON-ZERO GOOD-OS-TM-SET-PC
                      FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-BRANCH-ON-ZERO)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-BRANCH-NOT-ZERO
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-GOOD-ADDRESS ADDR OS))
                      (GOOD-OS (TM-EXECUTE-BRANCH-NOT-ZERO ADDR OS)))
             ((ENABLE TM-EXECUTE-BRANCH-NOT-ZERO GOOD-OS-TM-SET-PC
                      FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-BRANCH-NOT-ZERO)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-CALL
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR OS)))
                      (GOOD-OS (TM-EXECUTE-CALL ADDR OS)))
             ((ENABLE TM-EXECUTE-CALL FINITE-NUMBERP TM-WAITING OS-READYQ
                      ACCESS-TM-SET-PC ACCESS-TM-SET-SP
                      TM-GOOD-ADDRESS-TM-SET-PC TM-GOOD-ADDRESS-TM-SET-SP
                      FINITE-NUMBERP-TM-FETCH FINITE-NUMBERP-TM-DECR
                      GOOD-OS-TM-STORE GOOD-OS-TM-SET-PC GOOD-OS-TM-SET-SP
                      GOOD-OS-TM-SET-ERROR)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-CALL)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-COMPARE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-GOOD-ADDRESS ADDR1 OS))
                      (GOOD-OS (TM-EXECUTE-COMPARE ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-COMPARE GOOD-OS-TM-SET-CC
                      FINITE-NUMBERP-TM-CC-VALUE)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-COMPARE)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-DECR
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR OS)))
                      (GOOD-OS (TM-EXECUTE-DECR ADDR OS)))
             ((ENABLE TM-EXECUTE-DECR TM-WAITING OS-READYQ ACCESS-TM-SET-CC
                      TM-GOOD-ADDRESS-TM-SET-CC GOOD-OS-TM-STORE
                      GOOD-OS-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-DECR)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-DECR-MOD
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR1 OS)))
                      (GOOD-OS (TM-EXECUTE-DECR-MOD ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-DECR-MOD TM-WAITING OS-READYQ
                      ACCESS-TM-SET-CC TM-GOOD-ADDRESS-TM-SET-CC
                      GOOD-OS-TM-STORE GOOD-OS-TM-SET-CC
                      FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-DECR-MOD)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-DECR-MOD)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-INCR
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR OS)))
                      (GOOD-OS (TM-EXECUTE-INCR ADDR OS)))
             ((ENABLE TM-EXECUTE-INCR TM-WAITING OS-READYQ ACCESS-TM-SET-CC
                      TM-GOOD-ADDRESS-TM-SET-CC GOOD-OS-TM-STORE
                      GOOD-OS-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-INCR)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-INCR-MOD
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR1 OS)))
                      (GOOD-OS (TM-EXECUTE-INCR-MOD ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-INCR-MOD TM-WAITING OS-READYQ
                      ACCESS-TM-SET-CC TM-GOOD-ADDRESS-TM-SET-CC
                      GOOD-OS-TM-STORE GOOD-OS-TM-SET-CC
                      FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-INCR-MOD)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-INCR-MOD)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-LOAD-BASE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-LOAD-BASE ADDR OS)))
             ((ENABLE TM-EXECUTE-LOAD-BASE FINITE-NUMBERP GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-LOAD-BASE)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-LOAD-LIMIT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-LOAD-LIMIT ADDR OS)))
             ((ENABLE TM-EXECUTE-LOAD-LIMIT FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-LOAD-LIMIT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-LOAD-PSW
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-LOAD-PSW ADDR OS)))
             ((ENABLE TM-EXECUTE-LOAD-PSW FINITE-NUMBERP GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-LOAD-PSW)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-MOD
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR1 OS)))
                      (GOOD-OS (TM-EXECUTE-MOD ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-MOD GOOD-OS-TM-STORE GOOD-OS-TM-SET-CC
                      ACCESS-TM-SET-CC TM-WAITING OS-READYQ
                      TM-GOOD-ADDRESS-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MOD)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-MOD)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-MOVE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-GOOD-ADDRESS ADDR1 OS)
                                     (TM-GOOD-ADDRESS ADDR2 OS))))
                      (GOOD-OS (TM-EXECUTE-MOVE ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-MOVE GOOD-OS-TM-STORE FINITE-NUMBERP-TM-FETCH)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-MOVE)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-MULTIPLY
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (TM-GOOD-ADDRESS ADDR1 OS)))
                      (GOOD-OS (TM-EXECUTE-MULTIPLY ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-MULTIPLY GOOD-OS-TM-STORE GOOD-OS-TM-SET-CC
                      ACCESS-TM-SET-CC TM-WAITING OS-READYQ
                      TM-GOOD-ADDRESS-TM-SET-CC FINITE-NUMBERP-TM-CC-VALUE
                      FINITE-NUMBERP-ALU-VALUE-TM-ALU-MULT)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-MULTIPLY)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-RETURN
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-RETURN OS)))
             ((ENABLE TM-EXECUTE-RETURN FINITE-NUMBERP GOOD-OS-TM-SET-ERROR
                      GOOD-OS-TM-SET-PC GOOD-OS-TM-SET-SP
                      FINITE-NUMBERP-ADD1-TM-SP TM-INCR-SP-IS-ADD1-SP
                      FINITE-NUMBERP-TM-FETCH
                      TM-STACK-UNDERFLOWP-GUARDS-GOOD-ADDRESS)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-RETURN)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-POST-OUTPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-POST-OUTPUT-INTERRUPT ADDR OS)))
             ((ENABLE TM-EXECUTE-POST-OUTPUT-INTERRUPT FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-POST-OUTPUT-INTERRUPT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-RUN
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-RUN OS)))
             ((ENABLE TM-EXECUTE-RUN FINITE-NUMBERP GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-RUN)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-SET-CLOCK
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-SET-CLOCK ADDR OS)))
             ((ENABLE TM-EXECUTE-SET-CLOCK FINITE-NUMBERP GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-SET-CLOCK)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-START-OUTPUT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-START-OUTPUT ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-START-OUTPUT FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-START-OUTPUT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-SVC
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-GOOD-ADDRESS ADDR OS))
                      (GOOD-OS (TM-EXECUTE-SVC ADDR OS)))
             ((ENABLE TM-EXECUTE-SVC FINITE-NUMBERP FINITE-NUMBERP-REMAINDER
                      FINITE-NUMBERP-TM-FETCH GOOD-OS-TM-SET-SVCID
                      GOOD-OS-TM-SET-SVCFLAG)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-SVC)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-SVC-RETURN
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-SVC-RETURN ADDR OS)))
             ((ENABLE TM-EXECUTE-SVC-RETURN FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-SVC-RETURN)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-TEST-IPORT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-TEST-IPORT ADDR OS)))
             ((ENABLE TM-EXECUTE-TEST-IPORT FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-TEST-IPORT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-TEST-OPORT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-EXECUTE-TEST-OPORT ADDR OS)))
             ((ENABLE TM-EXECUTE-TEST-OPORT FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-TEST-OPORT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-WAIT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-WAIT OS)))
             ((ENABLE TM-EXECUTE-WAIT FINITE-NUMBERP GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-WAIT)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-NULLARY
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-NULLARY OPCODE OS)))
             ((ENABLE TM-EXECUTE-NULLARY FINITE-NUMBERP GOOD-OS-TM-EXECUTE-RUN
                      GOOD-OS-TM-EXECUTE-WAIT GOOD-OS-TM-EXECUTE-RETURN
                      GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-NULLARY)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-UNARY
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-UNARY OPCODE ADDR OS)))
             ((ENABLE TM-EXECUTE-UNARY FINITE-NUMBERP
                      GOOD-OS-TM-EXECUTE-BRANCH
                      GOOD-OS-TM-EXECUTE-BRANCH-ON-ZERO
                      GOOD-OS-TM-EXECUTE-BRANCH-NOT-ZERO
                      GOOD-OS-TM-EXECUTE-CALL GOOD-OS-TM-EXECUTE-DECR
                      GOOD-OS-TM-EXECUTE-INCR GOOD-OS-TM-EXECUTE-LOAD-BASE
                      GOOD-OS-TM-EXECUTE-LOAD-LIMIT
                      GOOD-OS-TM-EXECUTE-LOAD-PSW
                      GOOD-OS-TM-EXECUTE-POST-OUTPUT-INTERRUPT
                      GOOD-OS-TM-EXECUTE-SET-CLOCK
                      GOOD-OS-TM-EXECUTE-TEST-IPORT
                      GOOD-OS-TM-EXECUTE-TEST-OPORT GOOD-OS-TM-EXECUTE-SVC
                      GOOD-OS-TM-EXECUTE-SVC-RETURN GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-UNARY)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-BINARY
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-BINARY OPCODE ADDR1 ADDR2 OS)))
             ((ENABLE TM-EXECUTE-BINARY FINITE-NUMBERP
                      GOOD-OS-TM-EXECUTE-START-OUTPUT
                      GOOD-OS-TM-EXECUTE-MULTIPLY GOOD-OS-TM-EXECUTE-MOVE
                      GOOD-OS-TM-EXECUTE-MOD GOOD-OS-TM-EXECUTE-DECR-MOD
                      GOOD-OS-TM-EXECUTE-INCR-MOD GOOD-OS-TM-EXECUTE-COMPARE
                      GOOD-OS-TM-EXECUTE-ADD GOOD-OS-TM-SET-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-BINARY)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE-INSTRUCTION
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE-INSTRUCTION INSTRUCTION OS)))
             ((ENABLE TM-EXECUTE-INSTRUCTION FINITE-NUMBERP
                      GOOD-OS-TM-SET-ERROR GOOD-OS-TM-EXECUTE-NULLARY
                      GOOD-OS-TM-EXECUTE-UNARY GOOD-OS-TM-EXECUTE-BINARY)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE-INSTRUCTION)

(PROVE-LEMMA GOOD-OS-TM-EXECUTE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-EXECUTE INSTRUCTION OS)))
             ((ENABLE TM-EXECUTE FINITE-NUMBERP TM-WAITING OS-READYQ
                      ACCESS-TM-SET-PC FINITE-NUMBERP-TM-INCRN
                      GOOD-OS-TM-EXECUTE-INSTRUCTION GOOD-OS-TM-SET-PC
                      GOOD-OS-TM-SET-ERROR ACCESS-TM-SET-PC
                      ACCESS-TM-SET-ERROR)
              (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-EXECUTE)

(PROVE-LEMMA GOOD-OS-TM-DECREMENT-CLOCK
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-DECREMENT-CLOCK OS)))
             ((ENABLE TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK TM-WAITING
                      TM-IN-SUPERVISOR-MODE GOOD-OS OS-CODE OS-CURRENT-TASKID
                      OS-SEGMENT-TABLE OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ
                      OS-IBUFFERS OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-DECREMENT-CLOCK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-DECREMENT-CLOCK)

(PROVE-LEMMA GOOD-OS-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (TM-FETCH-EXECUTE OS)))
             ((ENABLE TM-FETCH-EXECUTE FINITE-NUMBERP TM-WAITING
                      TM-DECREMENT-CLOCK-PRESERVES-ALL-BUT-CLOCK
                      GOOD-OS-TM-SET-ERROR GOOD-OS-TM-EXECUTE
                      GOOD-OS-TM-DECREMENT-CLOCK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-FETCH-EXECUTE)

(PROVE-LEMMA GOOD-OS-TM-SET-IPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (PLISTP IPORTS)
                                (AND (EQUAL (LENGTH IPORTS) '16)
                                     (GOOD-TM-IPORT-ARRAY IPORTS))))
                      (GOOD-OS (TM-SET-IPORTS IPORTS OS)))
             ((ENABLE ACCESS-TM-SET-IPORTS TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-IPORTS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-IPORTS)

(PROVE-LEMMA GOOD-OS-TM-SET-OPORTS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (PLISTP OPORTS)
                                (AND (EQUAL (LENGTH OPORTS) '16)
                                     (GOOD-TM-OPORT-ARRAY OPORTS))))
                      (GOOD-OS (TM-SET-OPORTS OPORTS OS)))
             ((ENABLE ACCESS-TM-SET-OPORTS TM-WAITING TM-IN-SUPERVISOR-MODE
                      GOOD-OS OS-CODE OS-CURRENT-TASKID OS-SEGMENT-TABLE
                      OS-TASK-TABLE OS-STATUS-TABLE OS-READYQ OS-IBUFFERS
                      OS-OBUFFERS OS-MBUFFERS OS-READY-SET
                      GOOD-TM-TM-SET-OPORTS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-SET-OPORTS)

(PROVE-LEMMA GOOD-OS-TM-POST-INTERRUPT
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TM-POST-INTERRUPT INTERRUPT OS)))
             ((ENABLE TM-POST-INTERRUPT LENGTH PLISTP FINITE-NUMBERP
                      TM-POST-INPUT-INTERRUPT TM-POST-OUTPUT-INTERRUPT
                      LESSP-REMAINDER2 LENGTH-PUTNTH PLISTP-PUTNTH
                      GOOD-TM-IPORT GOOD-TM-OPORT GOOD-TM-IPORT-ARRAY-PUTNTH
                      GOOD-TM-OPORT-ARRAY-PUTNTH GOOD-OS-TM-SET-IPORTS
                      GOOD-OS-TM-SET-OPORTS FINITE-NUMBERP-REMAINDER)
              (USE (GOOD-TM-IPORT-GETNTH (I (REMAINDER (TM-IDEVID INTERRUPT)
                                                       '16))
                                         (L (TM-IPORTS OS))))
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TM-POST-INTERRUPT)

(DEFN DISJOINT-SEGMENTS-INDUCTION
      (I J L)
      (IF (ZEROP I)
          '0
          (IF (LISTP L)
              (DISJOINT-SEGMENTS-INDUCTION (SUB1 I)
                                           (SUB1 J)
                                           (CDR L))
              '0))
      NIL)

(PROVE-LEMMA MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT-CASE1
             (REWRITE)
             (IMPLIES (AND (MUTUALLY-DISJOINT L)
                           (AND (LESSP I (LENGTH L))
                                (AND (LESSP J (LENGTH L))
                                     (LESSP (FIX I) (FIX J)))))
                      (DISJOINT (BASE (GETNTH I L))
                                (LIMIT (GETNTH I L))
                                (BASE (GETNTH J L))
                                (LIMIT (GETNTH J L))))
             ((ENABLE MUTUALLY-DISJOINT LENGTH GETNTH DISJOINT-GETNTH)
              (INDUCT (DISJOINT-SEGMENTS-INDUCTION I J L))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT-CASE1)

(PROVE-LEMMA MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT
             (REWRITE)
             (IMPLIES (AND (MUTUALLY-DISJOINT L)
                           (AND (LESSP I (LENGTH L))
                                (AND (LESSP J (LENGTH L))
                                     (NOT (EQUAL (FIX I) (FIX J))))))
                      (DISJOINT (BASE (GETNTH I L))
                                (LIMIT (GETNTH I L))
                                (BASE (GETNTH J L))
                                (LIMIT (GETNTH J L))))
             ((USE (INTEGER-INEQUALITY-CASESPLIT (I (FIX I))
                                                 (J (FIX J)))
                   (MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT-CASE1 (I I)
                                                                  (J J)
                                                                  (L L))
                   (MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT-CASE1 (I J)
                                                                  (J I)
                                                                  (L L))
                   (SYMMETRY-OF-DISJOINT (B1 (BASE (GETNTH I L)))
                                         (L1 (LIMIT (GETNTH I L)))
                                         (B2 (BASE (GETNTH J L)))
                                         (L2 (LIMIT (GETNTH J L)))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT)

(PROVE-LEMMA NUMBERP-OS-CURRENT-TASKID
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (AND (NUMBERP (OS-CURRENT-TASKID OS))
                           (LESSP (OS-CURRENT-TASKID OS) '16)))
             ((ENABLE OS-CURRENT-TASKID)
              (ENABLE-THEORY GOOD-OS-PROPERTIES
                             FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NUMBERP-OS-CURRENT-TASKID)

(PROVE-LEMMA
 TM-FETCH-EXECUTE-MAPUP-ADDRESS-SPACE-SEPARATION
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (AND (LESSP TASKID '16)
                      (NOT (EQUAL TASKID
                                  (OS-CURRENT-TASKID OS)))))))
  (EQUAL
     (MAPUP-ADDRESS-SPACE (TM-MEMORY (TM-FETCH-EXECUTE OS))
                          REGS CC ERROR SVCFLAG SVCID
                          (BASE (GETNTH TASKID
                                        (TABLE '2 (OS-SEGMENT-TABLE OS))))
                          (LIMIT (GETNTH TASKID
                                         (TABLE '2 (OS-SEGMENT-TABLE OS)))))
     (MAPUP-ADDRESS-SPACE (TM-MEMORY OS)
                          REGS CC ERROR SVCFLAG SVCID
                          (BASE (GETNTH TASKID
                                        (TABLE '2 (OS-SEGMENT-TABLE OS))))
                          (LIMIT (GETNTH TASKID
                                         (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (ENABLE MAPUP-ADDRESS-SPACE TM-FETCH-EXECUTE-PROTECTION-THEOREM
          MUTUALLY-DISJOINT-SEGMENTS-ARE-DISJOINT NUMBERP-OS-CURRENT-TASKID
          LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE)
  (DISABLE-THEORY T)))

(DISABLE TM-FETCH-EXECUTE-MAPUP-ADDRESS-SPACE-SEPARATION)

(PROVE-LEMMA GETNTH-TM-REGLENGTH-TM-CPU
             (REWRITE)
             (EQUAL (GETNTH '8 (TM-CPU TM))
                    (TM-PACK-PSW (TM-CC TM)
                                 (TM-ERROR TM)
                                 (TM-SVCFLAG TM)
                                 (TM-SVCID TM)))
             ((ENABLE TM-CPU OPEN-UP-GETNTH OPEN-UP-GETNTH-ON-ZERO)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-TM-REGLENGTH-TM-CPU)

(PROVE-LEMMA
     OS-IBUFFERS-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-IBUFFERS (TM-FETCH-EXECUTE OS))
                     (OS-IBUFFERS OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM NESTED-INTERVALS OS-IBUFFERS
              DISJOINT-GETNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE
              NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '243)
                                         (J '128)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-OBUFFERS-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-OBUFFERS (TM-FETCH-EXECUTE OS))
                     (OS-OBUFFERS OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM NESTED-INTERVALS OS-OBUFFERS
              DISJOINT-GETNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE
              NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '371)
                                         (J '128)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-MBUFFERS-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-MBUFFERS (TM-FETCH-EXECUTE OS))
                     (OS-MBUFFERS OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM NESTED-INTERVALS OS-MBUFFERS
              DISJOINT-GETNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE
              NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '499)
                                         (J '2048)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-READYQ-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-READYQ (TM-FETCH-EXECUTE OS))
                     (OS-READYQ OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM OS-READYQ NESTED-INTERVALS
              DISJOINT-GETNTH LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE
              NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '191)
                                         (J '20)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-READYQ-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-STATUS-TABLE-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-STATUS-TABLE (TM-FETCH-EXECUTE OS))
                     (OS-STATUS-TABLE OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM OS-STATUS-TABLE
              DISJOINT-GETNTH NESTED-INTERVALS LENGTH-TABLE
              LENGTH-OS-SEGMENT-TABLE NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '211)
                                         (J '32)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-TASK-TABLE-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-TASK-TABLE (TM-FETCH-EXECUTE OS))
                     (OS-TASK-TABLE OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM OS-TASK-TABLE
              NESTED-INTERVALS DISJOINT-GETNTH LENGTH-TABLE
              LENGTH-OS-SEGMENT-TABLE NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '15)
                                         (J '144)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS))))
      (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-TM-FETCH-EXECUTE)

(PROVE-LEMMA
     OS-SEGMENT-TABLE-TM-FETCH-EXECUTE
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (OS-SEGMENT-TABLE (TM-FETCH-EXECUTE OS))
                     (OS-SEGMENT-TABLE OS)))
     ((ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
      (ENABLE TM-FETCH-EXECUTE-PROTECTION-THEOREM OS-SEGMENT-TABLE
              DISJOINT-GETNTH NESTED-INTERVALS LENGTH-TABLE LENGTH-GETSEG
              NUMBERP-OS-CURRENT-TASKID)
      (USE (EQUALITY-OF-GETSEG-BACKCHAIN (N '0)
                                         (K '3311)
                                         (I '159)
                                         (J '32)
                                         (L1 (TM-MEMORY (TM-FETCH-EXECUTE OS)))
                                         (L2 (TM-MEMORY OS)))
           (DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE (OS OS)))
      (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-TM-FETCH-EXECUTE)

(PROVE-LEMMA OS-CURRENT-TASKID-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (OS-CURRENT-TASKID (TM-FETCH-EXECUTE OS))
                             (OS-CURRENT-TASKID OS)))
             ((ENABLE OS-READYQ-TM-FETCH-EXECUTE OS-CURRENT-TASKID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CURRENT-TASKID-TM-FETCH-EXECUTE)

(PROVE-LEMMA TM-WAITING-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TM-WAITING (TM-FETCH-EXECUTE OS))
                             (TM-WAITING OS)))
             ((ENABLE OS-READYQ-TM-FETCH-EXECUTE
                      REGISTERS-UNTOUCHED-BY-TM-FETCH-EXECUTE TM-WAITING)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-TM-FETCH-EXECUTE)

(DEFTHEORY GOOD-OS-PROPERTIES-CROCK
           (FINITE-NUMBERP-OS-TASKID TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
                                     PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET
                                     FINITE-NUMBER-QUEUE-TABLEP-OS-MBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS
                                     FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE
                                     DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE
                                     MUTUALLY-DISJOINT-OS-SEGMENT-TABLE
                                     FINITE-NUMBER-QUEUEP-OS-READYQ
                                     GOOD-STATUS-LIST-OS-STATUS-TABLE
                                     GOOD-CPU-LIST-OS-TASK-TABLE
                                     OS-NOT-IN-SUPERVISOR-MODE OS-TIME-SLICE
                                     OS-OUTPUT-NEW-PC OS-INPUT-NEW-PC
                                     OS-SVC-NEW-PC OS-ERROR-NEW-PC
                                     OS-CLOCK-NEW-PC OS-CODE-OS TM-SLIMIT-OS
                                     GOOD-TM-OS))

(PROVE-LEMMA TIMES-COMMUTATIVITY-ASSOCIATIVITY-CROCK
             (REWRITE)
             (EQUAL (TIMES A (TIMES C B))
                    (TIMES (TIMES A B) C))
             ((ENABLE COMMUTATIVITY-OF-TIMES ASSOCIATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMES-COMMUTATIVITY-ASSOCIATIVITY-CROCK)

(PROVE-LEMMA
 TM-UNPACK-CC-TM-PACK-PSW
 (REWRITE)
 (IMPLIES (FINITE-NUMBERP CC '4)
          (EQUAL (TM-UNPACK-CC (TM-PACK-PSW CC ERROR SVCFLAG SVCID))
                 CC))
 ((ENABLE FINITE-NUMBERP TM-UNPACK-CC TM-PACK-PSW
          TIMES-COMMUTATIVITY-ASSOCIATIVITY-CROCK COMMUTATIVITY-OF-TIMES
          REMAINDER-NOOP REMAINDER-PLUS-TIMES-2)
  (USE
   (DISTRIBUTIVITY-OF-TIMES-OVER-PLUS-BACKWARDS (A '4)
                                                (B (TIMES SVCFLAG '64))
                                                (C (TIMES SVCID '128)))
   (DISTRIBUTIVITY-OF-TIMES-OVER-PLUS-BACKWARDS
                                               (A '4)
                                               (B ERROR)
                                               (C (PLUS (TIMES '64 SVCFLAG)
                                                        (TIMES '128 SVCID)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-UNPACK-CC-TM-PACK-PSW)

(PROVE-LEMMA REMAINDER-PLUS-PLUS-TIMES
             (REWRITE)
             (EQUAL (REMAINDER (PLUS A (PLUS B (TIMES J I)))
                               J)
                    (REMAINDER (PLUS A B) J))
             ((ENABLE ASSOCIATIVITY-OF-PLUS)
              (USE (REMAINDER-PLUS-TIMES-2 (X (PLUS A B))
                                           (I I)
                                           (J J)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS-PLUS-TIMES)

(PROVE-LEMMA
     TM-UNPACK-ERROR-TM-PACK-PSW
     (REWRITE)
     (IMPLIES (AND (FINITE-NUMBERP CC '4)
                   (FINITE-NUMBERP ERROR '64))
              (EQUAL (TM-UNPACK-ERROR (TM-PACK-PSW CC ERROR SVCFLAG SVCID))
                     ERROR))
     ((ENABLE FINITE-NUMBERP TM-UNPACK-ERROR TM-PACK-PSW
              TIMES-COMMUTATIVITY-ASSOCIATIVITY-CROCK COMMUTATIVITY-OF-TIMES
              QUOTIENT-PLUS-TIMES REMAINDER-NOOP)
      (USE (DISTRIBUTIVITY-OF-TIMES-OVER-PLUS-BACKWARDS (A '256)
                                                        (B (TIMES SVCFLAG '1))
                                                        (C (TIMES SVCID '2)))
           (REMAINDER-PLUS-PLUS-TIMES (A CC)
                                      (B (TIMES '4 ERROR))
                                      (J '256)
                                      (I (PLUS (TIMES '1 SVCFLAG)
                                               (TIMES '2 SVCID)))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE TM-UNPACK-ERROR-TM-PACK-PSW)

(PROVE-LEMMA REMAINDER-PLUS-PLUS-PLUS-TIMES
             (REWRITE)
             (EQUAL (REMAINDER (PLUS A (PLUS B (PLUS C (TIMES I J))))
                               J)
                    (REMAINDER (PLUS A (PLUS B C)) J))
             ((ENABLE ASSOCIATIVITY-OF-PLUS)
              (USE (REMAINDER-PLUS-TIMES-1 (X (PLUS A (PLUS B C)))
                                           (I I)
                                           (J J)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-PLUS-PLUS-PLUS-TIMES)

(PROVE-LEMMA QUOTIENT-PLUS-PLUS-TIMES
             (REWRITE)
             (IMPLIES (LESSP (PLUS C D) B)
                      (EQUAL (QUOTIENT (PLUS C (PLUS D (TIMES B A)))
                                       B)
                             (FIX A)))
             ((USE (QUOTIENT-PLUS-TIMES (A A)
                                        (B B)
                                        (C (PLUS C D))))
              (ENABLE ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-PLUS-PLUS-TIMES)

(PROVE-LEMMA
       TM-UNPACK-SVCFLAG-TM-PACK-PSW
       (REWRITE)
       (IMPLIES (AND (FINITE-NUMBERP CC '4)
                     (AND (FINITE-NUMBERP ERROR '64)
                          (FINITE-NUMBERP SVCFLAG '2)))
                (EQUAL (TM-UNPACK-SVCFLAG (TM-PACK-PSW CC ERROR SVCFLAG SVCID))
                       SVCFLAG))
       ((ENABLE FINITE-NUMBERP TM-UNPACK-SVCFLAG TM-PACK-PSW
                REMAINDER-PLUS-PLUS-PLUS-TIMES QUOTIENT-PLUS-PLUS-TIMES
                REMAINDER-NOOP COMMUTATIVITY-OF-TIMES)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE TM-UNPACK-SVCFLAG-TM-PACK-PSW)

(PROVE-LEMMA QUOTIENT-PLUS-PLUS-PLUS-TIMES
             (REWRITE)
             (IMPLIES (LESSP (PLUS C (PLUS D E)) B)
                      (EQUAL (QUOTIENT (PLUS C (PLUS D (PLUS E (TIMES B A))))
                                       B)
                             (FIX A)))
             ((USE (QUOTIENT-PLUS-TIMES (A A)
                                        (B B)
                                        (C (PLUS C (PLUS D E)))))
              (ENABLE ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE QUOTIENT-PLUS-PLUS-PLUS-TIMES)

(PROVE-LEMMA
         TM-UNPACK-SVCID-TM-PACK-PSW
         (REWRITE)
         (IMPLIES (AND (FINITE-NUMBERP CC '4)
                       (AND (FINITE-NUMBERP ERROR '64)
                            (AND (FINITE-NUMBERP SVCFLAG '2)
                                 (FINITE-NUMBERP SVCID '128))))
                  (EQUAL (TM-UNPACK-SVCID (TM-PACK-PSW CC ERROR SVCFLAG SVCID))
                         SVCID))
         ((ENABLE FINITE-NUMBERP TM-UNPACK-SVCID TM-PACK-PSW
                  QUOTIENT-PLUS-PLUS-PLUS-TIMES COMMUTATIVITY-OF-TIMES)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TM-UNPACK-SVCID-TM-PACK-PSW)

(PROVE-LEMMA
       MAPUP-CURRENT-TASK-TM-FETCH-EXECUTE
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (MAPUP-TASK (OS-CURRENT-TASKID OS)
                                   (TM-FETCH-EXECUTE OS))
                       (TM-FETCH-EXECUTE (MAPUP-TASK (OS-CURRENT-TASKID OS)
                                                     OS))))
       ((ENABLE MAPUP-TASK MAPUP-REGS MAPUP-CC MAPUP-ERROR MAPUP-SVCFLAG
                MAPUP-SVCID MAPUP-BASE MAPUP-LIMIT MAPUP-CPU
                TM-WAITING-TM-FETCH-EXECUTE GETNTH-TM-REGLENGTH-TM-CPU
                TM-UNPACK-SVCID-TM-PACK-PSW TM-UNPACK-SVCFLAG-TM-PACK-PSW
                TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-CC-TM-PACK-PSW
                NUMBERP-OS-CURRENT-TASKID GOOD-TM-TM-FETCH-EXECUTE
                CPU-REGS-SEGMENT LENGTH-TABLE LENGTH-OS-SEGMENT-TABLE
                OS-SEGMENT-TABLE-TM-FETCH-EXECUTE
                OS-CURRENT-TASKID-TM-FETCH-EXECUTE
                REGISTERS-UNTOUCHED-BY-TM-FETCH-EXECUTE)
        (USE (TM-FETCH-EXECUTE-COMMUTES-WITH-MAPUP-ADDRESS-SPACE (TM OS))
             (LEQ-PLUS-BASE-LIMIT-GETNTH (I (OS-CURRENT-TASKID OS))
                                         (MAX '65536)
                                         (L (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (TM-BASE-OS (OS OS))
             (TM-LIMIT-OS (OS OS)))
        (ENABLE-THEORY GOOD-OS-PROPERTIES-CROCK GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CURRENT-TASK-TM-FETCH-EXECUTE)

(PROVE-LEMMA
          MAPUP-TASK-SEPARATION
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (AND (NUMBERP TASKID)
                                  (AND (LESSP TASKID '16)
                                       (NOT (EQUAL TASKID
                                                   (OS-CURRENT-TASKID OS)))))))
                   (EQUAL (MAPUP-TASK TASKID
                                      (TM-FETCH-EXECUTE OS))
                          (MAPUP-TASK TASKID OS)))
          ((ENABLE MAPUP-TASK MAPUP-REGS MAPUP-CC MAPUP-ERROR MAPUP-SVCFLAG
                   MAPUP-SVCID MAPUP-BASE MAPUP-LIMIT MAPUP-CPU
                   TM-WAITING-TM-FETCH-EXECUTE
                   OS-CURRENT-TASKID-TM-FETCH-EXECUTE
                   OS-SEGMENT-TABLE-TM-FETCH-EXECUTE
                   OS-TASK-TABLE-TM-FETCH-EXECUTE
                   TM-FETCH-EXECUTE-MAPUP-ADDRESS-SPACE-SEPARATION)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-SEPARATION)

(PROVE-LEMMA
       MAPUP-TASK-TM-FETCH-EXECUTE-CASESPLIT
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NUMBERP TASKID)
                               (LESSP TASKID '16))))
                (EQUAL (MAPUP-TASK TASKID
                                   (TM-FETCH-EXECUTE OS))
                       (IF (EQUAL TASKID (OS-CURRENT-TASKID OS))
                           (TM-FETCH-EXECUTE (MAPUP-TASK (OS-CURRENT-TASKID OS)
                                                         OS))
                           (MAPUP-TASK TASKID OS))))
       ((ENABLE MAPUP-TASK-SEPARATION MAPUP-CURRENT-TASK-TM-FETCH-EXECUTE)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-TM-FETCH-EXECUTE-CASESPLIT)

(PROVE-LEMMA MAPUP-TASKS-TM-FETCH-EXECUTE-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (OS-CURRENT-TASKID OS)
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (TM-FETCH-EXECUTE OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-TM-FETCH-EXECUTE-CASESPLIT MAPUP-TASKS
                      AK-TASKIDLUB)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-TM-FETCH-EXECUTE-CASE1)

(PROVE-LEMMA GETNTH-MAPUP-TASKS
             NIL
             (IMPLIES (AND (LESSP I '16)
                           (AND (IF (LESSP I J) '*1*FALSE '*1*TRUE)
                                (AND (NUMBERP J) (NUMBERP I))))
                      (EQUAL (GETNTH (DIFFERENCE I J)
                                     (MAPUP-TASKS J OS))
                             (MAPUP-TASK I OS)))
             ((ENABLE GETNTH MAPUP-TASKS AK-TASKIDLUB DIFFERENCE-X-X
                      DIFFERENCE-EQUALS-0 DIFFERENCE-ADD1-ARG1
                      DIFFERENCE-SUB1-ARG1 DIFFERENCE-ADD1-ARG2)
              (EXPAND (MAPUP-TASKS 0 OS)
                      (MAPUP-TASKS I OS))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GETNTH-MAPUP-TASKS-COROLLARY2
             (REWRITE)
             (IMPLIES (AND (LESSP I '16) (NUMBERP I))
                      (EQUAL (GETNTH '0 (MAPUP-TASKS I OS))
                             (MAPUP-TASK I OS)))
             ((USE (GETNTH-MAPUP-TASKS (I I) (J I)))
              (ENABLE DIFFERENCE-X-X)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-MAPUP-TASKS-COROLLARY2)

(PROVE-LEMMA
 MAPUP-TASKS-TM-FETCH-EXECUTE-CASE2
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NUMBERP TASKID)
                   (IF (LESSP (OS-CURRENT-TASKID OS) TASKID)
                       '*1*FALSE
                       '*1*TRUE))))
    (EQUAL (MAPUP-TASKS TASKID
                        (TM-FETCH-EXECUTE OS))
           (PUTNTH (TM-FETCH-EXECUTE (GETNTH (DIFFERENCE (OS-CURRENT-TASKID OS)
                                                         TASKID)
                                             (MAPUP-TASKS TASKID OS)))
                   (DIFFERENCE (OS-CURRENT-TASKID OS)
                               TASKID)
                   (MAPUP-TASKS TASKID OS))))
 ((ENABLE MAPUP-TASKS MAPUP-TASK-TM-FETCH-EXECUTE-CASESPLIT LENGTH
          AK-TASKIDLUB MAPUP-TASKS-TM-FETCH-EXECUTE-CASE1 OPEN-UP-GETNTH1
          OPEN-UP-PUTNTH1 SUB1-DIFFERENCE OPEN-UP-GETNTH-ON-ZERO
          OPEN-UP-PUTNTH-ON-ZERO DIFFERENCE-X-X NUMBERP-OS-CURRENT-TASKID
          GETNTH-MAPUP-TASKS-COROLLARY2 PUTNTH-INTO-NIL)
  (EXPAND (MAPUP-TASKS 0 (TM-FETCH-EXECUTE OS))
          (MAPUP-TASKS (OS-CURRENT-TASKID OS)
                       (TM-FETCH-EXECUTE OS)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-TM-FETCH-EXECUTE-CASE2)

(PROVE-LEMMA DIFFERENCE-ZERO-ARG2
             (REWRITE)
             (EQUAL (DIFFERENCE N '0) (FIX N))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE DIFFERENCE-ZERO-ARG2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-TM-FETCH-EXECUTE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (MAPUP-OS-TASKS (TM-FETCH-EXECUTE OS))
        (PUTNTH (TM-FETCH-EXECUTE (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))
                (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS OS-CURRENT-TASKID CORRECTNESS-OF-ARRAY-QFIRST
          DIFFERENCE-ZERO-ARG2 MAPUP-TASKS-TM-FETCH-EXECUTE-CASE2
          GETNTH-WITH-NON-NUMBER-INDEX PUTNTH-WITH-NON-NUMBER-INDEX)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-TM-FETCH-EXECUTE)

(PROVE-LEMMA CORRECTNESS-OF-TM-FETCH-EXECUTE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-CLOCK-INTERRUPTP OS))))
                      (EQUAL (MAPUP-OS (TM-FETCH-EXECUTE OS))
                             (AK-PRIVATE-STEP (MAPUP-OS OS))))
             ((ENABLE MAPUP-OS AK-TASKID AK-PRIVATE-STEP AK-FETCH-EXECUTE
                      MAPUP-OS-TASKS-TM-FETCH-EXECUTE MAPUP-OS-IBUFFERS
                      MAPUP-OS-MBUFFERS MAPUP-OS-OBUFFERS
                      OS-MBUFFERS-TM-FETCH-EXECUTE
                      OS-OBUFFERS-TM-FETCH-EXECUTE
                      OS-IBUFFERS-TM-FETCH-EXECUTE OS-READYQ-TM-FETCH-EXECUTE
                      OS-STATUS-TABLE-TM-FETCH-EXECUTE
                      REGISTERS-UNTOUCHED-BY-TM-FETCH-EXECUTE
                      TM-CLOCK-TM-FETCH-EXECUTE)
              (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-TM-FETCH-EXECUTE)

(PROVE-LEMMA
          CONTRACT-ARRAY-ENQ
          (REWRITE)
          (IMPLIES (EQUAL MAXLENGTH (GETNTH '3 QUEUE))
                   (EQUAL (PUTNTH (INCR-MOD (GETNTH '1 QUEUE)
                                            MAXLENGTH)
                                  '1
                                  (PUTNTH (ADD1 (GETNTH '2 QUEUE))
                                          '2
                                          (PUTNTH ITEM
                                                  (PLUS '4 (GETNTH '1 QUEUE))
                                                  QUEUE)))
                          (ARRAY-ENQ ITEM QUEUE)))
          ((ENABLE ARRAY-ENQ)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE CONTRACT-ARRAY-ENQ)

(PROVE-LEMMA
 CONTRACT-ARRAY-ENQ-INSTANCE
 (REWRITE)
 (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
               (ARRAY-QEMPTYP QUEUE))
          (IMPLIES (EQUAL MAXLENGTH (GETNTH '3 QUEUE))
                   (EQUAL (PUTNTH (INCR-MOD (GETNTH '1 QUEUE)
                                            MAXLENGTH)
                                  '1
                                  (PUTNTH '1
                                          '2
                                          (PUTNTH ITEM
                                                  (PLUS '4 (GETNTH '1 QUEUE))
                                                  QUEUE)))
                          (ARRAY-ENQ ITEM QUEUE))))
 ((ENABLE-THEORY ARRAY-QUEUE-FACTS GROUND-ZERO)
  (USE (CONTRACT-ARRAY-ENQ (QUEUE QUEUE)
                           (ITEM ITEM)
                           (MAXLENGTH MAXLENGTH)))
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-ARRAY-ENQ-INSTANCE)

(PROVE-LEMMA CONTRACT-ARRAY-DEQ
             (REWRITE)
             (IMPLIES (EQUAL MAXLENGTH (GETNTH '3 QUEUE))
                      (EQUAL (PUTNTH (INCR-MOD (GETNTH '0 QUEUE)
                                               MAXLENGTH)
                                     '0
                                     (PUTNTH (SUB1 (GETNTH '2 QUEUE))
                                             '2
                                             QUEUE))
                             (ARRAY-DEQ QUEUE)))
             ((ENABLE ARRAY-DEQ)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-ARRAY-DEQ)

(PROVE-LEMMA CONTRACT-ARRAY-QFIRST
             (REWRITE)
             (EQUAL (GETNTH (PLUS '4 (GETNTH '0 QUEUE))
                            QUEUE)
                    (ARRAY-QFIRST QUEUE))
             ((ENABLE ARRAY-QFIRST)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-ARRAY-QFIRST)

(PROVE-LEMMA CONTRACT-ARRAY-QREPLACE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (AND (NOT (ARRAY-QEMPTYP QUEUE))
                                (EQUAL MAXLENGTH (GETNTH '3 QUEUE))))
                      (EQUAL (PUTNTH ITEM
                                     (PLUS '4
                                           (DECR-MOD (GETNTH '1 QUEUE)
                                                     MAXLENGTH))
                                     QUEUE)
                             (ARRAY-QREPLACE ITEM QUEUE)))
             ((ENABLE ARRAY-QREPLACE ARRAY-ENQ ARRAY-NONLAST ARRAY-QEMPTYP
                      ARRAY-QUEUEP LENGTH-PUTNTH INCR-MOD-DECR-MOD
                      PUTNTH-NON-INTERFERENCE-COROLLARY1
                      PUTNTH-NON-INTERFERENCE-COROLLARY2
                      PUTNTH-GETNTH-COINCIDENCE1 GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE COMMUTATIVITY-OF-PLUS)
              (DISABLE PLUS)
              (DO-NOT-INDUCT T)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-ARRAY-QREPLACE)

(DEFTHEORY CONTRACT-QUEUES
           (CONTRACT-ARRAY-QFIRST CONTRACT-ARRAY-ENQ-INSTANCE
                                  CONTRACT-ARRAY-QREPLACE CONTRACT-ARRAY-ENQ
                                  CONTRACT-ARRAY-DEQ))

(DEFN TICK
      (N)
      (FIXLENGTH N 'NIL 'TICK)
      NIL)

(PROVE-LEMMA TICK-PLUS NIL
             (EQUAL (TICK (PLUS A B))
                    (APPEND (TICK A) (TICK B)))
             ((ENABLE TICK APPEND-FIXLENGTH)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA GETNTH-OS-CODE
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (GETNTH N (OS-CODE OS))
                             (GETNTH N
                                     '(2187 13 2 2187 14 3 75 3 191 14 3280
                                            77 2 9 65 2 15 4299 2 0 12747 2
                                            0 4811 2 13 5067 2 14 3275 2 4
                                            3531 2 5 3787 2 6 4043 2 7 65 2
                                            8 20683 2 0 4171 2 13 4171 3 14
                                            0 2123 3 2 77 2 9 65 2 15 77 3
                                            2 65 3 159 218 3 478 3 2123 3 2
                                            65 3 8 6283 0 2 14731 0 2 6795
                                            0 3 63563 7 2 55371 6 2 47179 5
                                            2 38987 4 2 30795 3 2 22603 2 2
                                            0 14 2547 75 3 191 14 3280 14
                                            3274 14 3240 2 3206 14 2547 75
                                            3 191 14 3280 14 3274 77 2 2 65
                                            2 211 203 2 1 459 2 0 2 3206 14
                                            2547 137 8 4 131 8 0 10 2712
                                            131 8 1 10 2813 131 8 2 10 2922
                                            2 2981 2123 6 2 73 6 16 2123 7
                                            3 75 3 191 14 3280 2187 12 2
                                            2123 4 6 77 4 8 2123 3 2 77 3
                                            128 2113 3 4 65 3 499 14 3297
                                            10 2791 2123 2 7 14 3240 2123 3
                                            6 77 3 2 65 3 211 195 3 3 6
                                            3222 4547 3 12 6 3222 203 3 0
                                            459 3 0 2123 2 6 75 3 191 14
                                            3240 2 3222 75 3 191 14 3274
                                            4171 3 12 77 3 2 65 3 211 203 3
                                            2 2507 3 6 2 3206 2123 6 2 73 6
                                            16 75 3 191 14 3280 2187 12 2
                                            2123 4 2 77 4 8 2123 3 6 77 3
                                            128 2113 3 4 65 3 499 14 3293
                                            10 2900 14 3280 14 3274 4171 3
                                            12 77 3 9 65 3 15 3019 3 2 2123
                                            3 6 77 3 2 65 3 211 195 3 2 6
                                            3222 4547 3 12 6 3222 203 3 0
                                            459 3 0 2123 2 6 75 3 191 14
                                            3240 2 3222 75 3 191 14 3274
                                            4171 3 12 77 3 2 65 3 211 203 3
                                            3 2507 3 6 2 3206 2123 7 3 75 3
                                            191 14 3280 2187 12 2 2123 3 2
                                            77 3 8 65 3 371 14 3297 10 2959
                                            2123 2 7 14 3240 182 12 6 3222
                                            166 12 2 3222 75 3 191 14 3274
                                            4171 3 12 77 3 2 65 3 211 203 3
                                            4 459 3 0 2 3206 75 3 191 14
                                            3280 2187 12 2 2123 3 2 77 3 8
                                            65 3 243 14 3293 10 3020 14
                                            3280 14 3274 4171 3 12 77 3 9
                                            65 3 15 3019 3 2 2 3222 75 3
                                            191 14 3274 4171 3 12 77 3 2 65
                                            3 211 203 3 5 459 3 0 2 3206
                                            139 10 3206 2187 14 3 75 3 191
                                            14 3293 10 3063 139 10 3231
                                            4171 3 14 14 2547 4171 5 8 77 5
                                            2 65 5 211 195 5 5 6 3091 4171
                                            2 8 75 3 191 14 3240 203 5 0
                                            459 5 0 4171 3 8 77 3 8 65 3
                                            243 14 3297 6 3114 4171 2 9 65
                                            2 256 14 3258 130 10 178 8 6
                                            3128 4171 2 9 65 2 256 14 3240
                                            130 10 4171 2 9 14 3240 130 10
                                            139 10 3206 2187 14 3 75 3 191
                                            14 3293 10 3156 139 10 3231
                                            4171 3 14 14 2547 4171 5 9 77 5
                                            2 65 5 211 195 5 4 6 3184 4171
                                            2 9 75 3 191 14 3240 203 5 0
                                            459 5 0 4171 3 9 77 3 8 65 3
                                            371 14 3293 138 10 14 3280 2191
                                            9 2 14 3274 130 10 75 3 191 14
                                            3293 10 3221 14 3280 14 2601
                                            186 11 162 0 4 75 3 191 14 3280
                                            14 2601 174 0 75 3 191 14 3280
                                            14 2601 162 0 2123 4 3 65 4 4
                                            14401 4 3 2251 4 2 726 3 31175
                                            3 3 0 14411 4 3 30789 4 3 2113
                                            4 3 65 4 4 2251 4 2 0 722 3
                                            30919 3 3 0 2123 2 3 65 2 4
                                            6209 2 3 6219 2 2 0 707 3 0 0
                                            31427 3 3 0))))
             ((ENABLE OS-CODE-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-OS-CODE)

(DEFTHEORY TRACING-LEMMAS
           (GETNTH-OS-CODE OPEN-UP-TM-PROCESSOR TICK
                           TM-PROCESSOR-WITH-NULL-ORACLE))

(DEFTHEORY OS-SEGMENT-LENGTHS
           (LENGTH-OS-TASK-TABLE PLISTP-OS-TASK-TABLE LENGTH-OS-SEGMENT-TABLE
                                 PLISTP-OS-SEGMENT-TABLE LENGTH-OS-READYQ
                                 PLISTP-OS-READYQ LENGTH-OS-STATUS-TABLE
                                 PLISTP-OS-STATUS-TABLE LENGTH-OS-IBUFFERS
                                 PLISTP-OS-IBUFFERS LENGTH-OS-OBUFFERS
                                 PLISTP-OS-OBUFFERS LENGTH-OS-MBUFFERS
                                 PLISTP-OS-MBUFFERS LENGTH-OS-CODE
                                 PLISTP-OS-CODE))

(DEFTHEORY TRACE-ARITHMETIC
           (CANONICALIZE-PLUS-TERMS1 CANONICALIZE-PLUS-TERMS2
                                     CANONICALIZE-PLUS-TERMS3
                                     COMMUTATIVITY-OF-PLUS
                                     COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X
                                     DIFFERENCE-PLUS2
                                     DIFFERENCE-PLUS-CANCELLATION2-INSTANCE
                                     PLUS-0-ARG1 TIMES-1
                                     YET-ANOTHER-DIFFERENCE-PLUS-CROCK
                                     LESSP-REMAINDER2))

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES1
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY
                   FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                   FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY
                   FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY
                   ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY))

(DEFTHEORY GOOD-OS-PROPERTIES1
           (FINITE-NUMBERP-OS-TASKID PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET
                                     FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
                                     FINITE-NUMBER-QUEUE-TABLEP-OS-MBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS
                                     FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS
                                     FINITE-SEGMENT-TABLEP-OS-SEGMENT-TABLE
                                     DISJOINT-EVERYWHERE-OS-SEGMENT-TABLE
                                     MUTUALLY-DISJOINT-OS-SEGMENT-TABLE
                                     FINITE-NUMBER-QUEUEP-OS-READYQ
                                     GOOD-STATUS-LIST-OS-STATUS-TABLE
                                     GOOD-CPU-LIST-OS-TASK-TABLE TM-LIMIT-OS
                                     TM-BASE-OS OS-NOT-IN-SUPERVISOR-MODE
                                     OS-TIME-SLICE OS-OUTPUT-NEW-PC
                                     OS-INPUT-NEW-PC OS-SVC-NEW-PC
                                     OS-ERROR-NEW-PC OS-CLOCK-NEW-PC
                                     TM-SLIMIT-OS GOOD-TM-OS))

(DEFTHEORY MEMORY-REFERENCE
           (GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
                                      GETNTH-AFTER-PUTSEG GETNTH-BEFORE-PUTSEG
                                      GETNTH-PUTSEG-COINCIDENCE
                                      PUTNTH-COINCIDENCE
                                      PUTNTH-NON-INTERFERENCE-COROLLARY1
                                      PUTNTH-NON-INTERFERENCE-COROLLARY2
                                      PUTNTH-AFTER-PUTSEG
                                      PUTNTH-PUTSEG-COINCIDENCE LENGTH-GETSEG
                                      LENGTH-PUTSEG LENGTH-PUTNTH))

(DEFTHEORY
    TRACE-ARRAY-QUEUE-FACTS
    (ARRAY-QCURRLENGTH-IN-AN-EMPTY-QUEUE ARRAY-QCURRLENGTH-IN-A-NON-EMPTY-QUEUE
                                         ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
                                         ARRAY-QCURRLENGTH-IN-A-FULL-QUEUE
                                         NOT-ARRAY-QFULLP-ARRAY-DEQ
                                         NOT-ARRAY-QEMPTYP-ARRAY-ENQ
                                         ARRAY-QUEUEP-ARRAY-DEQ
                                         PLISTP-ARRAY-DEQ LENGTH-ARRAY-DEQ
                                         ARRAY-QUEUEP-ARRAY-ENQ
                                         PLISTP-ARRAY-ENQ LENGTH-ARRAY-ENQ
                                         LENGTH-ARRAY-QARRAY
                                         PLISTP-ARRAY-QARRAY
                                         LESSP-QCURRLENGTH-ADD1-QMAXLENGTH
                                         LESSP-QTAIL-QMAXLENGTH
                                         LESSP-QHEAD-QMAXLENGTH
                                         QMAXLENGTH-GREATER-THAN-ZERO
                                         QMAXLENGTH-NON-ZERO
                                         NUMBERP-QMAXLENGTH
                                         NUMBERP-QCURRLENGTH NUMBERP-QTAIL
                                         NUMBERP-QHEAD))

(DEFN OS-READYQ-QARRAY-ADDRESS
      NIL '195
      NIL)

(PROVE-LEMMA OS-READYQ-ADDRESS-FACTS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '16 '16)
                      (AND (EQUAL (LESSP (PLUS '195 (GETNTH '0 QUEUE))
                                         '65536)
                                  '*1*TRUE)
                           (EQUAL (LESSP (PLUS '195 (GETNTH '1 QUEUE))
                                         '65536)
                                  '*1*TRUE)))
             ((ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-ADDRESS-FACTS)

(PROVE-LEMMA
 TM-PACK-PSW-TM-UNPACK-FIELDS1
 (REWRITE)
 (EQUAL (TM-PACK-PSW (TM-UNPACK-CC N)
                     (TM-UNPACK-ERROR N)
                     (TM-UNPACK-SVCFLAG N)
                     (TM-UNPACK-SVCID N))
        (PLUS (REMAINDER N '256)
              (PLUS (TIMES '256
                           (QUOTIENT (REMAINDER N '512) '256))
                    (TIMES '512 (QUOTIENT N '512)))))
 ((ENABLE COMMUTATIVITY-OF-TIMES DIVIDES TM-PACK-PSW TM-UNPACK-CC
          TM-UNPACK-ERROR TM-UNPACK-SVCFLAG TM-UNPACK-SVCID)
  (DISABLE TIMES PLUS)
  (USE
   (REMAINDER-REMAINDER-INVERSE (N N)
                                (A '4)
                                (B '256))
   (ASSOCIATIVITY-OF-PLUS-INVERSE
                           (A (REMAINDER N '4))
                           (B (TIMES (QUOTIENT (REMAINDER N '256) '4)
                                     '4))
                           (C (PLUS (TIMES (QUOTIENT (REMAINDER N '512) '256)
                                           '256)
                                    (TIMES (QUOTIENT N '512) '512))))
   (REMAINDER-QUOTIENT (X (REMAINDER N '256))
                       (Y '4)))
  (DO-NOT-INDUCT T)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-PACK-PSW-TM-UNPACK-FIELDS1)

(PROVE-LEMMA
 TM-PACK-PSW-TM-UNPACK-FIELDS2
 (REWRITE)
 (EQUAL (PLUS (REMAINDER N '256)
              (PLUS (TIMES '256
                           (QUOTIENT (REMAINDER N '512) '256))
                    (TIMES '512 (QUOTIENT N '512))))
        (PLUS (REMAINDER N '512)
              (TIMES '512 (QUOTIENT N '512))))
 ((ENABLE COMMUTATIVITY-OF-TIMES DIVIDES)
  (DISABLE TIMES PLUS)
  (USE
   (REMAINDER-REMAINDER-INVERSE (N N)
                                (A '256)
                                (B '512))
   (ASSOCIATIVITY-OF-PLUS-INVERSE
                               (A (REMAINDER N '256))
                               (B (TIMES '256
                                         (QUOTIENT (REMAINDER N '512) '256)))
                               (C (TIMES '512 (QUOTIENT N '512))))
   (REMAINDER-QUOTIENT (X (REMAINDER N '512))
                       (Y '256)))
  (DO-NOT-INDUCT T)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-PACK-PSW-TM-UNPACK-FIELDS2)

(PROVE-LEMMA TM-PACK-PSW-TM-UNPACK-FIELDS
             (REWRITE)
             (IMPLIES (NUMBERP N)
                      (EQUAL (TM-PACK-PSW (TM-UNPACK-CC N)
                                          (TM-UNPACK-ERROR N)
                                          (TM-UNPACK-SVCFLAG N)
                                          (TM-UNPACK-SVCID N))
                             N))
             ((ENABLE REMAINDER-QUOTIENT TM-PACK-PSW-TM-UNPACK-FIELDS2
                      TM-PACK-PSW-TM-UNPACK-FIELDS1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PACK-PSW-TM-UNPACK-FIELDS)

(PROVE-LEMMA
 LIST-OF-GETNTHS9
 (REWRITE)
 (IMPLIES
  (AND (PLISTP L)
       (EQUAL (LENGTH L) '9))
  (EQUAL
   (CONS
    (GETNTH '0 L)
    (CONS
        (GETNTH '1 L)
        (CONS (GETNTH '2 L)
              (CONS (GETNTH '3 L)
                    (CONS (GETNTH '4 L)
                          (CONS (GETNTH '5 L)
                                (CONS (GETNTH '6 L)
                                      (CONS (GETNTH '7 L)
                                            (CONS (GETNTH '8 L) 'NIL)))))))))
   L))
 ((ENABLE PLISTP GETNTH LENGTH)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LIST-OF-GETNTHS9)

(PROVE-LEMMA CONTRACT-CPU
 (REWRITE)
 (IMPLIES
  (GOOD-CPU CPU)
  (EQUAL
   (CONS
    (GETNTH '0 CPU)
    (CONS
     (GETNTH '1 CPU)
     (CONS
      (GETNTH '2 CPU)
      (CONS
       (GETNTH '3 CPU)
       (CONS
        (GETNTH '4 CPU)
        (CONS
            (GETNTH '5 CPU)
            (CONS (GETNTH '6 CPU)
                  (CONS (GETNTH '7 CPU)
                        (CONS (TM-PACK-PSW (TM-UNPACK-CC (GETNTH '8 CPU))
                                           (TM-UNPACK-ERROR (GETNTH '8 CPU))
                                           (TM-UNPACK-SVCFLAG (GETNTH '8 CPU))
                                           (TM-UNPACK-SVCID (GETNTH '8 CPU)))
                              'NIL)))))))))
   CPU))
 ((ENABLE TM-PACK-PSW-TM-UNPACK-FIELDS GOOD-CPU LIST-OF-GETNTHS9
          FINITE-NUMBERP-GETNTH OPEN-UP-GETNTH OPEN-UP-GETNTH-ON-ZERO)
  (USE (A-FINITE-NUMBER-IS-A-NUMBER (N (GETNTH '8 CPU))
                                    (LUB '65536)))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-CPU)

(PROVE-LEMMA LIST-OF-PUTNTHS8
 (REWRITE)
 (IMPLIES
  (AND (PLISTP L)
       (EQUAL (LENGTH L) '8))
  (EQUAL
   (PUTNTH A '0
    (PUTNTH B '1
          (PUTNTH C '2
                  (PUTNTH D '3
                          (PUTNTH W '4
                                  (PUTNTH X '5
                                          (PUTNTH Y '6 (PUTNTH Z '7 L))))))))
   (CONS A
         (CONS B
               (CONS C
                     (CONS D
                           (CONS W
                                 (CONS X
                                       (CONS Y (CONS Z 'NIL))))))))))
 ((ENABLE APPEND FIRSTN-FIRSTN FIRSTN-ZERO LENGTH-APPEND LENGTH-FIRSTN
          NTHCDR-WITH-LARGE-N PLISTP-FIRSTN PUTNTH-APPEND-LEFT PUTNTH-SHIFT)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LIST-OF-PUTNTHS8)

(PROVE-LEMMA
 CONTRACT-LIST-OF-GETNTHS8
 (REWRITE)
 (IMPLIES
  (AND (NUMBERP N)
       (IF (LESSP (LENGTH L) (PLUS '8 N))
           '*1*FALSE
           '*1*TRUE))
  (EQUAL
        (CONS (GETNTH N L)
              (CONS (GETNTH (PLUS '1 N) L)
                    (CONS (GETNTH (PLUS '2 N) L)
                          (CONS (GETNTH (PLUS '3 N) L)
                                (CONS (GETNTH (PLUS '4 N) L)
                                      (CONS (GETNTH (PLUS '5 N) L)
                                            (CONS (GETNTH (PLUS '6 N) L)
                                                  (CONS (GETNTH (PLUS '7 N) L)
                                                        'NIL))))))))
        (GETSEG N '8 L)))
 ((ENABLE GETSEG-OF-LENGTH-ZERO GETSEG-ADD1-LENGTH2)
  (EXPAND (PLUS 1 N)
          (PLUS 2 N)
          (PLUS 3 N)
          (PLUS 4 N)
          (PLUS 5 N)
          (PLUS 6 N)
          (PLUS 7 N))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-LIST-OF-GETNTHS8)

(PROVE-LEMMA
 CONTRACT-SEQUENCE-OF-PUTNTHS8
 (REWRITE)
 (IMPLIES
  (AND (NUMBERP N)
       (IF (LESSP (LENGTH L) (PLUS '9 N))
           '*1*FALSE
           '*1*TRUE))
  (EQUAL
   (PUTNTH V0 N
    (PUTNTH V1
     (PLUS '1 N)
     (PUTNTH V2
      (PLUS '2 N)
      (PUTNTH V3
             (PLUS '3 N)
             (PUTNTH V4
                     (PLUS '4 N)
                     (PUTNTH V5
                             (PLUS '5 N)
                             (PUTNTH V6
                                     (PLUS '6 N)
                                     (PUTNTH V7
                                             (PLUS '7 N)
                                             (PUTNTH V8 (PLUS '8 N) L)))))))))
   (PUTSEG
     (CONS V0
           (CONS V1
                 (CONS V2
                       (CONS V3
                             (CONS V4
                                   (CONS V5
                                         (CONS V6
                                               (CONS V7 (CONS V8 'NIL)))))))))
     N L)))
 ((ENABLE OPEN-UP-PUTSEG-ON-SEGMENT-CONS PLUS PLUS-1 LENGTH
          COMMUTATIVITY-OF-PLUS PUTSEG-NIL-SEGMENT)
  (DO-NOT-INDUCT T)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-SEQUENCE-OF-PUTNTHS8)

(PROVE-LEMMA
 CONTRACT-PUTNTHS-INTO-TASK-TABLE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM OS) (LESSP ID '16))
  (EQUAL
   (PUTNTH
    (GETNTH '0 (TM-REGS OS))
    (TIMES '9 ID)
    (PUTNTH
     (GETNTH '1 (TM-REGS OS))
     (PLUS '1 (TIMES '9 ID))
     (PUTNTH
      (GETNTH '2 (TM-REGS OS))
      (PLUS '2 (TIMES '9 ID))
      (PUTNTH
       (GETNTH '3 (TM-REGS OS))
       (PLUS '3 (TIMES '9 ID))
       (PUTNTH
        (GETNTH '4 (TM-REGS OS))
        (PLUS '4 (TIMES '9 ID))
        (PUTNTH
         (GETNTH '5 (TM-REGS OS))
         (PLUS '5 (TIMES '9 ID))
         (PUTNTH
               (GETNTH '6 (TM-REGS OS))
               (PLUS '6 (TIMES '9 ID))
               (PUTNTH (GETNTH '7 (TM-REGS OS))
                       (PLUS '7 (TIMES '9 ID))
                       (PUTNTH (PLUS (TM-CC OS)
                                     (PLUS (TIMES '4 (TM-ERROR OS))
                                           (PLUS (TIMES '256 (TM-SVCFLAG OS))
                                                 (TIMES '512 (TM-SVCID OS)))))
                               (PLUS '8 (TIMES '9 ID))
                               (OS-TASK-TABLE OS))))))))))
   (PUTSEG (TM-CPU OS)
           (TIMES '9 ID)
           (OS-TASK-TABLE OS))))
 ((ENABLE TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 TM-PACK-PSW
          COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          CONTRACT-SEQUENCE-OF-PUTNTHS8 LENGTH-OS-TASK-TABLE)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE)

(PROVE-LEMMA
 CONTRACT-PUTNTHS-INTO-REGMEM
 (REWRITE)
 (IMPLIES
  (AND (GOOD-TM OS)
       (AND (EQUAL (LENGTH TASK-TABLE) '144)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))
  (EQUAL
   (PUTNTH
    (GETNTH (TIMES '9 TASKID) TASK-TABLE)
    '0
    (PUTNTH
     (GETNTH (PLUS '1 (TIMES '9 TASKID))
             TASK-TABLE)
     '1
     (PUTNTH
      (GETNTH (PLUS '2 (TIMES '9 TASKID))
              TASK-TABLE)
      '2
      (PUTNTH
          (GETNTH (PLUS '3 (TIMES '9 TASKID))
                  TASK-TABLE)
          '3
          (PUTNTH (GETNTH (PLUS '4 (TIMES '9 TASKID))
                          TASK-TABLE)
                  '4
                  (PUTNTH (GETNTH (PLUS '5 (TIMES '9 TASKID))
                                  TASK-TABLE)
                          '5
                          (PUTNTH (GETNTH (PLUS '6 (TIMES '9 TASKID))
                                          TASK-TABLE)
                                  '6
                                  (PUTNTH (GETNTH (PLUS '7 (TIMES '9 TASKID))
                                                  TASK-TABLE)
                                          '7
                                          (TM-REGS OS)))))))))
   (GETSEG '0
           '8
           (GETNTH TASKID
                   (TABLE '9 TASK-TABLE)))))
 ((ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (ENABLE LIST-OF-PUTNTHS8 LENGTH-TABLE CONTRACT-LIST-OF-GETNTHS8 GETNTH-TABLE
          COMMUTATIVITY-OF-TIMES GETSEG-GETSEG PLUS-0)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTHS-INTO-REGMEM)

(PROVE-LEMMA
 OS-TASK-TABLE-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
  (LESSP ID '16)
  (AND
    (EQUAL (LESSP (PLUS '15 (TIMES '9 ID))
                  '65536)
           '*1*TRUE)
    (AND (EQUAL (LESSP (PLUS '16 (TIMES '9 ID))
                       '65536)
                '*1*TRUE)
         (AND (EQUAL (LESSP (PLUS '17 (TIMES '9 ID))
                            '65536)
                     '*1*TRUE)
              (AND (EQUAL (LESSP (PLUS '18 (TIMES '9 ID))
                                 '65536)
                          '*1*TRUE)
                   (AND (EQUAL (LESSP (PLUS '19 (TIMES '9 ID))
                                      '65536)
                               '*1*TRUE)
                        (AND (EQUAL (LESSP (PLUS '20 (TIMES '9 ID))
                                           '65536)
                                    '*1*TRUE)
                             (AND (EQUAL (LESSP (PLUS '21 (TIMES '9 ID))
                                                '65536)
                                         '*1*TRUE)
                                  (AND (EQUAL (LESSP (PLUS '22 (TIMES '9 ID))
                                                     '65536)
                                              '*1*TRUE)
                                       (EQUAL (LESSP (PLUS '23 (TIMES '9 ID))
                                                     '65536)
                                              '*1*TRUE))))))))))
 ((ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-ADDRESS-FACTS)

(DEFN OS-NEW-TASK-TABLE
      (OS)
      (PUTSEG (TM-CPU OS)
              (TIMES '9
                     (ARRAY-QFIRST (OS-READYQ OS)))
              (OS-TASK-TABLE OS))
      NIL)

(DEFN OS-NEW-REGS
      (TASKID TM)
      (GETSEG '0
              '8
              (GETNTH TASKID
                      (TABLE '9 (OS-NEW-TASK-TABLE TM))))
      NIL)

(DEFN OS-NEW-FLAGS
      (TASKID TM)
      (GETNTH '8
              (GETNTH TASKID
                      (TABLE '9 (OS-NEW-TASK-TABLE TM))))
      NIL)

(DEFN OS-NEW-CC
      (TASKID TM)
      (TM-UNPACK-CC (OS-NEW-FLAGS TASKID TM))
      NIL)

(DEFN OS-NEW-ERROR
      (TASKID TM)
      (TM-UNPACK-ERROR (OS-NEW-FLAGS TASKID TM))
      NIL)

(DEFN OS-NEW-SVCFLAG
      (TASKID TM)
      (TM-UNPACK-SVCFLAG (OS-NEW-FLAGS TASKID TM))
      NIL)

(DEFN OS-NEW-SVCID
      (TASKID TM)
      (TM-UNPACK-SVCID (OS-NEW-FLAGS TASKID TM))
      NIL)

(DEFN OS-NEW-BASE
      (TASKID OS)
      (BASE (GETNTH TASKID
                    (TABLE '2 (OS-SEGMENT-TABLE OS))))
      NIL)

(DEFN OS-NEW-LIMIT
      (TASKID OS)
      (LIMIT (GETNTH TASKID
                     (TABLE '2 (OS-SEGMENT-TABLE OS))))
      NIL)

(DEFTHEORY OS-NEW-CPU
           (OS-NEW-BASE OS-NEW-CC OS-NEW-ERROR OS-NEW-FLAGS OS-NEW-LIMIT
                        OS-NEW-REGS OS-NEW-SVCFLAG OS-NEW-SVCID))

(PROVE-LEMMA GOOD-CPU-LIST-OS-NEW-TASK-TABLE
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-CPU-LIST (TABLE '9 (OS-NEW-TASK-TABLE OS))))
             ((ENABLE OS-NEW-TASK-TABLE PLISTP-TM-CPU LENGTH-TM-CPU
                      LENGTH-OS-TASK-TABLE TABLE-PUTSEG GOOD-CPU-LIST-PUTNTH
                      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-LIST-OS-NEW-TASK-TABLE)

(PROVE-LEMMA
          OS-SEGMENT-TABLE-ADDRESS-FACTS
          (REWRITE)
          (IMPLIES (LESSP ID '16)
                   (AND (EQUAL (LESSP (PLUS '159 (TIMES '2 ID))
                                      '65536)
                               '*1*TRUE)
                        (AND (EQUAL (LESSP (PLUS '160 (TIMES '2 ID))
                                           '65536)
                                    '*1*TRUE)
                             (AND (EQUAL (LESSP (TIMES '2 ID) '32)
                                         '*1*TRUE)
                                  (EQUAL (LESSP (PLUS '1 (TIMES '2 ID)) '32)
                                         '*1*TRUE)))))
          ((ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-ADDRESS-FACTS)

(PROVE-LEMMA
            CONTRACT-OS-NEW-BASE-EXPRESSION
            (REWRITE)
            (IMPLIES (LESSP (TIMES '2 TASKID) '32)
                     (EQUAL (GETNTH (TIMES '2 TASKID)
                                    (OS-SEGMENT-TABLE OS))
                            (BASE (GETNTH TASKID
                                          (TABLE '2 (OS-SEGMENT-TABLE OS))))))
            ((ENABLE LENGTH-OS-SEGMENT-TABLE GETNTH-TABLE BASE
                     COMMUTATIVITY-OF-TIMES CAR-GETSEG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE CONTRACT-OS-NEW-BASE-EXPRESSION)

(PROVE-LEMMA
           CONTRACT-OS-NEW-LIMIT-EXPRESSION
           (REWRITE)
           (IMPLIES (LESSP (PLUS '1 (TIMES '2 TASKID))
                           '32)
                    (EQUAL (GETNTH (PLUS '1 (TIMES '2 TASKID))
                                   (OS-SEGMENT-TABLE OS))
                           (LIMIT (GETNTH TASKID
                                          (TABLE '2 (OS-SEGMENT-TABLE OS))))))
           ((ENABLE LENGTH-OS-SEGMENT-TABLE GETNTH-TABLE LIMIT
                    COMMUTATIVITY-OF-TIMES)
            (DISABLE PLUS TIMES)
            (USE (GETNTH-PLUS-1-IS-CADR-GETSEG (N (TIMES '2 TASKID))
                                               (K '2)
                                               (L (OS-SEGMENT-TABLE OS))))
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE CONTRACT-OS-NEW-LIMIT-EXPRESSION)

(DEFTHEORY ACCESS-OS-SEGMENT-TABLE
           (OS-SEGMENT-TABLE-ADDRESS-FACTS CONTRACT-OS-NEW-BASE-EXPRESSION
                                           CONTRACT-OS-NEW-LIMIT-EXPRESSION))

(PROVE-LEMMA CONTRACT-SEQUENCE-OF-PUTNTHS2
             (REWRITE)
             (IMPLIES (AND (NUMBERP N)
                           (IF (LESSP (LENGTH L) (PLUS '2 N))
                               '*1*FALSE
                               '*1*TRUE))
                      (EQUAL (PUTNTH A N (PUTNTH B (PLUS '1 N) L))
                             (PUTSEG (CONS A (CONS B 'NIL)) N L)))
             ((ENABLE OPEN-UP-PUTSEG-ON-SEGMENT-CONS PLUS PLUS-1 LENGTH
                      COMMUTATIVITY-OF-PLUS PUTSEG-NIL-SEGMENT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-SEQUENCE-OF-PUTNTHS2)

(PROVE-LEMMA CONTRACT-PUTNTHS-INTO-STATUS-TABLE
             (REWRITE)
             (IMPLIES (LESSP I '16)
                      (EQUAL (PUTNTH A
                                     (TIMES '2 I)
                                     (PUTNTH B
                                             (PLUS '1 (TIMES '2 I))
                                             (OS-STATUS-TABLE OS)))
                             (PUTSEG (CONS A (CONS B 'NIL))
                                     (TIMES '2 I)
                                     (OS-STATUS-TABLE OS))))
             ((ENABLE CONTRACT-SEQUENCE-OF-PUTNTHS2 LENGTH-OS-STATUS-TABLE)
              (DISABLE PLUS TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTHS-INTO-STATUS-TABLE)

(PROVE-LEMMA
 OS-STATUS-TABLE-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
    (LESSP ID '16)
    (AND (EQUAL (LESSP (TIMES '2 ID) '65536)
                '*1*TRUE)
         (AND (EQUAL (LESSP (PLUS '211 (TIMES '2 ID))
                            '65536)
                     '*1*TRUE)
              (AND (EQUAL (LESSP (PLUS '212 (TIMES '2 ID))
                                 '65536)
                          '*1*TRUE)
                   (AND (EQUAL (LESSP (TIMES '2 ID) '32)
                               '*1*TRUE)
                        (AND (EQUAL (LESSP (ADD1 (TIMES '2 ID)) '32)
                                    '*1*TRUE)
                             (AND (EQUAL (LESSP (PLUS '1 (TIMES '2 ID)) '32)
                                         '*1*TRUE)
                                  (EQUAL (LESSP '32 (PLUS '2 (TIMES '2 ID)))
                                         '*1*FALSE))))))))
 ((ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-ADDRESS-FACTS)

(PROVE-LEMMA ACCESS-OS-STATUS-TABLE-CROCK
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS) (LESSP ID '16))
                      (AND (NUMBERP (GETNTH (TIMES '2 ID)
                                            (OS-STATUS-TABLE OS)))
                           (AND (LESSP (GETNTH (TIMES '2 ID)
                                               (OS-STATUS-TABLE OS))
                                       '65536)
                                (AND (NUMBERP (GETNTH (PLUS '1 (TIMES '2 ID))
                                                      (OS-STATUS-TABLE OS)))
                                     (LESSP (GETNTH (PLUS '1 (TIMES '2 ID))
                                                    (OS-STATUS-TABLE OS))
                                            '65536)))))
             ((DISABLE TIMES PLUS)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (ENABLE OS-STATUS-TABLE LENGTH-GETSEG FINITE-NUMBERP
                      OS-STATUS-TABLE-ADDRESS-FACTS)
              (USE (FINITE-NUMBERP-GETNTH (I (TIMES '2 ID))
                                          (L (OS-STATUS-TABLE OS))
                                          (LUB '65536))
                   (FINITE-NUMBERP-GETNTH (I (PLUS '1 (TIMES '2 ID)))
                                          (L (OS-STATUS-TABLE OS))
                                          (LUB '65536))
                   (FINITE-NUMBER-LISTP-GETSEG (N '211)
                                               (K '32)
                                               (L (TM-MEMORY OS))
                                               (LUB '65536)))
              (DISABLE-THEORY T)))

(DISABLE ACCESS-OS-STATUS-TABLE-CROCK)

(PROVE-LEMMA FINITE-NUMBERP-GETNTH-OS-STATUS-TABLE
             NIL
             (IMPLIES (AND (GOOD-TM OS) (LESSP I '32))
                      (FINITE-NUMBERP (GETNTH I (OS-STATUS-TABLE OS))
                                      '65536))
             ((USE (FINITE-NUMBERP-GETNTH (I I)
                                          (L (OS-STATUS-TABLE OS))
                                          (LUB '65536))
                   (FINITE-NUMBER-LISTP-GETSEG (N '211)
                                               (K '32)
                                               (L (TM-MEMORY OS))
                                               (LUB '65536)))
              (ENABLE OS-STATUS-TABLE LENGTH-GETSEG)
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DEFTHEORY ACCESS-OS-STATUS-TABLE
           (CONTRACT-PUTNTHS-INTO-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
                                               ACCESS-OS-STATUS-TABLE-CROCK))

(DEFN OS-UPDATE-STATUS
      (ID STATUS FLAG OS)
      (PUTSEG (CONS STATUS (CONS FLAG 'NIL))
              (TIMES '2 ID)
              (OS-STATUS-TABLE OS))
      NIL)

(PROVE-LEMMA RE-ASSOCIATE-TIMES
             (REWRITE)
             (EQUAL (TIMES (ADD1 A) (TIMES (ADD1 B) C))
                    (TIMES (TIMES (ADD1 A) (ADD1 B)) C))
             ((ENABLE ASSOCIATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE RE-ASSOCIATE-TIMES)

(PROVE-LEMMA LIMITED-ASSOCIATIVITY-OF-PLUS
             (REWRITE)
             (EQUAL (PLUS (PLUS (ADD1 A) (PLUS B C)) D)
                    (PLUS (ADD1 A) (PLUS (PLUS B C) D)))
             ((ENABLE ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LIMITED-ASSOCIATIVITY-OF-PLUS)

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-MBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS))

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS1
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-MBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS))

(DEFN OS-MBUFFER-SOURCE-MULTIPLIER
      NIL '128
      NIL)

(DEFN OS-MBUFFER-DEST-MULTIPLIER NIL '8
      NIL)

(DEFN OS-MBUFFERS-ADDRESS-PLUS-QTAIL-FIELD NIL '500
      NIL)

(DEFN OS-MBUFFERS-ADDRESS-PLUS-QCURRLENGTH-FIELD NIL '501
      NIL)

(DEFN OS-MBUFFERS-ADDRESS-PLUS-QMAXLENGTH-FIELD NIL '502
      NIL)

(DEFN OS-MBUFFERS-ADDRESS-PLUS-QARRAY-FIELD NIL '503
      NIL)

(DEFN OS-CURRENT-MBUFFER
      (SID DID OS)
      (GETNTH (PLUS (TIMES '16 SID) DID)
              (TABLE '8 (OS-MBUFFERS OS)))
      NIL)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (LESSP SID '16)
                              (LESSP DID '16)))
                    (FINITE-NUMBER-QUEUEP (GETNTH (PLUS (TIMES '16 SID) DID)
                                                  (TABLE '8 (OS-MBUFFERS OS)))
                                          '4
                                          '65536))
           ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
                    COMMUTATIVITY-OF-PLUS LENGTH-TABLE LENGTH-OS-MBUFFERS
                    FINITE-NUMBER-QUEUEP-GETNTH)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER)

(PROVE-LEMMA
           FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (LESSP SID '16)
                              (LESSP DID '16)))
                    (FINITE-NUMBER-QUEUEP (GETNTH (PLUS DID (TIMES '16 SID))
                                                  (TABLE '8 (OS-MBUFFERS OS)))
                                          '4
                                          '65536))
           ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS
                    COMMUTATIVITY-OF-PLUS LENGTH-TABLE LENGTH-OS-MBUFFERS
                    FINITE-NUMBER-QUEUEP-GETNTH)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE)

(PROVE-LEMMA RE-ASSOCIATE-TIMES1
             (REWRITE)
             (EQUAL (TIMES '8 (PLUS B (TIMES '16 A)))
                    (PLUS (TIMES '8 B) (TIMES '128 A)))
             ((ENABLE DISTRIBUTIVITY-OF-TIMES-OVER-PLUS RE-ASSOCIATE-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE RE-ASSOCIATE-TIMES1)

(PROVE-LEMMA REWRITE-OS-MBUFFER-ADDRESS
             (REWRITE)
             (EQUAL (PLUS (TIMES '8
                                 (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16))
                          (TIMES '128
                                 (ARRAY-QFIRST (OS-READYQ OS))))
                    (TIMES '8
                           (PLUS (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16)
                                 (TIMES '16
                                        (ARRAY-QFIRST (OS-READYQ OS))))))
             ((ENABLE RE-ASSOCIATE-TIMES1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-OS-MBUFFER-ADDRESS)

(PROVE-LEMMA REWRITE-OS-MBUFFER-ADDRESS1
             (REWRITE)
             (EQUAL (PLUS (TIMES '8
                                 (ARRAY-QFIRST (OS-READYQ OS)))
                          (TIMES '128
                                 (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16)))
                    (TIMES '8
                           (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                 (TIMES '16
                                        (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                   '16)))))
             ((ENABLE RE-ASSOCIATE-TIMES1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REWRITE-OS-MBUFFER-ADDRESS1)

(PROVE-LEMMA OS-MBUFFERS-ADDRESS-FACTS1
             (REWRITE)
             (IMPLIES (LESSP I '16)
                      (AND (EQUAL (LESSP (TIMES '8 I) '65536)
                                  '*1*TRUE)
                           (AND (EQUAL (LESSP (TIMES '128 I) '2048)
                                       '*1*TRUE)
                                (AND (EQUAL (LESSP (TIMES '128 I) '65536)
                                            '*1*TRUE)
                                     (EQUAL (LESSP (TIMES '16 I) '256)
                                            '*1*TRUE)))))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-ADDRESS-FACTS1)

(PROVE-LEMMA
 OS-MBUFFERS-ADDRESS-FACTS2
 (REWRITE)
 (IMPLIES
  (AND (LESSP I '16) (LESSP J '16))
  (AND
   (EQUAL (LESSP (PLUS (TIMES '8 J) (TIMES '128 I))
                 '65536)
          '*1*TRUE)
   (AND
    (EQUAL (LESSP (PLUS '500
                        (PLUS (TIMES '8 J) (TIMES '128 I)))
                  '65536)
           '*1*TRUE)
    (AND
     (EQUAL (LESSP (PLUS '499
                         (PLUS (TIMES '8 J) (TIMES '128 I)))
                   '65536)
            '*1*TRUE)
     (AND
      (EQUAL (LESSP (PLUS '501
                          (PLUS (TIMES '8 J) (TIMES '128 I)))
                    '65536)
             '*1*TRUE)
      (AND
       (EQUAL (LESSP (PLUS '502
                           (PLUS (TIMES '8 J) (TIMES '128 I)))
                     '65536)
              '*1*TRUE)
       (AND
        (EQUAL (LESSP (PLUS '503
                            (PLUS (TIMES '8 J) (TIMES '128 I)))
                      '65536)
               '*1*TRUE)
        (AND
            (EQUAL (LESSP (PLUS '1
                                (PLUS (TIMES '8 J) (TIMES '128 I)))
                          '2048)
                   '*1*TRUE)
            (AND (EQUAL (LESSP (PLUS '2
                                     (PLUS (TIMES '8 J) (TIMES '128 I)))
                               '2048)
                        '*1*TRUE)
                 (AND (EQUAL (LESSP (PLUS '3
                                          (PLUS (TIMES '8 J) (TIMES '128 I)))
                                    '2048)
                             '*1*TRUE)
                      (EQUAL (LESSP (PLUS '4
                                          (PLUS (TIMES '8 J) (TIMES '128 I)))
                                    '2048)
                             '*1*TRUE)))))))))))
 ((ENABLE COMMUTATIVITY-OF-PLUS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-ADDRESS-FACTS2)

(PROVE-LEMMA
 OS-MBUFFERS-ADDRESS-FACTS3
 (REWRITE)
 (IMPLIES
  (AND (LESSP I '16) (LESSP J '16))
  (AND
   (EQUAL (LESSP (PLUS (TIMES '16 J) I) '256)
          '*1*TRUE)
   (AND
    (EQUAL (LESSP (TIMES '8 (PLUS I (TIMES '16 J)))
                  '2048)
           '*1*TRUE)
    (AND
       (EQUAL (LESSP (TIMES '8 (PLUS (TIMES '16 J) I))
                     '2048)
              '*1*TRUE)
       (AND (EQUAL (LESSP '2048
                          (PLUS '8
                                (TIMES '8 (PLUS (TIMES '16 J) I))))
                   '*1*FALSE)
            (AND (EQUAL (LESSP (PLUS (TIMES '8 J) (TIMES '128 I))
                               '2048)
                        '*1*TRUE)
                 (AND (EQUAL (LESSP '2048
                                    (PLUS '8
                                          (TIMES '8 (PLUS I (TIMES '16 J)))))
                             '*1*FALSE)
                      (EQUAL (LESSP (PLUS I (TIMES '16 J)) '256)
                             '*1*TRUE))))))))
 ((ENABLE RE-ASSOCIATE-TIMES1 COMMUTATIVITY-OF-PLUS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-ADDRESS-FACTS3)

(PROVE-LEMMA
        FINITE-NUMBERP-GETNTH-FROM-CURRENT-MBUFFER NIL
        (IMPLIES (AND (GOOD-TM OS)
                      (AND (LESSP SID '16)
                           (AND (LESSP DID '16) (LESSP I '8))))
                 (FINITE-NUMBERP (GETNTH I
                                         (GETNTH (PLUS (TIMES '16 SID) DID)
                                                 (TABLE '8 (OS-MBUFFERS OS))))
                                 '65536))
        ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                 FINITE-NUMBER-LISTP-GETSEG FINITE-NUMBERP-GETNTH GETNTH-TABLE
                 LENGTH-GETSEG OS-MBUFFERS RE-ASSOCIATE-TIMES1)
         (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(PROVE-LEMMA
         FINITE-NUMBERP-GETNTH-FROM-CURRENT-MBUFFER1
         (REWRITE)
         (IMPLIES (AND (GOOD-TM OS)
                       (AND (LESSP SID '16)
                            (AND (LESSP DID '16) (LESSP I '8))))
                  (AND (NUMBERP (GETNTH I
                                        (GETNTH (PLUS (TIMES '16 SID) DID)
                                                (TABLE '8 (OS-MBUFFERS OS)))))
                       (LESSP (GETNTH I
                                      (GETNTH (PLUS (TIMES '16 SID) DID)
                                              (TABLE '8 (OS-MBUFFERS OS))))
                              '65536)))
         ((ENABLE FINITE-NUMBERP)
          (USE (FINITE-NUMBERP-GETNTH-FROM-CURRENT-MBUFFER))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-GETNTH-FROM-CURRENT-MBUFFER1)

(PROVE-LEMMA
       ACCESS-CURRENT-OS-MBUFFER-FIELDS
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (LESSP SID '16)
                          (LESSP DID '16)))
                (AND (LESSP (GETNTH '1
                                    (GETNTH (PLUS (TIMES '16 SID) DID)
                                            (TABLE '8 (OS-MBUFFERS OS))))
                            '65535)
                     (AND (LESSP (GETNTH '2
                                         (GETNTH (PLUS (TIMES '16 SID) DID)
                                                 (TABLE '8 (OS-MBUFFERS OS))))
                                 '65535)
                          (LESSP (GETNTH '3
                                         (GETNTH (PLUS (TIMES '16 SID) DID)
                                                 (TABLE '8 (OS-MBUFFERS OS))))
                                 '65535))))
       ((ENABLE-THEORY GOOD-OS-PROPERTIES
                       FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                       ARRAY-QUEUE-FACTS GROUND-ZERO)
        (USE (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (SID SID)
                                                   (DID DID)
                                                   (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-OS-MBUFFER-FIELDS)

(PROVE-LEMMA
 LESSP-PLUS-FACT-FOR-MBUFFERS1
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (AND (NOT (TM-WAITING OS))
               (AND (LESSP SID '16)
                    (LESSP DID '16))))
     (EQUAL (LESSP (PLUS '4
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '1
                                       (GETNTH (PLUS (TIMES '16 SID) DID)
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   '2048)
            '*1*TRUE))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
                                 (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                                (TABLE '8 (OS-MBUFFERS OS)))))
   (LESSP-QTAIL-QMAXLENGTH (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                          (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACT-FOR-MBUFFERS1)

(PROVE-LEMMA
 LESSP-PLUS-FACT-FOR-MBUFFERS2
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (AND (NOT (TM-WAITING OS))
               (AND (LESSP SID '16)
                    (LESSP DID '16))))
     (EQUAL (LESSP (PLUS '503
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '1
                                       (GETNTH (PLUS (TIMES '16 SID) DID)
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   '65536)
            '*1*TRUE))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
                                 (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                                (TABLE '8 (OS-MBUFFERS OS)))))
   (LESSP-QTAIL-QMAXLENGTH (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                          (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACT-FOR-MBUFFERS2)

(PROVE-LEMMA
 INDEX-WITHIN-LENGTH-OF-MBUFFER
 (REWRITE)
 (IMPLIES
  (AND
      (IF (LESSP '4 I)
          '*1*FALSE
          '*1*TRUE)
      (FINITE-NUMBER-QUEUEP (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS)))
                            '4
                            '65536))
  (EQUAL
       (LESSP (PLUS I
                    (GETNTH '1
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS)))))
              '8)
       '*1*TRUE))
 ((ENABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (LESSP-QTAIL-QMAXLENGTH
                     (QUEUE (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE INDEX-WITHIN-LENGTH-OF-MBUFFER)

(PROVE-LEMMA
 LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE1
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (AND (NOT (TM-WAITING OS))
               (AND (LESSP SID '16)
                    (LESSP DID '16))))
     (EQUAL (LESSP (PLUS '4
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '0
                                       (GETNTH (PLUS DID (TIMES '16 SID))
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   '2048)
            '*1*TRUE))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE
          COMMUTATIVITY-OF-PLUS
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
                                 (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                                (TABLE '8 (OS-MBUFFERS OS)))))
   (LESSP-QHEAD-QMAXLENGTH (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                          (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE1)

(PROVE-LEMMA
 LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE2
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (AND (NOT (TM-WAITING OS))
               (AND (LESSP SID '16)
                    (LESSP DID '16))))
     (EQUAL (LESSP (PLUS '503
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '0
                                       (GETNTH (PLUS DID (TIMES '16 SID))
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   '65536)
            '*1*TRUE))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE
          COMMUTATIVITY-OF-PLUS
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS
                                 (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                                (TABLE '8 (OS-MBUFFERS OS)))))
   (LESSP-QHEAD-QMAXLENGTH (QUEUE (GETNTH (PLUS (TIMES '16 SID) DID)
                                          (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE2)

(PROVE-LEMMA
       ACCESS-CURRENT-OS-MBUFFER-FIELDS-FOR-RECEIVE
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (LESSP I '16) (LESSP J '16)))
                (AND (LESSP (GETNTH '0
                                    (GETNTH (PLUS I (TIMES '16 J))
                                            (TABLE '8 (OS-MBUFFERS OS))))
                            '65535)
                     (AND (LESSP (GETNTH '2
                                         (GETNTH (PLUS I (TIMES '16 J))
                                                 (TABLE '8 (OS-MBUFFERS OS))))
                                 '65535)
                          (LESSP (GETNTH '3
                                         (GETNTH (PLUS I (TIMES '16 J))
                                                 (TABLE '8 (OS-MBUFFERS OS))))
                                 '65535))))
       ((ENABLE COMMUTATIVITY-OF-PLUS)
        (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                       GROUND-ZERO)
        (USE (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (SID J)
                                                   (DID I)
                                                   (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-OS-MBUFFER-FIELDS-FOR-RECEIVE)

(PROVE-LEMMA
 INDEX-WITHIN-LENGTH-OF-MBUFFER-FOR-RECEIVE
 (REWRITE)
 (IMPLIES
  (AND
   (IF (LESSP '4 I)
       '*1*FALSE
       '*1*TRUE)
   (FINITE-NUMBER-QUEUEP
                      (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS)))
                      '4
                      '65536))
  (EQUAL
   (LESSP
        (PLUS I
              (GETNTH '0
                      (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS)))))
        '8)
   '*1*TRUE))
 ((ENABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
          FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-MBUFFERS)
  (USE
   (LESSP-QHEAD-QMAXLENGTH
               (QUEUE (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE INDEX-WITHIN-LENGTH-OF-MBUFFER-FOR-RECEIVE)

(PROVE-LEMMA ACCESS-CURRENT-MBUFFER
             (REWRITE)
             (IMPLIES (AND (LESSP SID '16)
                           (AND (LESSP DID '16) (LESSP I '8)))
                      (EQUAL (GETNTH (PLUS I
                                           (PLUS (TIMES '8 DID)
                                                 (TIMES '128 SID)))
                                     (OS-MBUFFERS OS))
                             (GETNTH I
                                     (OS-CURRENT-MBUFFER SID DID OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-MBUFFERS
                      OS-CURRENT-MBUFFER RE-ASSOCIATE-TIMES1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-MBUFFER)

(PROVE-LEMMA
 CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS I
                      (GETNTH '1
                              (OS-CURRENT-MBUFFER SID DID OS)))
                '8)
         (AND (LESSP SID '16)
              (LESSP DID '16)))
    (EQUAL (PUTNTH VALUE
                   (PLUS I
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '1
                                       (GETNTH (PLUS (TIMES '16 SID) DID)
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   (OS-MBUFFERS OS))
           (PUTSEG (PUTNTH VALUE
                           (PLUS I
                                 (GETNTH '1
                                         (OS-CURRENT-MBUFFER SID DID OS)))
                           (OS-CURRENT-MBUFFER SID DID OS))
                   (PLUS (TIMES '8 DID)
                         (TIMES '128 SID))
                   (OS-MBUFFERS OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG LENGTH-OS-MBUFFERS
          OS-CURRENT-MBUFFER PUTNTH-PUTSEG-COINCIDENCE-INVERSE
          PUTSEG-GETSEG-COINCIDENCE RE-ASSOCIATE-TIMES1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER)

(PROVE-LEMMA
          ASSOCIATIVITY-OF-PLUS-CROCK
          (REWRITE)
          (EQUAL (PLUS '4
                       (PLUS (TIMES '8 I)
                             (PLUS (TIMES '128 J)
                                   (GETNTH (PLUS (TIMES '8 I) (TIMES '128 J))
                                           (OS-MBUFFERS OS)))))
                 (PLUS (TIMES '8 I)
                       (PLUS (TIMES '128 J)
                             (PLUS '4
                                   (GETNTH (PLUS (TIMES '8 I) (TIMES '128 J))
                                           (OS-MBUFFERS OS))))))
          ((ENABLE ASSOCIATIVITY-OF-PLUS)
           (DISABLE PLUS)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE ASSOCIATIVITY-OF-PLUS-CROCK)

(PROVE-LEMMA
 CONTRACT-GETNTH-FROM-CURRENT-MBUFFER-FOR-RECEIVE
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS '4
                      (GETNTH '0
                              (OS-CURRENT-MBUFFER SID DID OS)))
                '8)
         (AND (LESSP SID '16)
              (LESSP DID '16)))
    (EQUAL (GETNTH (PLUS '4
                         (PLUS (PLUS (TIMES '8 DID)
                                     (TIMES '128 SID))
                               (GETNTH '0
                                       (GETNTH (PLUS DID (TIMES '16 SID))
                                               (TABLE '8 (OS-MBUFFERS OS))))))
                   (OS-MBUFFERS OS))
           (GETNTH (PLUS '4
                         (GETNTH '0
                                 (OS-CURRENT-MBUFFER SID DID OS)))
                   (OS-CURRENT-MBUFFER SID DID OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS ASSOCIATIVITY-OF-PLUS-CROCK
          COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-GETSEG
          GETNTH-TABLE LENGTH-OS-MBUFFERS OS-CURRENT-MBUFFER
          RE-ASSOCIATE-TIMES1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-GETNTH-FROM-CURRENT-MBUFFER-FOR-RECEIVE)

(PROVE-LEMMA ACCESS-CURRENT-MBUFFER-QHEAD
             (REWRITE)
             (IMPLIES (AND (LESSP SID '16)
                           (LESSP DID '16))
                      (EQUAL (GETNTH (PLUS (TIMES '8 DID)
                                           (TIMES '128 SID))
                                     (OS-MBUFFERS OS))
                             (GETNTH '0
                                     (OS-CURRENT-MBUFFER SID DID OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-MBUFFERS
                      OS-CURRENT-MBUFFER RE-ASSOCIATE-TIMES1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-MBUFFER-QHEAD)

(PROVE-LEMMA CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER-FOR-RECEIVE1
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (LESSP I '4)
                                (AND (LESSP SID '16)
                                     (LESSP DID '16))))
                      (EQUAL (PUTNTH VALUE
                                     (PLUS I
                                           (PLUS (TIMES '8 DID)
                                                 (TIMES '128 SID)))
                                     (OS-MBUFFERS OS))
                             (PUTSEG (PUTNTH VALUE I
                                             (OS-CURRENT-MBUFFER SID DID OS))
                                     (PLUS (TIMES '8 DID)
                                           (TIMES '128 SID))
                                     (OS-MBUFFERS OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-TABLE LENGTH-GETSEG LENGTH-OS-MBUFFERS
                      OS-CURRENT-MBUFFER PUTNTH-PUTSEG-COINCIDENCE-INVERSE
                      PUTSEG-GETSEG-COINCIDENCE RE-ASSOCIATE-TIMES1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER-FOR-RECEIVE1)

(DEFN
    OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
    (OS)
    (PUTSEG (ARRAY-ENQ (GETNTH '3 (TM-REGS OS))
                       (OS-CURRENT-MBUFFER (ARRAY-QFIRST (OS-READYQ OS))
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           OS))
            (PLUS (TIMES '8
                         (REMAINDER (GETNTH '2 (TM-REGS OS))
                                    '16))
                  (TIMES '128
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-MBUFFERS OS))
    NIL)

(PROVE-LEMMA LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
             (REWRITE)
             (EQUAL (LENGTH (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS))
                    '2048)
             ((ENABLE OS-MBUFFERS-WITH-ENQUEUED-MESSAGE LENGTH-OS-MBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE)

(PROVE-LEMMA PLISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
             (REWRITE)
             (PLISTP (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS))
             ((ENABLE OS-MBUFFERS-WITH-ENQUEUED-MESSAGE PLISTP-PUTSEG
                      PLISTP-OS-MBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE)

(DEFN OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
      (OS)
      (PUTSEG (ARRAY-DEQ (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                             (OS-CURRENT-TASKID OS)
                                             OS))
              (PLUS (TIMES '8
                           (ARRAY-QFIRST (OS-READYQ OS)))
                    (TIMES '128
                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                      '16)))
              (OS-MBUFFERS OS))
      NIL)

(PROVE-LEMMA LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
             (REWRITE)
             (EQUAL (LENGTH (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS))
                    '2048)
             ((ENABLE OS-MBUFFERS-WITH-DEQUEUED-MESSAGE LENGTH-OS-MBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE)

(PROVE-LEMMA PLISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
             (REWRITE)
             (PLISTP (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS))
             ((ENABLE OS-MBUFFERS-WITH-DEQUEUED-MESSAGE PLISTP-PUTSEG
                      PLISTP-OS-MBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (EQUAL '4 (GETNTH '3 QUEUE)))
                      (EQUAL (ARRAY-QFULLP QUEUE)
                             (QFULLP (MAPUP-QUEUE QUEUE) '4)))
             ((USE (CORRECTNESS-OF-ARRAY-QFULLP (QUEUE QUEUE)
                                                (MAX '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE)

(PROVE-LEMMA
   MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
   (REWRITE)
   (IMPLIES (AND (LESSP I '16) (LESSP J '16))
            (EQUAL (MAPUP-QUEUE (GETNTH2 I J
                                         (TABLE '16
                                                (TABLE '8 (OS-MBUFFERS OS)))))
                   (GETNTH2 I J (MAPUP-OS-MBUFFERS OS))))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-GETSEG
            GETNTH-MAPUP-QUEUE-LIST GETNTH-TABLE GETNTH2
            LENGTH-MAPUP-QUEUE-LIST LENGTH-OS-MBUFFERS LENGTH-TABLE
            MAPUP-OS-MBUFFERS)
    (ENABLE-THEORY GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-GETNTH2-OS-MBUFFERS)

(PROVE-LEMMA OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2
             (REWRITE)
             (IMPLIES (AND (LESSP SID '16)
                           (LESSP DID '16))
                      (EQUAL (GETNTH (PLUS (TIMES '16 SID) DID)
                                     (TABLE '8 (OS-MBUFFERS OS)))
                             (GETNTH2 SID DID
                                      (TABLE '16
                                             (TABLE '8 (OS-MBUFFERS OS))))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE GETNTH2 LENGTH-OS-MBUFFERS
                      LENGTH-TABLE OS-MBUFFERS-ADDRESS-FACTS3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2)

(PROVE-LEMMA LIMITED-ASSOCIATIVITY-OF-PLUS2
             (REWRITE)
             (EQUAL (PLUS (PLUS (ADD1 A) B) C)
                    (PLUS (ADD1 A) (PLUS B C)))
             ((ENABLE ASSOCIATIVITY-OF-PLUS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LIMITED-ASSOCIATIVITY-OF-PLUS2)

(PROVE-LEMMA LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (LENGTH QUEUE) '8))
             ((USE (LENGTH-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (PLISTP QUEUE))
             ((USE (PLISTP-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (ARRAY-QUEUEP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '0 QUEUE))
                           (LESSP (GETNTH '0 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QHEAD-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '1 QUEUE))
                           (LESSP (GETNTH '1 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QTAIL-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '2 QUEUE))
                           (LESSP (GETNTH '2 QUEUE) '5)))
             ((USE (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (GETNTH '3 QUEUE) '4))
             ((USE (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (AND (NOT (ARRAY-QFULLP QUEUE))
                         (AND (NUMBERP ITEM)
                              (LESSP ITEM '65536))))
               (FINITE-NUMBER-QUEUEP (ARRAY-ENQ ITEM QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-ENQ (ITEM ITEM)
                                            (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE FINITE-NUMBERP)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (NOT (ARRAY-QEMPTYP QUEUE)))
               (FINITE-NUMBER-QUEUEP (ARRAY-DEQ QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-DEQ (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (AND (NUMBERP (ARRAY-QFIRST QUEUE))
                           (LESSP (ARRAY-QFIRST QUEUE) '65536)))
             ((USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                     (CAPACITY '4)
                                                     (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (REMAINDER (ARRAY-QFIRST QUEUE)
                                        '65536)
                             (ARRAY-QFIRST QUEUE)))
             ((USE (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                               (CAPACITY '4)
                                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-IBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS))

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-IBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS))

(DEFN OS-IBUFFERS-ADDRESS-PLUS-QTAIL-FIELD
      NIL '244
      NIL)

(DEFN OS-IBUFFERS-ADDRESS-PLUS-QCURRLENGTH-FIELD NIL '245
      NIL)

(DEFN OS-IBUFFERS-ADDRESS-PLUS-QMAXLENGTH-FIELD NIL '246
      NIL)

(DEFN OS-IBUFFERS-ADDRESS-PLUS-QARRAY-FIELD NIL '247
      NIL)

(DEFN OS-CURRENT-IBUFFER
      (ID OS)
      (GETNTH ID
              (TABLE '8 (OS-IBUFFERS OS)))
      NIL)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (LESSP ID '16))
                    (FINITE-NUMBER-QUEUEP (GETNTH ID
                                                  (TABLE '8 (OS-IBUFFERS OS)))
                                          '4
                                          '65536))
           ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS
                    COMMUTATIVITY-OF-PLUS LENGTH-TABLE LENGTH-OS-IBUFFERS
                    FINITE-NUMBER-QUEUEP-GETNTH)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (AND (NOT (ARRAY-QEMPTYP QUEUE))
                                (FINITE-NUMBERP ITEM '65536)))
                      (FINITE-NUMBER-QUEUEP (ARRAY-QREPLACE ITEM QUEUE)
                                            '4
                                            '65536))
             ((USE (FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE (QUEUE QUEUE)
                                                        (ITEM ITEM)
                                                        (CAPACITY '4)
                                                        (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS)

(PROVE-LEMMA
 OS-IBUFFERS-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
  (LESSP I '16)
  (AND
   (EQUAL (LESSP (TIMES '8 I) '128)
          '*1*TRUE)
   (AND
    (EQUAL (LESSP '128 (PLUS '8 (TIMES '8 I)))
           '*1*FALSE)
    (AND
     (EQUAL (LESSP (TIMES '8 I) '65536)
            '*1*TRUE)
     (AND
      (EQUAL (LESSP (PLUS '243 (TIMES '8 I))
                    '65536)
             '*1*TRUE)
      (AND
       (EQUAL (LESSP (PLUS '244 (TIMES '8 I))
                     '65536)
              '*1*TRUE)
       (AND
         (EQUAL (LESSP (PLUS '245 (TIMES '8 I))
                       '65536)
                '*1*TRUE)
         (AND (EQUAL (LESSP (PLUS '246 (TIMES '8 I))
                            '65536)
                     '*1*TRUE)
              (AND (EQUAL (LESSP (PLUS '247 (TIMES '8 I))
                                 '65536)
                          '*1*TRUE)
                   (AND (EQUAL (LESSP (PLUS '1 (TIMES '8 I)) '128)
                               '*1*TRUE)
                        (AND (EQUAL (LESSP (PLUS '2 (TIMES '8 I)) '128)
                                    '*1*TRUE)
                             (AND (EQUAL (LESSP (PLUS '3 (TIMES '8 I)) '128)
                                         '*1*TRUE)
                                  (EQUAL (LESSP (PLUS '4 (TIMES '8 I)) '128)
                                         '*1*TRUE)))))))))))))
 ((ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-ADDRESS-FACTS)

(PROVE-LEMMA
 LESSP-PLUS-FACTS-FOR-IBUFFERS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (LESSP ID '16)))
  (AND
     (EQUAL (LESSP (PLUS '4
                         (PLUS (TIMES '8 ID)
                               (GETNTH '0
                                       (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS))))))
                   '128)
            '*1*TRUE)
     (EQUAL (LESSP (PLUS '247
                         (PLUS (TIMES '8 ID)
                               (GETNTH '0
                                       (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS))))))
                   '65536)
            '*1*TRUE)))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER COMMUTATIVITY-OF-PLUS
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-IBUFFERS
                                 (QUEUE (GETNTH ID
                                                (TABLE '8 (OS-IBUFFERS OS)))))
   (LESSP-QHEAD-QMAXLENGTH (QUEUE (GETNTH ID
                                          (TABLE '8 (OS-IBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACTS-FOR-IBUFFERS)

(PROVE-LEMMA
  INDEX-WITHIN-LENGTH-OF-IBUFFER
  (REWRITE)
  (IMPLIES (AND (IF (LESSP '4 I)
                    '*1*FALSE
                    '*1*TRUE)
                (FINITE-NUMBER-QUEUEP (GETNTH ID
                                              (TABLE '8 (OS-IBUFFERS OS)))
                                      '4
                                      '65536))
           (EQUAL (LESSP (PLUS I
                               (GETNTH '0
                                       (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS)))))
                         '8)
                  '*1*TRUE))
  ((ENABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-IBUFFERS
           ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS)
   (USE (LESSP-QHEAD-QMAXLENGTH (QUEUE (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS))))))
   (ENABLE-THEORY GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE INDEX-WITHIN-LENGTH-OF-IBUFFER)

(PROVE-LEMMA LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS) (LESSP ID '16))
                      (LESSP (GETNTH '3
                                     (GETNTH ID
                                             (TABLE '8 (OS-IBUFFERS OS))))
                             '65536))
             ((ENABLE COMMUTATIVITY-OF-TIMES COMMUTATIVITY-OF-PLUS
                      ASSOCIATIVITY-OF-PLUS CANONICALIZE-PLUS-TERMS2
                      FINITE-NUMBERP GETNTH-TABLE LENGTH-TABLE OS-IBUFFERS
                      LENGTH-GETSEG GETNTH-GETSEG)
              (USE (FINITE-NUMBERP-GETNTH (I (PLUS '246 (TIMES '8 ID)))
                                          (L (TM-MEMORY OS))
                                          (LUB '65536)))
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB)

(PROVE-LEMMA
 QREPLACE-ADDRESS-FACT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (AND
   (EQUAL
    (LESSP
     (PLUS '243
      (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
     '65536)
    '*1*TRUE)
   (AND
    (EQUAL
     (LESSP
      (PLUS '247
       (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
      '65536)
     '*1*TRUE)
    (EQUAL
     (LESSP
      (PLUS '4
       (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
      '128)
     '*1*TRUE))))
 ((ENABLE DECR-MOD-SIZE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          GOOD-TM-OS)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (USE
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (OS OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE QREPLACE-ADDRESS-FACT)

(PROVE-LEMMA
 MORE-IBUFFER-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (AND
   (EQUAL
    (LESSP
        (PLUS '243
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '65536)
    '*1*TRUE)
   (AND
    (EQUAL
     (LESSP
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '65536)
     '*1*TRUE)
    (EQUAL
     (LESSP
        (PLUS '4
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '128)
     '*1*TRUE))))
 ((ENABLE FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GOOD-TM-OS)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (USE
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (OS OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MORE-IBUFFER-ADDRESS-FACTS)

(PROVE-LEMMA ACCESS-CURRENT-IBUFFER
             (REWRITE)
             (IMPLIES (AND (LESSP ID '16) (LESSP I '8))
                      (EQUAL (GETNTH (PLUS I (TIMES '8 ID))
                                     (OS-IBUFFERS OS))
                             (GETNTH I
                                     (OS-CURRENT-IBUFFER ID OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-IBUFFERS
                      OS-CURRENT-IBUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-IBUFFER)

(PROVE-LEMMA
 CONTRACT-GETNTH-FROM-CURRENT-IBUFFER
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS '4
                      (GETNTH '0
                              (OS-CURRENT-IBUFFER ID OS)))
                '8)
         (LESSP ID '16))
    (EQUAL (GETNTH (PLUS '4
                         (PLUS (TIMES '8 ID)
                               (GETNTH '0
                                       (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS))))))
                   (OS-IBUFFERS OS))
           (GETNTH (PLUS '4
                         (GETNTH '0
                                 (OS-CURRENT-IBUFFER ID OS)))
                   (OS-CURRENT-IBUFFER ID OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY2-OF-PLUS
          COMMUTATIVITY-OF-TIMES GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG
          LENGTH-OS-IBUFFERS OS-CURRENT-IBUFFER
          PUTNTH-PUTSEG-COINCIDENCE-INVERSE PUTSEG-GETSEG-COINCIDENCE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-GETNTH-FROM-CURRENT-IBUFFER)

(PROVE-LEMMA ACCESS-CURRENT-IBUFFER-QHEAD
             (REWRITE)
             (IMPLIES (LESSP ID '16)
                      (EQUAL (GETNTH (TIMES '8 ID)
                                     (OS-IBUFFERS OS))
                             (GETNTH '0
                                     (OS-CURRENT-IBUFFER ID OS))))
             ((ENABLE OS-CURRENT-IBUFFER GETNTH-TABLE LENGTH-TABLE
                      LENGTH-OS-IBUFFERS GETNTH-GETSEG COMMUTATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-IBUFFER-QHEAD)

(PROVE-LEMMA CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (LESSP I '4) (LESSP ID '16)))
                      (EQUAL (PUTNTH VALUE
                                     (PLUS I (TIMES '8 ID))
                                     (OS-IBUFFERS OS))
                             (PUTSEG (PUTNTH VALUE I
                                             (OS-CURRENT-IBUFFER ID OS))
                                     (TIMES '8 ID)
                                     (OS-IBUFFERS OS))))
             ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS
                      COMMUTATIVITY-OF-TIMES GETNTH-GETSEG GETNTH-TABLE
                      LENGTH-GETSEG LENGTH-OS-IBUFFERS OS-CURRENT-IBUFFER
                      PUTNTH-PUTSEG-COINCIDENCE-INVERSE
                      PUTSEG-GETSEG-COINCIDENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER)

(PROVE-LEMMA
 CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1
 (REWRITE)
 (IMPLIES
  (AND (LESSP (PLUS I
                    (DECR-MOD (GETNTH '1
                                      (OS-CURRENT-IBUFFER ID OS))
                              '4))
              '8)
       (LESSP ID '16))
  (EQUAL
   (PUTNTH VALUE
           (PLUS I
                 (PLUS (TIMES '8 ID)
                       (DECR-MOD (GETNTH '1
                                         (GETNTH ID
                                                 (TABLE '8 (OS-IBUFFERS OS))))
                                 '4)))
           (OS-IBUFFERS OS))
   (PUTSEG (PUTNTH VALUE
                   (PLUS I
                         (DECR-MOD (GETNTH '1
                                           (OS-CURRENT-IBUFFER ID OS))
                                   '4))
                   (OS-CURRENT-IBUFFER ID OS))
           (TIMES '8 ID)
           (OS-IBUFFERS OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG LENGTH-OS-IBUFFERS
          OS-CURRENT-IBUFFER PUTNTH-PUTSEG-COINCIDENCE-INVERSE
          PUTSEG-GETSEG-COINCIDENCE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1)

(PROVE-LEMMA
 CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS I
                      (GETNTH '1
                              (OS-CURRENT-IBUFFER ID OS)))
                '8)
         (LESSP ID '16))
    (EQUAL (PUTNTH VALUE
                   (PLUS I
                         (PLUS (TIMES '8 ID)
                               (GETNTH '1
                                       (GETNTH ID
                                               (TABLE '8 (OS-IBUFFERS OS))))))
                   (OS-IBUFFERS OS))
           (PUTSEG (PUTNTH VALUE
                           (PLUS I
                                 (GETNTH '1
                                         (OS-CURRENT-IBUFFER ID OS)))
                           (OS-CURRENT-IBUFFER ID OS))
                   (TIMES '8 ID)
                   (OS-IBUFFERS OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG LENGTH-OS-IBUFFERS
          OS-CURRENT-IBUFFER PUTNTH-PUTSEG-COINCIDENCE-INVERSE
          PUTSEG-GETSEG-COINCIDENCE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2)

(DEFN OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
      (OS)
      (PUTSEG (ARRAY-DEQ (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                             OS))
              (TIMES '8 (OS-CURRENT-TASKID OS))
              (OS-IBUFFERS OS))
      NIL)

(PROVE-LEMMA LENGTH-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS))
                    '128)
             ((ENABLE OS-IBUFFERS-WITH-DEQUEUED-CHARACTER LENGTH-OS-IBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER)

(PROVE-LEMMA PLISTP-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
             (REWRITE)
             (PLISTP (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS))
             ((ENABLE OS-IBUFFERS-WITH-DEQUEUED-CHARACTER PLISTP-PUTSEG
                      PLISTP-OS-IBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER)

(DEFN
 OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
 (OS)
 (PUTSEG
  (ARRAY-QREPLACE
   (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
   (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
           (TABLE '8 (OS-IBUFFERS OS))))
  (TIMES '8
         (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
  (OS-IBUFFERS OS))
 NIL)

(PROVE-LEMMA LENGTH-OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS))
                    '128)
             ((ENABLE OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      LENGTH-OS-IBUFFERS LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)

(PROVE-LEMMA PLISTP-OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
             (REWRITE)
             (PLISTP (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS))
             ((ENABLE OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      PLISTP-PUTSEG PLISTP-OS-IBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)

(DEFN
 OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
 (OS)
 (PUTSEG
  (ARRAY-ENQ
   (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
   (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
           (TABLE '8 (OS-IBUFFERS OS))))
  (TIMES '8
         (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
  (OS-IBUFFERS OS))
 NIL)

(PROVE-LEMMA LENGTH-OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS))
                    '128)
             ((ENABLE OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      LENGTH-OS-IBUFFERS LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)

(PROVE-LEMMA PLISTP-OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
             (REWRITE)
             (PLISTP (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS))
             ((ENABLE OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      PLISTP-PUTSEG PLISTP-OS-IBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)

(DEFN
 OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
 (OS)
 (PUTSEG
       (ARRAY-ENQ (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
                  (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '8 (OS-IBUFFERS OS))))
       (TIMES '8
              (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
       (OS-IBUFFERS OS))
 NIL)

(PROVE-LEMMA LENGTH-OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS))
                    '128)
             ((ENABLE OS-IBUFFERS-WITH-ENQUEUED-CHARACTER LENGTH-OS-IBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-IBUFFERS-WITH-ENQUEUED-CHARACTER)

(PROVE-LEMMA PLISTP-OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
             (REWRITE)
             (PLISTP (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS))
             ((ENABLE OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-PUTSEG
                      PLISTP-OS-IBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-IBUFFERS-WITH-ENQUEUED-CHARACTER)

(PROVE-LEMMA
            MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP ID '16))
                     (EQUAL (MAPUP-QUEUE (GETNTH ID
                                                 (TABLE '8 (OS-IBUFFERS OS))))
                            (GETNTH ID (MAPUP-OS-IBUFFERS OS))))
            ((ENABLE MAPUP-OS-IBUFFERS LENGTH-TABLE LENGTH-OS-IBUFFERS)
             (USE (MAPUP-QUEUE-GETNTH (L (TABLE '8 (OS-IBUFFERS OS)))
                                      (CAPACITY '4)
                                      (LUB '65536)))
             (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-GETNTH-FOR-IBUFFERS)

(PROVE-LEMMA LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (LENGTH QUEUE) '8))
             ((USE (LENGTH-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (PLISTP QUEUE))
             ((USE (PLISTP-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                               (CAPACITY '4)
                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (ARRAY-QUEUEP QUEUE))
             ((ENABLE FINITE-NUMBER-QUEUEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '0 QUEUE))
                           (LESSP (GETNTH '0 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QHEAD-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '1 QUEUE))
                           (LESSP (GETNTH '1 QUEUE) '4)))
             ((USE (FINITE-NUMBER-QUEUE-QTAIL-SIZE (QUEUE QUEUE)
                                                   (CAPACITY '4)
                                                   (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (AND (NUMBERP (GETNTH '2 QUEUE))
                           (LESSP (GETNTH '2 QUEUE) '5)))
             ((USE (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (FINITE-NUMBER-QUEUEP QUEUE '4
                                            '65536)
                      (EQUAL (GETNTH '3 QUEUE) '4))
             ((USE (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE (QUEUE QUEUE)
                                                         (CAPACITY '4)
                                                         (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (AND (NOT (ARRAY-QFULLP QUEUE))
                         (AND (NUMBERP ITEM)
                              (LESSP ITEM '65536))))
               (FINITE-NUMBER-QUEUEP (ARRAY-ENQ ITEM QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-ENQ (ITEM ITEM)
                                            (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE FINITE-NUMBERP)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      (REWRITE)
      (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                          '65536)
                    (NOT (ARRAY-QEMPTYP QUEUE)))
               (FINITE-NUMBER-QUEUEP (ARRAY-DEQ QUEUE)
                                     '4
                                     '65536))
      ((USE (FINITE-NUMBER-QUEUEP-ARRAY-DEQ (QUEUE QUEUE)
                                            (CAPACITY '4)
                                            (LUB '65536)))
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE
     FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (AND (NUMBERP (ARRAY-QFIRST QUEUE))
                           (LESSP (ARRAY-QFIRST QUEUE) '65536)))
             ((USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                     (CAPACITY '4)
                                                     (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(PROVE-LEMMA REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
             (REWRITE)
             (IMPLIES (AND (FINITE-NUMBER-QUEUEP QUEUE '4
                                                 '65536)
                           (NOT (ARRAY-QEMPTYP QUEUE)))
                      (EQUAL (REMAINDER (ARRAY-QFIRST QUEUE)
                                        '65536)
                             (ARRAY-QFIRST QUEUE)))
             ((USE (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE (QUEUE QUEUE)
                                                               (CAPACITY '4)
                                                               (LUB '65536)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-OBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS))

(DEFTHEORY
 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
 (REMAINDER-ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QTAIL-SIZE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBER-QUEUE-QHEAD-SIZE-COROLLARY-FOR-OBUFFERS
      ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      PLISTP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      LENGTH-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS))

(DEFN OS-OBUFFERS-ADDRESS-PLUS-QTAIL-FIELD
      NIL '372
      NIL)

(DEFN OS-OBUFFERS-ADDRESS-PLUS-QCURRLENGTH-FIELD NIL '373
      NIL)

(DEFN OS-OBUFFERS-ADDRESS-PLUS-QMAXLENGTH-FIELD NIL '374
      NIL)

(DEFN OS-OBUFFERS-ADDRESS-PLUS-QARRAY-FIELD NIL '375
      NIL)

(DEFN OS-CURRENT-OBUFFER
      (ID OS)
      (GETNTH ID
              (TABLE '8 (OS-OBUFFERS OS)))
      NIL)

(PROVE-LEMMA FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (LESSP ID '16))
                    (FINITE-NUMBER-QUEUEP (GETNTH ID
                                                  (TABLE '8 (OS-OBUFFERS OS)))
                                          '4
                                          '65536))
           ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS
                    COMMUTATIVITY-OF-PLUS LENGTH-TABLE LENGTH-OS-OBUFFERS
                    FINITE-NUMBER-QUEUEP-GETNTH)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER)

(PROVE-LEMMA
 OS-OBUFFERS-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
  (LESSP I '16)
  (AND
   (EQUAL (LESSP (TIMES '8 I) '65536)
          '*1*TRUE)
   (AND
    (EQUAL (LESSP (PLUS '371 (TIMES '8 I))
                  '65536)
           '*1*TRUE)
    (AND
     (EQUAL (LESSP (PLUS '372 (TIMES '8 I))
                   '65536)
            '*1*TRUE)
     (AND
         (EQUAL (LESSP (PLUS '373 (TIMES '8 I))
                       '65536)
                '*1*TRUE)
         (AND (EQUAL (LESSP (PLUS '374 (TIMES '8 I))
                            '65536)
                     '*1*TRUE)
              (AND (EQUAL (LESSP (PLUS '375 (TIMES '8 I))
                                 '65536)
                          '*1*TRUE)
                   (AND (EQUAL (LESSP (PLUS '1 (TIMES '8 I)) '128)
                               '*1*TRUE)
                        (AND (EQUAL (LESSP (PLUS '2 (TIMES '8 I)) '128)
                                    '*1*TRUE)
                             (AND (EQUAL (LESSP (PLUS '3 (TIMES '8 I)) '128)
                                         '*1*TRUE)
                                  (EQUAL (LESSP (PLUS '4 (TIMES '8 I)) '128)
                                         '*1*TRUE)))))))))))
 ((ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-ADDRESS-FACTS)

(PROVE-LEMMA
 LESSP-PLUS-FACTS-FOR-OBUFFERS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (LESSP ID '16)))
  (AND
     (EQUAL (LESSP (PLUS '4
                         (PLUS (TIMES '8 ID)
                               (GETNTH '1
                                       (GETNTH ID
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   '128)
            '*1*TRUE)
     (EQUAL (LESSP (PLUS '375
                         (PLUS (TIMES '8 ID)
                               (GETNTH '1
                                       (GETNTH ID
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   '65536)
            '*1*TRUE)))
 ((ENABLE FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER COMMUTATIVITY-OF-PLUS
          ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS)
  (USE
   (FINITE-NUMBER-QUEUE-QMAXLENGTH-VALUE-COROLLARY-FOR-OBUFFERS
                                 (QUEUE (GETNTH ID
                                                (TABLE '8 (OS-OBUFFERS OS)))))
   (LESSP-QTAIL-QMAXLENGTH (QUEUE (GETNTH ID
                                          (TABLE '8 (OS-OBUFFERS OS))))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE LESSP-PLUS-FACTS-FOR-OBUFFERS)

(PROVE-LEMMA LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS) (LESSP ID '16))
                      (LESSP (GETNTH '3
                                     (GETNTH ID
                                             (TABLE '8 (OS-OBUFFERS OS))))
                             '65536))
             ((ENABLE COMMUTATIVITY-OF-TIMES COMMUTATIVITY-OF-PLUS
                      ASSOCIATIVITY-OF-PLUS CANONICALIZE-PLUS-TERMS2
                      FINITE-NUMBERP GETNTH-TABLE LENGTH-TABLE OS-OBUFFERS
                      LENGTH-GETSEG GETNTH-GETSEG)
              (USE (FINITE-NUMBERP-GETNTH (I (PLUS '374 (TIMES '8 ID)))
                                          (L (TM-MEMORY OS))
                                          (LUB '65536)))
              (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB)

(PROVE-LEMMA
 OBUFFER-ADDRESS-FACTS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (EQUAL
   (LESSP
       (PLUS '375
             (PLUS (TIMES '8
                          (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                   (GETNTH '0
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))))
       '65536)
   '*1*TRUE))
 ((ENABLE FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK GOOD-TM-OS)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (USE
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE OBUFFER-ADDRESS-FACTS)

(PROVE-LEMMA ACCESS-CURRENT-OBUFFER
             (REWRITE)
             (IMPLIES (AND (LESSP ID '16) (LESSP I '8))
                      (EQUAL (GETNTH (PLUS I (TIMES '8 ID))
                                     (OS-OBUFFERS OS))
                             (GETNTH I
                                     (OS-CURRENT-OBUFFER ID OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-OBUFFERS
                      OS-CURRENT-OBUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-OBUFFER)

(PROVE-LEMMA
 CONTRACT-GETNTH-FROM-CURRENT-OBUFFER
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS '4
                      (GETNTH '1
                              (OS-CURRENT-OBUFFER ID OS)))
                '8)
         (LESSP ID '16))
    (EQUAL (GETNTH (PLUS '4
                         (PLUS (TIMES '8 ID)
                               (GETNTH '1
                                       (GETNTH ID
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   (OS-OBUFFERS OS))
           (GETNTH (PLUS '4
                         (GETNTH '1
                                 (OS-CURRENT-OBUFFER ID OS)))
                   (OS-CURRENT-OBUFFER ID OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY2-OF-PLUS
          COMMUTATIVITY-OF-TIMES GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG
          LENGTH-OS-OBUFFERS OS-CURRENT-OBUFFER
          PUTNTH-PUTSEG-COINCIDENCE-INVERSE PUTSEG-GETSEG-COINCIDENCE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-GETNTH-FROM-CURRENT-OBUFFER)

(PROVE-LEMMA
 CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS I
                      (GETNTH '1
                              (OS-CURRENT-OBUFFER ID OS)))
                '8)
         (LESSP ID '16))
    (EQUAL (PUTNTH VALUE
                   (PLUS I
                         (PLUS (TIMES '8 ID)
                               (GETNTH '1
                                       (GETNTH ID
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   (OS-OBUFFERS OS))
           (PUTSEG (PUTNTH VALUE
                           (PLUS I
                                 (GETNTH '1
                                         (OS-CURRENT-OBUFFER ID OS)))
                           (OS-CURRENT-OBUFFER ID OS))
                   (TIMES '8 ID)
                   (OS-OBUFFERS OS))))
 ((ENABLE ASSOCIATIVITY-OF-PLUS COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-GETSEG LENGTH-OS-OBUFFERS
          OS-CURRENT-OBUFFER PUTNTH-PUTSEG-COINCIDENCE-INVERSE
          PUTSEG-GETSEG-COINCIDENCE RE-ASSOCIATE-TIMES1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER)

(PROVE-LEMMA CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1
             (REWRITE)
             (IMPLIES (AND (NUMBERP I)
                           (AND (LESSP I '4) (LESSP ID '16)))
                      (EQUAL (PUTNTH VALUE
                                     (PLUS I (TIMES '8 ID))
                                     (OS-OBUFFERS OS))
                             (PUTSEG (PUTNTH VALUE I
                                             (OS-CURRENT-OBUFFER ID OS))
                                     (TIMES '8 ID)
                                     (OS-OBUFFERS OS))))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-GETSEG
                      LENGTH-OS-OBUFFERS OS-CURRENT-OBUFFER
                      PUTNTH-PUTSEG-COINCIDENCE-INVERSE
                      PUTSEG-GETSEG-COINCIDENCE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1)

(PROVE-LEMMA
 CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1
 (REWRITE)
 (IMPLIES
    (AND (LESSP (PLUS '4
                      (GETNTH '0
                              (OS-CURRENT-OBUFFER ID OS)))
                '8)
         (LESSP ID '16))
    (EQUAL (GETNTH (PLUS '4
                         (PLUS (TIMES '8 ID)
                               (GETNTH '0
                                       (GETNTH ID
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   (OS-OBUFFERS OS))
           (GETNTH (PLUS '4
                         (GETNTH '0
                                 (OS-CURRENT-OBUFFER ID OS)))
                   (OS-CURRENT-OBUFFER ID OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES COMMUTATIVITY2-OF-PLUS
          GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-OBUFFERS OS-CURRENT-OBUFFER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1)

(PROVE-LEMMA ACCESS-CURRENT-OBUFFER-QHEAD
             (REWRITE)
             (IMPLIES (LESSP ID '16)
                      (EQUAL (GETNTH (TIMES '8 ID)
                                     (OS-OBUFFERS OS))
                             (GETNTH '0
                                     (OS-CURRENT-OBUFFER ID OS))))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
                      GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-OBUFFERS
                      OS-CURRENT-OBUFFER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE ACCESS-CURRENT-OBUFFER-QHEAD)

(DEFN OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
      (OS)
      (PUTSEG (ARRAY-ENQ (GETNTH '3 (TM-REGS OS))
                         (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                             OS))
              (TIMES '8 (OS-CURRENT-TASKID OS))
              (OS-OBUFFERS OS))
      NIL)

(PROVE-LEMMA LENGTH-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS))
                    '128)
             ((ENABLE OS-OBUFFERS-WITH-ENQUEUED-CHARACTER LENGTH-OS-OBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)

(PROVE-LEMMA PLISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
             (REWRITE)
             (PLISTP (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS))
             ((ENABLE OS-OBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-PUTSEG
                      PLISTP-OS-OBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)

(DEFN
 OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
 (OS)
 (PUTSEG
    (ARRAY-DEQ (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
    (TIMES '8
           (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
    (OS-OBUFFERS OS))
 NIL)

(PROVE-LEMMA LENGTH-OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS))
                    '128)
             ((ENABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER LENGTH-OS-OBUFFERS
                      LENGTH-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)

(PROVE-LEMMA PLISTP-OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
             (REWRITE)
             (PLISTP (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS))
             ((ENABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER PLISTP-PUTSEG
                      PLISTP-OS-OBUFFERS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)

(PROVE-LEMMA
  RESTORE-REGS
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (GETSEG '0
                          '8
                          (GETSEG (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS)))
                                  '9
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS))))
                  (TM-REGS OS)))
  ((ENABLE COMMUTATIVITY-OF-PLUS CPU-REGS-SEGMENT DIFFERENCE-X-X GETSEG-GETSEG
           GETSEG-WITHIN-PUTSEG LENGTH-OS-TASK-TABLE LENGTH-TM-CPU)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE RESTORE-REGS)

(PROVE-LEMMA RESTORE-REGS1
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (NOT (TM-WAITING OS)))
    (EQUAL (GETSEG '0
                   '8
                   (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                           (TABLE '9
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS)))))
           (TM-REGS OS)))
 ((ENABLE COMMUTATIVITY-OF-PLUS CPU-REGS-SEGMENT DIFFERENCE-X-X GETSEG-GETSEG
          GETNTH-TABLE COMMUTATIVITY-OF-TIMES LENGTH-PUTSEG
          GETSEG-WITHIN-PUTSEG LENGTH-OS-TASK-TABLE LENGTH-TM-CPU)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE RESTORE-REGS1)

(PROVE-LEMMA RESTORE-CC
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (REMAINDER (GETNTH (PLUS '8
                                        (TIMES '9
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS)))
                          '4)
               (TM-CC OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTSEG-COINCIDENCE
          GETNTH-TM-REGLENGTH-TM-CPU LENGTH-OS-TASK-TABLE LENGTH-TM-CPU
          TM-UNPACK-CC)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-CC-TM-PACK-PSW (CC (TM-CC OS))
                                 (ERROR (TM-ERROR OS))
                                 (SVCFLAG (TM-SVCFLAG OS))
                                 (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-CC)

(PROVE-LEMMA RESTORE-ERROR
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
     (QUOTIENT (REMAINDER (GETNTH (PLUS '8
                                        (TIMES '9
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS)))
                          '256)
               '4)
     (TM-ERROR OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTSEG-COINCIDENCE
          GETNTH-TM-REGLENGTH-TM-CPU LENGTH-OS-TASK-TABLE LENGTH-TM-CPU
          TM-UNPACK-ERROR)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-ERROR-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-ERROR)

(PROVE-LEMMA RESTORE-SVCFLAG
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
     (QUOTIENT (REMAINDER (GETNTH (PLUS '8
                                        (TIMES '9
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS)))
                          '512)
               '256)
     (TM-SVCFLAG OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTSEG-COINCIDENCE
          GETNTH-TM-REGLENGTH-TM-CPU LENGTH-OS-TASK-TABLE LENGTH-TM-CPU
          TM-UNPACK-SVCFLAG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-SVCFLAG-TM-PACK-PSW (CC (TM-CC OS))
                                      (ERROR (TM-ERROR OS))
                                      (SVCFLAG (TM-SVCFLAG OS))
                                      (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-SVCFLAG)

(PROVE-LEMMA RESTORE-SVCID
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (QUOTIENT (GETNTH (PLUS '8
                                        (TIMES '9
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  (PUTSEG (TM-CPU OS)
                                          (TIMES '9
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (OS-TASK-TABLE OS)))
                          '512)
                (TM-SVCID OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTSEG-COINCIDENCE
          GETNTH-TM-REGLENGTH-TM-CPU LENGTH-OS-TASK-TABLE LENGTH-TM-CPU
          TM-UNPACK-SVCID)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-SVCID-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-SVCID)

(DEFN OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
      (OS)
      (PUTSEG (PUTNTH (ARRAY-QFIRST (GETNTH (OS-CURRENT-TASKID OS)
                                            (TABLE '8 (OS-IBUFFERS OS))))
                      '3
                      (TM-CPU OS))
              (TIMES '9
                     (ARRAY-QFIRST (OS-READYQ OS)))
              (OS-TASK-TABLE OS))
      NIL)

(PROVE-LEMMA LENGTH-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
             (REWRITE)
             (EQUAL (LENGTH (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
                    '144)
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER LENGTH-PUTSEG
                      LENGTH-OS-TASK-TABLE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER)

(PROVE-LEMMA PLISTP-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
             (REWRITE)
             (PLISTP (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      PLISTP-OS-TASK-TABLE PLISTP-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER)

(PROVE-LEMMA
 RESTORE-REGS-FOR-TYI-SVC-RETURN
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (EQUAL (GETSEG '0
                  '8
                  (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                          (TABLE '9
                                 (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))))
          (PUTNTH (ARRAY-QFIRST (GETNTH (OS-CURRENT-TASKID OS)
                                        (TABLE '8 (OS-IBUFFERS OS))))
                  '3
                  (TM-REGS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES CPU-REGS-SEGMENT
          DIFFERENCE-X-X GETNTH-TABLE GETSEG-GETSEG GETSEG-PUTNTH-COINCIDENCE
          GETSEG-WITHIN-PUTSEG LENGTH-GETSEG LENGTH-OS-IBUFFERS
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-PUTSEG LENGTH-TM-CPU
          OS-CURRENT-TASKID OS-TASK-TABLE-WITH-DELIVERED-CHARACTER)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE RESTORE-REGS-FOR-TYI-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-CC-FOR-TYI-SVC-RETURN
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (REMAINDER (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
                           '4)
                (TM-CC OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-CHARACTER TM-UNPACK-CC)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-CC-TM-PACK-PSW (CC (TM-CC OS))
                                 (ERROR (TM-ERROR OS))
                                 (SVCFLAG (TM-SVCFLAG OS))
                                 (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-CC-FOR-TYI-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-ERROR-FOR-TYI-SVC-RETURN
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
      (QUOTIENT (REMAINDER (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
                           '256)
                '4)
      (TM-ERROR OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-CHARACTER TM-UNPACK-ERROR)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-ERROR-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-ERROR-FOR-TYI-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-SVCID-FOR-TYI-SVC-RETURN
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (EQUAL (QUOTIENT (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
                           '512)
                 (TM-SVCID OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-CHARACTER TM-UNPACK-SVCID)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-SVCID-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-SVCID-FOR-TYI-SVC-RETURN)

(DEFN
 OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
 (OS)
 (PUTSEG
  (PUTNTH
        (ARRAY-QFIRST (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS))))
        '3
        (TM-CPU OS))
  (TIMES '9
         (ARRAY-QFIRST (OS-READYQ OS)))
  (OS-TASK-TABLE OS))
 NIL)

(PROVE-LEMMA LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
             (REWRITE)
             (EQUAL (LENGTH (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
                    '144)
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE LENGTH-PUTSEG
                      LENGTH-OS-TASK-TABLE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)

(PROVE-LEMMA PLISTP-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
             (REWRITE)
             (PLISTP (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      PLISTP-OS-TASK-TABLE PLISTP-PUTSEG)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE PLISTP-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)

(PROVE-LEMMA
 RESTORE-REGS-FOR-RECEIVE-SVC-RETURN
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (NOT (TM-WAITING OS)))
     (EQUAL (GETSEG '0
                    '8
                    (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                            (TABLE '9
                                   (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))))
            (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                      (OS-CURRENT-TASKID OS)
                                                      OS))
                    '3
                    (TM-REGS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES CPU-REGS-SEGMENT
          DIFFERENCE-X-X GETNTH-TABLE GETSEG-GETSEG GETSEG-PUTNTH-COINCIDENCE
          GETSEG-WITHIN-PUTSEG LENGTH-GETSEG LENGTH-OS-MBUFFERS
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-PUTSEG LENGTH-TM-CPU
          LESSP-REMAINDER2 OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-MBUFFERS-ADDRESS-FACTS3 OS-SRCID
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE TM-R2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE RESTORE-REGS-FOR-RECEIVE-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-CC-FOR-RECEIVE-SVC-RETURN
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (REMAINDER (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
                           '4)
                (TM-CC OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE TM-UNPACK-CC)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-CC-TM-PACK-PSW (CC (TM-CC OS))
                                 (ERROR (TM-ERROR OS))
                                 (SVCFLAG (TM-SVCFLAG OS))
                                 (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-CC-FOR-RECEIVE-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-ERROR-FOR-RECEIVE-SVC-RETURN
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
      (QUOTIENT (REMAINDER (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
                           '256)
                '4)
      (TM-ERROR OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE TM-UNPACK-ERROR)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-ERROR-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-ERROR-FOR-RECEIVE-SVC-RETURN)

(PROVE-LEMMA
 RESTORE-SVCID-FOR-RECEIVE-SVC-RETURN
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (EQUAL (QUOTIENT (GETNTH (PLUS '8
                                         (TIMES '9
                                                (ARRAY-QFIRST (OS-READYQ OS))))
                                   (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
                           '512)
                 (TM-SVCID OS)))
 ((ENABLE DIFFERENCE-PLUS4 GETNTH-PUTNTH-NON-INTERFERENCE
          GETNTH-PUTSEG-COINCIDENCE GETNTH-TM-REGLENGTH-TM-CPU
          LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE TM-UNPACK-SVCID)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-UNPACK-SVCID-TM-PACK-PSW (CC (TM-CC OS))
                                    (ERROR (TM-ERROR OS))
                                    (SVCFLAG (TM-SVCFLAG OS))
                                    (SVCID (TM-SVCID OS))))
  (DISABLE-THEORY T)))

(DISABLE RESTORE-SVCID-FOR-RECEIVE-SVC-RETURN)

(DEFTHEORY EXECUTABLE-FNS
           (*1*GREATERP *1*LEQ *1*GEQ *1*MEMBER *1*IFF *1*ORD-LESSP
                        *1*ORDINALP *1*ASSOC *1*PAIRLIST *1*SUBRP
                        *1*APPLY-SUBR *1*FORMALS *1*BODY *1*FIX-COST
                        *1*STRIP-CARS *1*SUM-CDRS *1*V&C$ *1*V&C-APPLY$
                        *1*EVAL$ *1*QUANTIFIER-INITIAL-VALUE *1*ADD-TO-SET
                        *1*APPEND *1*MAX *1*UNION *1*QUANTIFIER-OPERATION
                        *1*FOR *1*EXP *1*DIVIDES *1*NUMBER-AND-LIST-INDUCTION
                        *1*DOUBLE-NUMBER-INDUCTION
                        *1*DOUBLE-NUMBER-DOUBLE-LIST-INDUCTION
                        *1*LESSP-QUOTIENT-INDUCTION *1*MIN
                        *1*LESSP-QUOTIENT-QUOTIENT-INDUCTION *1*LENGTH
                        *1*INSERT *1*OCCURRENCES *1*REMOVE *1*PERMUTATION
                        *1*PLISTP *1*SETP *1*SORTED
                        *1*TRANSITIVITY-OF-PERMUTATION-INDUCTION
                        *1*SETP-PERMUTATION-INDUCTION *1*GETNTH *1*PUTNTH
                        *1*GETSEG *1*PUTSEG *1*FIXLENGTH *1*FIRSTN *1*NTHCDR
                        *1*GETNTH-GETSEG-INDUCTION
                        *1*INTEGER-INDUCTION-INSTANCE
                        *1*GETSEG-PUTSEG-INDUCTION *1*NESTED-INTERVALS
                        *1*STRANGE-INDUCTION *1*GETNTH2 *1*PUTNTH2 *1*REVERSE
                        *1*FINITE-NUMBERP *1*NUMBER-LISTP
                        *1*FINITE-NUMBER-LISTP *1*NON-ZERO-LISTP *1*TABLEP
                        *1*TABLE *1*FLATTEN *1*INTEGER-NTHCDR-INDUCTION
                        *1*FINITE-NUMBER-TABLEP *1*NONLAST *1*INCR-MOD
                        *1*DECR-MOD *1*QFIRST *1*ENQ *1*DEQ *1*QEMPTYP
                        *1*QFULLP *1*QREPLACE *1*QHEAD-FIELD *1*QTAIL-FIELD
                        *1*QCURRLENGTH-FIELD *1*QMAXLENGTH-FIELD
                        *1*QARRAY-FIELD *1*DELTA *1*ARRAY-QINDEX-RELATION
                        *1*ARRAY-QUEUEP *1*ARRAY-ENQ *1*ARRAY-DEQ
                        *1*ARRAY-QFIRST *1*ARRAY-QFULLP *1*ARRAY-QEMPTYP
                        *1*ARRAY-NONLAST *1*ARRAY-QREPLACE *1*DELTA-SEGMENT
                        *1*MAPUP-QUEUE *1*QFIRST2 *1*ENQ2 *1*DEQ2 *1*QFULLP2
                        *1*QEMPTYP2 *1*TM-WORDSIZE *1*TM-WORDLUB *1*ALU-RESULT
                        *1*ALU-VALUE *1*ALU-CARRY *1*TM-ALU-DECR
                        *1*TM-ALU-DECR-MOD *1*TM-ALU-DIFFERENCE *1*TM-ALU-INCR
                        *1*TM-ALU-INCR-MOD *1*TM-ALU-MOD *1*TM-ALU-MULT
                        *1*TM-ALU-PLUS *1*TM-INCR *1*TM-INCRN *1*TM-DECR
                        *1*TM-SHELLP *1*TM-MEMORY *1*TM-REGS *1*TM-CC
                        *1*TM-ERROR *1*TM-SVCFLAG *1*TM-SVCID *1*TM-BASE
                        *1*TM-LIMIT *1*TM-SLIMIT *1*TM-SVMODE *1*TM-RWSTATE
                        *1*TM-CLOCK *1*TM-IPORTS *1*TM-OPORTS *1*TM-REGSIZE
                        *1*TM-CHARSIZE *1*TM-CCSIZE *1*TM-ERRORSIZE
                        *1*TM-SVCFLAGSIZE *1*TM-SVCIDSIZE *1*TM-CCLUB
                        *1*TM-ERRORLUB *1*TM-SVCFLAGLUB *1*TM-SVCIDLUB
                        *1*TM-REGLENGTH *1*TM-MEMLENGTH *1*TM-CHARLUB
                        *1*TM-PORT-LENGTH *1*TM-PC-ADDRESS *1*TM-SP-ADDRESS
                        *1*TM-SET-MEMORY *1*TM-SET-REGS *1*TM-SET-CC
                        *1*TM-SET-ERROR *1*TM-SET-SVCFLAG *1*TM-SET-SVCID
                        *1*TM-SET-BASE *1*TM-SET-LIMIT *1*TM-SET-SLIMIT
                        *1*TM-SET-SVMODE *1*TM-SET-RWSTATE *1*TM-SET-CLOCK
                        *1*TM-SET-IPORTS *1*TM-SET-OPORTS *1*TM-PC
                        *1*TM-SET-PC *1*TM-SP *1*TM-SET-SP
                        *1*TM-NON-ZERO-NO-CARRY-CONDITION
                        *1*TM-ZERO-NO-CARRY-CONDITION
                        *1*TM-NON-ZERO-CARRY-CONDITION
                        *1*TM-ZERO-CARRY-CONDITION *1*TM-CC-VALUE
                        *1*TM-CC-DIVISOR *1*TM-ERROR-DIVISOR
                        *1*TM-SVCFLAG-DIVISOR *1*TM-PACK-PSW *1*TM-UNPACK-CC
                        *1*TM-UNPACK-ERROR *1*TM-UNPACK-SVCFLAG
                        *1*TM-UNPACK-SVCID *1*TM-REGISTER-SAVE-AREA-ADDR
                        *1*TM-CLOCK-NEW-PC-ADDR *1*TM-ERROR-NEW-PC-ADDR
                        *1*TM-SVC-NEW-PC-ADDR *1*TM-INPUT-NEW-PC-ADDR
                        *1*TM-OUTPUT-NEW-PC-ADDR *1*TM-SVCID-ADDR
                        *1*TM-INPUT-DEVID-ADDR *1*TM-INPUT-CHAR-ADDR
                        *1*TM-OUTPUT-DEVID-ADDR *1*TM-NO-ERROR
                        *1*TM-HALT-STATUS *1*TM-OPCODE-ERROR
                        *1*TM-PRIVILEGE-ERROR *1*TM-STACK-OVERFLOW-ERROR
                        *1*TM-STACK-UNDERFLOW-ERROR *1*TM-ADDRESS-ERROR
                        *1*TM-PC-ADDRESS-ERROR *1*TM-SUPERVISOR-MODE
                        *1*TM-USER-MODE *1*TM-IN-SUPERVISOR-MODE
                        *1*TM-WAIT-STATE *1*TM-RUN-STATE *1*TM-WAITING
                        *1*TM-SVC *1*TM-NO-SVC *1*TM-CLEARED-SVCFLAG
                        *1*TM-IPORTP *1*TM-IINTERRUPT-FLAG *1*TM-IERROR-FLAG
                        *1*TM-ICHAR *1*TM-OPORTP *1*TM-OINTERRUPT-FLAG
                        *1*TM-OBUSY-FLAG *1*TM-OCHAR *1*TM-IPORT-ERRORP
                        *1*TM-CLEAR-INPUT-INTERRUPT *1*TM-POST-INPUT-INTERRUPT
                        *1*TM-OPORT-IDLEP *1*TM-START-OUTPUT
                        *1*TM-POST-OUTPUT-INTERRUPT
                        *1*TM-CLEAR-OUTPUT-INTERRUPT *1*REAL-ADDR
                        *1*REAL-ADDR-SOURCE *1*REAL-ADDR-NUM *1*TM-ARG-MODE
                        *1*TM-ARG-DATUM *1*TM-ARG-INDEX *1*TM-FIX-WORD
                        *1*TM-FIX-REG-ADDRESS *1*TM-COMPUTE-ADDRESS
                        *1*TM-GOOD-ADDRESS *1*TM-INCR-ADDRESS
                        *1*TM-INCRN-ADDRESS *1*TM-FETCH-FROM-MEMORY
                        *1*TM-STORE-IN-MEMORY *1*TM-FETCH-FROM-REGMEM
                        *1*TM-STORE-IN-REGMEM *1*TM-FETCH *1*TM-STORE
                        *1*TM-STACK-OVERFLOWP *1*TM-STACK-UNDERFLOWP
                        *1*TM-EXECUTE-ADD *1*TM-EXECUTE-BRANCH
                        *1*TM-EXECUTE-BRANCH-ON-ZERO
                        *1*TM-EXECUTE-BRANCH-NOT-ZERO *1*TM-EXECUTE-CALL
                        *1*TM-EXECUTE-COMPARE *1*TM-EXECUTE-DECR
                        *1*TM-EXECUTE-DECR-MOD *1*TM-EXECUTE-INCR
                        *1*TM-EXECUTE-INCR-MOD *1*TM-EXECUTE-LOAD-BASE
                        *1*TM-EXECUTE-LOAD-LIMIT *1*TM-EXECUTE-LOAD-PSW
                        *1*TM-EXECUTE-MOD *1*TM-EXECUTE-MOVE
                        *1*TM-EXECUTE-MULTIPLY
                        *1*TM-EXECUTE-POST-OUTPUT-INTERRUPT
                        *1*TM-EXECUTE-RETURN *1*TM-EXECUTE-RUN
                        *1*TM-EXECUTE-SET-CLOCK *1*TM-EXECUTE-START-OUTPUT
                        *1*TM-EXECUTE-SVC *1*TM-EXECUTE-SVC-RETURN
                        *1*TM-EXECUTE-TEST-IPORT *1*TM-EXECUTE-TEST-OPORT
                        *1*TM-EXECUTE-WAIT *1*TM-OPCODE-SIZE *1*TM-MODE-SIZE
                        *1*TM-INDEX-SIZE *1*TM-OPCODE-DIVISOR
                        *1*TM-MODE1-DIVISOR *1*TM-INDEX1-DIVISOR
                        *1*TM-MODE2-DIVISOR *1*TM-OPCODE *1*TM-MODE1
                        *1*TM-INDEX1 *1*TM-MODE2 *1*TM-INDEX2
                        *1*TM-NULLARY-INSTRUCTIONP *1*TM-UNARY-INSTRUCTIONP
                        *1*TM-DATUM1 *1*TM-DATUM2 *1*TM-ARG1 *1*TM-ARG2
                        *1*TM-RETURN-OPCODE *1*TM-WAIT-OPCODE *1*TM-RUN-OPCODE
                        *1*TM-EXECUTE-NULLARY *1*TM-BR-OPCODE
                        *1*TM-BRNZ-OPCODE *1*TM-BRZ-OPCODE *1*TM-CALL-OPCODE
                        *1*TM-DECR-OPCODE *1*TM-INCR-OPCODE *1*TM-LBASE-OPCODE
                        *1*TM-LLIMIT-OPCODE *1*TM-LPSW-OPCODE
                        *1*TM-POST-OPCODE *1*TM-SVC-OPCODE
                        *1*TM-SVC-RETURN-OPCODE *1*TM-TESTI-OPCODE
                        *1*TM-TESTO-OPCODE *1*TM-TIME-OPCODE
                        *1*TM-EXECUTE-UNARY *1*TM-ADD-OPCODE
                        *1*TM-COMPARE-OPCODE *1*TM-DECR-MOD-OPCODE
                        *1*TM-INCR-MOD-OPCODE *1*TM-MOD-OPCODE
                        *1*TM-MOVE-OPCODE *1*TM-MULT-OPCODE *1*TM-STOUT-OPCODE
                        *1*TM-EXECUTE-BINARY *1*TM-EXECUTE-INSTRUCTION
                        *1*TM-FETCH-OPCODE *1*TM-FETCH-ARG1 *1*TM-FETCH-ARG2
                        *1*TM-EXECUTE *1*TM-DECREMENT-CLOCK
                        *1*TM-GOOD-PC-ADDRESS *1*TM-FETCH-EXECUTE
                        *1*TM-FETCH-NEW-PC-ON-INTERRUPT
                        *1*TM-STORE-OLD-PSW-ON-INTERRUPT
                        *1*TM-CLOCK-INTERRUPTP *1*TM-EXECUTE-CLOCK-INTERRUPT
                        *1*TM-ERRORP *1*TM-EXECUTE-ERROR-INTERRUPT
                        *1*TM-SVC-INTERRUPTP *1*TM-STORE-SVCID-ON-INTERRUPT
                        *1*TM-EXECUTE-SVC-INTERRUPT *1*TM-OVERFLOW-CHAR
                        *1*TM-SOME-INPUT-INTERRUPTP *1*TM-INPUT-INTERRUPTP
                        *1*TM-INTERRUPTING-INPUT-PORT
                        *1*TM-STORE-INTERRUPTING-INPUT-DEVICE
                        *1*TM-EXECUTE-INPUT-INTERRUPT
                        *1*TM-SOME-OUTPUT-INTERRUPTP *1*TM-OUTPUT-INTERRUPTP
                        *1*TM-INTERRUPTING-OUTPUT-PORT
                        *1*TM-STORE-INTERRUPTING-OUTPUT-DEVICE
                        *1*TM-EXECUTE-OUTPUT-INTERRUPT
                        *1*TM-DEVICE-INPUT-EVENTP *1*TM-IDEVID *1*TM-IDATUM
                        *1*TM-DEVICE-OUTPUT-EVENTP *1*TM-ODEVID
                        *1*TM-POST-INTERRUPT *1*TM-STEP *1*TM-PROCESSOR))

(DEFN
 OS-INTENDED-CLOCK-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH (TM-PC TM)
          '0
          (PUTNTH (TM-SP TM)
                  '1
                  (PUTNTH (TM-PACK-PSW (TM-CC TM)
                                       (TM-ERROR TM)
                                       (TM-SVCFLAG TM)
                                       (TM-SVCID TM))
                          '2
                          (PUTSEG (OS-TASK-TABLE TM)
                                  '15
                                  (PUTSEG (OS-SEGMENT-TABLE TM)
                                          '159
                                          (PUTSEG (OS-READYQ TM)
                                                  '191
                                                  (PUTSEG (OS-CODE TM)
                                                          '2547
                                                          (TM-MEMORY TM))))))))
  (TM-SET-PC '2654
           (TM-SET-SP '3310
                      (TM-SET-SVMODE '1
                                     (TM-SET-ERROR '0
                                                   (TM-SET-RWSTATE '0 TM))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-CLOCK-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-CLOCK-INTERRUPT OS)
                             (OS-INTENDED-CLOCK-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-CLOCK-INTERRUPT OS-TASK-TABLE OS-READYQ
                      OS-CODE OS-SEGMENT-TABLE GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 OS-CLOCK-NEW-PC
                      TM-SLIMIT-OS)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (NON-1-FINITE-NUMBER-IS-ZERO (A (TM-RWSTATE OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS))))
              (ENABLE-THEORY TM-DEFINITION GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-CLOCK-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
              (OS-NEW-TASK-TABLE OS)
              '15
              (PUTSEG (OS-SEGMENT-TABLE OS)
                      '159
                      (PUTSEG (OS-READYQ OS)
                              '191
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '2558
                                              '3309
                                              (PUTNTH '2656
                                                      '3310
                                                      (TM-MEMORY OS))))))))))))
  (PUTNTH '2656
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (TM-R2 OS)
                          '2
                          (PUTNTH (TM-R3 OS)
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (TM-PROCESSOR (OS-INTENDED-CLOCK-INTERRUPT OS)
                      (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS))
        (OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP LENGTH
          OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
          OS-INTENDED-CLOCK-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
              (OS-NEW-TASK-TABLE OS)
              '15
              (PUTSEG (OS-SEGMENT-TABLE OS)
                      '159
                      (PUTSEG (ARRAY-ENQ (ARRAY-QFIRST (OS-READYQ OS))
                                         (ARRAY-DEQ (OS-READYQ OS)))
                              '191
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '2558
                                              '3309
                                              (PUTNTH '2665
                                                      '3310
                                                      (TM-MEMORY OS))))))))))))
  (PUTNTH '3206
     '0
     (PUTNTH '3310
             '1
             (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                     '2
                     (PUTNTH '191
                             '3
                             (PUTNTH (PLUS '195
                                           (GETNTH '1
                                                   (ARRAY-DEQ (OS-READYQ OS))))
                                     '4
                                     (TM-REGS OS))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1
                                        (ARRAY-DEQ (OS-READYQ OS)))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (EQUAL (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS)
                        (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS))
          (OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS)))
 ((ENABLE FINITE-NUMBERP OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
          OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
              (OS-NEW-TASK-TABLE OS)
              '15
              (PUTSEG (OS-SEGMENT-TABLE OS)
                      '159
                      (PUTSEG (ARRAY-ENQ (ARRAY-QFIRST (OS-READYQ OS))
                                         (ARRAY-DEQ (OS-READYQ OS)))
                              '191
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '2558
                                              '3309
                                              (PUTNTH '3217
                                                      '3310
                                                      (TM-MEMORY OS))))))))))))
  (PUTNTH '2601
     '0
     (PUTNTH '3309
             '1
             (PUTNTH (ARRAY-QFIRST (ARRAY-ENQ (ARRAY-QFIRST (OS-READYQ OS))
                                              (ARRAY-DEQ (OS-READYQ OS))))
                     '2
                     (PUTNTH '191
                             '3
                             (PUTNTH (PLUS '195
                                           (GETNTH '1
                                                   (ARRAY-DEQ (OS-READYQ OS))))
                                     '4
                                     (TM-REGS OS))))))
  (TM-CC-VALUE (TM-ALU-PLUS '195
                            (GETNTH '0
                                    (ARRAY-ENQ (ARRAY-QFIRST (OS-READYQ OS))
                                               (ARRAY-DEQ (OS-READYQ OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
       (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS)
                     (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS))
       (OS-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS)))
 ((ENABLE FINITE-NUMBERP OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER
          OS-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE)

(DEFN OS-CLOCK-NEW-READYQ
      (OS)
      (ARRAY-ENQ (ARRAY-QFIRST (OS-READYQ OS))
                 (ARRAY-DEQ (OS-READYQ OS)))
      NIL)

(DEFN OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-CLOCK-INTERRUPT-HANDLER
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
              (OS-NEW-TASK-TABLE OS)
              '15
              (PUTSEG (OS-SEGMENT-TABLE OS)
                      '159
                      (PUTSEG (OS-CLOCK-NEW-READYQ OS)
                              '191
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '2558
                                              '3309
                                              (PUTNTH '3217
                                                      '3310
                                                      (TM-MEMORY OS))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-CLOCK-INTERRUPT-HANDLER-TO-FINISH
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (NOT (TM-WAITING OS)))
       (EQUAL (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS)
                            (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH OS))
              (OS-CLOCK-INTERRUPT-HANDLER OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
          GETNTH-TABLE OS-CLOCK-INTERRUPT-HANDLER
          OS-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS-CLOCK-NEW-READYQ
          OS-CURRENT-TASKID OS-NEW-TASK-TABLE OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-CLOCK-INTERRUPT-HANDLER-TO-FINISH)

(DEFN OS-CIH-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-CIH-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-CLOCK-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-CLOCK-INTERRUPT OS)
                (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER OS))
  (TM-PROCESSOR
        (TM-PROCESSOR (OS-INTENDED-CLOCK-INTERRUPT OS)
                      (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS))
        (OS-CIH-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS-CIH-TIME1)
  (USE
   (TICK-PLUS (A '25) (B '53))
   (TM-PROCESSOR-APPEND-ORACLE
                   (TM (OS-INTENDED-CLOCK-INTERRUPT OS))
                   (A (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS))
                   (B (OS-CIH-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-CLOCK-TRACE1)

(PROVE-LEMMA
 REWRITE-CLOCK-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS)
                (OS-CIH-TIME1 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS)
                        (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS))
          (OS-CIH-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS-CIH-TIME1
          OS-CIH-TIME2)
  (USE
   (TICK-PLUS (A '20) (B '33))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE OS))
                     (A (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS))
                     (B (OS-CIH-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-CLOCK-TRACE2)

(PROVE-LEMMA
 REWRITE-CLOCK-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS)
                (OS-CIH-TIME2 OS))
  (TM-PROCESSOR
       (TM-PROCESSOR (OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS)
                     (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS))
       (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH OS)))
 ((ENABLE OS-CIH-TIME2 OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE
          OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH)
  (USE
   (TICK-PLUS (A '12) (B '21))
   (TM-PROCESSOR-APPEND-ORACLE
                  (TM (OS-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER OS))
                  (A (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE OS))
                  (B (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER-TO-FINISH OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-CLOCK-TRACE3)

(PROVE-LEMMA
        TRACE-CLOCK-INTERRUPT-HANDLER
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TM-PROCESSOR (OS-INTENDED-CLOCK-INTERRUPT OS)
                                      (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER OS))
                        (OS-CLOCK-INTERRUPT-HANDLER OS)))
        ((ENABLE REWRITE-CLOCK-TRACE1 REWRITE-CLOCK-TRACE2
                 REWRITE-CLOCK-TRACE3
                 TRACE-CLOCK-INTERRUPT-HANDLER-THRU-SAVE-STATE
                 TRACE-CLOCK-INTERRUPT-HANDLER-TO-DISPATCHER
                 TRACE-CLOCK-INTERRUPT-HANDLER-TO-RESTORE-STATE
                 TRACE-CLOCK-INTERRUPT-HANDLER-TO-FINISH)
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE TRACE-CLOCK-INTERRUPT-HANDLER)

(DEFN
 OS-INTENDED-ERROR-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
         (TM-SP TM)
         '1
         (PUTNTH (TM-PACK-PSW (TM-CC TM)
                              (TM-ERROR TM)
                              (TM-SVCFLAG TM)
                              (TM-SVCID TM))
                 '2
                 (PUTSEG (OS-TASK-TABLE TM)
                         '15
                         (PUTSEG (OS-SEGMENT-TABLE TM)
                                 '159
                                 (PUTSEG (OS-READYQ TM)
                                         '191
                                         (PUTSEG (OS-STATUS-TABLE TM)
                                                 '211
                                                 (PUTSEG (OS-CODE TM)
                                                         '2547
                                                         (TM-MEMORY TM)))))))))
  (TM-SET-PC '2667
           (TM-SET-SP '3310
                      (TM-SET-SVMODE '1
                                     (TM-SET-ERROR '0
                                                   (TM-SET-RWSTATE '0 TM))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-ERROR-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-EXECUTE-ERROR-INTERRUPT OS)
                             (OS-INTENDED-ERROR-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-ERROR-INTERRUPT OS-TASK-TABLE OS-READYQ
                      OS-CODE OS-SEGMENT-TABLE OS-STATUS-TABLE
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 OS-ERROR-NEW-PC
                      TM-SLIMIT-OS)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (NON-1-FINITE-NUMBER-IS-ZERO (A (TM-RWSTATE OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS))))
              (ENABLE-THEORY TM-DEFINITION GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-ERROR-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-ERROR-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
        (OS-NEW-TASK-TABLE OS)
        '15
        (PUTSEG
             (OS-SEGMENT-TABLE OS)
             '159
             (PUTSEG (OS-READYQ OS)
                     '191
                     (PUTSEG (OS-STATUS-TABLE OS)
                             '211
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '2558
                                             '3309
                                             (PUTNTH '2669
                                                     '3310
                                                     (TM-MEMORY OS)))))))))))))
  (PUTNTH '2669
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (TM-R2 OS)
                          '2
                          (PUTNTH (TM-R3 OS)
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-ERROR-HANDLER-THRU-SAVE-STATE
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                (OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS))
                  (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)))
  ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
           OS-ERROR-HANDLER-THRU-SAVE-STATE OS-INTENDED-ERROR-INTERRUPT
           OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
           OS-TASK-TABLE-ADDRESS-FACTS
           OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE)
   (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(DEFN OS-ERROR-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
        (OS-NEW-TASK-TABLE OS)
        '15
        (PUTSEG
             (OS-SEGMENT-TABLE OS)
             '159
             (PUTSEG (ARRAY-DEQ (OS-READYQ OS))
                     '191
                     (PUTSEG (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)
                             '211
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '2558
                                             '3309
                                             (PUTNTH '2676
                                                     '3310
                                                     (TM-MEMORY OS)))))))))))))
  (PUTNTH '3206
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (PLUS '211
                                (TIMES '2
                                       (ARRAY-QFIRST (OS-READYQ OS))))
                          '2
                          (PUTNTH '191 '3 (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '2
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '211))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-ERROR-HANDLER-TO-DISPATCHER
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TM-PROCESSOR (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)
                                  (OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS))
                    (OS-ERROR-HANDLER-TO-DISPATCHER OS)))
    ((ENABLE FINITE-NUMBERP OS-ERROR-HANDLER-THRU-SAVE-STATE
             OS-ERROR-HANDLER-TO-DISPATCHER OS-NEW-TASK-TABLE
             OS-READYQ-ADDRESS-FACTS OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER
             OS-UPDATE-STATUS)
     (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                    FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                    GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                    TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                    TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
     (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
     (DISABLE TIMES PLUS)
     (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-ERROR-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
        (OS-NEW-TASK-TABLE OS)
        '15
        (PUTSEG
             (OS-SEGMENT-TABLE OS)
             '159
             (PUTSEG (ARRAY-DEQ (OS-READYQ OS))
                     '191
                     (PUTSEG (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)
                             '211
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '2558
                                             '3309
                                             (PUTNTH '3211
                                                     '3310
                                                     (TM-MEMORY OS)))))))))))))
  (PUTNTH '3222
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (PLUS '211
                                (TIMES '2
                                       (ARRAY-QFIRST (OS-READYQ OS))))
                          '2
                          (PUTNTH '191 '3 (TM-REGS OS)))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-ERROR-HANDLER-TO-WAIT-STATE
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (AND (NOT (TM-WAITING OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
             (EQUAL (TM-PROCESSOR (OS-ERROR-HANDLER-TO-DISPATCHER OS)
                                  (OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE OS))
                    (OS-ERROR-HANDLER-PATH1 OS)))
    ((ENABLE FINITE-NUMBERP OS-ERROR-HANDLER-PATH1
             OS-ERROR-HANDLER-TO-DISPATCHER OS-NEW-TASK-TABLE
             OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE OS-UPDATE-STATUS)
     (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                    GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                    OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                    TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
     (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
     (DISABLE TIMES PLUS)
     (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-TO-WAIT-STATE)

(DEFN OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-ERROR-HANDLER-TO-RESTORE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
        (OS-NEW-TASK-TABLE OS)
        '15
        (PUTSEG
             (OS-SEGMENT-TABLE OS)
             '159
             (PUTSEG (ARRAY-DEQ (OS-READYQ OS))
                     '191
                     (PUTSEG (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)
                             '211
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '2558
                                             '3309
                                             (PUTNTH '3217
                                                     '3310
                                                     (TM-MEMORY OS)))))))))))))
  (PUTNTH '2601
          '0
          (PUTNTH '3309
                  '1
                  (PUTNTH (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          '2
                          (PUTNTH '191 '3 (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS '195
                            (GETNTH '0
                                    (ARRAY-DEQ (OS-READYQ OS)))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-ERROR-HANDLER-TO-RESTORE-STATE
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
          (EQUAL (TM-PROCESSOR (OS-ERROR-HANDLER-TO-DISPATCHER OS)
                               (OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE OS))
                 (OS-ERROR-HANDLER-TO-RESTORE-STATE OS)))
 ((ENABLE FINITE-NUMBERP OS-ERROR-HANDLER-TO-DISPATCHER
          OS-ERROR-HANDLER-TO-RESTORE-STATE OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE
          OS-UPDATE-STATUS)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-TO-RESTORE-STATE)

(DEFN OS-TIME-FOR-ERROR-HANDLER-TO-FINISH
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-ERROR-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS))))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-R2 OS)
      '13
      (PUTNTH
       (TM-R3 OS)
       '14
       (PUTSEG
        (OS-NEW-TASK-TABLE OS)
        '15
        (PUTSEG
             (OS-SEGMENT-TABLE OS)
             '159
             (PUTSEG (ARRAY-DEQ (OS-READYQ OS))
                     '191
                     (PUTSEG (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)
                             '211
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '2558
                                             '3309
                                             (PUTNTH '3217
                                                     '3310
                                                     (TM-MEMORY OS)))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-ERROR-HANDLER-TO-FINISH
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                 (EQUAL (TM-PROCESSOR (OS-ERROR-HANDLER-TO-RESTORE-STATE OS)
                                      (OS-TIME-FOR-ERROR-HANDLER-TO-FINISH OS))
                        (OS-ERROR-HANDLER-PATH2 OS)))
        ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
                 GETNTH-TABLE OS-CURRENT-TASKID OS-ERROR-HANDLER-PATH2
                 OS-ERROR-HANDLER-TO-RESTORE-STATE OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-ADDRESS-FACTS
                 OS-TIME-FOR-ERROR-HANDLER-TO-FINISH OS-UPDATE-STATUS)
         (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                        FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                        GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                        OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                        TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS
                        TRACING-LEMMAS GROUND-ZERO)
         (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
         (DISABLE TIMES PLUS)
         (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-TO-FINISH)

(DEFN OS-ERROR-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-ERROR-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-ERROR-TRACE1
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                  (OS-TIME-FOR-ERROR-HANDLER-PATH1 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                (OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS))
                  (OS-ERROR-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-ERROR-HANDLER-PATH1
          OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS-ERROR-TIME1)
  (USE
   (TICK-PLUS (A '25) (B '22))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-INTENDED-ERROR-INTERRUPT OS))
                             (A (OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS))
                             (B (OS-ERROR-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-ERROR-TRACE1)

(PROVE-LEMMA
 REWRITE-ERROR-TRACE2
 (REWRITE)
 (EQUAL
      (TM-PROCESSOR (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)
                    (OS-ERROR-TIME1 OS))
      (TM-PROCESSOR (TM-PROCESSOR (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)
                                  (OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS))
                    (OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE OS)))
 ((ENABLE OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS-ERROR-TIME1
          OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE)
  (USE
   (TICK-PLUS (A '22) (B '6))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-ERROR-HANDLER-THRU-SAVE-STATE OS))
                             (A (OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS))
                             (B (OS-TIME-FOR-ERROR-HANDLER-TO-WAIT-STATE OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-ERROR-TRACE2)

(PROVE-LEMMA
            TRACE-ERROR-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (NOT (TM-WAITING OS))
                               (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
                     (EQUAL (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                          (OS-TIME-FOR-ERROR-HANDLER-PATH1 OS))
                            (OS-ERROR-HANDLER-PATH1 OS)))
            ((ENABLE REWRITE-ERROR-TRACE1 REWRITE-ERROR-TRACE2
                     TRACE-ERROR-HANDLER-THRU-SAVE-STATE
                     TRACE-ERROR-HANDLER-TO-DISPATCHER
                     TRACE-ERROR-HANDLER-TO-WAIT-STATE)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-PATH1)

(DEFN OS-ERROR-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-ERROR-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-ERROR-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-ERROR-TRACE3
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                  (OS-TIME-FOR-ERROR-HANDLER-PATH2 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                (OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS))
                  (OS-ERROR-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-ERROR-HANDLER-PATH2
          OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS-ERROR-TIME2)
  (USE
   (TICK-PLUS (A '25) (B '49))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-INTENDED-ERROR-INTERRUPT OS))
                             (A (OS-TIME-FOR-ERROR-HANDLER-THRU-SAVE-STATE OS))
                             (B (OS-ERROR-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-ERROR-TRACE3)

(PROVE-LEMMA
 REWRITE-ERROR-TRACE4
 (REWRITE)
 (EQUAL
      (TM-PROCESSOR (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)
                    (OS-ERROR-TIME2 OS))
      (TM-PROCESSOR (TM-PROCESSOR (OS-ERROR-HANDLER-THRU-SAVE-STATE OS)
                                  (OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS))
                    (OS-ERROR-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS-ERROR-TIME2
          OS-ERROR-TIME3)
  (USE
   (TICK-PLUS (A '16) (B '33))
   (TM-PROCESSOR-APPEND-ORACLE (TM (OS-ERROR-HANDLER-THRU-SAVE-STATE OS))
                               (A (OS-TIME-FOR-ERROR-HANDLER-TO-DISPATCHER OS))
                               (B (OS-ERROR-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-ERROR-TRACE4)

(PROVE-LEMMA
 REWRITE-ERROR-TRACE5
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-ERROR-HANDLER-TO-DISPATCHER OS)
                 (OS-ERROR-TIME3 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-ERROR-HANDLER-TO-DISPATCHER OS)
                               (OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE OS))
                 (OS-TIME-FOR-ERROR-HANDLER-TO-FINISH OS)))
 ((ENABLE OS-ERROR-TIME3 OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE
          OS-TIME-FOR-ERROR-HANDLER-TO-FINISH)
  (USE
   (TICK-PLUS (A '12) (B '21))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-ERROR-HANDLER-TO-DISPATCHER OS))
                            (A (OS-TIME-FOR-ERROR-HANDLER-TO-RESTORE-STATE OS))
                            (B (OS-TIME-FOR-ERROR-HANDLER-TO-FINISH OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-ERROR-TRACE5)

(PROVE-LEMMA
          TRACE-ERROR-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                        (OS-TIME-FOR-ERROR-HANDLER-PATH2 OS))
                          (OS-ERROR-HANDLER-PATH2 OS)))
          ((ENABLE REWRITE-ERROR-TRACE3 REWRITE-ERROR-TRACE4
                   REWRITE-ERROR-TRACE5 TRACE-ERROR-HANDLER-THRU-SAVE-STATE
                   TRACE-ERROR-HANDLER-TO-DISPATCHER
                   TRACE-ERROR-HANDLER-TO-RESTORE-STATE
                   TRACE-ERROR-HANDLER-TO-FINISH)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE TRACE-ERROR-HANDLER-PATH2)

(DEFN OS-TIME-FOR-ERROR-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
          (OS-TIME-FOR-ERROR-HANDLER-PATH1 OS)
          (OS-TIME-FOR-ERROR-HANDLER-PATH2 OS))
      NIL)

(DEFN OS-ERROR-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
          (OS-ERROR-HANDLER-PATH1 OS)
          (OS-ERROR-HANDLER-PATH2 OS))
      NIL)

(PROVE-LEMMA TRACE-OS-ERROR-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-PROCESSOR (OS-INTENDED-ERROR-INTERRUPT OS)
                                           (OS-TIME-FOR-ERROR-HANDLER OS))
                             (OS-ERROR-HANDLER OS)))
             ((ENABLE OS-TIME-FOR-ERROR-HANDLER OS-ERROR-HANDLER
                      TRACE-ERROR-HANDLER-PATH2 TRACE-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TRACE-OS-ERROR-HANDLER)

(DEFN
 OS-INTENDED-SVC-SEND-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
    (TM-SP TM)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC TM)
                  (TM-ERROR TM)
                  (TM-SVCFLAG TM)
                  (TM-SVCID TM))
     '2
     (PUTNTH
       (TM-SVCID TM)
       '8
       (PUTSEG (OS-TASK-TABLE TM)
               '15
               (PUTSEG (OS-SEGMENT-TABLE TM)
                       '159
                       (PUTSEG (OS-READYQ TM)
                               '191
                               (PUTSEG (OS-STATUS-TABLE TM)
                                       '211
                                       (PUTSEG (OS-MBUFFERS TM)
                                               '499
                                               (PUTSEG (OS-CODE TM)
                                                       '2547
                                                       (TM-MEMORY TM)))))))))))
  (TM-SET-PC '2690
           (TM-SET-SP '3310
                      (TM-SET-SVMODE '1
                                     (TM-SET-ERROR '0
                                                   (TM-SET-RWSTATE '0 TM))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-SVC-SEND-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-SVC-INTERRUPT OS)
                             (OS-INTENDED-SVC-SEND-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-SVC-SEND-INTERRUPT OS-TASK-TABLE OS-READYQ
                      OS-CODE OS-SEGMENT-TABLE OS-STATUS-TABLE OS-MBUFFERS
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 OS-SVC-NEW-PC
                      TM-SLIMIT-OS)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (NON-1-FINITE-NUMBER-IS-ZERO (A (TM-RWSTATE OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '499)
                                              (K '2048)
                                              (I '499)
                                              (L (TM-MEMORY OS))))
              (ENABLE-THEORY TM-DEFINITION GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-SVC-SEND-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-SVCID OS)
      '8
      (PUTNTH
       (TM-R2 OS)
       '13
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-NEW-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (OS-READYQ OS)
           '191
           (PUTSEG (OS-STATUS-TABLE OS)
                   '211
                   (PUTSEG (OS-MBUFFERS OS)
                           '499
                           (PUTSEG (OS-CODE OS)
                                   '2547
                                   (PUTNTH '2558
                                           '3309
                                           (PUTNTH '2692
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '2692
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (TM-R2 OS)
                          '2
                          (PUTNTH (TM-R3 OS)
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
          OS-INTENDED-SVC-SEND-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-SVC-SEND-HANDLER-THRU-SAVE-STATE
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-TO-QFULLP-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2726
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2747
    '0
    (PUTNTH '3310
            '1
            (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                    '2
                    (PUTNTH (PLUS '499
                                  (PLUS (TIMES '8
                                               (REMAINDER (TM-R2 OS) '16))
                                        (TIMES '128
                                               (ARRAY-QFIRST (OS-READYQ OS)))))
                            '3
                            (PUTNTH (TIMES '8
                                           (REMAINDER (TM-R2 OS) '16))
                                    '4
                                    (PUTNTH (REMAINDER (TM-R2 OS) '16)
                                            '6
                                            (PUTNTH (TM-R3 OS)
                                                    '7
                                                    (TM-REGS OS))))))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS (TIMES '8
                                         (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                    '16))
                                  (TIMES '128
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '499))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (AND (NOT (TM-WAITING OS))
                   (EQUAL (REMAINDER (TM-SVCID OS) '4)
                          '0)))
         (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-MBUFFERS-ADDRESS-FACTS1 OS-MBUFFERS-ADDRESS-FACTS2
          OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
          OS-SVC-SEND-HANDLER-THRU-SAVE-STATE
          OS-SVC-SEND-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '2
                                    (OS-DESTID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2796
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                   '2
                   (PUTNTH (PLUS '211
                                 (TIMES '2
                                        (ARRAY-QFIRST (OS-READYQ OS))))
                           '3
                           (PUTNTH (TIMES '8
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (PUTNTH (GETNTH '3 (TM-REGS OS))
                                                   '7
                                                   (TM-REGS OS))))))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '2
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '211))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-DISPATCHER
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                              '0)
                       (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))))
        (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
               (OS-SVC-SEND-HANDLER-TO-DISPATCHER OS)))
 ((ENABLE ACCESS-CURRENT-MBUFFER FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER
          FINITE-NUMBERP OS-CURRENT-MBUFFER OS-CURRENT-TASKID OS-DESTID
          OS-MBUFFERS-ADDRESS-FACTS2 OS-NEW-TASK-TABLE
          OS-SVC-SEND-HANDLER-TO-DISPATCHER OS-SVC-SEND-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS-UPDATE-STATUS
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '2
                                    (OS-DESTID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3211
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                   '2
                   (PUTNTH '191
                           '3
                           (PUTNTH (TIMES '8
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (PUTNTH (GETNTH '3 (TM-REGS OS))
                                                   '7
                                                   (TM-REGS OS))))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-WAIT-STATE
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
          (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-DISPATCHER OS)
                               (OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE OS))
                 (OS-SVC-SEND-HANDLER-PATH1 OS)))
 ((ENABLE FINITE-NUMBERP OS-CURRENT-TASKID OS-DESTID OS-NEW-TASK-TABLE
          OS-SVC-SEND-HANDLER-PATH1 OS-SVC-SEND-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE OS-UPDATE-STATUS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-WAIT-STATE)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS))))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '2
                                    (OS-DESTID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3217
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-LPSW
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-DISPATCHER OS)
                                     (OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW OS))
                       (OS-SVC-SEND-HANDLER-PATH2 OS)))
       ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
                GETNTH-TABLE OS-CURRENT-TASKID OS-DESTID OS-NEW-TASK-TABLE
                OS-READYQ-ADDRESS-FACTS OS-SVC-SEND-HANDLER-PATH2
                OS-SVC-SEND-HANDLER-TO-DISPATCHER OS-TASK-TABLE-ADDRESS-FACTS
                OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW OS-UPDATE-STATUS
                TM-FIX-WORD-NOOP)
        (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                       FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                       GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                       OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                       TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                       GROUND-ZERO)
        (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
        (DISABLE TIMES PLUS)
        (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-LPSW)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-THRU-ENQUEUE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2756
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2756
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-R3 OS)
     '2
     (PUTNTH
      (PLUS '499
            (PLUS (TIMES '8
                         (REMAINDER (GETNTH '2 (TM-REGS OS))
                                    '16))
                  (TIMES '128
                         (ARRAY-QFIRST (OS-READYQ OS)))))
      '3
      (PUTNTH
        (PLUS '503
              (PLUS (PLUS (TIMES '8
                                 (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16))
                          (TIMES '128
                                 (ARRAY-QFIRST (OS-READYQ OS))))
                    (GETNTH '1
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))))
        '4
        (PUTNTH (REMAINDER (TM-R2 OS) '16)
                '6
                (PUTNTH (TM-R3 OS)
                        '7
                        (TM-REGS OS))))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-THRU-ENQUEUE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))))))
   (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                        (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
          (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)))
 ((ENABLE ACCESS-CURRENT-MBUFFER ACCESS-CURRENT-OS-MBUFFER-FIELDS
          CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER
          FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER FINITE-NUMBERP
          LESSP-PLUS-FACT-FOR-MBUFFERS1 LESSP-PLUS-FACT-FOR-MBUFFERS2
          LIMITED-ASSOCIATIVITY-OF-PLUS OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-DESTID OS-MBUFFERS-ADDRESS-FACTS2
          OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS-NEW-TASK-TABLE
          OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS-SVC-SEND-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS1
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-THRU-ENQUEUE)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (OS-DESTID OS '16)
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (OS-DESTID OS '16)
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2789
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                              '16)
                   '2
                   (PUTNTH '191
                           '3
                           (PUTNTH (PLUS '195
                                         (GETNTH '1 (OS-READYQ OS)))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (PUTNTH (GETNTH '3 (TM-REGS OS))
                                                   '7
                                                   (TM-REGS OS))))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '3)
                   (EQUAL (GETNTH (PLUS '1
                                        (TIMES '2 (OS-DESTID OS '16)))
                                  (OS-STATUS-TABLE OS))
                          (OS-CURRENT-TASKID OS)))))
    (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS))
           (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS)))
 ((ENABLE FINITE-NUMBERP LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
          OS-CURRENT-TASKID OS-DESTID OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS-UPDATE-STATUS
          TM-CC-VALUE-ON-COMPARE-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2756
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-R3 OS)
     '2
     (PUTNTH
      (PLUS '211
            (TIMES '2 (OS-DESTID OS '16)))
      '3
      (PUTNTH
        (PLUS '503
              (PLUS (PLUS (TIMES '8
                                 (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16))
                          (TIMES '128
                                 (ARRAY-QFIRST (OS-READYQ OS))))
                    (GETNTH '1
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))))
        '4
        (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                           '16)
                '6
                (PUTNTH (GETNTH '3 (TM-REGS OS))
                        '7
                        (TM-REGS OS))))))))
  (TM-CC-VALUE
         (TM-ALU-DIFFERENCE (GETNTH (TIMES '2
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16))
                                    (OS-STATUS-TABLE OS))
                            '3))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (NOT (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '3))))
    (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS))
           (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS)))
 ((ENABLE FINITE-NUMBERP LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
          OS-CURRENT-TASKID OS-DESTID OS-NEW-TASK-TABLE
          OS-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2756
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-R3 OS)
     '2
     (PUTNTH
      (PLUS '211
            (TIMES '2 (OS-DESTID OS '16)))
      '3
      (PUTNTH
        (PLUS '503
              (PLUS (PLUS (TIMES '8
                                 (REMAINDER (GETNTH '2 (TM-REGS OS))
                                            '16))
                          (TIMES '128
                                 (ARRAY-QFIRST (OS-READYQ OS))))
                    (GETNTH '1
                            (GETNTH (PLUS (TIMES '16
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                     '16))
                                    (TABLE '8 (OS-MBUFFERS OS))))))
        '4
        (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                           '16)
                '6
                (PUTNTH (GETNTH '3 (TM-REGS OS))
                        '7
                        (TM-REGS OS))))))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE (GETNTH (PLUS '1
                                    (TIMES '2
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (OS-STATUS-TABLE OS))
                      (ARRAY-QFIRST (OS-READYQ OS))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '3)
                   (NOT (EQUAL (GETNTH (PLUS '1
                                             (TIMES '2 (OS-DESTID OS '16)))
                                       (OS-STATUS-TABLE OS))
                               (OS-CURRENT-TASKID OS))))))
    (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS))
           (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS)))
 ((ENABLE FINITE-NUMBERP LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
          OS-CURRENT-TASKID OS-DESTID OS-NEW-TASK-TABLE
          OS-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-SEND-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (OS-DESTID OS '16)
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (OS-DESTID OS '16)
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-SVCR1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                        (OS-STATUS-TABLE OS))
                                '3)
                         (EQUAL (GETNTH (PLUS '1
                                              (TIMES '2 (OS-DESTID OS '16)))
                                        (OS-STATUS-TABLE OS))
                                (OS-CURRENT-TASKID OS)))))
          (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS)
                               (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))
                 (OS-SVC-SEND-HANDLER-PATH3 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS-CURRENT-TASKID OS-DESTID
          OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS OS-SVC-SEND-HANDLER-PATH3
          OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS-UPDATE-STATUS RESTORE-CC
          RESTORE-ERROR RESTORE-REGS1 RESTORE-SVCID)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVCR1)

(DEFN
 OS-SVC-SEND-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '0
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-TO-SVCR2
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS)
                                   (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))
                     (OS-SVC-SEND-HANDLER-PATH4 OS)))
     ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
              LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS-CURRENT-TASKID
              OS-DESTID OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
              OS-SVC-SEND-HANDLER-PATH4
              OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
              OS-TASK-TABLE-ADDRESS-FACTS OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR
              RESTORE-CC RESTORE-ERROR RESTORE-REGS1 RESTORE-SVCID)
      (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                     FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                     GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                     TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                     TRACING-LEMMAS GROUND-ZERO)
      (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
      (DISABLE TIMES PLUS)
      (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVCR2)

(PROVE-LEMMA
     TRACE-SVC-SEND-HANDLER-TO-SVCR3
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS)
                                   (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))
                     (OS-SVC-SEND-HANDLER-PATH4 OS)))
     ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
              LENGTH-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS-CURRENT-TASKID
              OS-DESTID OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
              OS-SVC-SEND-HANDLER-PATH4
              OS-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
              OS-TASK-TABLE-ADDRESS-FACTS OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR
              RESTORE-CC RESTORE-ERROR RESTORE-REGS1 RESTORE-SVCID)
      (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                     FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                     GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                     TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                     TRACING-LEMMAS GROUND-ZERO)
      (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
      (DISABLE TIMES PLUS)
      (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-TO-SVCR3)

(DEFN OS-SVC-SEND-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-SEND-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                (OS-TIME-FOR-SVC-SEND-HANDLER-PATH1 OS))
  (TM-PROCESSOR
               (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-PATH1
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-SEND-TIME1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-SEND-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                          (B (OS-SVC-SEND-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE1)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-SEND-TIME1 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS-SVC-SEND-TIME1
          OS-SVC-SEND-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-SEND-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                           (B (OS-SVC-SEND-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE2)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE3
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                 (OS-SVC-SEND-TIME2 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                               (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
                 (OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE OS)))
 ((ENABLE OS-SVC-SEND-TIME2 OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
                          (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-WAIT-STATE OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE3)

(PROVE-LEMMA
 TRACE-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))
   (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                        (OS-TIME-FOR-SVC-SEND-HANDLER-PATH1 OS))
          (OS-SVC-SEND-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-SVC-SEND-TRACE1 REWRITE-SVC-SEND-TRACE2
          REWRITE-SVC-SEND-TRACE3 TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-SEND-HANDLER-TO-DISPATCHER
          TRACE-SVC-SEND-HANDLER-TO-WAIT-STATE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH1)

(DEFN OS-SVC-SEND-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-SEND-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                (OS-TIME-FOR-SVC-SEND-HANDLER-PATH2 OS))
  (TM-PROCESSOR
               (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-PATH2
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-SEND-TIME3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-SEND-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                          (B (OS-SVC-SEND-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE4)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-SEND-TIME3 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS-SVC-SEND-TIME3
          OS-SVC-SEND-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-SEND-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                           (B (OS-SVC-SEND-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE5)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE6
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                 (OS-SVC-SEND-TIME4 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                               (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
                 (OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-SVC-SEND-TIME4 OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                            (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-DISPATCHER OS))
                            (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE6)

(PROVE-LEMMA
 TRACE-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
   (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                        (OS-TIME-FOR-SVC-SEND-HANDLER-PATH2 OS))
          (OS-SVC-SEND-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-SVC-SEND-TRACE4 REWRITE-SVC-SEND-TRACE5
          REWRITE-SVC-SEND-TRACE6 TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-SEND-HANDLER-TO-DISPATCHER TRACE-SVC-SEND-HANDLER-TO-LPSW)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH2)

(DEFN OS-SVC-SEND-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-SEND-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                (OS-TIME-FOR-SVC-SEND-HANDLER-PATH3 OS))
  (TM-PROCESSOR
               (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-PATH3
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-SEND-TIME5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-SEND-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                          (B (OS-SVC-SEND-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE7)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-SEND-TIME5 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS-SVC-SEND-TIME5
          OS-SVC-SEND-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-SEND-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                           (B (OS-SVC-SEND-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE8)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE9
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                  (OS-SVC-SEND-TIME6 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                                (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                  (OS-SVC-SEND-TIME7 OS)))
 ((ENABLE OS-SVC-SEND-TIME6 OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-TIME7)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
              (B (OS-SVC-SEND-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                             (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                             (B (OS-SVC-SEND-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE9)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                (OS-SVC-SEND-TIME7 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS))
           (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-SEND-TIME7 OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS))
              (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                      (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1 OS))
                      (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE10)

(PROVE-LEMMA
 TRACE-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '0)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))
                  (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                      (OS-STATUS-TABLE OS))
                              '3)
                       (EQUAL (GETNTH (PLUS '1
                                            (TIMES '2 (OS-DESTID OS '16)))
                                      (OS-STATUS-TABLE OS))
                              (OS-CURRENT-TASKID OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-SEND-HANDLER-PATH3 OS))
         (OS-SVC-SEND-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-SVC-SEND-TRACE7 REWRITE-SVC-SEND-TRACE8
          REWRITE-SVC-SEND-TRACE9 REWRITE-SVC-SEND-TRACE10
          TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-SEND-HANDLER-THRU-ENQUEUE
          TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK1
          TRACE-SVC-SEND-HANDLER-TO-SVCR1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH3)

(DEFN OS-SVC-SEND-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME9
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME10
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH4A
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-SEND-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4A OS))
  (TM-PROCESSOR
               (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-TIME8 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-PATH4A
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-SEND-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-SEND-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                          (B (OS-SVC-SEND-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE11)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-SEND-TIME8 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-TIME9 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS-SVC-SEND-TIME8
          OS-SVC-SEND-TIME9)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-SEND-TIME9 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                           (B (OS-SVC-SEND-TIME9 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE12)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE13
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                  (OS-SVC-SEND-TIME9 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                                (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                  (OS-SVC-SEND-TIME10 OS)))
 ((ENABLE OS-SVC-SEND-TIME9 OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-TIME10)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
              (B (OS-SVC-SEND-TIME10 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                             (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                             (B (OS-SVC-SEND-TIME10 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE13)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE14
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                (OS-SVC-SEND-TIME10 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS))
           (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-SEND-TIME10 OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS))
              (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                      (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2 OS))
                      (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE14)

(PROVE-LEMMA
 TRACE-SVC-SEND-HANDLER-PATH4A
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '0)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))
                  (NOT (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                      (OS-STATUS-TABLE OS))
                              '3))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4A OS))
         (OS-SVC-SEND-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-SVC-SEND-TRACE11 REWRITE-SVC-SEND-TRACE12
          REWRITE-SVC-SEND-TRACE13 REWRITE-SVC-SEND-TRACE14
          TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-SEND-HANDLER-THRU-ENQUEUE
          TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK2
          TRACE-SVC-SEND-HANDLER-TO-SVCR2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH4A)

(DEFN OS-SVC-SEND-TIME11
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME12
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-SEND-TIME13
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH4B
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-SEND-TRACE15
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4B OS))
  (TM-PROCESSOR
               (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                             (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
               (OS-SVC-SEND-TIME11 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-PATH4B
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-SEND-TIME11)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-SEND-TIME11 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                          (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                          (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                          (B (OS-SVC-SEND-TIME11 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE15)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE16
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-SEND-TIME11 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                (OS-SVC-SEND-TIME12 OS)))
 ((ENABLE OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS-SVC-SEND-TIME11
          OS-SVC-SEND-TIME12)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-SEND-TIME12 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                           (B (OS-SVC-SEND-TIME12 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE16)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE17
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                  (OS-SVC-SEND-TIME12 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS)
                                (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                  (OS-SVC-SEND-TIME13 OS)))
 ((ENABLE OS-SVC-SEND-TIME12 OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE
          OS-SVC-SEND-TIME13)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
              (B (OS-SVC-SEND-TIME13 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-SEND-HANDLER-TO-QFULLP-TEST OS))
                             (A (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                             (B (OS-SVC-SEND-TIME13 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE17)

(PROVE-LEMMA
 REWRITE-SVC-SEND-TRACE18
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                (OS-SVC-SEND-TIME13 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS)
                         (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS))
           (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-SEND-TIME13 OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
          OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS))
              (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-SVC-SEND-HANDLER-THRU-ENQUEUE OS))
                      (A (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3 OS))
                      (B (OS-TIME-FOR-SVC-SEND-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-SEND-TRACE18)

(PROVE-LEMMA
 TRACE-SVC-SEND-HANDLER-PATH4B
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
      (NOT (TM-WAITING OS))
      (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                  '0)
           (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))
                (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                    (OS-STATUS-TABLE OS))
                            '3)
                     (NOT (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4B OS))
         (OS-SVC-SEND-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-SVC-SEND-TRACE15 REWRITE-SVC-SEND-TRACE16
          REWRITE-SVC-SEND-TRACE17 REWRITE-SVC-SEND-TRACE18
          TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-SEND-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-SEND-HANDLER-THRU-ENQUEUE
          TRACE-SVC-SEND-HANDLER-TO-SVC-RESUME-TASK3
          TRACE-SVC-SEND-HANDLER-TO-SVCR3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH4B)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER-PATH4
      (OS)
      (IF (NOT (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                              (OS-STATUS-TABLE OS))
                      '3))
          (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4A OS)
          (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4B OS))
      NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
      (NOT (TM-WAITING OS))
      (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                  '0)
           (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))
                (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4 OS))
         (OS-SVC-SEND-HANDLER-PATH4 OS)))
 ((ENABLE TRACE-SVC-SEND-HANDLER-PATH4A TRACE-SVC-SEND-HANDLER-PATH4B
          OS-TIME-FOR-SVC-SEND-HANDLER-PATH4)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER-PATH4)

(DEFN OS-TIME-FOR-SVC-SEND-HANDLER
      (OS)
      (IF (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                            (OS-DESTID OS '16)
                                            OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-TIME-FOR-SVC-SEND-HANDLER-PATH1 OS)
              (OS-TIME-FOR-SVC-SEND-HANDLER-PATH2 OS))
          (IF (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '3)
                   (EQUAL (GETNTH (PLUS '1
                                        (TIMES '2 (OS-DESTID OS '16)))
                                  (OS-STATUS-TABLE OS))
                          (OS-CURRENT-TASKID OS)))
              (OS-TIME-FOR-SVC-SEND-HANDLER-PATH3 OS)
              (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4 OS)))
      NIL)

(DEFN OS-SVC-SEND-HANDLER
      (OS)
      (IF (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                            (OS-DESTID OS '16)
                                            OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-SVC-SEND-HANDLER-PATH1 OS)
              (OS-SVC-SEND-HANDLER-PATH2 OS))
          (IF (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '3)
                   (EQUAL (GETNTH (PLUS '1
                                        (TIMES '2 (OS-DESTID OS '16)))
                                  (OS-STATUS-TABLE OS))
                          (OS-CURRENT-TASKID OS)))
              (OS-SVC-SEND-HANDLER-PATH3 OS)
              (OS-SVC-SEND-HANDLER-PATH4 OS)))
      NIL)

(PROVE-LEMMA TRACE-SVC-SEND-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                       '0)))
                      (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-SEND-INTERRUPT OS)
                                           (OS-TIME-FOR-SVC-SEND-HANDLER OS))
                             (OS-SVC-SEND-HANDLER OS)))
             ((ENABLE TRACE-SVC-SEND-HANDLER-PATH1
                      TRACE-SVC-SEND-HANDLER-PATH2
                      TRACE-SVC-SEND-HANDLER-PATH3
                      TRACE-SVC-SEND-HANDLER-PATH4
                      OS-TIME-FOR-SVC-SEND-HANDLER OS-SVC-SEND-HANDLER)
              (DISABLE PLUS TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-SEND-HANDLER)

(DEFN OS-INTENDED-SVC-RECEIVE-INTERRUPT
      (TM)
      (OS-INTENDED-SVC-SEND-INTERRUPT TM)
      NIL)

(PROVE-LEMMA EQUIVALENCE-OF-SVC-RECEIVE-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-SVC-INTERRUPT OS)
                             (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-SVC-RECEIVE-INTERRUPT
                      EQUIVALENCE-OF-SVC-SEND-INTERRUPT-EXPRESSIONS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-SVC-RECEIVE-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
      (OS)
      (OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
      (OS)
      (OS-SVC-SEND-HANDLER-THRU-SAVE-STATE OS)
      NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (NOT (TM-WAITING OS)))
     (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE TRACE-SVC-SEND-HANDLER-THRU-SAVE-STATE
          OS-INTENDED-SVC-RECEIVE-INTERRUPT
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2824
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2845
      '0
      (PUTNTH '3310
              '1
              (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                      '2
                      (PUTNTH (PLUS '499
                                    (PLUS (TIMES '8
                                                 (ARRAY-QFIRST (OS-READYQ OS)))
                                          (TIMES '128
                                                 (REMAINDER (TM-R2 OS) '16))))
                              '3
                              (PUTNTH (TIMES '8
                                             (ARRAY-QFIRST (OS-READYQ OS)))
                                      '4
                                      (PUTNTH (REMAINDER (TM-R2 OS) '16)
                                              '6
                                              (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS (TIMES '8
                                         (ARRAY-QFIRST (OS-READYQ OS)))
                                  (TIMES '128
                                         (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                    '16)))
                            '499))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
 (REWRITE)
 (IMPLIES
     (AND (GOOD-OS OS)
          (AND (NOT (TM-WAITING OS))
               (EQUAL (REMAINDER (TM-SVCID OS) '4)
                      '1)))
     (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-MBUFFERS-ADDRESS-FACTS1 OS-MBUFFERS-ADDRESS-FACTS2
          OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
          OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          OS-SVC-SEND-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '3
                                    (OS-SRCID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2905
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                   '2
                   (PUTNTH (PLUS '211
                                 (TIMES '2
                                        (ARRAY-QFIRST (OS-READYQ OS))))
                           '3
                           (PUTNTH (TIMES '8
                                          (ARRAY-QFIRST (OS-READYQ OS)))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '2
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '211))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-DISPATCHER
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                             '1)
                      (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
              (OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS)))
 ((ENABLE ACCESS-CURRENT-MBUFFER
          FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE FINITE-NUMBERP
          LENGTH-OS-MBUFFERS OPEN-UP-TM-PROCESSOR OS-CURRENT-MBUFFER
          OS-CURRENT-TASKID OS-MBUFFERS-ADDRESS-FACTS2 OS-NEW-TASK-TABLE
          OS-SRCID OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS-UPDATE-STATUS
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '3
                                    (OS-SRCID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3211
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                   '2
                   (PUTNTH '191
                           '3
                           (PUTNTH (TIMES '8
                                          (ARRAY-QFIRST (OS-READYQ OS)))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-WAIT-STATE
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
       (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE OS))
              (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
 ((ENABLE FINITE-NUMBERP OS-CURRENT-TASKID OS-NEW-TASK-TABLE OS-SRCID
          OS-SVC-RECEIVE-HANDLER-PATH1 OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE OS-UPDATE-STATUS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-WAIT-STATE)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS))))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '3
                                    (OS-SRCID OS '16)
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3217
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-LPSW
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (AND (NOT (TM-WAITING OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
             (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS)
                                  (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW OS))
                    (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
    ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
             GETNTH-TABLE OS-CURRENT-TASKID OS-NEW-TASK-TABLE
             OS-READYQ-ADDRESS-FACTS OS-SRCID OS-SVC-RECEIVE-HANDLER-PATH2
             OS-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS-TASK-TABLE-ADDRESS-FACTS
             OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW OS-UPDATE-STATUS
             TM-FIX-WORD-NOOP)
     (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                    FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                    GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                    OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                    TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                    GROUND-ZERO)
     (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
     (DISABLE TIMES PLUS)
     (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-LPSW)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2853
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2865
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
        (ARRAY-QFIRST (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS))))
        '2
        (PUTNTH (PLUS '15
                      (TIMES '9
                             (ARRAY-QFIRST (OS-READYQ OS))))
                '3
                (PUTNTH (TIMES '8
                               (ARRAY-QFIRST (OS-READYQ OS)))
                        '4
                        (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                           '16)
                                '6
                                (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '9
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '15))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-THRU-DELIVERY
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))))))
  (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
         (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)))
 ((ENABLE ACCESS-CURRENT-MBUFFER ACCESS-CURRENT-MBUFFER-QHEAD
          ACCESS-CURRENT-OS-MBUFFER-FIELDS-FOR-RECEIVE
          CONTRACT-GETNTH-FROM-CURRENT-MBUFFER-FOR-RECEIVE
          CONTRACT-PUTNTH-INTO-CURRENT-MBUFFER-FOR-RECEIVE1
          FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER-FOR-RECEIVE FINITE-NUMBERP
          LENGTH-TM-CPU LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE1
          LESSP-PLUS-FACT-FOR-MBUFFERS-FOR-RECEIVE2
          LIMITED-ASSOCIATIVITY-OF-PLUS OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-MBUFFERS-ADDRESS-FACTS2 OS-MBUFFERS-ADDRESS-FACTS3
          OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS-NEW-TASK-TABLE OS-SRCID
          OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO
          TM-PROCESSOR-WITH-NULL-ORACLE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS1
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-THRU-DELIVERY)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (OS-SRCID OS '16)
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (OS-SRCID OS '16)
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2898
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
           '1
           (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                              '16)
                   '2
                   (PUTNTH '191
                           '3
                           (PUTNTH (PLUS '195
                                         (GETNTH '1 (OS-READYQ OS)))
                                   '4
                                   (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)
                                           '6
                                           (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                (OS-STATUS-TABLE OS))
                        '2)
                 (EQUAL (GETNTH (PLUS '1
                                      (TIMES '2 (OS-SRCID OS '16)))
                                (OS-STATUS-TABLE OS))
                        (OS-CURRENT-TASKID OS)))))
  (EQUAL
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS))
        (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-STATUS-TABLE FINITE-NUMBERP
          LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-TASKID
          OS-READYQ-ADDRESS-FACTS OS-SRCID OS-STATUS-TABLE-ADDRESS-FACTS
          OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS-UPDATE-STATUS
          TM-CC-VALUE-ON-COMPARE-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2853
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
        (ARRAY-QFIRST (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS))))
        '2
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (REMAINDER (GETNTH '2 (TM-REGS OS))
                                        '16)))
                '3
                (PUTNTH (TIMES '8
                               (ARRAY-QFIRST (OS-READYQ OS)))
                        '4
                        (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                           '16)
                                '6
                                (TM-REGS OS)))))))
  (TM-CC-VALUE
         (TM-ALU-DIFFERENCE (GETNTH (TIMES '2
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16))
                                    (OS-STATUS-TABLE OS))
                            '2))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (NOT (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                (OS-STATUS-TABLE OS))
                        '2))))
  (EQUAL
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS))
        (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS)))
 ((ENABLE FINITE-NUMBERP LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-TASKID
          OS-SRCID OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2853
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
        (ARRAY-QFIRST (GETNTH (PLUS (ARRAY-QFIRST (OS-READYQ OS))
                                    (TIMES '16
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (TABLE '8 (OS-MBUFFERS OS))))
        '2
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (REMAINDER (GETNTH '2 (TM-REGS OS))
                                        '16)))
                '3
                (PUTNTH (TIMES '8
                               (ARRAY-QFIRST (OS-READYQ OS)))
                        '4
                        (PUTNTH (REMAINDER (GETNTH '2 (TM-REGS OS))
                                           '16)
                                '6
                                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE (GETNTH (PLUS '1
                                    (TIMES '2
                                           (REMAINDER (GETNTH '2 (TM-REGS OS))
                                                      '16)))
                              (OS-STATUS-TABLE OS))
                      (ARRAY-QFIRST (OS-READYQ OS))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                (OS-STATUS-TABLE OS))
                        '2)
                 (NOT (EQUAL (GETNTH (PLUS '1
                                           (TIMES '2 (OS-SRCID OS '16)))
                                     (OS-STATUS-TABLE OS))
                             (OS-CURRENT-TASKID OS))))))
  (EQUAL
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS))
        (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS)))
 ((ENABLE FINITE-NUMBERP LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-TASKID
          OS-SRCID OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (OS-SRCID OS '16)
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (OS-SRCID OS '16)
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                            (OS-CURRENT-TASKID OS)
                                            OS))
          '3
          (TM-REGS OS))
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-SVCR1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                        (OS-STATUS-TABLE OS))
                                '2)
                         (EQUAL (GETNTH (PLUS '1
                                              (TIMES '2 (OS-SRCID OS '16)))
                                        (OS-STATUS-TABLE OS))
                                (OS-CURRENT-TASKID OS)))))
          (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS)
                               (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))
                 (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-MBUFFER
          OS-CURRENT-TASKID OS-READYQ-ADDRESS-FACTS OS-SRCID
          OS-SVC-RECEIVE-HANDLER-PATH3
          OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
          OS-TASK-TABLE-ADDRESS-FACTS OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR
          OS-UPDATE-STATUS RESTORE-CC-FOR-RECEIVE-SVC-RETURN
          RESTORE-ERROR-FOR-RECEIVE-SVC-RETURN
          RESTORE-REGS-FOR-RECEIVE-SVC-RETURN
          RESTORE-SVCID-FOR-RECEIVE-SVC-RETURN TM-PROCESSOR-WITH-NULL-ORACLE)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
     (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
     (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                  (DESTID (OS-SRCID OS '16))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVCR1)

(DEFN
 OS-SVC-RECEIVE-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))
     '2
     (PUTNTH '1
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)
                          '499
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                            (OS-CURRENT-TASKID OS)
                                            OS))
          '3
          (TM-REGS OS))
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-TO-SVCR2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS)
                                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))
                  (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
  ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
           LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
           LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-MBUFFER
           OS-CURRENT-TASKID OS-READYQ-ADDRESS-FACTS OS-SRCID
           OS-SVC-RECEIVE-HANDLER-PATH4
           OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
           OS-TASK-TABLE-ADDRESS-FACTS OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR
           RESTORE-CC-FOR-RECEIVE-SVC-RETURN
           RESTORE-ERROR-FOR-RECEIVE-SVC-RETURN
           RESTORE-REGS-FOR-RECEIVE-SVC-RETURN
           RESTORE-SVCID-FOR-RECEIVE-SVC-RETURN)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVCR2)

(PROVE-LEMMA
  TRACE-SVC-RECEIVE-HANDLER-TO-SVCR3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS)
                                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))
                  (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
  ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
           LENGTH-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
           LENGTH-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-CURRENT-MBUFFER
           OS-CURRENT-TASKID OS-READYQ-ADDRESS-FACTS OS-SRCID
           OS-SVC-RECEIVE-HANDLER-PATH4
           OS-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
           OS-TASK-TABLE-ADDRESS-FACTS OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR
           RESTORE-CC-FOR-RECEIVE-SVC-RETURN
           RESTORE-ERROR-FOR-RECEIVE-SVC-RETURN
           RESTORE-REGS-FOR-RECEIVE-SVC-RETURN
           RESTORE-SVCID-FOR-RECEIVE-SVC-RETURN)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-TO-SVCR3)

(DEFN OS-SVC-RECEIVE-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-RECEIVE-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS-SVC-RECEIVE-TIME1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-RECEIVE-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (B (OS-SVC-RECEIVE-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE1)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-RECEIVE-TIME1 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS-SVC-RECEIVE-TIME1
          OS-SVC-RECEIVE-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-RECEIVE-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (B (OS-SVC-RECEIVE-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE2)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                (OS-SVC-RECEIVE-TIME2 OS))
  (TM-PROCESSOR
              (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME2 OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
                       (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-WAIT-STATE OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE3)

(PROVE-LEMMA
 TRACE-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1 OS))
         (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-SVC-RECEIVE-TRACE1 REWRITE-SVC-RECEIVE-TRACE2
          REWRITE-SVC-RECEIVE-TRACE3 TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          TRACE-SVC-RECEIVE-HANDLER-TO-WAIT-STATE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH1)

(DEFN OS-SVC-RECEIVE-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-RECEIVE-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-RECEIVE-TIME3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-RECEIVE-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (B (OS-SVC-RECEIVE-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE4)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-RECEIVE-TIME3 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS-SVC-RECEIVE-TIME3
          OS-SVC-RECEIVE-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-RECEIVE-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (B (OS-SVC-RECEIVE-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE5)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE6
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                (OS-SVC-RECEIVE-TIME4 OS))
  (TM-PROCESSOR
              (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME4 OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                         (TM (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                         (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-DISPATCHER OS))
                         (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE6)

(PROVE-LEMMA
 TRACE-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2 OS))
         (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-SVC-RECEIVE-TRACE4 REWRITE-SVC-RECEIVE-TRACE5
          REWRITE-SVC-RECEIVE-TRACE6 TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-RECEIVE-HANDLER-TO-DISPATCHER
          TRACE-SVC-RECEIVE-HANDLER-TO-LPSW)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH2)

(DEFN OS-SVC-RECEIVE-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-RECEIVE-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-RECEIVE-TIME5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-RECEIVE-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (B (OS-SVC-RECEIVE-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE7)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-RECEIVE-TIME5 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS-SVC-RECEIVE-TIME5
          OS-SVC-RECEIVE-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-RECEIVE-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (B (OS-SVC-RECEIVE-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE8)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE9
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                (OS-SVC-RECEIVE-TIME6 OS))
  (TM-PROCESSOR
              (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (OS-SVC-RECEIVE-TIME7 OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME6 OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-TIME7)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (B (OS-SVC-RECEIVE-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                         (TM (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                         (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                         (B (OS-SVC-RECEIVE-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE9)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                (OS-SVC-RECEIVE-TIME7 OS))
  (TM-PROCESSOR
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS))
        (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME7
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS))
              (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                   (TM (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                   (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1 OS))
                   (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE10)

(PROVE-LEMMA
 TRACE-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2)
                      (EQUAL (GETNTH (PLUS '1
                                           (TIMES '2 (OS-SRCID OS '16)))
                                     (OS-STATUS-TABLE OS))
                             (OS-CURRENT-TASKID OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3 OS))
         (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-SVC-RECEIVE-TRACE7 REWRITE-SVC-RECEIVE-TRACE8
          REWRITE-SVC-RECEIVE-TRACE9 REWRITE-SVC-RECEIVE-TRACE10
          TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK1
          TRACE-SVC-RECEIVE-HANDLER-TO-SVCR1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH3)

(DEFN OS-SVC-RECEIVE-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME9
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME10
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4A
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-RECEIVE-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4A OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-TIME8 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4A
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-RECEIVE-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-RECEIVE-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (B (OS-SVC-RECEIVE-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE11)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-RECEIVE-TIME8 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-TIME9 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS-SVC-RECEIVE-TIME8
          OS-SVC-RECEIVE-TIME9)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-RECEIVE-TIME9 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (B (OS-SVC-RECEIVE-TIME9 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE12)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE13
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                (OS-SVC-RECEIVE-TIME9 OS))
  (TM-PROCESSOR
              (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (OS-SVC-RECEIVE-TIME10 OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME9 OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-TIME10)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (B (OS-SVC-RECEIVE-TIME10 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                         (TM (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                         (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                         (B (OS-SVC-RECEIVE-TIME10 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE13)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE14
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                (OS-SVC-RECEIVE-TIME10 OS))
  (TM-PROCESSOR
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS))
        (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME10
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS))
              (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                   (TM (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                   (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2 OS))
                   (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE14)

(PROVE-LEMMA
 TRACE-SVC-RECEIVE-HANDLER-PATH4A
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (NOT (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4A OS))
         (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-SVC-RECEIVE-TRACE11 REWRITE-SVC-RECEIVE-TRACE12
          REWRITE-SVC-RECEIVE-TRACE13 REWRITE-SVC-RECEIVE-TRACE14
          TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK2
          TRACE-SVC-RECEIVE-HANDLER-TO-SVCR2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH4A)

(DEFN OS-SVC-RECEIVE-TIME11
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME12
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-RECEIVE-TIME13
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4B
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-RECEIVE-TRACE15
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4B OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
            (OS-SVC-RECEIVE-TIME11 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4B
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          OS-TIME-FOR-SVC-SEND-HANDLER-THRU-SAVE-STATE OS-SVC-RECEIVE-TIME11)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-RECEIVE-TIME11 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (B (OS-SVC-RECEIVE-TIME11 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE15)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE16
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-RECEIVE-TIME11 OS))
  (TM-PROCESSOR
            (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS)
                          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
            (OS-SVC-RECEIVE-TIME12 OS)))
 ((ENABLE OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          OS-SVC-RECEIVE-TIME11 OS-SVC-RECEIVE-TIME12)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-RECEIVE-TIME12 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                       (TM (OS-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE OS))
                       (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                       (B (OS-SVC-RECEIVE-TIME12 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE16)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE17
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                (OS-SVC-RECEIVE-TIME12 OS))
  (TM-PROCESSOR
              (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (OS-SVC-RECEIVE-TIME13 OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME12 OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          OS-SVC-RECEIVE-TIME13)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
              (B (OS-SVC-RECEIVE-TIME13 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                         (TM (OS-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST OS))
                         (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                         (B (OS-SVC-RECEIVE-TIME13 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE17)

(PROVE-LEMMA
 REWRITE-SVC-RECEIVE-TRACE18
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                (OS-SVC-RECEIVE-TIME13 OS))
  (TM-PROCESSOR
        (TM-PROCESSOR (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS)
                      (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS))
        (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-RECEIVE-TIME13
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS))
              (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                   (TM (OS-SVC-RECEIVE-HANDLER-THRU-DELIVERY OS))
                   (A (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3 OS))
                   (B (OS-TIME-FOR-SVC-RECEIVE-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-RECEIVE-TRACE18)

(PROVE-LEMMA
 TRACE-SVC-RECEIVE-HANDLER-PATH4B
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2)
                      (NOT (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4B OS))
         (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-SVC-RECEIVE-TRACE15 REWRITE-SVC-RECEIVE-TRACE16
          REWRITE-SVC-RECEIVE-TRACE17 REWRITE-SVC-RECEIVE-TRACE18
          TRACE-SVC-RECEIVE-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-RECEIVE-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-RECEIVE-HANDLER-THRU-DELIVERY
          TRACE-SVC-RECEIVE-HANDLER-TO-SVC-RESUME-TASK3
          TRACE-SVC-RECEIVE-HANDLER-TO-SVCR3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH4B)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4
      (OS)
      (IF (NOT (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                              (OS-STATUS-TABLE OS))
                      '2))
          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4A OS)
          (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4B OS))
      NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4 OS))
         (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
 ((ENABLE TRACE-SVC-RECEIVE-HANDLER-PATH4A TRACE-SVC-RECEIVE-HANDLER-PATH4B
          OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER-PATH4)

(DEFN OS-TIME-FOR-SVC-RECEIVE-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                             (OS-CURRENT-TASKID OS)
                                             OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1 OS)
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2 OS))
          (IF (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '2)
                   (EQUAL (GETNTH (PLUS '1
                                        (TIMES '2 (OS-SRCID OS '16)))
                                  (OS-STATUS-TABLE OS))
                          (OS-CURRENT-TASKID OS)))
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3 OS)
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4 OS)))
      NIL)

(DEFN OS-SVC-RECEIVE-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                             (OS-CURRENT-TASKID OS)
                                             OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-SVC-RECEIVE-HANDLER-PATH1 OS)
              (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
          (IF (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                  (OS-STATUS-TABLE OS))
                          '2)
                   (EQUAL (GETNTH (PLUS '1
                                        (TIMES '2 (OS-SRCID OS '16)))
                                  (OS-STATUS-TABLE OS))
                          (OS-CURRENT-TASKID OS)))
              (OS-SVC-RECEIVE-HANDLER-PATH3 OS)
              (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
      NIL)

(PROVE-LEMMA TRACE-SVC-RECEIVE-HANDLER
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                     '1)))
                    (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
                                         (OS-TIME-FOR-SVC-RECEIVE-HANDLER OS))
                           (OS-SVC-RECEIVE-HANDLER OS)))
           ((ENABLE TRACE-SVC-RECEIVE-HANDLER-PATH1
                    TRACE-SVC-RECEIVE-HANDLER-PATH2
                    TRACE-SVC-RECEIVE-HANDLER-PATH3
                    TRACE-SVC-RECEIVE-HANDLER-PATH4
                    OS-TIME-FOR-SVC-RECEIVE-HANDLER OS-SVC-RECEIVE-HANDLER)
            (DISABLE PLUS TIMES)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-RECEIVE-HANDLER)

(DEFN
 OS-INTENDED-SVC-TYI-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
    (TM-SP TM)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC TM)
                  (TM-ERROR TM)
                  (TM-SVCFLAG TM)
                  (TM-SVCID TM))
     '2
     (PUTNTH
       (TM-SVCID TM)
       '8
       (PUTSEG (OS-TASK-TABLE TM)
               '15
               (PUTSEG (OS-SEGMENT-TABLE TM)
                       '159
                       (PUTSEG (OS-READYQ TM)
                               '191
                               (PUTSEG (OS-STATUS-TABLE TM)
                                       '211
                                       (PUTSEG (OS-IBUFFERS TM)
                                               '243
                                               (PUTSEG (OS-CODE TM)
                                                       '2547
                                                       (TM-MEMORY TM)))))))))))
  (TM-SET-PC '2690
           (TM-SET-SP '3310
                      (TM-SET-SVMODE '1
                                     (TM-SET-ERROR '0
                                                   (TM-SET-RWSTATE '0 TM))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-SVC-TYI-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-SVC-INTERRUPT OS)
                             (OS-INTENDED-SVC-TYI-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-SVC-TYI-INTERRUPT OS-TASK-TABLE OS-READYQ
                      OS-CODE OS-SEGMENT-TABLE OS-STATUS-TABLE OS-IBUFFERS
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 OS-SVC-NEW-PC
                      TM-SLIMIT-OS)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (NON-1-FINITE-NUMBER-IS-ZERO (A (TM-RWSTATE OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '243)
                                              (K '128)
                                              (I '243)
                                              (L (TM-MEMORY OS))))
              (ENABLE-THEORY TM-DEFINITION GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-SVC-TYI-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-SVCID OS)
      '8
      (PUTNTH
       (TM-R2 OS)
       '13
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-NEW-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (OS-READYQ OS)
           '191
           (PUTSEG (OS-STATUS-TABLE OS)
                   '211
                   (PUTSEG (OS-IBUFFERS OS)
                           '243
                           (PUTSEG (OS-CODE OS)
                                   '2547
                                   (PUTNTH '2558
                                           '3309
                                           (PUTNTH '2692
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '2692
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (TM-R2 OS)
                          '2
                          (PUTNTH (TM-R3 OS)
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
          OS-INTENDED-SVC-TYI-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-SVC-TYI-HANDLER-THRU-SAVE-STATE
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-IBUFFERS OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2986
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2998
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH (PLUS '243
                                        (TIMES '8
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '8
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '243))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (AND (NOT (TM-WAITING OS))
                   (EQUAL (REMAINDER (TM-SVCID OS) '4)
                          '3)))
         (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
          OS-SVC-TYI-HANDLER-THRU-SAVE-STATE
          OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
          OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-TO-QEMPTYP-TEST)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '5
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3025
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3206
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH (PLUS '211
                                        (TIMES '2
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '2
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '211))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-TO-DISPATCHER
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (NOT (TM-WAITING OS))
                     (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                        OS))))
           (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                                (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
                  (OS-SVC-TYI-HANDLER-TO-DISPATCHER OS)))
  ((ENABLE ACCESS-CURRENT-IBUFFER FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
           FINITE-NUMBERP OS-CURRENT-IBUFFER OS-CURRENT-TASKID
           OS-IBUFFERS-ADDRESS-FACTS OS-NEW-TASK-TABLE
           OS-SVC-TYI-HANDLER-TO-DISPATCHER OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
           OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS-UPDATE-STATUS
           TM-FIX-WORD-NOOP)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '5
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3211
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH '191 '3 (TM-REGS OS)))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-TO-WAIT-STATE
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (NOT (TM-WAITING OS))
                     (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
           (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-DISPATCHER OS)
                                (OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE OS))
                  (OS-SVC-TYI-HANDLER-PATH1 OS)))
  ((ENABLE FINITE-NUMBERP OS-CURRENT-TASKID OS-NEW-TASK-TABLE
           OS-SVC-TYI-HANDLER-PATH1 OS-SVC-TYI-HANDLER-TO-DISPATCHER
           OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE OS-UPDATE-STATUS)
   (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                  GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                  OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-TO-WAIT-STATE)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS))))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '5
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3217
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-TO-LPSW
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                 (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-DISPATCHER OS)
                                      (OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW OS))
                        (OS-SVC-TYI-HANDLER-PATH2 OS)))
        ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
                 GETNTH-TABLE OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-READYQ-ADDRESS-FACTS OS-SVC-TYI-HANDLER-PATH2
                 OS-SVC-TYI-HANDLER-TO-DISPATCHER OS-TASK-TABLE-ADDRESS-FACTS
                 OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW OS-UPDATE-STATUS
                 TM-FIX-WORD-NOOP)
         (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                        FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                        GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                        OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                        TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS
                        TRACING-LEMMAS GROUND-ZERO)
         (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
         (DISABLE TIMES PLUS)
         (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-TO-LPSW)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-THRU-DELIVERY
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3006
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                                (TABLE '8 (OS-IBUFFERS OS))))
                          '2
                          (PUTNTH (PLUS '15
                                        (TIMES '9
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '9
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '15))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-THRU-DELIVERY
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                            (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY OS))
              (OS-SVC-TYI-HANDLER-THRU-DELIVERY OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER ACCESS-CURRENT-IBUFFER-QHEAD
          CONTRACT-GETNTH-FROM-CURRENT-IBUFFER
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP LENGTH-TM-CPU
          LESSP-PLUS-FACTS-FOR-IBUFFERS
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-IBUFFER OS-CURRENT-TASKID
          OS-IBUFFERS-ADDRESS-FACTS OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-THRU-DELIVERY
          OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS-TASK-TABLE-ADDRESS-FACTS
          OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
          OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-THRU-DELIVERY)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-TYI-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))
     '2
     (PUTNTH '3
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH (ARRAY-QFIRST (GETNTH (OS-CURRENT-TASKID OS)
                                (TABLE '8 (OS-IBUFFERS OS))))
          '3
          (TM-REGS OS))
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER-TO-SVCR
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-DELIVERY OS)
                                      (OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR OS))
                        (OS-SVC-TYI-HANDLER-PATH3 OS)))
        ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
                 LENGTH-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
                 LENGTH-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                 OS-CURRENT-TASKID OS-READYQ-ADDRESS-FACTS
                 OS-SVC-TYI-HANDLER-PATH3 OS-SVC-TYI-HANDLER-THRU-DELIVERY
                 OS-TASK-TABLE-ADDRESS-FACTS
                 OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR
                 RESTORE-CC-FOR-TYI-SVC-RETURN
                 RESTORE-ERROR-FOR-TYI-SVC-RETURN
                 RESTORE-REGS-FOR-TYI-SVC-RETURN
                 RESTORE-SVCID-FOR-TYI-SVC-RETURN)
         (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                        FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                        GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                        TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                        TRACING-LEMMAS GROUND-ZERO)
         (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
         (DISABLE TIMES PLUS)
         (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-TO-SVCR)

(DEFN OS-SVC-TYI-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYI-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYI-HANDLER-PATH1 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYI-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-PATH1
          OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS-SVC-TYI-TIME1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYI-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYI-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE1)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-TYI-TIME1 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                (OS-SVC-TYI-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS-SVC-TYI-TIME1
          OS-SVC-TYI-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-TYI-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                           (B (OS-SVC-TYI-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE2)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE3
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                  (OS-SVC-TYI-TIME2 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                                (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
                  (OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE OS)))
 ((ENABLE OS-SVC-TYI-TIME2 OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
                           (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-WAIT-STATE OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE3)

(PROVE-LEMMA
 TRACE-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-TYI-HANDLER-PATH1 OS))
         (OS-SVC-TYI-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-SVC-TYI-TRACE1 REWRITE-SVC-TYI-TRACE2 REWRITE-SVC-TYI-TRACE3
          TRACE-SVC-TYI-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-TYI-HANDLER-TO-DISPATCHER
          TRACE-SVC-TYI-HANDLER-TO-WAIT-STATE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-PATH1)

(DEFN OS-SVC-TYI-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-TYI-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYI-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYI-HANDLER-PATH2 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYI-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-PATH2
          OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS-SVC-TYI-TIME3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYI-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYI-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE4)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-TYI-TIME3 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                (OS-SVC-TYI-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS-SVC-TYI-TIME3
          OS-SVC-TYI-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-TYI-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                           (B (OS-SVC-TYI-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE5)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE6
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                  (OS-SVC-TYI-TIME4 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                                (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
                  (OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-SVC-TYI-TIME4 OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                             (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-DISPATCHER OS))
                             (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE6)

(PROVE-LEMMA
 TRACE-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-TYI-HANDLER-PATH2 OS))
         (OS-SVC-TYI-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-SVC-TYI-TRACE4 REWRITE-SVC-TYI-TRACE5 REWRITE-SVC-TYI-TRACE6
          TRACE-SVC-TYI-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-TYI-HANDLER-TO-DISPATCHER TRACE-SVC-TYI-HANDLER-TO-LPSW)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-PATH2)

(DEFN OS-SVC-TYI-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYI-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYI-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYI-HANDLER-PATH3 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYI-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-PATH3
          OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS-SVC-TYI-TIME5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYI-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYI-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE7)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                (OS-SVC-TYI-TIME5 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS)
                              (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                (OS-SVC-TYI-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS-SVC-TYI-TIME5
          OS-SVC-TYI-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
              (B (OS-SVC-TYI-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-TYI-HANDLER-THRU-SAVE-STATE OS))
                           (A (OS-TIME-FOR-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                           (B (OS-SVC-TYI-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE8)

(PROVE-LEMMA
 REWRITE-SVC-TYI-TRACE9
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                  (OS-SVC-TYI-TIME6 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS)
                                (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY OS))
                  (OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR OS)))
 ((ENABLE OS-SVC-TYI-TIME6 OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY
          OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY OS))
              (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-TYI-HANDLER-TO-QEMPTYP-TEST OS))
                             (A (OS-TIME-FOR-SVC-TYI-HANDLER-THRU-DELIVERY OS))
                             (B (OS-TIME-FOR-SVC-TYI-HANDLER-TO-SVCR OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYI-TRACE9)

(PROVE-LEMMA
 TRACE-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-TYI-HANDLER-PATH3 OS))
         (OS-SVC-TYI-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-SVC-TYI-TRACE7 REWRITE-SVC-TYI-TRACE8 REWRITE-SVC-TYI-TRACE9
          TRACE-SVC-TYI-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYI-HANDLER-TO-QEMPTYP-TEST
          TRACE-SVC-TYI-HANDLER-THRU-DELIVERY TRACE-SVC-TYI-HANDLER-TO-SVCR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER-PATH3)

(DEFN OS-TIME-FOR-SVC-TYI-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                             OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-TIME-FOR-SVC-TYI-HANDLER-PATH1 OS)
              (OS-TIME-FOR-SVC-TYI-HANDLER-PATH2 OS))
          (OS-TIME-FOR-SVC-TYI-HANDLER-PATH3 OS))
      NIL)

(DEFN OS-SVC-TYI-HANDLER
      (OS)
      (IF (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                             OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-SVC-TYI-HANDLER-PATH1 OS)
              (OS-SVC-TYI-HANDLER-PATH2 OS))
          (OS-SVC-TYI-HANDLER-PATH3 OS))
      NIL)

(PROVE-LEMMA TRACE-SVC-TYI-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                       '3)))
                      (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYI-INTERRUPT OS)
                                           (OS-TIME-FOR-SVC-TYI-HANDLER OS))
                             (OS-SVC-TYI-HANDLER OS)))
             ((ENABLE TRACE-SVC-TYI-HANDLER-PATH1 TRACE-SVC-TYI-HANDLER-PATH2
                      TRACE-SVC-TYI-HANDLER-PATH3 OS-TIME-FOR-SVC-TYI-HANDLER
                      OS-SVC-TYI-HANDLER)
              (DISABLE PLUS TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYI-HANDLER)

(DEFN
 OS-INTENDED-SVC-TYO-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
    (TM-SP TM)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC TM)
                  (TM-ERROR TM)
                  (TM-SVCFLAG TM)
                  (TM-SVCID TM))
     '2
     (PUTNTH
       (TM-SVCID TM)
       '8
       (PUTSEG (OS-TASK-TABLE TM)
               '15
               (PUTSEG (OS-SEGMENT-TABLE TM)
                       '159
                       (PUTSEG (OS-READYQ TM)
                               '191
                               (PUTSEG (OS-STATUS-TABLE TM)
                                       '211
                                       (PUTSEG (OS-OBUFFERS TM)
                                               '371
                                               (PUTSEG (OS-CODE TM)
                                                       '2547
                                                       (TM-MEMORY TM)))))))))))
  (TM-SET-PC '2690
           (TM-SET-SP '3310
                      (TM-SET-SVMODE '1
                                     (TM-SET-ERROR '0
                                                   (TM-SET-RWSTATE '0 TM))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-SVC-TYO-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-SVC-INTERRUPT OS)
                             (OS-INTENDED-SVC-TYO-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-SVC-TYO-INTERRUPT OS-TASK-TABLE OS-READYQ
                      OS-CODE OS-SEGMENT-TABLE OS-STATUS-TABLE OS-OBUFFERS
                      GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 OS-SVC-NEW-PC
                      TM-SLIMIT-OS)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (NON-1-FINITE-NUMBER-IS-ZERO (A (TM-RWSTATE OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '371)
                                              (K '128)
                                              (I '371)
                                              (L (TM-MEMORY OS))))
              (ENABLE-THEORY TM-DEFINITION GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-SVC-TYO-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-SVCID OS)
      '8
      (PUTNTH
       (TM-R2 OS)
       '13
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-NEW-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (OS-READYQ OS)
           '191
           (PUTSEG (OS-STATUS-TABLE OS)
                   '211
                   (PUTSEG (OS-OBUFFERS OS)
                           '371
                           (PUTSEG (OS-CODE OS)
                                   '2547
                                   (PUTNTH '2558
                                           '3309
                                           (PUTNTH '2692
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '2692
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (TM-R2 OS)
                          '2
                          (PUTNTH (TM-R3 OS)
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
          OS-INTENDED-SVC-TYO-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-SVC-TYO-HANDLER-THRU-SAVE-STATE
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-TO-QFULLP-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2930
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2942
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH (PLUS '371
                                        (TIMES '8
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  '3
                                  (PUTNTH (GETNTH '3 (TM-REGS OS))
                                          '7
                                          (TM-REGS OS))))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '8
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '371))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (REMAINDER (TM-SVCID OS) '4)
                           '2)))
          (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                               (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                 (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
          OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS-SVC-TYO-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-TO-DISPATCHER
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '4
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2964
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3206
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH (PLUS '211
                                        (TIMES '2
                                               (ARRAY-QFIRST (OS-READYQ OS))))
                                  '3
                                  (PUTNTH (GETNTH '3 (TM-REGS OS))
                                          '7
                                          (TM-REGS OS))))))
  (TM-CC-VALUE (TM-ALU-PLUS (TIMES '2
                                   (ARRAY-QFIRST (OS-READYQ OS)))
                            '211))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-DISPATCHER
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                              '2)
                       (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
        (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                             (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
               (OS-SVC-TYO-HANDLER-TO-DISPATCHER OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
          FINITE-NUMBERP OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-OBUFFERS-ADDRESS-FACTS
          OS-SVC-TYO-HANDLER-TO-DISPATCHER OS-SVC-TYO-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS-UPDATE-STATUS
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-DISPATCHER)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '4
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3211
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3222
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (ARRAY-QFIRST (OS-READYQ OS))
                          '2
                          (PUTNTH '191
                                  '3
                                  (PUTNTH (GETNTH '3 (TM-REGS OS))
                                          '7
                                          (TM-REGS OS))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-WAIT-STATE
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (NOT (TM-WAITING OS))
                     (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
           (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-DISPATCHER OS)
                                (OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE OS))
                  (OS-SVC-TYO-HANDLER-PATH1 OS)))
  ((ENABLE FINITE-NUMBERP OS-CURRENT-TASKID OS-NEW-TASK-TABLE
           OS-SVC-TYO-HANDLER-PATH1 OS-SVC-TYO-HANDLER-TO-DISPATCHER
           OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE OS-UPDATE-STATUS)
   (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                  GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                  OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-WAIT-STATE)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS))))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-DEQ (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                    '4
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3217
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
             OS)
  (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                  OS)
  (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
               OS)
  (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                OS)
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-LPSW
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                 (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-DISPATCHER OS)
                                      (OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW OS))
                        (OS-SVC-TYO-HANDLER-PATH2 OS)))
        ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-GETSEG
                 GETNTH-TABLE OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-READYQ-ADDRESS-FACTS OS-SVC-TYO-HANDLER-PATH2
                 OS-SVC-TYO-HANDLER-TO-DISPATCHER OS-TASK-TABLE-ADDRESS-FACTS
                 OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW OS-UPDATE-STATUS
                 TM-FIX-WORD-NOOP)
         (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                        FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                        GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-NEW-CPU
                        OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                        TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS
                        TRACING-LEMMAS GROUND-ZERO)
         (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
         (DISABLE TIMES PLUS)
         (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-LPSW)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-THRU-ENQUEUE
 (OS)
 (TM
  (PUTNTH
   (TM-R0 OS)
   '0
   (PUTNTH
    (TM-R1 OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '2951
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '2951
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (GETNTH '3 (TM-REGS OS))
     '2
     (PUTNTH
           (PLUS '371
                 (TIMES '8
                        (ARRAY-QFIRST (OS-READYQ OS))))
           '3
           (PUTNTH (PLUS '375
                         (PLUS (TIMES '8
                                      (ARRAY-QFIRST (OS-READYQ OS)))
                               (GETNTH '1
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (TABLE '8 (OS-OBUFFERS OS))))))
                   '4
                   (PUTNTH (GETNTH '3 (TM-REGS OS))
                           '7
                           (TM-REGS OS)))))))
  (TM-CC-VALUE
              (TM-ALU-INCR-MOD (GETNTH '1
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (TABLE '8 (OS-OBUFFERS OS))))
                               (GETNTH '3
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (TABLE '8 (OS-OBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-THRU-ENQUEUE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))))))
   (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                        (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
          (OS-SVC-TYO-HANDLER-THRU-ENQUEUE OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER
          FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER FINITE-NUMBERP
          LESSP-PLUS-FACTS-FOR-OBUFFERS
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-OBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS-SVC-TYO-HANDLER-THRU-ENQUEUE
          OS-SVC-TYO-HANDLER-TO-QFULLP-TEST
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-THRU-ENQUEUE)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-POST-OUTPUT-INTERRUPT (ARRAY-QFIRST (OS-READYQ OS))
                            (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-SVCR1
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                          (TM-OPORTS OS))))
                (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-ENQUEUE OS)
                                     (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1 OS))
                       (OS-SVC-TYO-HANDLER-PATH3 OS)))
       ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
                LENGTH-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
                OS-SVC-TYO-HANDLER-PATH3 OS-SVC-TYO-HANDLER-THRU-ENQUEUE
                OS-TASK-TABLE-ADDRESS-FACTS
                OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1 RESTORE-CC RESTORE-ERROR
                RESTORE-REGS1 RESTORE-SVCID)
        (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                       FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                       GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                       TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                       TRACING-LEMMAS GROUND-ZERO)
        (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
        (DISABLE TIMES PLUS)
        (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-SVCR1)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH '2
      '8
      (PUTNTH
       (ARRAY-QFIRST (OS-READYQ OS))
       '12
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3229
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  '0
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER-TO-SVCR2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (NOT (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                               (TM-OPORTS OS)))))
                (EQUAL (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-ENQUEUE OS)
                                     (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2 OS))
                       (OS-SVC-TYO-HANDLER-PATH4 OS)))
       ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
                LENGTH-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-READYQ-ADDRESS-FACTS
                OS-SVC-TYO-HANDLER-PATH4 OS-SVC-TYO-HANDLER-THRU-ENQUEUE
                OS-TASK-TABLE-ADDRESS-FACTS
                OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2 RESTORE-CC RESTORE-ERROR
                RESTORE-REGS1 RESTORE-SVCID)
        (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                       FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                       GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                       TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                       TRACING-LEMMAS GROUND-ZERO)
        (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
        (DISABLE TIMES PLUS)
        (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-TO-SVCR2)

(DEFN OS-SVC-TYO-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYO-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYO-HANDLER-PATH1 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYO-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-PATH1
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS-SVC-TYO-TIME1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYO-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYO-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE1)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE2
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                 (OS-SVC-TYO-TIME1 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                               (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                 (OS-SVC-TYO-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS-SVC-TYO-TIME1
          OS-SVC-TYO-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-TYO-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                            (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                            (B (OS-SVC-TYO-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE2)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE3
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                  (OS-SVC-TYO-TIME2 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                                (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
                  (OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE OS)))
 ((ENABLE OS-SVC-TYO-TIME2 OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                           (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
                           (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-WAIT-STATE OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE3)

(PROVE-LEMMA
 TRACE-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))
   (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                        (OS-TIME-FOR-SVC-TYO-HANDLER-PATH1 OS))
          (OS-SVC-TYO-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-SVC-TYO-TRACE1 REWRITE-SVC-TYO-TRACE2 REWRITE-SVC-TYO-TRACE3
          TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-TYO-HANDLER-TO-DISPATCHER
          TRACE-SVC-TYO-HANDLER-TO-WAIT-STATE)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-PATH1)

(DEFN OS-SVC-TYO-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-SVC-TYO-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYO-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYO-HANDLER-PATH2 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYO-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-PATH2
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS-SVC-TYO-TIME3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYO-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYO-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE4)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE5
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                 (OS-SVC-TYO-TIME3 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                               (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                 (OS-SVC-TYO-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS-SVC-TYO-TIME3
          OS-SVC-TYO-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-TYO-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                            (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                            (B (OS-SVC-TYO-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE5)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE6
 (REWRITE)
 (EQUAL
    (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                  (OS-SVC-TYO-TIME4 OS))
    (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                                (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
                  (OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-SVC-TYO-TIME4 OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                             (TM (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                             (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-DISPATCHER OS))
                             (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE6)

(PROVE-LEMMA
 TRACE-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
   (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                        (OS-TIME-FOR-SVC-TYO-HANDLER-PATH2 OS))
          (OS-SVC-TYO-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-SVC-TYO-TRACE4 REWRITE-SVC-TYO-TRACE5 REWRITE-SVC-TYO-TRACE6
          TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-TYO-HANDLER-TO-DISPATCHER TRACE-SVC-TYO-HANDLER-TO-LPSW)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-PATH2)

(DEFN OS-SVC-TYO-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYO-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYO-HANDLER-PATH3 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYO-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-PATH3
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS-SVC-TYO-TIME5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYO-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYO-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE7)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE8
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                 (OS-SVC-TYO-TIME5 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                               (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                 (OS-SVC-TYO-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS-SVC-TYO-TIME5
          OS-SVC-TYO-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-TYO-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                            (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                            (B (OS-SVC-TYO-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE8)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE9
 (REWRITE)
 (EQUAL
     (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                   (OS-SVC-TYO-TIME6 OS))
     (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                                 (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
                   (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1 OS)))
 ((ENABLE OS-SVC-TYO-TIME6 OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                              (TM (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                              (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
                              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE9)

(PROVE-LEMMA
 TRACE-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                  (TM-OPORTS OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-TYO-HANDLER-PATH3 OS))
         (OS-SVC-TYO-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-SVC-TYO-TRACE7 REWRITE-SVC-TYO-TRACE8 REWRITE-SVC-TYO-TRACE9
          TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-TYO-HANDLER-THRU-ENQUEUE TRACE-SVC-TYO-HANDLER-TO-SVCR1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-PATH3)

(DEFN OS-SVC-TYO-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-SVC-TYO-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER-PATH4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-SVC-TYO-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                (OS-TIME-FOR-SVC-TYO-HANDLER-PATH4 OS))
  (TM-PROCESSOR (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                              (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                (OS-SVC-TYO-TIME7 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-PATH4
          OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS-SVC-TYO-TIME7)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-SVC-TYO-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                           (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                           (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                           (B (OS-SVC-TYO-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE10)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE11
 (REWRITE)
 (EQUAL
   (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                 (OS-SVC-TYO-TIME7 OS))
   (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS)
                               (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                 (OS-SVC-TYO-TIME8 OS)))
 ((ENABLE OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS-SVC-TYO-TIME7
          OS-SVC-TYO-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
              (B (OS-SVC-TYO-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                            (TM (OS-SVC-TYO-HANDLER-THRU-SAVE-STATE OS))
                            (A (OS-TIME-FOR-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                            (B (OS-SVC-TYO-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE11)

(PROVE-LEMMA
 REWRITE-SVC-TYO-TRACE12
 (REWRITE)
 (EQUAL
     (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                   (OS-SVC-TYO-TIME8 OS))
     (TM-PROCESSOR (TM-PROCESSOR (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS)
                                 (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
                   (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2 OS)))
 ((ENABLE OS-SVC-TYO-TIME8 OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE
          OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                              (TM (OS-SVC-TYO-HANDLER-TO-QFULLP-TEST OS))
                              (A (OS-TIME-FOR-SVC-TYO-HANDLER-THRU-ENQUEUE OS))
                              (B (OS-TIME-FOR-SVC-TYO-HANDLER-TO-SVCR2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-SVC-TYO-TRACE12)

(PROVE-LEMMA
 TRACE-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (NOT (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                       (TM-OPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                       (OS-TIME-FOR-SVC-TYO-HANDLER-PATH4 OS))
         (OS-SVC-TYO-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-SVC-TYO-TRACE10 REWRITE-SVC-TYO-TRACE11
          REWRITE-SVC-TYO-TRACE12 TRACE-SVC-TYO-HANDLER-THRU-SAVE-STATE
          TRACE-SVC-TYO-HANDLER-TO-QFULLP-TEST
          TRACE-SVC-TYO-HANDLER-THRU-ENQUEUE TRACE-SVC-TYO-HANDLER-TO-SVCR2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER-PATH4)

(DEFN OS-TIME-FOR-SVC-TYO-HANDLER
      (OS)
      (IF (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                            OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-TIME-FOR-SVC-TYO-HANDLER-PATH1 OS)
              (OS-TIME-FOR-SVC-TYO-HANDLER-PATH2 OS))
          (IF (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                              (TM-OPORTS OS))
              (OS-TIME-FOR-SVC-TYO-HANDLER-PATH3 OS)
              (OS-TIME-FOR-SVC-TYO-HANDLER-PATH4 OS)))
      NIL)

(DEFN OS-SVC-TYO-HANDLER
      (OS)
      (IF (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                            OS))
          (IF (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))
              (OS-SVC-TYO-HANDLER-PATH1 OS)
              (OS-SVC-TYO-HANDLER-PATH2 OS))
          (IF (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                              (TM-OPORTS OS))
              (OS-SVC-TYO-HANDLER-PATH3 OS)
              (OS-SVC-TYO-HANDLER-PATH4 OS)))
      NIL)

(PROVE-LEMMA TRACE-SVC-TYO-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                       '2)))
                      (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                                           (OS-TIME-FOR-SVC-TYO-HANDLER OS))
                             (OS-SVC-TYO-HANDLER OS)))
             ((ENABLE TRACE-SVC-TYO-HANDLER-PATH1 TRACE-SVC-TYO-HANDLER-PATH2
                      TRACE-SVC-TYO-HANDLER-PATH3 TRACE-SVC-TYO-HANDLER-PATH4
                      OS-TIME-FOR-SVC-TYO-HANDLER OS-SVC-TYO-HANDLER)
              (DISABLE PLUS TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-TYO-HANDLER)

(DEFN
 OS-INTENDED-INPUT-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
    (TM-SP TM)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC TM)
                  (TM-ERROR TM)
                  (TM-SVCFLAG TM)
                  (TM-SVCID TM))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
                         (TM-IPORTS TM)))
       '9
       (PUTSEG
              (OS-TASK-TABLE TM)
              '15
              (PUTSEG (OS-SEGMENT-TABLE TM)
                      '159
                      (PUTSEG (OS-READYQ TM)
                              '191
                              (PUTSEG (OS-STATUS-TABLE TM)
                                      '211
                                      (PUTSEG (OS-IBUFFERS TM)
                                              '243
                                              (PUTSEG (OS-CODE TM)
                                                      '2547
                                                      (TM-MEMORY TM))))))))))))
  (TM-SET-PC '3042
   (TM-SET-SP '3310
    (TM-SET-SVMODE '1
     (TM-SET-ERROR '0
      (TM-SET-RWSTATE '0
       (TM-SET-IPORTS
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS TM))
                                    (TM-IPORTS TM))
          TM)))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-INPUT-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TM-EXECUTE-INPUT-INTERRUPT OS)
                             (OS-INTENDED-INPUT-INTERRUPT OS)))
             ((ENABLE GETNTH-PUTNTH-NON-INTERFERENCE OS-CODE OS-IBUFFERS
                      OS-INPUT-NEW-PC OS-INTENDED-INPUT-INTERRUPT OS-READYQ
                      OS-SEGMENT-TABLE OS-STATUS-TABLE OS-TASK-TABLE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 TM-SLIMIT-OS)
              (ENABLE-THEORY GOOD-TM-PROPERTIES TM-DEFINITION GROUND-ZERO)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '243)
                                              (K '128)
                                              (I '243)
                                              (L (TM-MEMORY OS))))
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-INPUT-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG (OS-READYQ OS)
                   '191
                   (PUTSEG (OS-STATUS-TABLE OS)
                           '211
                           (PUTSEG (OS-IBUFFERS OS)
                                   '243
                                   (PUTSEG (OS-CODE OS)
                                           '2547
                                           (PUTNTH '3053
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3063
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH '191 '3 (TM-REGS OS))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
            (TM-WAITING OS)))
  (EQUAL
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-INTENDED-INPUT-INTERRUPT
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3085
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3091
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
             (PLUS '195
                   (GETNTH '1 (OS-READYQ OS)))
             '4
             (PUTNTH (PLUS '211
                           (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     '5
                     (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (TM-WAITING OS)
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL
     (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                   (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)))
 ((ENABLE CONTRACT-ARRAY-ENQ-INSTANCE FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          OS-READYQ-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-UPDATE-STATUS OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER1
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3112
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
       (PLUS '247
        (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
       '4
       (PUTNTH (PLUS '211
                     (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
               '5
               (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-PLUS
    (PLUS '243
     (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
    '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-QREPLACE
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1 DECR-MOD-SIZE
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-IBUFFER
          OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER1
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST QREPLACE-ADDRESS-FACT
          TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER1)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3126
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER2
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST REMAINDER-NOOP TICK
          TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER2)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER3
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3133
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS)))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER3
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST REMAINDER-NOOP TICK
          TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP
          TM-IPORT-ERROR-FLAG-IS-ZERO)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER3)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
           (OS-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
            (OS-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
             (OS-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3217
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (GETSEG '0
          '8
          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (TABLE '9 (OS-TASK-TABLE OS))))
  (REMAINDER (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '256)
   '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '512)
   '256)
  (QUOTIENT (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
  (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                 (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-LPSW1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS)
                               (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))
                 (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-ARRAY-QFIRST
          CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
          OS-READYQ-ADDRESS-FACTS OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-PATH1
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER1
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                  (QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-LPSW1)

(DEFN
 OS-WAITING-INPUT-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
           (OS-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
            (OS-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
             (OS-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3217
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (GETSEG '0
          '8
          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (TABLE '9 (OS-TASK-TABLE OS))))
  (REMAINDER (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '256)
   '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '512)
   '256)
  (QUOTIENT (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
  (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                 (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-LPSW2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS)
                               (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))
                 (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-ARRAY-QFIRST
          CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS-READYQ-ADDRESS-FACTS
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-PATH2
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                  (QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-LPSW2)

(DEFN
 OS-WAITING-INPUT-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
           (OS-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
            (OS-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
             (OS-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)
                  '211
                  (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                          '243
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '3217
                                          '3310
                                          (TM-MEMORY OS)))))))))))))))
  (GETSEG '0
          '8
          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (TABLE '9 (OS-TASK-TABLE OS))))
  (REMAINDER (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '256)
   '4)
  (QUOTIENT
   (REMAINDER
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))
             '512)
   '256)
  (QUOTIENT (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
  (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                 (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-LPSW3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS)
                               (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))
                 (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-ARRAY-QFIRST
          CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-READYQ-ADDRESS-FACTS
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          OS-WAITING-INPUT-HANDLER-PATH3
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER3
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                  (QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-LPSW3)

(DEFN OS-WAITING-INPUT-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE1)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME1 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                   (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-WAITING-INPUT-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-WAITING-INPUT-TIME1 OS-WAITING-INPUT-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-WAITING-INPUT-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
                (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-WAITING-INPUT-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE2)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-WAITING-INPUT-TIME2 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-WAITING-INPUT-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER1 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE3)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1 OS))
         (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE1 REWRITE-WAITING-INPUT-TRACE2
          REWRITE-WAITING-INPUT-TRACE3
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER1
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-LPSW1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH1)

(DEFN OS-WAITING-INPUT-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE4)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME3 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                   (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-WAITING-INPUT-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-WAITING-INPUT-TIME3 OS-WAITING-INPUT-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-WAITING-INPUT-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
                (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-WAITING-INPUT-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE5)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE6
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-WAITING-INPUT-TIME4 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-WAITING-INPUT-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER2 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE6)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2 OS))
         (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE4 REWRITE-WAITING-INPUT-TRACE5
          REWRITE-WAITING-INPUT-TRACE6
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER2
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-LPSW2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH2)

(DEFN OS-WAITING-INPUT-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE7)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME5 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                   (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-WAITING-INPUT-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-WAITING-INPUT-TIME5 OS-WAITING-INPUT-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-WAITING-INPUT-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
                (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-WAITING-INPUT-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE8)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE9
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-WAITING-INPUT-TIME6 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS-WAITING-INPUT-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER3 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE9)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3 OS))
         (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE7 REWRITE-WAITING-INPUT-TRACE8
          REWRITE-WAITING-INPUT-TRACE9
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER3
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-LPSW3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH3)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG (OS-READYQ OS)
                   '191
                   (PUTSEG (OS-STATUS-TABLE OS)
                           '211
                           (PUTSEG (OS-IBUFFERS OS)
                                   '243
                                   (PUTSEG (OS-CODE OS)
                                           '2547
                                           (PUTNTH '3053
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3091
   '0
   (PUTNTH '3310
     '1
     (PUTNTH '191
             '3
             (PUTNTH (PLUS '211
                           (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     '5
                     (TM-REGS OS)))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE
                    (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
        (TM-WAITING OS)
        (NOT (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)))))
  (EQUAL
    (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                  (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)))
 ((ENABLE FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (FINITE-NUMBERP-GETNTH-OS-STATUS-TABLE
                        (I (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                        (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG (OS-STATUS-TABLE OS)
                     '211
                     (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                             '243
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '3112
                                             '3310
                                             (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
       (PLUS '247
        (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
       '4
       (PUTNTH (PLUS '211
                     (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
               '5
               (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-PLUS
    (PLUS '243
     (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
    '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-QREPLACE
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1 DECR-MOD-SIZE
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-IBUFFER
          OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER4
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 QREPLACE-ADDRESS-FACT
          TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER4)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER5
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
              (OS-READYQ OS)
              '191
              (PUTSEG (OS-STATUS-TABLE OS)
                      '211
                      (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                              '243
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '3126
                                              '3310
                                              (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER5
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 REMAINDER-NOOP TICK
          TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER5)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-TO-DISPATCHER6
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG (OS-READYQ OS)
                   '191
                   (PUTSEG (OS-STATUS-TABLE OS)
                           '211
                           (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                                   '243
                                   (PUTSEG (OS-CODE OS)
                                           '2547
                                           (PUTNTH '3133
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS)))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS))
         (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6
          OS-WAITING-INPUT-HANDLER-TO-DISPATCHER6
          OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 REMAINDER-NOOP TICK
          TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP
          TM-IPORT-ERROR-FLAG-IS-ZERO)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER6)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG (OS-STATUS-TABLE OS)
                     '211
                     (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                             '243
                             (PUTSEG (OS-CODE OS)
                                     '2547
                                     (PUTNTH '3211
                                             '3310
                                             (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
       (PLUS '247
        (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
       '4
       (PUTNTH (PLUS '211
                     (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
               '5
               (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-WAIT1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS)
                                (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))
                  (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
  ((ENABLE FINITE-NUMBERP OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
           OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT
           OS-WAITING-INPUT-HANDLER-PATH4
           OS-WAITING-INPUT-HANDLER-TO-DISPATCHER4)
   (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES
                  GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                  OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-WAIT1)

(DEFN
 OS-WAITING-INPUT-HANDLER-PATH5
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
              (OS-READYQ OS)
              '191
              (PUTSEG (OS-STATUS-TABLE OS)
                      '211
                      (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                              '243
                              (PUTSEG (OS-CODE OS)
                                      '2547
                                      (PUTNTH '3211
                                              '3310
                                              (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-WAIT2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS)
                                (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))
                  (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
  ((ENABLE FINITE-NUMBERP OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
           OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT
           OS-WAITING-INPUT-HANDLER-PATH5
           OS-WAITING-INPUT-HANDLER-TO-DISPATCHER5)
   (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES
                  GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                  OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-WAIT2)

(DEFN
 OS-WAITING-INPUT-HANDLER-PATH6
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3206
        '10
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG (OS-READYQ OS)
                   '191
                   (PUTSEG (OS-STATUS-TABLE OS)
                           '211
                           (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                                   '243
                                   (PUTSEG (OS-CODE OS)
                                           '2547
                                           (PUTNTH '3211
                                                   '3310
                                                   (TM-MEMORY OS)))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS)))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER-TO-WAIT3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (TM-WAITING OS)))
           (EQUAL (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS)
                                (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))
                  (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
  ((ENABLE FINITE-NUMBERP OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
           OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT
           OS-WAITING-INPUT-HANDLER-PATH6
           OS-WAITING-INPUT-HANDLER-TO-DISPATCHER6)
   (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES
                  GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                  OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                  TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-TO-WAIT3)

(DEFN OS-WAITING-INPUT-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME7 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME7)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE10)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME7 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                  (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-WAITING-INPUT-TIME8 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-WAITING-INPUT-TIME7 OS-WAITING-INPUT-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-WAITING-INPUT-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
               (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-WAITING-INPUT-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE11)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-WAITING-INPUT-TIME8 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS-WAITING-INPUT-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER4 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE12)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4 OS))
         (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE10 REWRITE-WAITING-INPUT-TRACE11
          REWRITE-WAITING-INPUT-TRACE12
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER4
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-WAITING-INPUT-HANDLER-TO-WAIT1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH4)

(DEFN OS-WAITING-INPUT-TIME9
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME10
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE13
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME9 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME9)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME9 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME9 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE13)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE14
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME9 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                  (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-WAITING-INPUT-TIME10 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-WAITING-INPUT-TIME10 OS-WAITING-INPUT-TIME9)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-WAITING-INPUT-TIME10 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
               (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-WAITING-INPUT-TIME10 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE14)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE15
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-WAITING-INPUT-TIME10 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS-WAITING-INPUT-TIME10)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER5 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE15)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5 OS))
         (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE13 REWRITE-WAITING-INPUT-TRACE14
          REWRITE-WAITING-INPUT-TRACE15
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER5
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-WAITING-INPUT-HANDLER-TO-WAIT2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH5)

(DEFN OS-WAITING-INPUT-TIME11
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-INPUT-TIME12
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-INPUT-TRACE16
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                 (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-INPUT-TIME11 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6
          OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-INPUT-TIME11)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME11 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-INTENDED-INPUT-INTERRUPT OS))
              (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (B (OS-WAITING-INPUT-TIME11 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE16)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE17
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-INPUT-TIME11 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                  (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-WAITING-INPUT-TIME12 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-WAITING-INPUT-TIME11 OS-WAITING-INPUT-TIME12)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-WAITING-INPUT-TIME12 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
               (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-WAITING-INPUT-TIME12 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE17)

(PROVE-LEMMA
 REWRITE-WAITING-INPUT-TRACE18
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-WAITING-INPUT-TIME12 OS))
  (TM-PROCESSOR
           (TM-PROCESSOR (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                         (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS))
           (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
 ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6
          OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS-WAITING-INPUT-TIME12)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS))
              (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                      (TM (OS-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                      (A (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-DISPATCHER6 OS))
                      (B (OS-TIME-FOR-WAITING-INPUT-HANDLER-TO-WAIT OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-INPUT-TRACE18)

(PROVE-LEMMA
 TRACE-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6 OS))
         (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE REWRITE-WAITING-INPUT-TRACE16 REWRITE-WAITING-INPUT-TRACE17
          REWRITE-WAITING-INPUT-TRACE18
          TRACE-WAITING-INPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-INPUT-HANDLER-TO-DISPATCHER6
          TRACE-WAITING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-WAITING-INPUT-HANDLER-TO-WAIT3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER-PATH6)

(DEFN
 OS-TIME-FOR-WAITING-INPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '5)
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2 OS)
       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3 OS)))
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5 OS)
       (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6 OS))))
 NIL)

(DEFN OS-WAITING-INPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '5)
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-WAITING-INPUT-HANDLER-PATH1 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-WAITING-INPUT-HANDLER-PATH2 OS)
       (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-WAITING-INPUT-HANDLER-PATH4 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-WAITING-INPUT-HANDLER-PATH5 OS)
       (OS-WAITING-INPUT-HANDLER-PATH6 OS))))
 NIL)

(PROVE-LEMMA TRACE-WAITING-INPUT-HANDLER
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                             (TM-WAITING OS)))
                   (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                                        (OS-TIME-FOR-WAITING-INPUT-HANDLER OS))
                          (OS-WAITING-INPUT-HANDLER OS)))
          ((ENABLE OS-TIME-FOR-WAITING-INPUT-HANDLER OS-WAITING-INPUT-HANDLER
                   TRACE-WAITING-INPUT-HANDLER-PATH1
                   TRACE-WAITING-INPUT-HANDLER-PATH2
                   TRACE-WAITING-INPUT-HANDLER-PATH3
                   TRACE-WAITING-INPUT-HANDLER-PATH4
                   TRACE-WAITING-INPUT-HANDLER-PATH5
                   TRACE-WAITING-INPUT-HANDLER-PATH6)
           (DISABLE PLUS TIMES)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-INPUT-HANDLER)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3063
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3063
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (GETNTH '2 (TM-REGS OS))
                          '2
                          (PUTNTH (GETNTH '3 (TM-REGS OS))
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (NOT (TM-WAITING OS))))
   (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
          OS-INTENDED-INPUT-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3085
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3091
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
             (PLUS '195
                   (GETNTH '1 (OS-READYQ OS)))
             '4
             (PUTNTH (PLUS '211
                           (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     '5
                     (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL
     (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)))
 ((ENABLE CONTRACT-ARRAY-ENQ FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-UPDATE-STATUS)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3112
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
       (PLUS '247
        (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
       '4
       (PUTNTH (PLUS '211
                     (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
               '5
               (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-PLUS
    (PLUS '243
     (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
    '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-QREPLACE
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1 DECR-MOD-SIZE
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-IBUFFER
          OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS-UPDATE-STATUS
          QREPLACE-ADDRESS-FACT TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3126
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS-UPDATE-STATUS
          REMAINDER-NOOP TICK TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP
          TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3133
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS)))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS-UPDATE-STATUS
          REMAINDER-NOOP TICK TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP
          TM-IPORT-ERROR-FLAG-IS-ZERO)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
         (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH1
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          RESTORE-CC RESTORE-ERROR RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW1)

(DEFN
 OS-RUNNING-INPUT-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
         (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH2
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          RESTORE-CC RESTORE-ERROR RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW2)

(DEFN
 OS-RUNNING-INPUT-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (OS-READYQ OS))
             '191
             (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
         (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH3
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          RESTORE-CC RESTORE-ERROR RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW3)

(DEFN OS-RUNNING-INPUT-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME1 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME1 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE1)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME1 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-RUNNING-INPUT-TIME2 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME1 OS-RUNNING-INPUT-TIME2
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-RUNNING-INPUT-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-RUNNING-INPUT-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE2)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-RUNNING-INPUT-TIME2 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME2 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE3)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE1 REWRITE-RUNNING-INPUT-TRACE2
          REWRITE-RUNNING-INPUT-TRACE3
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW1
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH1)

(DEFN OS-RUNNING-INPUT-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME3 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME3 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE4)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME3 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-RUNNING-INPUT-TIME4 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME3 OS-RUNNING-INPUT-TIME4
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-RUNNING-INPUT-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-RUNNING-INPUT-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE5)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE6
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-RUNNING-INPUT-TIME4 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME4 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE6)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE4 REWRITE-RUNNING-INPUT-TRACE5
          REWRITE-RUNNING-INPUT-TRACE6
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW2
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH2)

(DEFN OS-RUNNING-INPUT-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME5 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME5 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE7)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME5 OS))
  (TM-PROCESSOR
     (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
     (OS-RUNNING-INPUT-TIME6 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME5 OS-RUNNING-INPUT-TIME6
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
              (B (OS-RUNNING-INPUT-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                (B (OS-RUNNING-INPUT-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE8)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE9
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                (OS-RUNNING-INPUT-TIME6 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME6 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE9)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE7 REWRITE-RUNNING-INPUT-TRACE8
          REWRITE-RUNNING-INPUT-TRACE9
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW3
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH3)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3063
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3091
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (GETNTH '2 (TM-REGS OS))
     '2
     (PUTNTH (GETNTH '3 (TM-REGS OS))
             '3
             (PUTNTH (PLUS '211
                           (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     '5
                     (TM-REGS OS))))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE
                    (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
        (NOT (TM-WAITING OS))
        (NOT (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)))))
  (EQUAL
    (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                  (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)))
 ((ENABLE FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (FINITE-NUMBERP-GETNTH-OS-STATUS-TABLE
                        (I (TIMES '2
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                        (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3112
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
       (PLUS '247
        (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
       '4
       (PUTNTH (PLUS '211
                     (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
               '5
               (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-PLUS
    (PLUS '243
     (PLUS
          (TIMES '8
                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
          (DECR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    '4)))
    '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-QREPLACE
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER1 DECR-MOD-SIZE
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-IBUFFER
          OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
          QREPLACE-ADDRESS-FACT TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3126
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (PLUS '256
           (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 REMAINDER-NOOP
          TICK TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP TM-ICHAR-FACTS)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3133
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (TM-IPORTS OS)))
     '2
     (PUTNTH
      (PLUS '243
            (TIMES '8
                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
      '3
      (PUTNTH
        (PLUS '247
              (PLUS (TIMES '8
                           (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                    (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
        '4
        (PUTNTH (PLUS '211
                      (TIMES '2
                             (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                '5
                (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD (GETNTH '1
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))
                    (GETNTH '3
                            (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '8 (OS-IBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT
       (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
      (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS))
         (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS)))
 ((ENABLE ACCESS-CURRENT-IBUFFER CONTRACT-ARRAY-ENQ
          CONTRACT-PUTNTH-INTO-CURRENT-IBUFFER2
          FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-IBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 MORE-IBUFFER-ADDRESS-FACTS
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
          OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
          OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 REMAINDER-NOOP TICK
          TM-CC-VALUE-ON-COMPARE-LESSP TM-FIX-WORD-NOOP
          TM-IPORT-ERROR-FLAG-IS-ZERO)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QCURRLENGTH-IN-A-NON-FULL-QUEUE
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6)

(DEFN
 OS-RUNNING-INPUT-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW4
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (NOT (TM-WAITING OS))))
           (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS)
                                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
                  (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
  ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-TABLE
           LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
           OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
           OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH4
           OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4
           OS-TASK-TABLE-ADDRESS-FACTS
           OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW RESTORE-CC RESTORE-ERROR
           RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID TM-FIX-WORD-NOOP)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW4)

(DEFN
 OS-RUNNING-INPUT-HANDLER-PATH5
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW5
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (NOT (TM-WAITING OS))))
           (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS)
                                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
                  (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
  ((ENABLE CONTRACT-ARRAY-QFIRST CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
           GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
           OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS-NEW-TASK-TABLE
           OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH5
           OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5
           OS-TASK-TABLE-ADDRESS-FACTS
           OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW RESTORE-CC RESTORE-ERROR
           RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID TM-FIX-WORD-NOOP)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW5)

(DEFN
 OS-RUNNING-INPUT-HANDLER-PATH6
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
      '8
      (PUTNTH
       (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (TM-IPORTS OS)))
       '9
       (PUTNTH '3231
        '10
        (PUTNTH
         (TM-R2 OS)
         '13
         (PUTNTH
          (TM-R3 OS)
          '14
          (PUTSEG
           (OS-NEW-TASK-TABLE OS)
           '15
           (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG
             (OS-READYQ OS)
             '191
             (PUTSEG
                 (OS-STATUS-TABLE OS)
                 '211
                 (PUTSEG (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)
                         '243
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS)))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TM-IPORTS OS))
  (TM-OPORTS OS))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER-TO-LPSW6
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                     (NOT (TM-WAITING OS))))
           (EQUAL (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS)
                                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))
                  (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
  ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-TABLE
           LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID
           OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE
           OS-READYQ-ADDRESS-FACTS OS-RUNNING-INPUT-HANDLER-PATH6
           OS-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6
           OS-TASK-TABLE-ADDRESS-FACTS
           OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW RESTORE-CC RESTORE-ERROR
           RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID TM-FIX-WORD-NOOP)
   (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                  FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                  GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                  TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                  TRACING-LEMMAS GROUND-ZERO)
   (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
   (DISABLE TIMES PLUS)
   (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-TO-LPSW6)

(DEFN OS-RUNNING-INPUT-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME7 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME7 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE10)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME7 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                  (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-RUNNING-INPUT-TIME8 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME7 OS-RUNNING-INPUT-TIME8
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-RUNNING-INPUT-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
               (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-RUNNING-INPUT-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE11)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-RUNNING-INPUT-TIME8 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME8 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE12)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE10 REWRITE-RUNNING-INPUT-TRACE11
          REWRITE-RUNNING-INPUT-TRACE12
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW4
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH4)

(DEFN OS-RUNNING-INPUT-TIME9
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME10
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE13
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME9 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME9 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME9 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME9 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE13)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE14
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME9 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                  (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-RUNNING-INPUT-TIME10 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME10 OS-RUNNING-INPUT-TIME9
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-RUNNING-INPUT-TIME10 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
               (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-RUNNING-INPUT-TIME10 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE14)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE15
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-RUNNING-INPUT-TIME10 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME10 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE15)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE13 REWRITE-RUNNING-INPUT-TRACE14
          REWRITE-RUNNING-INPUT-TRACE15
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW5
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK5)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH5)

(DEFN OS-RUNNING-INPUT-TIME11
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-INPUT-TIME12
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-INPUT-TRACE16
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
          (OS-RUNNING-INPUT-TIME11 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME11 OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-INPUT-TIME11 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
                     (B (OS-RUNNING-INPUT-TIME11 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE16)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE17
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-INPUT-TIME11 OS))
  (TM-PROCESSOR
    (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS)
                  (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
    (OS-RUNNING-INPUT-TIME12 OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME11 OS-RUNNING-INPUT-TIME12
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
              (B (OS-RUNNING-INPUT-TIME12 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
               (TM (OS-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE OS))
               (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
               (B (OS-RUNNING-INPUT-TIME12 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE17)

(PROVE-LEMMA
 REWRITE-RUNNING-INPUT-TRACE18
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                (OS-RUNNING-INPUT-TIME12 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS)
                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS))
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-INPUT-TIME12 OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS))
              (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2 OS))
                     (A (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6 OS))
                     (B (OS-TIME-FOR-RUNNING-INPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-INPUT-TRACE18)

(PROVE-LEMMA
 TRACE-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6 OS))
         (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE REWRITE-RUNNING-INPUT-TRACE16 REWRITE-RUNNING-INPUT-TRACE17
          REWRITE-RUNNING-INPUT-TRACE18
          TRACE-RUNNING-INPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-INPUT-HANDLER-TO-IBUFFER-FULL-TEST2
          TRACE-RUNNING-INPUT-HANDLER-TO-LPSW6
          TRACE-RUNNING-INPUT-HANDLER-TO-RESUME-TASK6)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER-PATH6)

(DEFN
 OS-TIME-FOR-RUNNING-INPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '5)
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2 OS)
       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3 OS)))
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5 OS)
       (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6 OS))))
 NIL)

(DEFN OS-RUNNING-INPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '5)
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-RUNNING-INPUT-HANDLER-PATH1 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-RUNNING-INPUT-HANDLER-PATH2 OS)
       (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
  (IF
   (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))
   (OS-RUNNING-INPUT-HANDLER-PATH4 OS)
   (IF (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS))
       (OS-RUNNING-INPUT-HANDLER-PATH5 OS)
       (OS-RUNNING-INPUT-HANDLER-PATH6 OS))))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-INPUT-HANDLER
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                             (NOT (TM-WAITING OS))))
                   (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                                        (OS-TIME-FOR-RUNNING-INPUT-HANDLER OS))
                          (OS-RUNNING-INPUT-HANDLER OS)))
          ((ENABLE OS-RUNNING-INPUT-HANDLER OS-TIME-FOR-RUNNING-INPUT-HANDLER
                   TRACE-RUNNING-INPUT-HANDLER-PATH1
                   TRACE-RUNNING-INPUT-HANDLER-PATH2
                   TRACE-RUNNING-INPUT-HANDLER-PATH3
                   TRACE-RUNNING-INPUT-HANDLER-PATH4
                   TRACE-RUNNING-INPUT-HANDLER-PATH5
                   TRACE-RUNNING-INPUT-HANDLER-PATH6)
           (DISABLE PLUS TIMES)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-INPUT-HANDLER)

(DEFN
 OS-INTENDED-OUTPUT-INTERRUPT
 (TM)
 (TM-SET-MEMORY
  (PUTNTH
   (TM-PC TM)
   '0
   (PUTNTH
    (TM-SP TM)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC TM)
                  (TM-ERROR TM)
                  (TM-SVCFLAG TM)
                  (TM-SVCID TM))
     '2
     (PUTNTH
       (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
       '9
       (PUTSEG (OS-TASK-TABLE TM)
               '15
               (PUTSEG (OS-SEGMENT-TABLE TM)
                       '159
                       (PUTSEG (OS-READYQ TM)
                               '191
                               (PUTSEG (OS-STATUS-TABLE TM)
                                       '211
                                       (PUTSEG (OS-OBUFFERS TM)
                                               '371
                                               (PUTSEG (OS-CODE TM)
                                                       '2547
                                                       (TM-MEMORY TM)))))))))))
  (TM-SET-PC '3135
   (TM-SET-SP '3310
    (TM-SET-SVMODE '1
     (TM-SET-ERROR '0
      (TM-SET-RWSTATE '0
       (TM-SET-OPORTS
        (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS TM))
                                   (TM-OPORTS TM))
        TM)))))))
 NIL)

(PROVE-LEMMA EQUIVALENCE-OF-OUTPUT-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TM-EXECUTE-OUTPUT-INTERRUPT OS)
                             (OS-INTENDED-OUTPUT-INTERRUPT OS)))
             ((ENABLE GETNTH-PUTNTH-NON-INTERFERENCE OS-CODE
                      OS-INTENDED-OUTPUT-INTERRUPT OS-OBUFFERS
                      OS-OUTPUT-NEW-PC OS-READYQ OS-SEGMENT-TABLE
                      OS-STATUS-TABLE OS-TASK-TABLE
                      PUTNTH-NON-INTERFERENCE-COROLLARY1 TM-SLIMIT-OS)
              (ENABLE-THEORY GOOD-TM-PROPERTIES TM-DEFINITION GROUND-ZERO)
              (USE (GOOD-TM-OS (OS OS))
                   (OS-NOT-IN-SUPERVISOR-MODE (OS OS))
                   (PUTSEG-GETSEG-COINCIDENCE (N '2547)
                                              (K '754)
                                              (I '2547)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '159)
                                              (K '32)
                                              (I '159)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '15)
                                              (K '144)
                                              (I '15)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '191)
                                              (K '20)
                                              (I '191)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '211)
                                              (K '32)
                                              (I '211)
                                              (L (TM-MEMORY OS)))
                   (PUTSEG-GETSEG-COINCIDENCE (N '371)
                                              (K '128)
                                              (I '371)
                                              (L (TM-MEMORY OS))))
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-OUTPUT-INTERRUPT-EXPRESSIONS)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3146
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3156
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH '191 '3 (TM-REGS OS))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (TM-WAITING OS)))
  (EQUAL
   (TM-PROCESSOR
                (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)))
 ((ENABLE FINITE-NUMBERP OS-INTENDED-OUTPUT-INTERRUPT
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (OS-READYQ OS))
           '191
           (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '3178
                                         '3310
                                         (TM-MEMORY OS))))))))))))))
  (PUTNTH '3184
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (TM-WAITING OS)
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL
   (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                 (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)))
 ((ENABLE CONTRACT-ARRAY-ENQ-INSTANCE FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          OS-READYQ-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-UPDATE-STATUS OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (OS-READYQ OS))
           '191
           (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '3195
                                         '3310
                                         (TM-MEMORY OS))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
     '2
     (PUTNTH
      (PLUS '371
            (TIMES '8
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS))
         (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
          FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER
          OS-OBUFFERS-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS-UPDATE-STATUS
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (OS-READYQ OS))
           '191
           (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '3204
                                         '3310
                                         (TM-MEMORY OS))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '8 (OS-OBUFFERS OS))))
     '2
     (PUTNTH
      (PLUS '371
            (TIMES '8
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD
                   (GETNTH '0
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
                   (GETNTH '3
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (NOT
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS))
         (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER ACCESS-CURRENT-OBUFFER-QHEAD
          CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1
          CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1
          FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OBUFFER-ADDRESS-FACTS
          OS-CURRENT-OBUFFER OS-OBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS-UPDATE-STATUS
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
           (OS-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            (OS-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
             (OS-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (OS-READYQ OS))
           '191
           (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '3217
                                         '3310
                                         (TM-MEMORY OS))))))))))))))
  (GETSEG '0
          '8
          (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                  (TABLE '9 (OS-TASK-TABLE OS))))
  (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '4)
  (QUOTIENT
   (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '256)
   '4)
  (QUOTIENT
   (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
   '256)
  (QUOTIENT (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
  (BASE (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (LIMIT (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                 (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS)
                               (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS))
                 (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-ARRAY-QFIRST
          CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK GETNTH-TABLE
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-READYQ-ADDRESS-FACTS
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          OS-WAITING-OUTPUT-HANDLER-PATH1
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                 (QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW1)

(DEFN
 OS-WAITING-OUTPUT-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
           (OS-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            (OS-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
             (OS-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
          (OS-SEGMENT-TABLE OS)
          '159
          (PUTSEG
           (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (OS-READYQ OS))
           '191
           (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '3217
                                         '3310
                                         (TM-MEMORY OS))))))))))))))
  (GETSEG '0
          '8
          (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                  (TABLE '9 (OS-TASK-TABLE OS))))
  (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '4)
  (QUOTIENT
   (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '256)
   '4)
  (QUOTIENT
   (REMAINDER
            (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
   '256)
  (QUOTIENT (GETNTH (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))
            '512)
  (BASE (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (LIMIT (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                 (TABLE '2 (OS-SEGMENT-TABLE OS))))
  (TM-SLIMIT OS)
  '0
  '0
  '1000
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS)
                               (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS))
                 (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-ARRAY-QFIRST
          CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-READYQ-ADDRESS-FACTS
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          OS-WAITING-OUTPUT-HANDLER-PATH2
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUE-QCURRLENGTH-SIZE-COROLLARY
                 (QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW2)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3146
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3184
   '0
   (PUTNTH '3310
    '1
    (PUTNTH '191
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE
                   (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
       (TM-WAITING OS)
       (NOT (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)))))
  (EQUAL
   (TM-PROCESSOR
                (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)))
 ((ENABLE FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (FINITE-NUMBERP-GETNTH-OS-STATUS-TABLE
                       (I (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                       (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3195
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH (PLUS '371
                  (TIMES '8
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS))
         (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
          FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER
          OS-OBUFFERS-ADDRESS-FACTS
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3204
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3206
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '8 (OS-OBUFFERS OS))))
     '2
     (PUTNTH
            (PLUS '371
                  (TIMES '8
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD
                   (GETNTH '0
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
                   (GETNTH '3
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (NOT
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS))
         (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER ACCESS-CURRENT-OBUFFER-QHEAD
          CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1
          CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1
          FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OBUFFER-ADDRESS-FACTS
          OS-CURRENT-OBUFFER OS-OBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
          OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT
      (OS)
      '(TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3211
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH '191
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS)
                               (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS))
                 (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE FINITE-NUMBERP OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT
          OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT1)

(DEFN
 OS-WAITING-OUTPUT-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3206
       '10
       (PUTNTH
        (TM-R3 OS)
        '14
        (PUTSEG
         (OS-TASK-TABLE OS)
         '15
         (PUTSEG
            (OS-SEGMENT-TABLE OS)
            '159
            (PUTSEG (OS-READYQ OS)
                    '191
                    (PUTSEG (OS-STATUS-TABLE OS)
                            '211
                            (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                                    '371
                                    (PUTSEG (OS-CODE OS)
                                            '2547
                                            (PUTNTH '3211
                                                    '3310
                                                    (TM-MEMORY OS))))))))))))))
  (PUTNTH '3222
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '8 (OS-OBUFFERS OS))))
     '2
     (PUTNTH '191
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '1
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (TM-WAITING OS)))
          (EQUAL (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS)
                               (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS))
                 (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE FINITE-NUMBERP OS-CURRENT-OBUFFER
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT
          OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT2)

(DEFN OS-WAITING-OUTPUT-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-OUTPUT-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME1 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME1)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE1)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME1 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                 (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME2 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME1 OS-WAITING-OUTPUT-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-WAITING-OUTPUT-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-WAITING-OUTPUT-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE2)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME2 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                        (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS))
          (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS-WAITING-OUTPUT-TIME2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS))
              (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
                     (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1 OS))
                     (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE3)

(PROVE-LEMMA
 TRACE-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1 OS))
         (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-WAITING-OUTPUT-TRACE1 REWRITE-WAITING-OUTPUT-TRACE2
          REWRITE-WAITING-OUTPUT-TRACE3
          TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER1
          TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW1
          TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-PATH1)

(DEFN OS-WAITING-OUTPUT-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-OUTPUT-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME3 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME3)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE4)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME3 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                 (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME4 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME3 OS-WAITING-OUTPUT-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-WAITING-OUTPUT-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
              (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-WAITING-OUTPUT-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE5)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE6
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME4 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                        (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS))
          (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS-WAITING-OUTPUT-TIME4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS))
              (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
                     (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2 OS))
                     (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE6)

(PROVE-LEMMA
 TRACE-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2 OS))
         (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-WAITING-OUTPUT-TRACE4 REWRITE-WAITING-OUTPUT-TRACE5
          REWRITE-WAITING-OUTPUT-TRACE6
          TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER2
          TRACE-WAITING-OUTPUT-HANDLER-TO-LPSW2
          TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-PATH2)

(DEFN OS-WAITING-OUTPUT-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-OUTPUT-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME5 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME5)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE7)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME5 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-WAITING-OUTPUT-TIME6 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-WAITING-OUTPUT-TIME5 OS-WAITING-OUTPUT-TIME6)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-WAITING-OUTPUT-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-WAITING-OUTPUT-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE8)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE9
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                (OS-WAITING-OUTPUT-TIME6 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                        (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS))
          (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS-WAITING-OUTPUT-TIME6)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS))
              (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
                     (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3 OS))
                     (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE9)

(PROVE-LEMMA
 TRACE-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3 OS))
         (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-WAITING-OUTPUT-TRACE7 REWRITE-WAITING-OUTPUT-TRACE8
          REWRITE-WAITING-OUTPUT-TRACE9
          TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER3
          TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-PATH3)

(DEFN OS-WAITING-OUTPUT-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-WAITING-OUTPUT-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-WAITING-OUTPUT-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
   (OS-WAITING-OUTPUT-TIME7 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          OS-WAITING-OUTPUT-TIME7)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (B (OS-WAITING-OUTPUT-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE10)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-WAITING-OUTPUT-TIME7 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS)
                (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-WAITING-OUTPUT-TIME8 OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-WAITING-OUTPUT-TIME7 OS-WAITING-OUTPUT-TIME8)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-WAITING-OUTPUT-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST OS))
             (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-WAITING-OUTPUT-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE11)

(PROVE-LEMMA
 REWRITE-WAITING-OUTPUT-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                (OS-WAITING-OUTPUT-TIME8 OS))
  (TM-PROCESSOR
          (TM-PROCESSOR (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                        (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS))
          (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS)))
 ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
          OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS-WAITING-OUTPUT-TIME8)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS))
              (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                     (TM (OS-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
                     (A (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4 OS))
                     (B (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-TO-WAIT OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-WAITING-OUTPUT-TRACE12)

(PROVE-LEMMA
 TRACE-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4 OS))
         (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-WAITING-OUTPUT-TRACE10 REWRITE-WAITING-OUTPUT-TRACE11
          REWRITE-WAITING-OUTPUT-TRACE12
          TRACE-WAITING-OUTPUT-HANDLER-THRU-READYQ-EMPTY-TEST
          TRACE-WAITING-OUTPUT-HANDLER-TO-DISPATCHER4
          TRACE-WAITING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TRACE-WAITING-OUTPUT-HANDLER-TO-WAIT2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER-PATH4)

(DEFN
 OS-TIME-FOR-WAITING-OUTPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '4)
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1 OS)
   (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2 OS))
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3 OS)
   (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 NIL)

(DEFN OS-WAITING-OUTPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '4)
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)
   (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)
   (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 NIL)

(PROVE-LEMMA TRACE-WAITING-OUTPUT-HANDLER
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                            (TM-WAITING OS)))
                  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                                       (OS-TIME-FOR-WAITING-OUTPUT-HANDLER OS))
                         (OS-WAITING-OUTPUT-HANDLER OS)))
         ((ENABLE OS-TIME-FOR-WAITING-OUTPUT-HANDLER OS-WAITING-OUTPUT-HANDLER
                  TRACE-WAITING-OUTPUT-HANDLER-PATH1
                  TRACE-WAITING-OUTPUT-HANDLER-PATH2
                  TRACE-WAITING-OUTPUT-HANDLER-PATH3
                  TRACE-WAITING-OUTPUT-HANDLER-PATH4)
          (DISABLE PLUS TIMES)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TRACE-WAITING-OUTPUT-HANDLER)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3156
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3156
          '0
          (PUTNTH '3310
                  '1
                  (PUTNTH (GETNTH '2 (TM-REGS OS))
                          '2
                          (PUTNTH (GETNTH '3 (TM-REGS OS))
                                  '3
                                  (TM-REGS OS)))))
  (TM-CC-VALUE (TM-ALU-PLUS (PLUS '15
                                  (TIMES '9
                                         (ARRAY-QFIRST (OS-READYQ OS))))
                            '8))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (NOT (TM-WAITING OS))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
         (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-TASK-TABLE FINITE-NUMBERP
          OS-INTENDED-OUTPUT-INTERRUPT OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3178
                                                 '3310
                                                 (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3184
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
     '2
     (PUTNTH '191
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  (TM-CC-VALUE (TM-ALU-INCR-MOD (GETNTH '1 (OS-READYQ OS))
                                '16))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL
   (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                 (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)))
 ((ENABLE CONTRACT-ARRAY-ENQ FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-UPDATE-STATUS)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE
                 FINITE-NUMBER-QUEUE-COROLLARIES1 GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3195
                                                 '3310
                                                 (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
     '2
     (PUTNTH
      (PLUS '371
            (TIMES '8
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS))
         (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
          FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER OS-NEW-TASK-TABLE
          OS-OBUFFERS-ADDRESS-FACTS
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS-UPDATE-STATUS
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3204
                                                 '3310
                                                 (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '8 (OS-OBUFFERS OS))))
     '2
     (PUTNTH
      (PLUS '371
            (TIMES '8
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
      '3
      (PUTNTH
            (PLUS '195
                  (GETNTH '1 (OS-READYQ OS)))
            '4
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS)))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD
                   (GETNTH '0
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
                   (GETNTH '3
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (NOT
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS))
         (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER ACCESS-CURRENT-OBUFFER-QHEAD
          CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1
          CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1
          FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OBUFFER-ADDRESS-FACTS
          OS-CURRENT-OBUFFER OS-NEW-TASK-TABLE OS-OBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS-UPDATE-STATUS
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-PATH1
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK GETNTH-TABLE
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-OUTPUT-HANDLER-PATH1
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          RESTORE-CC RESTORE-ERROR RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW1)

(DEFN
 OS-RUNNING-OUTPUT-HANDLER-PATH2
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                       (OS-READYQ OS))
            '191
            (PUTSEG
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)
                 '211
                 (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                         '371
                         (PUTSEG (OS-CODE OS)
                                 '2547
                                 (PUTNTH '2558
                                         '3309
                                         (PUTNTH '3238
                                                 '3310
                                                 (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK GETNTH-GETSEG
          GETNTH-TABLE LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER
          OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-READYQ-ADDRESS-FACTS
          OS-RUNNING-OUTPUT-HANDLER-PATH2
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS-UPDATE-STATUS
          RESTORE-CC RESTORE-ERROR RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID
          TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW2)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
      (OS)
      '(TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3156
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3184
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (GETNTH '2 (TM-REGS OS))
     '2
     (PUTNTH
            (GETNTH '3 (TM-REGS OS))
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS))))))
  (TM-CC-VALUE
   (TM-ALU-DIFFERENCE
                   (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
       (NOT (TM-WAITING OS))
       (NOT (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)))))
  (EQUAL
   (TM-PROCESSOR
                (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)))
 ((ENABLE FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-STATUS-TABLE GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (FINITE-NUMBERP-GETNTH-OS-STATUS-TABLE
                       (I (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                       (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3195
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (GETNTH '2 (TM-REGS OS))
     '2
     (PUTNTH
            (PLUS '371
                  (TIMES '8
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS))))))
  '1
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS))
         (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
          FINITE-NUMBERP FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-OBUFFERS-ADDRESS-FACTS
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
 (OS)
 (TM
  (PUTNTH
   (TM-PC OS)
   '0
   (PUTNTH
    (TM-SP OS)
    '1
    (PUTNTH
     (TM-PACK-PSW (TM-CC OS)
                  (TM-ERROR OS)
                  (TM-SVCFLAG OS)
                  (TM-SVCID OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3204
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (PUTNTH '3231
   '0
   (PUTNTH '3310
    '1
    (PUTNTH
     (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '8 (OS-OBUFFERS OS))))
     '2
     (PUTNTH
            (PLUS '371
                  (TIMES '8
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
            '3
            (PUTNTH (PLUS '211
                          (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    '5
                    (TM-REGS OS))))))
  (TM-CC-VALUE
   (TM-ALU-INCR-MOD
                   (GETNTH '0
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
                   (GETNTH '3
                           (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))))
  '0
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '1
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (NOT
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS))
         (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS)))
 ((ENABLE ACCESS-CURRENT-OBUFFER ACCESS-CURRENT-OBUFFER-QHEAD
          CONTRACT-GETNTH-FROM-CURRENT-OBUFFER1
          CONTRACT-PUTNTH-INTO-CURRENT-OBUFFER1
          FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER FINITE-NUMBERP
          FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT-CROCK
          LESSP-QMAXLENGTH-FIELD-OS-CURRENT-OBUFFER-TM-WORDLUB
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OBUFFER-ADDRESS-FACTS
          OS-CURRENT-OBUFFER OS-NEW-TASK-TABLE OS-OBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
          TM-CC-VALUE-ON-COMPARE-NOT-EQUAL-TO-ZERO TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS1
                 GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES MEMORY-REFERENCE
                 OS-SEGMENT-LENGTHS TM-ALU-ARITHMETIC TM-DEFINITION
                 TRACE-ARITHMETIC TRACE-ARRAY-QUEUE-FACTS TRACING-LEMMAS
                 GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4)

(DEFN
 OS-RUNNING-OUTPUT-HANDLER-PATH3
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3238
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (NOT (TM-WAITING OS))))
          (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS)
                               (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))
                 (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-TABLE
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW RESTORE-CC RESTORE-ERROR
          RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW3)

(DEFN
 OS-RUNNING-OUTPUT-HANDLER-PATH4
 (OS)
 (TM
  (PUTNTH
   (GETNTH (TIMES '9
                  (ARRAY-QFIRST (OS-READYQ OS)))
           (OS-NEW-TASK-TABLE OS))
   '0
   (PUTNTH
    (GETNTH (PLUS '1
                  (TIMES '9
                         (ARRAY-QFIRST (OS-READYQ OS))))
            (OS-NEW-TASK-TABLE OS))
    '1
    (PUTNTH
     (GETNTH (PLUS '8
                   (TIMES '9
                          (ARRAY-QFIRST (OS-READYQ OS))))
             (OS-NEW-TASK-TABLE OS))
     '2
     (PUTNTH
      (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
      '9
      (PUTNTH '3231
       '10
       (PUTNTH
        (TM-R2 OS)
        '13
        (PUTNTH
         (TM-R3 OS)
         '14
         (PUTSEG
          (OS-NEW-TASK-TABLE OS)
          '15
          (PUTSEG
           (OS-SEGMENT-TABLE OS)
           '159
           (PUTSEG
            (OS-READYQ OS)
            '191
            (PUTSEG
                  (OS-STATUS-TABLE OS)
                  '211
                  (PUTSEG (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)
                          '371
                          (PUTSEG (OS-CODE OS)
                                  '2547
                                  (PUTNTH '2558
                                          '3309
                                          (PUTNTH '3238
                                                  '3310
                                                  (TM-MEMORY OS))))))))))))))))
  (TM-REGS OS)
  (TM-CC OS)
  (TM-ERROR OS)
  (TM-SVCFLAG OS)
  (TM-SVCID OS)
  (TM-BASE OS)
  (TM-LIMIT OS)
  (TM-SLIMIT OS)
  '0
  '0
  (TM-CLOCK OS)
  (TM-IPORTS OS)
  (TM-START-OUTPUT
             (ARRAY-QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '8 (OS-OBUFFERS OS))))
             (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
             (TM-OPORTS OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW4
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                    (NOT (TM-WAITING OS))))
          (EQUAL (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS)
                               (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))
                 (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE CONTRACT-PUTNTHS-INTO-REGMEM FINITE-NUMBERP GETNTH-TABLE
          LIMITED-ASSOCIATIVITY-OF-PLUS2 OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
          OS-READYQ-ADDRESS-FACTS OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4
          OS-TASK-TABLE-ADDRESS-FACTS
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW RESTORE-CC RESTORE-ERROR
          RESTORE-REGS RESTORE-SVCFLAG RESTORE-SVCID TM-FIX-WORD-NOOP)
  (ENABLE-THEORY EXECUTABLE-FNS ACCESS-OS-SEGMENT-TABLE CONTRACT-QUEUES
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 GOOD-TM-PROPERTIES MEMORY-REFERENCE OS-SEGMENT-LENGTHS
                 TM-ALU-ARITHMETIC TM-DEFINITION TRACE-ARITHMETIC
                 TRACING-LEMMAS GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE TIMES PLUS)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW4)

(DEFN OS-RUNNING-OUTPUT-TIME1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-TIME2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-OUTPUT-TRACE1
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
         (OS-RUNNING-OUTPUT-TIME1 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME1 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-OUTPUT-TIME1 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
                    (B (OS-RUNNING-OUTPUT-TIME1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE1)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE2
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-OUTPUT-TIME1 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                 (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-RUNNING-OUTPUT-TIME2 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME1 OS-RUNNING-OUTPUT-TIME2
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-RUNNING-OUTPUT-TIME2 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-RUNNING-OUTPUT-TIME2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE2)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE3
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                (OS-RUNNING-OUTPUT-TIME2 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS))
         (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME2 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS))
              (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1 OS))
                    (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE3)

(PROVE-LEMMA
 TRACE-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE REWRITE-RUNNING-OUTPUT-TRACE1 REWRITE-RUNNING-OUTPUT-TRACE2
          REWRITE-RUNNING-OUTPUT-TRACE3
          TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW1
          TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-PATH1)

(DEFN OS-RUNNING-OUTPUT-TIME3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-TIME4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-OUTPUT-TRACE4
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
         (OS-RUNNING-OUTPUT-TIME3 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME3 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-OUTPUT-TIME3 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
                    (B (OS-RUNNING-OUTPUT-TIME3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE4)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE5
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-OUTPUT-TIME3 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                 (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
   (OS-RUNNING-OUTPUT-TIME4 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME3 OS-RUNNING-OUTPUT-TIME4
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-RUNNING-OUTPUT-TIME4 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
              (TM (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
              (B (OS-RUNNING-OUTPUT-TIME4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE5)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE6
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                (OS-RUNNING-OUTPUT-TIME4 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS))
         (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME4 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS))
              (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2 OS))
                    (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE6)

(PROVE-LEMMA
 TRACE-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE REWRITE-RUNNING-OUTPUT-TRACE4 REWRITE-RUNNING-OUTPUT-TRACE5
          REWRITE-RUNNING-OUTPUT-TRACE6
          TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW2
          TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST
          TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-PATH2)

(DEFN OS-RUNNING-OUTPUT-TIME5
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-TIME6
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-OUTPUT-TRACE7
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
         (OS-RUNNING-OUTPUT-TIME5 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME5 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-OUTPUT-TIME5 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
                    (B (OS-RUNNING-OUTPUT-TIME5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE7)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE8
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-OUTPUT-TIME5 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-RUNNING-OUTPUT-TIME6 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME5 OS-RUNNING-OUTPUT-TIME6
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-RUNNING-OUTPUT-TIME6 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
             (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-RUNNING-OUTPUT-TIME6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE8)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE9
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                (OS-RUNNING-OUTPUT-TIME6 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS))
         (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME6 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS))
              (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3 OS))
                    (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE9)

(PROVE-LEMMA
 TRACE-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3 OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE REWRITE-RUNNING-OUTPUT-TRACE7 REWRITE-RUNNING-OUTPUT-TRACE8
          REWRITE-RUNNING-OUTPUT-TRACE9
          TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW3
          TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-PATH3)

(DEFN OS-RUNNING-OUTPUT-TIME7
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-RUNNING-OUTPUT-TIME8
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(DEFN OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4
      (OS)
      '(TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK TICK
             TICK TICK TICK TICK TICK TICK TICK)
      NIL)

(PROVE-LEMMA REWRITE-RUNNING-OUTPUT-TRACE10
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
         (OS-RUNNING-OUTPUT-TIME7 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME7 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
              (B (OS-RUNNING-OUTPUT-TIME7 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
                    (B (OS-RUNNING-OUTPUT-TIME7 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE10)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE11
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-RUNNING-OUTPUT-TIME7 OS))
  (TM-PROCESSOR
   (TM-PROCESSOR
                (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS)
                (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
   (OS-RUNNING-OUTPUT-TIME8 OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME7 OS-RUNNING-OUTPUT-TIME8
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2)
  (USE
   (TICK-PLUS
             (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-RUNNING-OUTPUT-TIME8 OS)))
   (TM-PROCESSOR-APPEND-ORACLE
             (TM (OS-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE OS))
             (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
             (B (OS-RUNNING-OUTPUT-TIME8 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE11)

(PROVE-LEMMA
 REWRITE-RUNNING-OUTPUT-TRACE12
 (REWRITE)
 (EQUAL
  (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                (OS-RUNNING-OUTPUT-TIME8 OS))
  (TM-PROCESSOR
         (TM-PROCESSOR (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS))
         (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
 ((ENABLE OS-RUNNING-OUTPUT-TIME8 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW
          OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4)
  (USE
   (TICK-PLUS (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS))
              (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS)))
   (TM-PROCESSOR-APPEND-ORACLE
                    (TM (OS-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2 OS))
                    (A (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4 OS))
                    (B (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-TO-LPSW OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE REWRITE-RUNNING-OUTPUT-TRACE12)

(PROVE-LEMMA
 TRACE-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4 OS))
         (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE REWRITE-RUNNING-OUTPUT-TRACE10 REWRITE-RUNNING-OUTPUT-TRACE11
          REWRITE-RUNNING-OUTPUT-TRACE12
          TRACE-RUNNING-OUTPUT-HANDLER-THRU-SAVE-STATE
          TRACE-RUNNING-OUTPUT-HANDLER-TO-LPSW4
          TRACE-RUNNING-OUTPUT-HANDLER-TO-OBUFFER-EMPTY-TEST2
          TRACE-RUNNING-OUTPUT-HANDLER-TO-RESUME-TASK4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER-PATH4)

(DEFN
 OS-TIME-FOR-RUNNING-OUTPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '4)
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1 OS)
   (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2 OS))
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3 OS)
   (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 NIL)

(DEFN OS-RUNNING-OUTPUT-HANDLER
 (OS)
 (IF
  (EQUAL (GETNTH (TIMES '2
                        (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                 (OS-STATUS-TABLE OS))
         '4)
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)
   (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
  (IF
   (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))
   (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)
   (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 NIL)

(PROVE-LEMMA TRACE-RUNNING-OUTPUT-HANDLER
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                            (NOT (TM-WAITING OS))))
                  (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                                       (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER OS))
                         (OS-RUNNING-OUTPUT-HANDLER OS)))
         ((ENABLE OS-RUNNING-OUTPUT-HANDLER OS-TIME-FOR-RUNNING-OUTPUT-HANDLER
                  TRACE-RUNNING-OUTPUT-HANDLER-PATH1
                  TRACE-RUNNING-OUTPUT-HANDLER-PATH2
                  TRACE-RUNNING-OUTPUT-HANDLER-PATH3
                  TRACE-RUNNING-OUTPUT-HANDLER-PATH4)
          (DISABLE PLUS TIMES)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TRACE-RUNNING-OUTPUT-HANDLER)

(DEFTHEORY ACCESS-OS-MEMORY
           (GETNTH-BEFORE-PUTSEG GETNTH-PUTNTH-NON-INTERFERENCE
                                 GETSEG-AFTER-PUTNTH GETSEG-AFTER-PUTSEG
                                 GETSEG-BEFORE-PUTNTH GETSEG-BEFORE-PUTSEG
                                 GETSEG-FOR-LENGTH GETSEG-GETSEG
                                 GETSEG-WITHIN-PUTSEG LENGTH-ARRAY-DEQ
                                 LENGTH-ARRAY-ENQ LENGTH-GETSEG LENGTH-PUTNTH
                                 LENGTH-PUTSEG PLISTP-ARRAY-DEQ
                                 PLISTP-ARRAY-ENQ PLISTP-GETSEG PLISTP-PUTNTH
                                 PLISTP-PUTSEG))

(PROVE-LEMMA GOOD-TM-OS-INTENDED-CLOCK-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-TM (OS-INTENDED-CLOCK-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-CLOCK-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-CLOCK-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-CLOCK-INTERRUPT)

(PROVE-LEMMA
     GOOD-TM-OS-CLOCK-INTERRUPT-HANDLER
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (AND (NOT (TM-WAITING OS))
                        (NOT (TM-ERRORP OS))))
              (GOOD-TM (OS-CLOCK-INTERRUPT-HANDLER OS)))
     ((ENABLE GOOD-TM-OS-INTENDED-CLOCK-INTERRUPT)
      (USE (TRACE-CLOCK-INTERRUPT-HANDLER (OS OS))
           (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-CLOCK-INTERRUPT OS))
                                 (N (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER OS))))
      (ENABLE-THEORY GROUND-ZERO)
      (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-SLIMIT-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-CLOCK-INTERRUPT-HANDLER OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-CODE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CODE OS-CLOCK-NEW-READYQ
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-CLOCK-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
     (EQUAL (GETNTH '4
                    (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
            (GETNTH '4 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '5
                         (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
                 (GETNTH '5 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '6
                              (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
                      (GETNTH '6 (TM-MEMORY OS)))
               (AND (EQUAL (GETNTH '7
                                   (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
                           (GETNTH '7 (TM-MEMORY OS)))
                    (EQUAL (GETNTH '11
                                   (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
                           (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-CLOCK-INTERRUPT-HANDLER OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-NEW-TASK-TABLE
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-NEW-TASK-TABLE
                      OS-SEGMENT-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-CLOCK-NEW-READYQ OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                      OS-NEW-TASK-TABLE OS-READYQ)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
          FINITE-NUMBER-QUEUEP-OS-CLOCK-NEW-READYQ
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (FINITE-NUMBER-QUEUEP (OS-CLOCK-NEW-READYQ OS)
                                         '16
                                         '16))
          ((ENABLE OS-CLOCK-NEW-READYQ
                   FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY
                   TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
                   NOT-ARRAY-QFULLP-ARRAY-DEQ)
           (ENABLE-THEORY QUEUE-FACTS GOOD-OS-PROPERTIES1 GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-OS-CLOCK-NEW-READYQ)

(PROVE-LEMMA
          NOT-ARRAY-QEMPTYP-OS-CLOCK-NEW-READYQ
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (NOT (ARRAY-QEMPTYP (OS-CLOCK-NEW-READYQ OS))))
          ((ENABLE OS-CLOCK-NEW-READYQ
                   FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY
                   FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY
                   ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY
                   TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
                   NOT-ARRAY-QEMPTYP-ARRAY-ENQ NOT-ARRAY-QFULLP-ARRAY-DEQ)
           (ENABLE-THEORY QUEUE-FACTS GOOD-OS-PROPERTIES1 GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE NOT-ARRAY-QEMPTYP-OS-CLOCK-NEW-READYQ)

(PROVE-LEMMA OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                      OS-IBUFFERS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                      OS-OBUFFERS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                      OS-MBUFFERS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-STATUS-TABLE OS)))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                      OS-NEW-TASK-TABLE OS-STATUS-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA OS-READY-SET-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READY-SET (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (OS-READY-SET OS)))
             ((ENABLE OS-READY-SET OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
 PERMUTATION-OS-CLOCK-NEW-READYQ-OS-READY-SET
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (OS-CLOCK-NEW-READYQ OS))
                       (OS-READY-SET (OS-CLOCK-INTERRUPT-HANDLER OS))))
 ((ENABLE ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY CORRECTNESS-OF-ARRAY-DEQ
          CORRECTNESS-OF-ARRAY-ENQ CORRECTNESS-OF-ARRAY-QFIRST
          OS-CLOCK-NEW-READYQ OS-READY-SET-OS-CLOCK-INTERRUPT-HANDLER
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY ARRAY-QUEUE-FACTS GOOD-OS-PROPERTIES1 GROUND-ZERO)
  (USE
     (PERMUTATION-ENQ-DEQ (QUEUE (MAPUP-QUEUE (OS-READYQ OS))))
     (TRANSITIVITY-OF-PERMUTATION (A (ENQ (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
                                  (B (MAPUP-QUEUE (OS-READYQ OS)))
                                  (C (OS-READY-SET OS)))
     (CORRECTNESS-OF-ARRAY-QEMPTYP (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-CLOCK-NEW-READYQ-OS-READY-SET)

(PROVE-LEMMA TM-BASE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-BASE (OS-CLOCK-INTERRUPT-HANDLER OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                 OS))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-CLOCK-INTERRUPT-HANDLER OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                  OS))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
      (EQUAL (TM-BASE (OS-CLOCK-INTERRUPT-HANDLER OS))
             (BASE (GETNTH (OS-CURRENT-TASKID (OS-CLOCK-INTERRUPT-HANDLER OS))
                           (TABLE '2 (OS-SEGMENT-TABLE OS)))))
      (EQUAL (TM-LIMIT (OS-CLOCK-INTERRUPT-HANDLER OS))
             (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-CLOCK-INTERRUPT-HANDLER OS))
                            (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
          TM-BASE-OS-CLOCK-INTERRUPT-HANDLER OS-CURRENT-TASKID OS-NEW-BASE
          OS-NEW-LIMIT OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA NOT-TM-WAITING-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (NOT (TM-WAITING (OS-CLOCK-INTERRUPT-HANDLER OS)))
             ((ENABLE TM-WAITING OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-OS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-OS (OS-CLOCK-INTERRUPT-HANDLER OS)))
             ((ENABLE GOOD-OS GOOD-TM-OS-CLOCK-INTERRUPT-HANDLER
                      TM-SLIMIT-OS-CLOCK-INTERRUPT-HANDLER
                      OS-CODE-OS-CLOCK-INTERRUPT-HANDLER
                      TM-INTERRUPT-ADDRESSES-OS-CLOCK-INTERRUPT-HANDLER
                      NOT-TM-IN-SUPERVISOR-MODE-OS-CLOCK-INTERRUPT-HANDLER
                      OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
                      OS-SEGMENT-TABLE-OS-CLOCK-INTERRUPT-HANDLER
                      OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER
                      GOOD-CPU-LIST-OS-NEW-TASK-TABLE
                      FINITE-NUMBER-QUEUEP-OS-CLOCK-NEW-READYQ
                      OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER
                      PERMUTATION-OS-CLOCK-NEW-READYQ-OS-READY-SET
                      TM-BASE-TM-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
                      NOT-ARRAY-QEMPTYP-OS-CLOCK-NEW-READYQ
                      NOT-TM-WAITING-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-ERROR-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-TM (OS-INTENDED-ERROR-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-ERROR-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-ERROR-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-ERROR-INTERRUPT)

(PROVE-LEMMA
         GOOD-TM-OS-ERROR-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (NOT (TM-WAITING OS))
                            (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
                  (GOOD-TM (OS-ERROR-HANDLER-PATH1 OS)))
         ((ENABLE GOOD-TM-OS-INTENDED-ERROR-INTERRUPT)
          (USE (TRACE-ERROR-HANDLER-PATH1 (OS OS))
               (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-ERROR-INTERRUPT OS))
                                     (N (OS-TIME-FOR-ERROR-HANDLER-PATH1 OS))))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-ERROR-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
    (EQUAL (GETNTH '3
                   (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
           (GETNTH '3 (TM-MEMORY OS)))
    (AND (EQUAL (GETNTH '4
                        (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                (GETNTH '4 (TM-MEMORY OS)))
         (AND (EQUAL (GETNTH '5
                             (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                     (GETNTH '5 (TM-MEMORY OS)))
              (AND (EQUAL (GETNTH '6
                                  (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                          (GETNTH '6 (TM-MEMORY OS)))
                   (AND (EQUAL (GETNTH '7
                                       (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                               (GETNTH '7 (TM-MEMORY OS)))
                        (EQUAL (GETNTH '11
                                       (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                               (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-ERROR-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-ERROR-HANDLER-PATH1 OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-TASK-TABLE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE
                      OS-SEGMENT-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-READYQ-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-ERROR-HANDLER-PATH1 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE OS-READYQ)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-IBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-OBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-MBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH1 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1)

(DEFTHEORY EXECUTABLE-THEORY
           (*1*GREATERP *1*LEQ *1*GEQ *1*MEMBER *1*IFF *1*ORD-LESSP
                        *1*ORDINALP *1*ASSOC *1*PAIRLIST *1*SUBRP
                        *1*APPLY-SUBR *1*FORMALS *1*BODY *1*FIX-COST
                        *1*STRIP-CARS *1*SUM-CDRS *1*V&C$ *1*V&C-APPLY$
                        *1*EVAL$ *1*QUANTIFIER-INITIAL-VALUE *1*ADD-TO-SET
                        *1*APPEND *1*MAX *1*UNION *1*QUANTIFIER-OPERATION
                        *1*FOR *1*EXP *1*DIVIDES *1*MIN *1*LENGTH *1*INSERT
                        *1*OCCURRENCES *1*REMOVE *1*PERMUTATION *1*PLISTP
                        *1*SETP *1*SORTED *1*GETNTH *1*PUTNTH *1*GETSEG
                        *1*PUTSEG *1*FIXLENGTH *1*FIRSTN *1*NTHCDR
                        *1*NESTED-INTERVALS *1*GETNTH2 *1*PUTNTH2 *1*REVERSE
                        *1*FINITE-NUMBERP *1*NUMBER-LISTP
                        *1*FINITE-NUMBER-LISTP *1*NON-ZERO-LISTP *1*TABLEP
                        *1*TABLE *1*FLATTEN *1*FINITE-NUMBER-TABLEP *1*NONLAST
                        *1*INCR-MOD *1*DECR-MOD *1*QFIRST *1*ENQ *1*DEQ
                        *1*QEMPTYP *1*QFULLP *1*QREPLACE *1*QHEAD-FIELD
                        *1*QTAIL-FIELD *1*QCURRLENGTH-FIELD
                        *1*QMAXLENGTH-FIELD *1*QARRAY-FIELD *1*DELTA
                        *1*ARRAY-QINDEX-RELATION *1*ARRAY-QUEUEP *1*ARRAY-ENQ
                        *1*ARRAY-DEQ *1*ARRAY-QFIRST *1*ARRAY-QFULLP
                        *1*ARRAY-QEMPTYP *1*ARRAY-NONLAST *1*ARRAY-QREPLACE
                        *1*DELTA-SEGMENT *1*MAPUP-QUEUE *1*QFIRST2 *1*ENQ2
                        *1*DEQ2 *1*QFULLP2 *1*QEMPTYP2))

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (NOT (TM-WAITING OS)))
      (GOOD-STATUS-LIST (TABLE '2
                               (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH1 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1 OS-UPDATE-STATUS PLISTP
          TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS EXECUTABLE-THEORY
                 GROUND-ZERO)
  (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-ERROR-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (OS-READY-SET (OS-ERROR-HANDLER-PATH1 OS))
        (INDEX-READY-SET '0
                         (TABLE '2
                                (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                                  '1
                                                  '0
                                                  OS)))))
 ((ENABLE OS-READY-SET OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1 OS-UPDATE-STATUS
          TABLE-PUTSEG TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ AK-ERROR-STATUS)
  (ENABLE-THEORY GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-ERROR-HANDLER-PATH1 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET OS-READY-SET-OS-ERROR-HANDLER-PATH1 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE TABLE-PUTSEG
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-ERROR-HANDLER-PATH1 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '1)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-WAITING-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (TM-WAITING (OS-ERROR-HANDLER-PATH1 OS))
             ((ENABLE TM-WAITING OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
         GOOD-OS-OS-ERROR-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (NOT (TM-WAITING OS))
                            (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
                  (GOOD-OS (OS-ERROR-HANDLER-PATH1 OS)))
         ((ENABLE GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
                  GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1
                  GOOD-TM-OS-ERROR-HANDLER-PATH1
                  NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH1
                  OS-CODE-OS-ERROR-HANDLER-PATH1
                  OS-IBUFFERS-OS-ERROR-HANDLER-PATH1
                  OS-MBUFFERS-OS-ERROR-HANDLER-PATH1
                  OS-OBUFFERS-OS-ERROR-HANDLER-PATH1
                  OS-READYQ-OS-ERROR-HANDLER-PATH1
                  OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH1
                  OS-TASK-TABLE-OS-ERROR-HANDLER-PATH1
                  PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH1
                  TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH1
                  TM-SLIMIT-OS-ERROR-HANDLER-PATH1
                  TM-WAITING-OS-ERROR-HANDLER-PATH1)
          (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
         GOOD-TM-OS-ERROR-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (NOT (TM-WAITING OS))
                            (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                  (GOOD-TM (OS-ERROR-HANDLER-PATH2 OS)))
         ((ENABLE GOOD-TM-OS-INTENDED-ERROR-INTERRUPT)
          (USE (TRACE-ERROR-HANDLER-PATH2 (OS OS))
               (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-ERROR-INTERRUPT OS))
                                     (N (OS-TIME-FOR-ERROR-HANDLER-PATH2 OS))))
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-ERROR-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
    (EQUAL (GETNTH '3
                   (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
           (GETNTH '3 (TM-MEMORY OS)))
    (AND (EQUAL (GETNTH '4
                        (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                (GETNTH '4 (TM-MEMORY OS)))
         (AND (EQUAL (GETNTH '5
                             (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                     (GETNTH '5 (TM-MEMORY OS)))
              (AND (EQUAL (GETNTH '6
                                  (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                          (GETNTH '6 (TM-MEMORY OS)))
                   (AND (EQUAL (GETNTH '7
                                       (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                               (GETNTH '7 (TM-MEMORY OS)))
                        (EQUAL (GETNTH '11
                                       (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                               (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-ERROR-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-ERROR-HANDLER-PATH2 OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE
                      OS-SEGMENT-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-READYQ-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-ERROR-HANDLER-PATH2 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE OS-READYQ)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-IBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-OBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-MBUFFERS OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH2 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '1
                                               '0
                                               OS)))
             ((ENABLE OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (NOT (TM-WAITING OS)))
      (GOOD-STATUS-LIST (TABLE '2
                               (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH2 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2 OS-UPDATE-STATUS PLISTP
          TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                 GROUND-ZERO)
  (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (OS-READY-SET (OS-ERROR-HANDLER-PATH2 OS))
        (INDEX-READY-SET '0
                         (TABLE '2
                                (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                                  '1
                                                  '0
                                                  OS)))))
 ((ENABLE OS-READY-SET OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2 OS-UPDATE-STATUS
          TABLE-PUTSEG TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-ERROR-HANDLER-PATH2 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET OS-READY-SET-OS-ERROR-HANDLER-PATH2 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE TABLE-PUTSEG
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-ERROR-HANDLER-PATH2 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '1)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-ERROR-HANDLER-PATH2 OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS))
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-ERROR-HANDLER-PATH2 OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  OS))
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
     (GOOD-TM OS)
     (AND (EQUAL (TM-BASE (OS-ERROR-HANDLER-PATH2 OS))
                 (BASE (GETNTH (OS-CURRENT-TASKID (OS-ERROR-HANDLER-PATH2 OS))
                               (TABLE '2 (OS-SEGMENT-TABLE OS)))))
          (EQUAL (TM-LIMIT (OS-ERROR-HANDLER-PATH2 OS))
                 (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-ERROR-HANDLER-PATH2 OS))
                                (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-ERROR-HANDLER-PATH2 TM-BASE-OS-ERROR-HANDLER-PATH2
          OS-CURRENT-TASKID OS-NEW-BASE OS-NEW-LIMIT
          OS-READYQ-OS-ERROR-HANDLER-PATH2)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-ERROR-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
         GOOD-OS-OS-ERROR-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (AND (NOT (TM-WAITING OS))
                            (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                  (GOOD-OS (OS-ERROR-HANDLER-PATH2 OS)))
         ((ENABLE GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
                  GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2
                  GOOD-TM-OS-ERROR-HANDLER-PATH2
                  NOT-TM-IN-SUPERVISOR-MODE-OS-ERROR-HANDLER-PATH2
                  NOT-TM-WAITING-OS-ERROR-HANDLER-PATH2
                  OS-CODE-OS-ERROR-HANDLER-PATH2
                  OS-IBUFFERS-OS-ERROR-HANDLER-PATH2
                  OS-MBUFFERS-OS-ERROR-HANDLER-PATH2
                  OS-OBUFFERS-OS-ERROR-HANDLER-PATH2
                  OS-READYQ-OS-ERROR-HANDLER-PATH2
                  OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH2
                  OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2
                  PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-ERROR-HANDLER-PATH2
                  TM-BASE-TM-LIMIT-OS-ERROR-HANDLER-PATH2
                  TM-INTERRUPT-ADDRESSES-OS-ERROR-HANDLER-PATH2
                  TM-SLIMIT-OS-ERROR-HANDLER-PATH2)
          (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA GOOD-OS-OS-ERROR-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (GOOD-OS (OS-ERROR-HANDLER OS)))
             ((ENABLE OS-ERROR-HANDLER GOOD-OS-OS-ERROR-HANDLER-PATH1
                      GOOD-OS-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-ERROR-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-TM (OS-INTENDED-SVC-SEND-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-SVC-SEND-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-SVC-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-TM (OS-SVC-SEND-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT)
  (USE (TRACE-SVC-SEND-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-SEND-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-SEND-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
      (EQUAL (GETNTH '4
                     (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
             (GETNTH '4 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '5
                          (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
                  (GETNTH '5 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '6
                               (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
                       (GETNTH '6 (TM-MEMORY OS)))
                (AND (EQUAL (GETNTH '7
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
                            (GETNTH '7 (TM-MEMORY OS)))
                     (EQUAL (GETNTH '11
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
                            (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-SEND-HANDLER-PATH1 OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-READYQ-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '2
                                               (OS-DESTID OS '16)
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-SEND-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH1 OS))
               (INDEX-READY-SET '0
                                (PUTNTH (CONS '2
                                              (CONS (OS-DESTID OS '16) 'NIL))
                                        (ARRAY-QFIRST (OS-READYQ OS))
                                        (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH1 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-SEND-HANDLER-PATH1 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '2)
                                    (X (OS-DESTID OS '16))
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-WAITING-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (TM-WAITING (OS-SVC-SEND-HANDLER-PATH1 OS))
             ((ENABLE TM-WAITING OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-OS (OS-SVC-SEND-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP-REMAINDER GETNTH-0-2 GETNTH-1-2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-SEND-HANDLER-PATH1
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH1
          OS-CODE-OS-SVC-SEND-HANDLER-PATH1 OS-DESTID
          OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH1
          OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH1 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH1
          PLISTP TABLE-PUTSEG TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH1
          TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH1
          TM-WAITING-OS-SVC-SEND-HANDLER-PATH1)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-TM (OS-SVC-SEND-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT)
  (USE (TRACE-SVC-SEND-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-SEND-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-SEND-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
      (EQUAL (GETNTH '4
                     (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
             (GETNTH '4 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '5
                          (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
                  (GETNTH '5 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '6
                               (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
                       (GETNTH '6 (TM-MEMORY OS)))
                (AND (EQUAL (GETNTH '7
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
                            (GETNTH '7 (TM-MEMORY OS)))
                     (EQUAL (GETNTH '11
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
                            (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-SEND-HANDLER-PATH2 OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-READYQ-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '2
                                               (OS-DESTID OS '16)
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-SEND-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH2 OS))
               (INDEX-READY-SET '0
                                (PUTNTH (CONS '2
                                              (CONS (OS-DESTID OS '16) 'NIL))
                                        (ARRAY-QFIRST (OS-READYQ OS))
                                        (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH2 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-SEND-HANDLER-PATH2 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '2)
                                    (X (OS-DESTID OS '16))
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH2 OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH2 OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH2 OS))
              (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH2 OS))
                            (TABLE '2 (OS-SEGMENT-TABLE OS)))))
       (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH2 OS))
              (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2 TM-BASE-OS-SVC-SEND-HANDLER-PATH2
          OS-CURRENT-TASKID OS-NEW-BASE OS-NEW-LIMIT
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH2)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-SEND-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-OS (OS-SVC-SEND-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP-REMAINDER GETNTH-0-2 GETNTH-1-2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-SEND-HANDLER-PATH2
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH2
          NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH2
          OS-CODE-OS-SVC-SEND-HANDLER-PATH2 OS-DESTID
          OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH2
          OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH2
          PLISTP TABLE-PUTSEG TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH2
          TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH2)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '0)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))
                  (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                      (OS-STATUS-TABLE OS))
                              '3)
                       (EQUAL (GETNTH (PLUS '1
                                            (TIMES '2 (OS-DESTID OS '16)))
                                      (OS-STATUS-TABLE OS))
                              (OS-CURRENT-TASKID OS))))))))
  (GOOD-TM (OS-SVC-SEND-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT)
  (USE (TRACE-SVC-SEND-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-SEND-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
                      OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
      (EQUAL (GETNTH '4
                     (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
             (GETNTH '4 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '5
                          (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
                  (GETNTH '5 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '6
                               (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
                       (GETNTH '6 (TM-MEMORY OS)))
                (AND (EQUAL (GETNTH '7
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
                            (GETNTH '7 (TM-MEMORY OS)))
                     (EQUAL (GETNTH '11
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
                            (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-SEND-HANDLER-PATH3 OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (ARRAY-ENQ (OS-DESTID OS '16)
                                        (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                      OS-UPDATE-STATUS OS-MBUFFERS-WITH-ENQUEUED-MESSAGE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))))
      (FINITE-NUMBER-QUEUE-LISTP (TABLE '8
                                        (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS))
                                 '4
                                 '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      FINITE-NUMBERP GETNTH-TABLE OS-MBUFFERS-ADDRESS-FACTS3 LESSP-REMAINDER2
      OS-CURRENT-MBUFFER OS-CURRENT-TASKID OS-DESTID
      OS-MBUFFERS-WITH-ENQUEUED-MESSAGE REWRITE-OS-MBUFFER-ADDRESS
      TABLE-PUTSEG TM-R2)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-CURRENT-TASKID OS))
                                             (DID (OS-DESTID OS '16)))
       (FINITE-NUMBERP-GETNTH (I '3)
                              (L (TM-REGS OS))
                              (LUB '65536)))
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES ACCESS-OS-MEMORY
                 OS-SEGMENT-LENGTHS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (PUTSEG '(0 0)
                                     (TIMES '2 (OS-DESTID OS '16))
                                     (OS-STATUS-TABLE OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-SEND-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-SEND-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH3 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(0 0)
                                           (OS-DESTID OS '16)
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS LESSP-REMAINDER2 OS-DESTID
           OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
           OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3 PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                   (OS-STATUS-TABLE OS))
                           '3)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-ENQ (OS-DESTID OS '16)
                                               (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH3 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP-REMAINDER GETNTH-GETSEG
          GETNTH-TABLE LENGTH-OS-STATUS-TABLE LENGTH-TABLE LESSP-REMAINDER2
          FINITE-NUMBERP-REMAINDER OS-DESTID OS-READY-SET
          OS-STATUS-TABLE-ADDRESS-FACTS
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-SEND-HANDLER-PATH3 (OS OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                                     (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                     (FLAG '0)
                                     (X '0)
                                     (TASKID (OS-DESTID OS '16))
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-SEND-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                           (OS-STATUS-TABLE OS))
                   '3)))
  (AND (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH3 OS))
              (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH3 OS))
                            (TABLE '2 (OS-SEGMENT-TABLE OS)))))
       (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH3 OS))
              (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP-REMAINDER OS-CURRENT-TASKID
          OS-DESTID OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
          TM-BASE-OS-SVC-SEND-HANDLER-PATH3 TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (ENABLE-THEORY GOOD-TM-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA FINITE-NUMBERP-OS-DESTID
             (REWRITE)
             (AND (NUMBERP (OS-DESTID OS '16))
                  (AND (LESSP (OS-DESTID OS '16) '16)
                       (FINITE-NUMBERP (OS-DESTID OS '16)
                                       '16)))
             ((ENABLE OS-DESTID LESSP-REMAINDER2 FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-OS-DESTID)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '0)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))
                  (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                      (OS-STATUS-TABLE OS))
                              '3)
                       (EQUAL (GETNTH (PLUS '1
                                            (TIMES '2 (OS-DESTID OS '16)))
                                      (OS-STATUS-TABLE OS))
                              (OS-CURRENT-TASKID OS))))))))
  (GOOD-OS (OS-SVC-SEND-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS
          FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
          FINITE-NUMBERP-OS-DESTID GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-STATUS-LIST-PUTNTH GOOD-TM-OS-SVC-SEND-HANDLER-PATH3
          OS-STATUS-TABLE-ADDRESS-FACTS NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH3
          NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH3
          OS-CODE-OS-SVC-SEND-HANDLER-PATH3
          OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH3
          OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH3 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-SEND-HANDLER-PATH3
          PLISTP TABLE-PUTSEG TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH3
          TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH3)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
      (NOT (TM-ERRORP OS))
      (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                  '0)
           (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))
                (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS)))))))))
  (GOOD-TM (OS-SVC-SEND-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-SEND-INTERRUPT)
  (USE (TRACE-SVC-SEND-HANDLER-PATH4 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-SEND-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-SEND-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
                      OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
      (EQUAL (GETNTH '4
                     (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
             (GETNTH '4 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '5
                          (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
                  (GETNTH '5 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '6
                               (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
                       (GETNTH '6 (TM-MEMORY OS)))
                (AND (EQUAL (GETNTH '7
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
                            (GETNTH '7 (TM-MEMORY OS)))
                     (EQUAL (GETNTH '11
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
                            (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-SEND-HANDLER-PATH4 OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-MBUFFERS-WITH-ENQUEUED-MESSAGE OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4
                      OS-UPDATE-STATUS OS-MBUFFERS-WITH-ENQUEUED-MESSAGE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-STATUS-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA OS-READY-SET-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (OS-READY-SET (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (OS-READY-SET OS)))
             ((ENABLE LENGTH PLISTP OS-READY-SET
                      OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4 GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-SEND-HANDLER-PATH4 OS)))
             ((ENABLE TM-WAITING OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-BASE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND (EQUAL (TM-BASE (OS-SVC-SEND-HANDLER-PATH4 OS))
              (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH4 OS))
                            (TABLE '2 (OS-SEGMENT-TABLE OS)))))
       (EQUAL (TM-LIMIT (OS-SVC-SEND-HANDLER-PATH4 OS))
              (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
          TM-BASE-OS-SVC-SEND-HANDLER-PATH4 TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
      (NOT (TM-ERRORP OS))
      (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                  '0)
           (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))
                (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS)))))))))
  (GOOD-OS (OS-SVC-SEND-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-SVC-SEND-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-SEND-HANDLER-PATH4
          NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH4
          OS-CODE-OS-SVC-SEND-HANDLER-PATH4
          OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          OS-READY-SET-OS-SVC-SEND-HANDLER-PATH4
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH4
          OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH4
          TM-BASE-TM-LIMIT-OS-SVC-SEND-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-SVC-SEND-HANDLER-PATH4
          TM-SLIMIT-OS-SVC-SEND-HANDLER-PATH4)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA GOOD-OS-OS-SVC-SEND-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '0))))
                      (GOOD-OS (OS-SVC-SEND-HANDLER OS)))
             ((ENABLE OS-SVC-SEND-HANDLER GOOD-OS-OS-SVC-SEND-HANDLER-PATH1
                      GOOD-OS-OS-SVC-SEND-HANDLER-PATH2
                      GOOD-OS-OS-SVC-SEND-HANDLER-PATH3
                      GOOD-OS-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-SEND-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-SVC-RECEIVE-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-SVC-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-TM (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT)
  (USE (TRACE-SVC-RECEIVE-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-RECEIVE-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
        (EQUAL (GETNTH '5
                       (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
               (GETNTH '5 (TM-MEMORY OS)))
        (AND (EQUAL (GETNTH '6
                            (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                    (GETNTH '6 (TM-MEMORY OS)))
             (AND (EQUAL (GETNTH '7
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                         (GETNTH '7 (TM-MEMORY OS)))
                  (EQUAL (GETNTH '11
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                         (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-RECEIVE-HANDLER-PATH1
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
           OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-SEGMENT-TABLE (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                           (OS-SEGMENT-TABLE OS)))
           ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                    OS-SVC-RECEIVE-HANDLER-PATH1)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
            OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                            (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                              '3
                                              (OS-SRCID OS '16)
                                              OS)))
            ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                     OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                (INDEX-READY-SET '0
                                 (PUTNTH (CONS '3
                                               (CONS (OS-SRCID OS '16) 'NIL))
                                         (ARRAY-QFIRST (OS-READYQ OS))
                                         (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP OS-READY-SET
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS PLISTP
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH1 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH1 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '3)
                                    (X (OS-SRCID OS '16))
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (TM-WAITING (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
             ((ENABLE TM-WAITING OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-OS (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP-REMAINDER GETNTH-0-2 GETNTH-1-2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH1
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1 OS-SRCID
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1 OS-UPDATE-STATUS
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH1
          PLISTP TABLE-PUTSEG
          TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH1
          TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH1
          TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH1)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-TM (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT)
  (USE (TRACE-SVC-RECEIVE-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-RECEIVE-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
        (EQUAL (GETNTH '5
                       (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
               (GETNTH '5 (TM-MEMORY OS)))
        (AND (EQUAL (GETNTH '6
                            (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                    (GETNTH '6 (TM-MEMORY OS)))
             (AND (EQUAL (GETNTH '7
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                         (GETNTH '7 (TM-MEMORY OS)))
                  (EQUAL (GETNTH '11
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                         (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-RECEIVE-HANDLER-PATH2
                      OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
           OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-SEGMENT-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                           (OS-SEGMENT-TABLE OS)))
           ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                    OS-SVC-RECEIVE-HANDLER-PATH2)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE
                      OS-SVC-RECEIVE-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
            OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                            (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                              '3
                                              (OS-SRCID OS '16)
                                              OS)))
            ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                     OS-SVC-RECEIVE-HANDLER-PATH2 OS-UPDATE-STATUS)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                (INDEX-READY-SET '0
                                 (PUTNTH (CONS '3
                                               (CONS (OS-SRCID OS '16) 'NIL))
                                         (ARRAY-QFIRST (OS-READYQ OS))
                                         (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP OS-READY-SET
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2 OS-UPDATE-STATUS PLISTP
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH2 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH2 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '3)
                                    (X (OS-SRCID OS '16))
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
    (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
           (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                         (TABLE '2 (OS-SEGMENT-TABLE OS)))))
    (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
           (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                          (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH2 OS-CURRENT-TASKID OS-NEW-BASE
          OS-NEW-LIMIT OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-OS (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP-REMAINDER GETNTH-0-2 GETNTH-1-2
          OS-UPDATE-STATUS GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-STATUS-LIST-PUTNTH GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH2
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH2
          NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2 OS-SRCID
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH2
          PLISTP TABLE-PUTSEG TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH2)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2)
                      (EQUAL (GETNTH (PLUS '1
                                           (TIMES '2 (OS-SRCID OS '16)))
                                     (OS-STATUS-TABLE OS))
                             (OS-CURRENT-TASKID OS))))))))
  (GOOD-TM (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT)
  (USE (TRACE-SVC-RECEIVE-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH3
                      OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
        (EQUAL (GETNTH '5
                       (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
               (GETNTH '5 (TM-MEMORY OS)))
        (AND (EQUAL (GETNTH '6
                            (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                    (GETNTH '6 (TM-MEMORY OS)))
             (AND (EQUAL (GETNTH '7
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                         (GETNTH '7 (TM-MEMORY OS)))
                  (EQUAL (GETNTH '11
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                         (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH3 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA LESSP-CROCK-FOR-GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
             (REWRITE)
             (IMPLIES (LESSP N '16)
                      (EQUAL (LESSP '144 (PLUS '9 (TIMES '9 N)))
                             '*1*FALSE))
             ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE LESSP-CROCK-FOR-GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)

(PROVE-LEMMA
 GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (GOOD-CPU-LIST (TABLE '9
                             (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBER-LISTP-PUTNTH FINITE-NUMBERP
          GOOD-CPU LENGTH-OS-TASK-TABLE LENGTH-PUTNTH LENGTH-TM-CPU
          LESSP-CROCK-FOR-GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
          LESSP-REMAINDER2 OS-CURRENT-MBUFFER OS-CURRENT-TASKID OS-SRCID
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE PLISTP-PUTNTH PLISTP-TM-CPU
          TABLE-PUTSEG TM-R2)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
                              (QUEUE (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                         (SID (OS-SRCID OS '16))
                                         (DID (OS-CURRENT-TASKID OS))))
  (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)

(PROVE-LEMMA
           OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-SEGMENT-TABLE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                           (OS-SEGMENT-TABLE OS)))
           ((ENABLE OS-SEGMENT-TABLE OS-SVC-RECEIVE-HANDLER-PATH3
                    OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (ARRAY-ENQ (OS-SRCID OS '16)
                                        (OS-READYQ OS))))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-READYQ
                      OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)))
             ((ENABLE OS-MBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH3
                      OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                        (OS-CURRENT-TASKID OS)
                                                        OS)))))
      (FINITE-NUMBER-QUEUE-LISTP (TABLE '8
                                        (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS))
                                 '4
                                 '65536))
 ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-MBUFFERS
      GETNTH-TABLE LENGTH-ARRAY-DEQ LENGTH-GETSEG LENGTH-OS-MBUFFERS
      OS-MBUFFERS-ADDRESS-FACTS3 OS-MBUFFERS-ADDRESS-FACTS3 LESSP-REMAINDER2
      OS-CURRENT-MBUFFER OS-CURRENT-TASKID OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
      OS-SRCID PLISTP-ARRAY-DEQ PLISTP-GETSEG REWRITE-OS-MBUFFER-ADDRESS1
      TABLE-PUTSEG)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-SRCID OS '16))
                                             (DID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE)

(PROVE-LEMMA
            OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                            (OS-UPDATE-STATUS (OS-SRCID OS '16)
                                              '0
                                              '0
                                              OS)))
            ((ENABLE OS-STATUS-TABLE OS-SVC-RECEIVE-HANDLER-PATH3
                     OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-UPDATE-STATUS)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(0 0)
                                           (OS-SRCID OS '16)
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS LESSP-REMAINDER2 OS-READY-SET
           OS-SRCID OS-STATUS-TABLE-ADDRESS-FACTS
           OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3 OS-UPDATE-STATUS
           PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                   (OS-STATUS-TABLE OS))
                           '2)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-ENQ (OS-SRCID OS '16)
                                               (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH3 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP-REMAINDER GETNTH-GETSEG
          GETNTH-TABLE LENGTH-OS-STATUS-TABLE LENGTH-TABLE LESSP-REMAINDER2
          OS-READY-SET OS-SRCID OS-STATUS-TABLE-ADDRESS-FACTS
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH3 (OS OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                                     (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                     (FLAG '0)
                                     (X '0)
                                     (TASKID (OS-SRCID OS '16))
                                     (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                (DESTID (OS-SRCID OS '16))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                           (OS-STATUS-TABLE OS))
                   '2)))
  (AND
    (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
           (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                         (TABLE '2 (OS-SEGMENT-TABLE OS)))))
    (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
           (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                          (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP-REMAINDER OS-CURRENT-TASKID
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3 OS-SRCID
          TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)
  (USE
     (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                  (DESTID (OS-SRCID OS '16))))
  (ENABLE-THEORY GOOD-TM-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA FINITE-NUMBERP-OS-SRCID
             (REWRITE)
             (AND (NUMBERP (OS-SRCID OS '16))
                  (AND (LESSP (OS-SRCID OS '16) '16)
                       (FINITE-NUMBERP (OS-SRCID OS '16)
                                       '16)))
             ((ENABLE OS-SRCID LESSP-REMAINDER2 FINITE-NUMBERP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBERP-OS-SRCID)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2)
                      (EQUAL (GETNTH (PLUS '1
                                           (TIMES '2 (OS-SRCID OS '16)))
                                     (OS-STATUS-TABLE OS))
                             (OS-CURRENT-TASKID OS))))))))
  (GOOD-OS (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS
          FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          FINITE-NUMBERP-OS-SRCID
          GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE GOOD-OS
          GOOD-STATUS-LIST-PUTNTH GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-STATUS-TABLE-ADDRESS-FACTS NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH3
          NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-RECEIVE-HANDLER-PATH3
          PLISTP OS-UPDATE-STATUS TABLE-PUTSEG
          TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
     (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                  (DESTID (OS-SRCID OS '16))))
  (DISABLE PLUS TIMES)
  (DO-NOT-INDUCT T)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS)))))))))
  (GOOD-TM (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-RECEIVE-INTERRUPT)
  (USE (TRACE-SVC-RECEIVE-HANDLER-PATH4 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-RECEIVE-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH4
                      OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
        (EQUAL (GETNTH '5
                       (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
               (GETNTH '5 (TM-MEMORY OS)))
        (AND (EQUAL (GETNTH '6
                            (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                    (GETNTH '6 (TM-MEMORY OS)))
             (AND (EQUAL (GETNTH '7
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                         (GETNTH '7 (TM-MEMORY OS)))
                  (EQUAL (GETNTH '11
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                         (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH4 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
           OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-SEGMENT-TABLE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                           (OS-SEGMENT-TABLE OS)))
           ((ENABLE OS-SEGMENT-TABLE OS-SVC-RECEIVE-HANDLER-PATH4
                    OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-READYQ
                      OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS)))
             ((ENABLE OS-MBUFFERS OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
                      OS-SVC-RECEIVE-HANDLER-PATH4
                      OS-MBUFFERS-WITH-DEQUEUED-MESSAGE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
            OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                            (OS-STATUS-TABLE OS)))
            ((ENABLE OS-STATUS-TABLE OS-SVC-RECEIVE-HANDLER-PATH4
                     OS-TASK-TABLE-WITH-DELIVERED-MESSAGE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (OS-READY-SET (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (OS-READY-SET OS)))
             ((ENABLE GOOD-TM-OS OS-READY-SET
                      OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
             ((ENABLE TM-WAITING OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
    (EQUAL (TM-BASE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
           (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                         (TABLE '2 (OS-SEGMENT-TABLE OS)))))
    (EQUAL (TM-LIMIT (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
           (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                          (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-BASE-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)
  (ENABLE-THEORY GOOD-TM-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS)))))))))
  (GOOD-OS (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
          GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-MESSAGE GOOD-OS
          GOOD-TM-OS-SVC-RECEIVE-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-RECEIVE-HANDLER-PATH4
          NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-CODE-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-READY-SET-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-BASE-TM-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-SLIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA GOOD-OS-OS-SVC-RECEIVE-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '1))))
                      (GOOD-OS (OS-SVC-RECEIVE-HANDLER OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER
                      GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH1
                      GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH2
                      GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH3
                      GOOD-OS-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-SVC-TYI-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-TM (OS-INTENDED-SVC-TYI-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-SVC-TYI-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-SVC-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-SVC-TYI-INTERRUPT)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-TM (OS-SVC-TYI-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYI-INTERRUPT)
  (USE (TRACE-SVC-TYI-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYI-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYI-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYI-HANDLER-PATH1 OS)))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '5
                                               '0
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYI-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-TYI-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-TYI-HANDLER-PATH1 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(5 0)
                                           (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-TYI-HANDLER-PATH1 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-TYI-HANDLER-PATH1 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '5)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY OS-SEGMENT-LENGTHS
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-WAITING-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (TM-WAITING (OS-SVC-TYI-HANDLER-PATH1 OS))
             ((ENABLE TM-WAITING OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-OS (OS-SVC-TYI-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          OS-UPDATE-STATUS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-TYI-HANDLER-PATH1
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH1
          OS-CODE-OS-SVC-TYI-HANDLER-PATH1
          OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          OS-READYQ-OS-SVC-TYI-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH1
          OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1
          OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH1
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH1
          PLISTP TABLE-PUTSEG TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH1
          TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH1
          TM-WAITING-OS-SVC-TYI-HANDLER-PATH1)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-TM (OS-SVC-TYI-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYI-INTERRUPT)
  (USE (TRACE-SVC-TYI-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYI-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYI-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYI-HANDLER-PATH2 OS)))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '5
                                               '0
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYI-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-TYI-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-TYI-HANDLER-PATH2 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(5 0)
                                           (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-TYI-HANDLER-PATH2 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-TYI-HANDLER-PATH2 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '5)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY OS-SEGMENT-LENGTHS
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-TYI-HANDLER-PATH2 OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-TYI-HANDLER-PATH2 OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (GOOD-TM OS)
   (AND (EQUAL (TM-BASE (OS-SVC-TYI-HANDLER-PATH2 OS))
               (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))
        (EQUAL (TM-LIMIT (OS-SVC-TYI-HANDLER-PATH2 OS))
               (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH2 OS))
                              (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2 TM-BASE-OS-SVC-TYI-HANDLER-PATH2
          OS-CURRENT-TASKID OS-NEW-BASE OS-NEW-LIMIT
          OS-READYQ-OS-SVC-TYI-HANDLER-PATH2)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-TYI-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-OS (OS-SVC-TYI-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP GOOD-CPU-LIST-OS-NEW-TASK-TABLE OS-UPDATE-STATUS
          GOOD-OS GOOD-STATUS-LIST-PUTNTH GOOD-TM-OS-SVC-TYI-HANDLER-PATH2
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH2
          NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH2
          OS-CODE-OS-SVC-TYI-HANDLER-PATH2
          OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          OS-READYQ-OS-SVC-TYI-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH2
          OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYI-HANDLER-PATH2
          PLISTP TABLE-PUTSEG TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH2
          TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH2)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))))
  (GOOD-TM (OS-SVC-TYI-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYI-INTERRUPT)
  (USE (TRACE-SVC-TYI-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYI-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYI-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH3
                      OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      OS-IBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYI-HANDLER-PATH3 OS)))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      OS-SVC-TYI-HANDLER-PATH3 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (GOOD-CPU-LIST (TABLE '9
                             (OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS))))
 ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS FINITE-NUMBER-LISTP-PUTNTH
          FINITE-NUMBERP GOOD-CPU LENGTH-OS-TASK-TABLE LENGTH-PUTNTH
          LENGTH-TM-CPU OS-CURRENT-IBUFFER OS-CURRENT-TASKID
          OS-TASK-TABLE-WITH-DELIVERED-CHARACTER PLISTP-PUTNTH PLISTP-TM-CPU
          TABLE-PUTSEG)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
                              (QUEUE (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (OS OS)
                                         (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS-SEGMENT-TABLE
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS-READYQ
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS)))
             ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                      OS)))))
    (FINITE-NUMBER-QUEUE-LISTP (TABLE '8
                                      (OS-IBUFFERS-WITH-DEQUEUED-CHARACTER OS))
                               '4
                               '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      GETNTH-TABLE LENGTH-ARRAY-DEQ LENGTH-GETSEG LENGTH-OS-IBUFFERS
      OS-CURRENT-IBUFFER OS-CURRENT-TASKID OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
      PLISTP-ARRAY-DEQ PLISTP-GETSEG TABLE-PUTSEG)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (OS OS)
                                             (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (OS-STATUS-TABLE OS)))
             ((ENABLE OS-TASK-TABLE-WITH-DELIVERED-CHARACTER OS-STATUS-TABLE
                      OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-TYI-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (AND (EQUAL (TM-BASE (OS-SVC-TYI-HANDLER-PATH3 OS))
               (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))
        (EQUAL (TM-LIMIT (OS-SVC-TYI-HANDLER-PATH3 OS))
               (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH3 OS))
                              (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-SVC-TYI-HANDLER-PATH3
          TM-BASE-OS-SVC-TYI-HANDLER-PATH3 TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))))
  (GOOD-OS (OS-SVC-TYI-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
          FINITE-NUMBERP-REMAINDER
          GOOD-CPU-LIST-OS-TASK-TABLE-WITH-DELIVERED-CHARACTER GOOD-OS
          GOOD-TM-OS-SVC-TYI-HANDLER-PATH3
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYI-HANDLER-PATH3
          NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH3
          OS-CODE-OS-SVC-TYI-HANDLER-PATH3
          OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3 OS-READY-SET
          OS-READYQ-OS-SVC-TYI-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH3
          OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3
          OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH3
          TM-BASE-TM-LIMIT-OS-SVC-TYI-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-SVC-TYI-HANDLER-PATH3
          TM-SLIMIT-OS-SVC-TYI-HANDLER-PATH3)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA GOOD-OS-OS-SVC-TYI-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '3))))
                      (GOOD-OS (OS-SVC-TYI-HANDLER OS)))
             ((ENABLE OS-SVC-TYI-HANDLER GOOD-OS-OS-SVC-TYI-HANDLER-PATH1
                      GOOD-OS-OS-SVC-TYI-HANDLER-PATH2
                      GOOD-OS-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYI-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-TM (OS-INTENDED-SVC-TYO-INTERRUPT OS)))
             ((USE (EQUIVALENCE-OF-SVC-TYO-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-SVC-INTERRUPT (TM OS)))
              (ENABLE GOOD-TM-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-TM (OS-SVC-TYO-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT)
  (USE (TRACE-SVC-TYO-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYO-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYO-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYO-HANDLER-PATH1 OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '4
                                               '0
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYO-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-TYO-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-TYO-HANDLER-PATH1 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(4 0)
                                           (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-TYO-HANDLER-PATH1 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-TYO-HANDLER-PATH1 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '4)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY OS-SEGMENT-LENGTHS
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-WAITING-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (TM-WAITING (OS-SVC-TYO-HANDLER-PATH1 OS))
             ((ENABLE TM-WAITING OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (GOOD-OS (OS-SVC-TYO-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          OS-UPDATE-STATUS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-TYO-HANDLER-PATH1
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH1
          OS-CODE-OS-SVC-TYO-HANDLER-PATH1
          OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH1
          OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH1
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH1
          PLISTP TABLE-PUTSEG TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH1
          TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH1
          TM-WAITING-OS-SVC-TYO-HANDLER-PATH1)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-TM (OS-SVC-TYO-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT)
  (USE (TRACE-SVC-TYO-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYO-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYO-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYO-HANDLER-PATH2 OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (ARRAY-DEQ (OS-READYQ OS))))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (OS-UPDATE-STATUS (ARRAY-QFIRST (OS-READYQ OS))
                                               '4
                                               '0
                                               OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYO-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
  OS-READY-SET-OS-SVC-TYO-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (OS-READY-SET (OS-SVC-TYO-HANDLER-PATH2 OS))
                  (INDEX-READY-SET '0
                                   (PUTNTH '(4 0)
                                           (ARRAY-QFIRST (OS-READYQ OS))
                                           (TABLE '2 (OS-STATUS-TABLE OS))))))
  ((ENABLE LENGTH PLISTP OS-READY-SET OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (NOT (TM-WAITING OS)))
          (PERMUTATION (MAPUP-QUEUE (ARRAY-DEQ (OS-READYQ OS)))
                       (OS-READY-SET (OS-SVC-TYO-HANDLER-PATH2 OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY LENGTH-TABLE
          LESSP-QFIRST-MAPUP-QUEUE-OS-READYQ NOT-QEMPTYP-MAPUP-QUEUE-OS-READYQ
          OS-READY-SET PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-SVC-TYO-HANDLER-PATH2 (OS OS))
   (PERMUTATION-DEQ-INDEX-READY-SET-PUTNTH
                                    (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                                    (FLAG '4)
                                    (X '0)
                                    (TASKID (ARRAY-QFIRST (OS-READYQ OS)))
                                    (STATUS (TABLE '2 (OS-STATUS-TABLE OS)))))
  (ENABLE-THEORY EXECUTABLE-THEORY OS-SEGMENT-LENGTHS
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH2 OS))
                    (OS-NEW-BASE (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH2 OS))
                    (OS-NEW-LIMIT (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (GOOD-TM OS)
   (AND (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH2 OS))
               (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))
        (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH2 OS))
               (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH2 OS))
                              (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2 TM-BASE-OS-SVC-TYO-HANDLER-PATH2
          OS-CURRENT-TASKID OS-NEW-BASE OS-NEW-LIMIT
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH2)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-TYO-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (GOOD-OS (OS-SVC-TYO-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          OS-UPDATE-STATUS GOOD-STATUS-LIST-PUTNTH
          GOOD-TM-OS-SVC-TYO-HANDLER-PATH2
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH2
          NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH2
          OS-CODE-OS-SVC-TYO-HANDLER-PATH2
          OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH2
          OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-SVC-TYO-HANDLER-PATH2
          PLISTP TABLE-PUTSEG TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH2
          TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH2)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                  (TM-OPORTS OS)))))))
  (GOOD-TM (OS-SVC-TYO-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT)
  (USE (TRACE-SVC-TYO-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYO-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH3
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYO-HANDLER-PATH3 OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH3 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH3
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH3
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                     OS)))))
    (FINITE-NUMBER-QUEUE-LISTP (TABLE '8
                                      (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS))
                               '4
                               '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES FINITE-NUMBERP
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-GETSEG LENGTH-OS-OBUFFERS
      OS-CURRENT-OBUFFER OS-CURRENT-TASKID OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
      PLISTP-ARRAY-ENQ PLISTP-GETSEG TABLE-PUTSEG)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBERP-GETNTH (I '3)
                              (L (TM-REGS OS))
                              (LUB '65536))
       (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (OS OS)
                                             (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH3
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (OS-STATUS-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-TYO-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (AND (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH3 OS))
               (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))
        (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH3 OS))
               (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH3 OS))
                              (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-SVC-TYO-HANDLER-PATH3
          TM-BASE-OS-SVC-TYO-HANDLER-PATH3 TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                  (TM-OPORTS OS)))))))
  (GOOD-OS (OS-SVC-TYO-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
          FINITE-NUMBERP-REMAINDER GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-SVC-TYO-HANDLER-PATH3
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH3
          NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH3
          OS-CODE-OS-SVC-TYO-HANDLER-PATH3
          OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3 OS-READY-SET
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH3
          OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH3
          TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH3
          TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH3)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (NOT (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                       (TM-OPORTS OS))))))))
  (GOOD-TM (OS-SVC-TYO-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-SVC-TYO-INTERRUPT)
  (USE (TRACE-SVC-TYO-HANDLER-PATH4 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-SVC-TYO-INTERRUPT OS))
                             (N (OS-TIME-FOR-SVC-TYO-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH4
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
       (EQUAL (GETNTH '4
                      (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
              (GETNTH '4 (TM-MEMORY OS)))
       (AND (EQUAL (GETNTH '5
                           (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
                   (GETNTH '5 (TM-MEMORY OS)))
            (AND (EQUAL (GETNTH '6
                                (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
                        (GETNTH '6 (TM-MEMORY OS)))
                 (AND (EQUAL (GETNTH '7
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
                             (GETNTH '7 (TM-MEMORY OS)))
                      (EQUAL (GETNTH '11
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
                             (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-SVC-TYO-HANDLER-PATH4 OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-NEW-TASK-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH4 OS-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-SEGMENT-TABLE (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-SEGMENT-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-SEGMENT-TABLE
                      OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-READYQ OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH4
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-OBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH4
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH4
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (OS-STATUS-TABLE OS)))
             ((ENABLE OS-NEW-TASK-TABLE OS-STATUS-TABLE
                      OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-WAITING (OS-SVC-TYO-HANDLER-PATH4 OS)))
             ((ENABLE TM-WAITING OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-BASE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-BASE OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (AND (EQUAL (TM-BASE (OS-SVC-TYO-HANDLER-PATH4 OS))
               (BASE (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (TABLE '2 (OS-SEGMENT-TABLE OS)))))
        (EQUAL (TM-LIMIT (OS-SVC-TYO-HANDLER-PATH4 OS))
               (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH4 OS))
                              (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-SVC-TYO-HANDLER-PATH4
          TM-BASE-OS-SVC-TYO-HANDLER-PATH4 TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4)
  (ENABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (NOT (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                       (TM-OPORTS OS))))))))
  (GOOD-OS (OS-SVC-TYO-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
          FINITE-NUMBERP-REMAINDER GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-SVC-TYO-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-SVC-TYO-HANDLER-PATH4
          NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH4
          OS-CODE-OS-SVC-TYO-HANDLER-PATH4
          OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4 OS-READY-SET
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH4
          OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH4
          TM-BASE-TM-LIMIT-OS-SVC-TYO-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-SVC-TYO-HANDLER-PATH4
          TM-SLIMIT-OS-SVC-TYO-HANDLER-PATH4)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA GOOD-OS-OS-SVC-TYO-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '2))))
                      (GOOD-OS (OS-SVC-TYO-HANDLER OS)))
             ((ENABLE OS-SVC-TYO-HANDLER GOOD-OS-OS-SVC-TYO-HANDLER-PATH1
                      GOOD-OS-OS-SVC-TYO-HANDLER-PATH2
                      GOOD-OS-OS-SVC-TYO-HANDLER-PATH3
                      GOOD-OS-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-TYO-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-INPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
                      (GOOD-TM (OS-INTENDED-INPUT-INTERRUPT OS)))
             ((ENABLE GOOD-TM-OS)
              (USE (EQUIVALENCE-OF-INPUT-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-INPUT-INTERRUPT (TM OS)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (TM-WAITING OS)
             (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
   (FINITE-NUMBER-QUEUEP (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))
                         '16
                         '16))
 ((ENABLE FINITE-NUMBERP)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
       (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH1)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
         OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH1)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
           OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                           (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)))
           ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                    OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBER-QUEUE-LISTP-PUTNTH
          FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS
          FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS
          OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS)))))
 ((ENABLE LENGTH PLISTP COMMUTATIVITY-OF-PLUS FINITE-NUMBERP
          GOOD-STATUS-LIST-PUTNTH LENGTH-OS-STATUS-TABLE
          OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH1 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-WAITING OS)
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH1 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH1 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-BASE-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS) (TM-WAITING OS))
  (AND
   (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH1 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1 ARRAY-QFIRST-ARRAY-ENQ1
          TM-BASE-OS-WAITING-INPUT-HANDLER-PATH1 OS-CURRENT-TASKID OS-NEW-BASE
          OS-NEW-LIMIT OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH1 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH1
          NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH1
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH1
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH1
          TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH1
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH2)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
         OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH2)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
            OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                            (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)))
            ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                     OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
      OS-CURRENT-IBUFFER OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
      PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH2 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-WAITING OS)
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH2 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH2 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS) (TM-WAITING OS))
  (AND
   (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH2 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2
          TM-BASE-OS-WAITING-INPUT-HANDLER-PATH2
          TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH2 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH2
          NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH2
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH2
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH2
          TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH2
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
                      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH3)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH3)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH3 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-WAITING OS)
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-WAITING-INPUT-HANDLER-PATH3 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-WAITING-INPUT-HANDLER-PATH3 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    (BASE (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    (LIMIT (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS) (TM-WAITING OS))
  (AND
   (EQUAL (TM-BASE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-WAITING-INPUT-HANDLER-PATH3 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3
          TM-BASE-OS-WAITING-INPUT-HANDLER-PATH3
          TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH3 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH3
          NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH3
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH3
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-INPUT-HANDLER-PATH3
          TM-BASE-TM-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH3
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH4 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH4
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH4)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
           OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                           (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)))
           ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                    OS-WAITING-INPUT-HANDLER-PATH4)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBER-QUEUE-LISTP-PUTNTH
          FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS
          FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS
          OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH4)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH4 OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          GOOD-OS GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH4
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH4
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4 OS-READY-SET
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH4
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH4
          TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH5 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH5
                      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH5)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                            (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)))
            ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                     OS-WAITING-INPUT-HANDLER-PATH5)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
      TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH5)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH5 OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          GOOD-OS GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH5
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH5
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH5
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5 OS-READY-SET
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH5
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH5
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH5
          TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-TM (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-WAITING-INPUT-HANDLER-PATH6 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-WAITING-INPUT-HANDLER-PATH6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-CODE-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-INPUT-HANDLER-PATH6
                      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                            (OS-TASK-TABLE OS)))
            ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6 OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-WAITING-INPUT-HANDLER-PATH6)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-WAITING-INPUT-HANDLER-PATH6)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (TM-WAITING (OS-WAITING-INPUT-HANDLER-PATH6 OS))
             ((ENABLE TM-WAITING OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-OS (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          GOOD-OS GOOD-TM-OS-WAITING-INPUT-HANDLER-PATH6
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-INPUT-HANDLER-PATH6
          OS-CODE-OS-WAITING-INPUT-HANDLER-PATH6
          OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6 OS-READY-SET
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH6
          OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
          TM-INTERRUPT-ADDRESSES-OS-WAITING-INPUT-HANDLER-PATH6
          TM-SLIMIT-OS-WAITING-INPUT-HANDLER-PATH6
          TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA GOOD-OS-OS-WAITING-INPUT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (TM-WAITING OS)))
                      (GOOD-OS (OS-WAITING-INPUT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH1
                      GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH2
                      GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH3
                      GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH4
                      GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH5
                      GOOD-OS-OS-WAITING-INPUT-HANDLER-PATH6
                      OS-WAITING-INPUT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-INPUT-HANDLER)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (FINITE-NUMBER-QUEUEP (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                   (OS-READYQ OS))
                        '16
                        '16))
 ((ENABLE FINITE-NUMBERP)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS)))
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT2)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH1 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1 OS-TASK-TABLE
                     OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-INPUT-HANDLER-PATH1
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
         OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-READYQ OS-RUNNING-INPUT-HANDLER-PATH1 OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
           OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                           (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)))
           ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                    OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
                    OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBER-QUEUE-LISTP-PUTNTH
          FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS
          FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS
          OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH1
           OS-UPDATE-STATUS)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH1 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH1 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP OS-CURRENT-TASKID
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                          (OS OS)
                          (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH1 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH1
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH2 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE
                      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2 OS-NEW-TASK-TABLE
                     OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2 OS-NEW-TASK-TABLE
                  OS-SEGMENT-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
         OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2 OS-NEW-TASK-TABLE OS-READYQ)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
            OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                            (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)))
            ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                     OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                     OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
      OS-CURRENT-IBUFFER OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
      PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
           OS-NEW-TASK-TABLE)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH2 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH2 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP OS-CURRENT-TASKID
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                          (OS OS)
                          (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH2 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH2
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH3 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
                      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3 OS-TASK-TABLE
                     OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3 OS-SEGMENT-TABLE
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                         (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS))))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3 OS-READYQ OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH3
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
  OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (GOOD-TM OS)
           (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                  (OS-UPDATE-STATUS (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    '0
                                    '0
                                    OS)))
  ((ENABLE OS-STATUS-TABLE OS-RUNNING-INPUT-HANDLER-PATH3 OS-NEW-TASK-TABLE
           OS-UPDATE-STATUS)
   (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                  OS-SEGMENT-LENGTHS GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (GOOD-STATUS-LIST
                (TABLE '2
                       (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
    (EQUAL (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
           (INDEX-READY-SET '0
                            (PUTNTH '(0 0)
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH PLISTP FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (PERMUTATION
            (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (OS-READYQ OS)))
            (OS-READY-SET (OS-RUNNING-INPUT-HANDLER-PATH3 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-RUNNING-INPUT-HANDLER-PATH3 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                           (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                           (FLAG '0)
                           (X '0)
                           (TASKID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                           (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP OS-CURRENT-TASKID
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                          (OS OS)
                          (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-INPUT-PORT2
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH3 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH3
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH4 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH4 OS-NEW-TASK-TABLE
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4 OS-TASK-TABLE
                     OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-INPUT-HANDLER-PATH4
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-RUNNING-INPUT-HANDLER-PATH4
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
           OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                           (OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER OS)))
           ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                    OS-RUNNING-INPUT-HANDLER-PATH4 OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBER-QUEUE-LISTP-PUTNTH
          FINITE-NUMBER-QUEUEP-ARRAY-QREPLACE-COROLLARY-FOR-IBUFFERS
          FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS
          OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH4 OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS
                      OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH4 OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-NEW-TASK-TABLE
                   OS-RUNNING-INPUT-HANDLER-PATH4)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH4
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4 OS-READY-SET
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH5 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH5 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE
                      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE
                     OS-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE
                  OS-SEGMENT-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE
                      OS-READYQ)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                            (OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER OS)))
            ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                     OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
      OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
      TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                      OS-RUNNING-INPUT-HANDLER-PATH5 OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-RUNNING-INPUT-HANDLER-PATH5
                   OS-NEW-TASK-TABLE)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH5
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH5
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5 OS-READY-SET
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-TM (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-INPUT-INTERRUPT)
  (USE (TRACE-RUNNING-INPUT-HANDLER-PATH6 (OS OS))
       (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-INPUT-INTERRUPT OS))
                             (N (OS-TIME-FOR-RUNNING-INPUT-HANDLER-PATH6 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-INPUT-HANDLER-PATH6
                      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
      (EQUAL (GETNTH '5
                     (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
             (GETNTH '5 (TM-MEMORY OS)))
      (AND (EQUAL (GETNTH '6
                          (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
                  (GETNTH '6 (TM-MEMORY OS)))
           (AND (EQUAL (GETNTH '7
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
                       (GETNTH '7 (TM-MEMORY OS)))
                (EQUAL (GETNTH '11
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
                       (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
            OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
            (REWRITE)
            (IMPLIES (GOOD-TM OS)
                     (EQUAL (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                            (OS-NEW-TASK-TABLE OS)))
            ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6 OS-TASK-TABLE
                     OS-NEW-TASK-TABLE)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                            GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
         OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                         (OS-SEGMENT-TABLE OS)))
         ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6 OS-SEGMENT-TABLE
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6 OS-READYQ
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (OS-IBUFFERS-WITH-ENQUEUED-CHARACTER OS)))
             ((ENABLE OS-IBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                      (TABLE '8
                             (OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
                      '4
                      '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-ENQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS
      OS-IBUFFERS-ADDRESS-FACTS OS-CURRENT-IBUFFER
      OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
      OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
          (REWRITE)
          (IMPLIES (GOOD-TM OS)
                   (EQUAL (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                          (OS-STATUS-TABLE OS)))
          ((ENABLE OS-STATUS-TABLE OS-NEW-TASK-TABLE
                   OS-RUNNING-INPUT-HANDLER-PATH6)
           (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                          OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
   (EQUAL (TM-BASE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
          (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
         (TM-LIMIT (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
         (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                        (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-BASE-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (GOOD-OS (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-RUNNING-INPUT-HANDLER-PATH6
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-INPUT-HANDLER-PATH6
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-CODE-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6 OS-READY-SET
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-BASE-TM-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-SLIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA GOOD-OS-OS-RUNNING-INPUT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (NOT (TM-WAITING OS))))
                      (GOOD-OS (OS-RUNNING-INPUT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH1
                      GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH2
                      GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH3
                      GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH4
                      GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH5
                      GOOD-OS-OS-RUNNING-INPUT-HANDLER-PATH6
                      OS-RUNNING-INPUT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER)

(PROVE-LEMMA GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
                      (GOOD-TM (OS-INTENDED-OUTPUT-INTERRUPT OS)))
             ((ENABLE GOOD-TM-OS)
              (USE (EQUIVALENCE-OF-OUTPUT-INTERRUPT-EXPRESSIONS (OS OS))
                   (GOOD-TM-TM-EXECUTE-OUTPUT-INTERRUPT (TM OS)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
  (FINITE-NUMBER-QUEUEP (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))
                        '16
                        '16))
 ((ENABLE FINITE-NUMBERP)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
       (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-TM (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-WAITING-OUTPUT-HANDLER-PATH1 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                           (OS-TASK-TABLE OS)))
           ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1 OS-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
        OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                        (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))))
        ((ENABLE OS-READYQ OS-WAITING-OUTPUT-HANDLER-PATH1)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (GOOD-TM OS)
          (EQUAL (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)))
 ((ENABLE OS-STATUS-TABLE OS-WAITING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (GOOD-STATUS-LIST
               (TABLE '2
                      (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
   (EQUAL (OS-READY-SET (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
          (INDEX-READY-SET '0
                           (PUTNTH '(0 0)
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-WAITING OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (PERMUTATION
           (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))
           (OS-READY-SET (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH1 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                          (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                          (FLAG '0)
                          (X '0)
                          (TASKID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE
        PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-WAITING (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
             ((ENABLE TM-WAITING OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-BASE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    (BASE (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                  (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    (LIMIT (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS) (TM-WAITING OS))
  (AND
   (EQUAL
         (TM-BASE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
          TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1
          TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-OS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT GOOD-OS
         GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
         GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH1 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
         NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH1
         NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
         OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
         PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH1
         TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
         TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH1
         TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-TM (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-WAITING-OUTPUT-HANDLER-PATH2 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                           (OS-TASK-TABLE OS)))
           ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2 OS-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
        OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                        (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))))
        ((ENABLE OS-READYQ OS-WAITING-OUTPUT-HANDLER-PATH2)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH2
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH2
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                     (TABLE '8
                            (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                     '4
                     '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-OS-OBUFFERS OS-IBUFFERS-ADDRESS-FACTS
      OS-CURRENT-OBUFFER OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH2
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (GOOD-TM OS)
          (EQUAL (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)))
 ((ENABLE OS-STATUS-TABLE OS-WAITING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (GOOD-STATUS-LIST
               (TABLE '2
                      (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
   (EQUAL (OS-READY-SET (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
          (INDEX-READY-SET '0
                           (PUTNTH '(0 0)
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-WAITING OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (PERMUTATION
           (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))
           (OS-READY-SET (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-WAITING-OUTPUT-HANDLER-PATH2 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                          (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                          (FLAG '0)
                          (X '0)
                          (TASKID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE
        PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    (BASE (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                  (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    (LIMIT (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-SEGMENT-TABLE OS)))))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS) (TM-WAITING OS))
  (AND
   (EQUAL
         (TM-BASE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
          TM-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2
          TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-OS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE
         FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
         FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT GOOD-OS
         GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
         GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH2 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
         NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH2
         NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
         OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
         PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-WAITING-OUTPUT-HANDLER-PATH2
         TM-BASE-TM-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
         TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH2
         TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-TM (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-WAITING-OUTPUT-HANDLER-PATH3 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                           (OS-TASK-TABLE OS)))
           ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3 OS-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                         (OS-STATUS-TABLE OS)))
         ((ENABLE OS-STATUS-TABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (TM-WAITING (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
             ((ENABLE TM-WAITING OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-OS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-OS GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH3
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3 OS-READY-SET
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-TM (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-WAITING-OUTPUT-HANDLER-PATH4 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-WAITING-OUTPUT-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-WAITING-OUTPUT-HANDLER-PATH4
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                           (OS-TASK-TABLE OS)))
           ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4 OS-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH4
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                     (TABLE '8
                            (OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
                     '4
                     '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-OS-OBUFFERS OS-IBUFFERS-ADDRESS-FACTS
      OS-CURRENT-OBUFFER OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-WAITING-OUTPUT-HANDLER-PATH4
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
         OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                         (OS-STATUS-TABLE OS)))
         ((ENABLE OS-STATUS-TABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (TM-WAITING (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
             ((ENABLE TM-WAITING OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-OS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          GOOD-OS GOOD-TM-OS-WAITING-OUTPUT-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-CODE-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4 OS-READY-SET
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-SLIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA GOOD-OS-OS-WAITING-OUTPUT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (TM-WAITING OS)))
                      (GOOD-OS (OS-WAITING-OUTPUT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH1
                      GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH2
                      GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH3
                      GOOD-OS-OS-WAITING-OUTPUT-HANDLER-PATH4
                      OS-WAITING-OUTPUT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-WAITING-OUTPUT-HANDLER)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (FINITE-NUMBER-QUEUEP (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))
                        '16
                        '16))
 ((ENABLE FINITE-NUMBERP)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT2)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-TM (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-RUNNING-OUTPUT-HANDLER-PATH1 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH1 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-OUTPUT-HANDLER-PATH1
                      OS-NEW-TASK-TABLE OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                           (OS-NEW-TASK-TABLE OS)))
           ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-TASK-TABLE
                    OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH1
                 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
        OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                        (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))))
        ((ENABLE OS-READYQ OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH1
                      OS-UPDATE-STATUS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (GOOD-TM OS)
          (EQUAL (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)))
 ((ENABLE OS-STATUS-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          OS-NEW-TASK-TABLE)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (GOOD-STATUS-LIST
               (TABLE '2
                      (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
   (EQUAL (OS-READY-SET (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
          (INDEX-READY-SET '0
                           (PUTNTH '(0 0)
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (PERMUTATION
           (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))
           (OS-READY-SET (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH1 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                          (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                          (FLAG '0)
                          (X '0)
                          (TASKID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE
        PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (AND
   (EQUAL
         (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP OS-CURRENT-TASKID
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
          TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-OS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
 ((ENABLE LENGTH PLISTP
         FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT2
         GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
         GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
         GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH1 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
         NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH1
         NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
         OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
         PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH1
         TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
         TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH1
         TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-TM (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-RUNNING-OUTPUT-HANDLER-PATH2 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH2 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-OUTPUT-HANDLER-PATH2
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                           (OS-NEW-TASK-TABLE OS)))
           ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-TASK-TABLE
                    OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH2
                 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
        OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                        (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS))))
        ((ENABLE OS-READYQ OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH2
                      OS-UPDATE-STATUS OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH2
                      OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                     (TABLE '8
                            (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                     '4
                     '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-OS-OBUFFERS OS-IBUFFERS-ADDRESS-FACTS
      OS-CURRENT-OBUFFER OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH2
                      OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-UPDATE-STATUS)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (GOOD-TM OS)
          (EQUAL (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                 (OS-UPDATE-STATUS (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   '0
                                   '0
                                   OS)))
 ((ENABLE OS-STATUS-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          OS-NEW-TASK-TABLE)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                 OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (GOOD-STATUS-LIST
               (TABLE '2
                      (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))))
 ((ENABLE COMMUTATIVITY-OF-PLUS FINITE-NUMBERP GOOD-STATUS-LIST-PUTNTH
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
   (EQUAL (OS-READY-SET (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
          (INDEX-READY-SET '0
                           (PUTNTH '(0 0)
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TABLE '2 (OS-STATUS-TABLE OS))))))
 ((ENABLE LENGTH FINITE-NUMBERP OS-READY-SET
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-UPDATE-STATUS
          PLISTP TABLE-PUTSEG)
  (ENABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (PERMUTATION
           (MAPUP-QUEUE (ARRAY-ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (OS-READYQ OS)))
           (OS-READY-SET (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CORRECTNESS-OF-ARRAY-ENQ
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBER-LISTP-MAPUP-QUEUE
          FINITE-NUMBER-LISTP-QARRAY FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE
          LENGTH-TABLE OS-READY-SET OS-STATUS-TABLE-ADDRESS-FACTS
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          PERMUTATION-OS-READYQ-QARRAY-OS-READY-SET-COROLLARY
          PLISTP-MAPUP-QUEUE PLUS-0 STATUS-FLAG-READYP)
  (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE
   (A-FINITE-NUMBER-LIST-IS-A-NUMBER-LIST (L (MAPUP-QUEUE (OS-READYQ OS)))
                                          (LUB '16))
   (OS-READY-SET-OS-RUNNING-OUTPUT-HANDLER-PATH2 (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (PERMUTATION-ENQ-INDEX-READY-SET-PUTNTH
                          (QUEUE (MAPUP-QUEUE (OS-READYQ OS)))
                          (FLAG '0)
                          (X '0)
                          (TASKID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (STATUS (TABLE '2 (OS-STATUS-TABLE OS))))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE
        PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (AND
   (EQUAL
         (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP OS-CURRENT-TASKID
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
          TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-OS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
 ((ENABLE LENGTH PLISTP
         FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
         FINITE-NUMBER-QUEUEP-ARRAY-ENQ-INTERRUPTING-OUTPUT-PORT2
         GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
         GOOD-STATUS-LIST-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
         GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH2 NOT-ARRAY-QEMPTYP-ARRAY-ENQ
         NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH2
         NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
         OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
         PERMUTATION-OS-READYQ-OS-READY-SET-FOR-OS-RUNNING-OUTPUT-HANDLER-PATH2
         TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
         TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH2
         TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-TM (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-RUNNING-OUTPUT-HANDLER-PATH3 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH3 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-OUTPUT-HANDLER-PATH3
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                           (OS-NEW-TASK-TABLE OS)))
           ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3 OS-TASK-TABLE
                    OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH3
                 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-RUNNING-OUTPUT-HANDLER-PATH3
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH3
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-OBUFFERS OS)))
             ((ENABLE OS-OBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH3
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH3
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
         OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                         (OS-STATUS-TABLE OS)))
         ((ENABLE OS-STATUS-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH3
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
   (EQUAL
         (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (GOOD-OS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
 ((ENABLE LENGTH PLISTP GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH3
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3 OS-READY-SET
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-TM (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE GOOD-TM-OS-INTENDED-OUTPUT-INTERRUPT)
  (USE
      (TRACE-RUNNING-OUTPUT-HANDLER-PATH4 (OS OS))
      (GOOD-TM-TM-PROCESSOR (TM (OS-INTENDED-OUTPUT-INTERRUPT OS))
                            (N (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER-PATH4 OS))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-SLIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-SLIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-CODE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-CODE OS)))
             ((ENABLE OS-CODE OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (GOOD-TM OS)
  (AND
   (EQUAL (GETNTH '3
                  (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
          (GETNTH '3 (TM-MEMORY OS)))
   (AND
    (EQUAL (GETNTH '4
                   (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
           (GETNTH '4 (TM-MEMORY OS)))
    (AND
     (EQUAL (GETNTH '5
                    (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
            (GETNTH '5 (TM-MEMORY OS)))
     (AND (EQUAL (GETNTH '6
                         (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
                 (GETNTH '6 (TM-MEMORY OS)))
          (AND (EQUAL (GETNTH '7
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETNTH '7 (TM-MEMORY OS)))
               (EQUAL (GETNTH '11
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETNTH '11 (TM-MEMORY OS)))))))))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4 TM-IN-SUPERVISOR-MODE)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
           OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (GOOD-TM OS)
                    (EQUAL (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                           (OS-NEW-TASK-TABLE OS)))
           ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4 OS-TASK-TABLE
                    OS-NEW-TASK-TABLE)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                           GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
        OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-TM OS)
                 (EQUAL (OS-SEGMENT-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                        (OS-SEGMENT-TABLE OS)))
        ((ENABLE OS-SEGMENT-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH4
                 OS-NEW-TASK-TABLE)
         (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                        OS-SEGMENT-LENGTHS GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-READYQ OS)))
             ((ENABLE OS-READYQ OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-IBUFFERS OS)))
             ((ENABLE OS-IBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-NEW-TASK-TABLE)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS)))
             ((ENABLE OS-OBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (FINITE-NUMBER-QUEUE-LISTP
                     (TABLE '8
                            (OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
                     '4
                     '65536))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
      FINITE-NUMBER-QUEUE-LISTP-PUTNTH
      FINITE-NUMBER-QUEUEP-ARRAY-DEQ-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
      FINITE-NUMBERP GETNTH-TABLE LENGTH-OS-OBUFFERS OS-IBUFFERS-ADDRESS-FACTS
      OS-CURRENT-OBUFFER OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
      OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-TM OS)
                      (EQUAL (OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (OS-MBUFFERS OS)))
             ((ENABLE OS-MBUFFERS OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-DEQUEUED-CHARACTER)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
         OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
         (REWRITE)
         (IMPLIES (GOOD-TM OS)
                  (EQUAL (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                         (OS-STATUS-TABLE OS)))
         ((ENABLE OS-STATUS-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH4
                  OS-NEW-TASK-TABLE)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-TM-PROPERTIES
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (NOT (TM-WAITING (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
             ((ENABLE TM-WAITING OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-BASE OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-LIMIT OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (AND
   (EQUAL
         (TM-BASE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
         (BASE (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))
   (EQUAL
        (TM-LIMIT (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
        (LIMIT (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                       (TABLE '2 (OS-SEGMENT-TABLE OS)))))))
 ((ENABLE OS-CURRENT-TASKID OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (GOOD-OS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
 ((ENABLE LENGTH PLISTP
          FINITE-NUMBER-QUEUE-LISTP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          GOOD-CPU-LIST-OS-NEW-TASK-TABLE GOOD-OS
          GOOD-TM-OS-RUNNING-OUTPUT-HANDLER-PATH4
          NOT-TM-IN-SUPERVISOR-MODE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-CODE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4 OS-READY-SET
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-BASE-TM-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-INTERRUPT-ADDRESSES-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-SLIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA GOOD-OS-OS-RUNNING-OUTPUT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (NOT (TM-WAITING OS))))
                      (GOOD-OS (OS-RUNNING-OUTPUT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH1
                      GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH2
                      GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      GOOD-OS-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      OS-RUNNING-OUTPUT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER)

(DEFN OS-SVC-HANDLER
      (OS)
      (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                 '0)
          (OS-SVC-SEND-HANDLER OS)
          (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                     '1)
              (OS-SVC-RECEIVE-HANDLER OS)
              (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (OS-SVC-TYO-HANDLER OS)
                  (OS-SVC-TYI-HANDLER OS))))
      NIL)

(DEFN OS-TIME-FOR-SVC-HANDLER
      (OS)
      (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                 '0)
          (OS-TIME-FOR-SVC-SEND-HANDLER OS)
          (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                     '1)
              (OS-TIME-FOR-SVC-RECEIVE-HANDLER OS)
              (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (OS-TIME-FOR-SVC-TYO-HANDLER OS)
                  (OS-TIME-FOR-SVC-TYI-HANDLER OS))))
      NIL)

(DEFN OS-INTENDED-SVC-INTERRUPT
      (OS)
      (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                 '0)
          (OS-INTENDED-SVC-SEND-INTERRUPT OS)
          (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                     '1)
              (OS-INTENDED-SVC-RECEIVE-INTERRUPT OS)
              (IF (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (OS-INTENDED-SVC-TYO-INTERRUPT OS)
                  (OS-INTENDED-SVC-TYI-INTERRUPT OS))))
      NIL)

(PROVE-LEMMA EQUIVALENCE-OF-SVC-INTERRUPT-EXPRESSIONS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-EXECUTE-SVC-INTERRUPT OS)
                             (OS-INTENDED-SVC-INTERRUPT OS)))
             ((ENABLE OS-INTENDED-SVC-INTERRUPT)
              (USE (EQUIVALENCE-OF-SVC-SEND-INTERRUPT-EXPRESSIONS (OS OS))
                   (EQUIVALENCE-OF-SVC-RECEIVE-INTERRUPT-EXPRESSIONS (OS OS))
                   (EQUIVALENCE-OF-SVC-TYO-INTERRUPT-EXPRESSIONS (OS OS))
                   (EQUIVALENCE-OF-SVC-TYI-INTERRUPT-EXPRESSIONS (OS OS)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE EQUIVALENCE-OF-SVC-INTERRUPT-EXPRESSIONS)

(PROVE-LEMMA LESSP-4-CROCK
             NIL
             (IMPLIES (AND (NUMBERP A)
                           (AND (LESSP A '4)
                                (AND (NOT (EQUAL A '0))
                                     (AND (NOT (EQUAL A '1))
                                          (NOT (EQUAL A '2))))))
                      (EQUAL A '3))
             ((ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(PROVE-LEMMA REMAINDER-4-EQUALS-3
             (REWRITE)
             (IMPLIES (AND (NOT (EQUAL (REMAINDER N '4) '0))
                           (AND (NOT (EQUAL (REMAINDER N '4) '1))
                                (NOT (EQUAL (REMAINDER N '4) '2))))
                      (EQUAL (REMAINDER N '4) '3))
             ((ENABLE LESSP-REMAINDER2)
              (USE (LESSP-4-CROCK (A (REMAINDER N '4))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE REMAINDER-4-EQUALS-3)

(PROVE-LEMMA TRACE-SVC-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (TM-PROCESSOR (OS-INTENDED-SVC-INTERRUPT OS)
                                           (OS-TIME-FOR-SVC-HANDLER OS))
                             (OS-SVC-HANDLER OS)))
             ((ENABLE OS-INTENDED-SVC-INTERRUPT OS-SVC-HANDLER
                      OS-TIME-FOR-SVC-HANDLER REMAINDER-4-EQUALS-3
                      TRACE-SVC-RECEIVE-HANDLER TRACE-SVC-SEND-HANDLER
                      TRACE-SVC-TYI-HANDLER TRACE-SVC-TYO-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TRACE-SVC-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-OS-OS-SVC-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (GOOD-OS (OS-SVC-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-SVC-RECEIVE-HANDLER
                      GOOD-OS-OS-SVC-SEND-HANDLER GOOD-OS-OS-SVC-TYI-HANDLER
                      GOOD-OS-OS-SVC-TYO-HANDLER OS-SVC-HANDLER
                      REMAINDER-4-EQUALS-3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-SVC-HANDLER)

(DEFN OS-INPUT-INTERRUPT-HANDLER
      (OS)
      (IF (TM-WAITING OS)
          (OS-WAITING-INPUT-HANDLER OS)
          (OS-RUNNING-INPUT-HANDLER OS))
      NIL)

(DEFN OS-TIME-FOR-INPUT-INTERRUPT-HANDLER
      (OS)
      (IF (TM-WAITING OS)
          (OS-TIME-FOR-WAITING-INPUT-HANDLER OS)
          (OS-TIME-FOR-RUNNING-INPUT-HANDLER OS))
      NIL)

(PROVE-LEMMA TRACE-INPUT-INTERRUPT-HANDLER
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
                 (EQUAL (TM-PROCESSOR (OS-INTENDED-INPUT-INTERRUPT OS)
                                      (OS-TIME-FOR-INPUT-INTERRUPT-HANDLER OS))
                        (OS-INPUT-INTERRUPT-HANDLER OS)))
        ((ENABLE OS-INPUT-INTERRUPT-HANDLER
                 OS-TIME-FOR-INPUT-INTERRUPT-HANDLER
                 TRACE-RUNNING-INPUT-HANDLER TRACE-WAITING-INPUT-HANDLER)
         (ENABLE-THEORY GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE TRACE-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-OS-OS-INPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
                      (GOOD-OS (OS-INPUT-INTERRUPT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-RUNNING-INPUT-HANDLER
                      GOOD-OS-OS-WAITING-INPUT-HANDLER
                      OS-INPUT-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-INPUT-INTERRUPT-HANDLER)

(DEFN OS-OUTPUT-INTERRUPT-HANDLER
      (OS)
      (IF (TM-WAITING OS)
          (OS-WAITING-OUTPUT-HANDLER OS)
          (OS-RUNNING-OUTPUT-HANDLER OS))
      NIL)

(DEFN OS-TIME-FOR-OUTPUT-INTERRUPT-HANDLER
      (OS)
      (IF (TM-WAITING OS)
          (OS-TIME-FOR-WAITING-OUTPUT-HANDLER OS)
          (OS-TIME-FOR-RUNNING-OUTPUT-HANDLER OS))
      NIL)

(PROVE-LEMMA TRACE-OUTPUT-INTERRUPT-HANDLER
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
                (EQUAL (TM-PROCESSOR (OS-INTENDED-OUTPUT-INTERRUPT OS)
                                     (OS-TIME-FOR-OUTPUT-INTERRUPT-HANDLER OS))
                       (OS-OUTPUT-INTERRUPT-HANDLER OS)))
       ((ENABLE OS-OUTPUT-INTERRUPT-HANDLER
                OS-TIME-FOR-OUTPUT-INTERRUPT-HANDLER
                TRACE-RUNNING-OUTPUT-HANDLER TRACE-WAITING-OUTPUT-HANDLER)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE TRACE-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA GOOD-OS-OS-OUTPUT-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
                      (GOOD-OS (OS-OUTPUT-INTERRUPT-HANDLER OS)))
             ((ENABLE GOOD-OS-OS-RUNNING-OUTPUT-HANDLER
                      GOOD-OS-OS-WAITING-OUTPUT-HANDLER
                      OS-OUTPUT-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-OUTPUT-INTERRUPT-HANDLER)

(DEFN OS-STEP
      (OS)
      (IF (TM-INPUT-INTERRUPTP OS)
          (OS-INPUT-INTERRUPT-HANDLER OS)
          (IF (TM-OUTPUT-INTERRUPTP OS)
              (OS-OUTPUT-INTERRUPT-HANDLER OS)
              (IF (TM-WAITING OS)
                  OS
                  (IF (TM-ERRORP OS)
                      (OS-ERROR-HANDLER OS)
                      (IF (TM-CLOCK-INTERRUPTP OS)
                          (OS-CLOCK-INTERRUPT-HANDLER OS)
                          (IF (TM-SVC-INTERRUPTP OS)
                              (OS-SVC-HANDLER OS)
                              (TM-FETCH-EXECUTE OS)))))))
      NIL)

(DEFN OS-PROCESSOR
      (OS ORACLE)
      (IF (LISTP ORACLE)
          (OS-PROCESSOR (OS-STEP (TM-POST-INTERRUPT (CAR ORACLE) OS))
                        (CDR ORACLE))
          OS)
      NIL)

(PROVE-LEMMA GOOD-OS-OS-STEP
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (OS-STEP OS)))
             ((ENABLE GOOD-OS-OS-CLOCK-INTERRUPT-HANDLER
                      GOOD-OS-OS-ERROR-HANDLER
                      GOOD-OS-OS-INPUT-INTERRUPT-HANDLER
                      GOOD-OS-OS-OUTPUT-INTERRUPT-HANDLER
                      GOOD-OS-OS-SVC-HANDLER GOOD-OS-TM-FETCH-EXECUTE
                      OS-NOT-IN-SUPERVISOR-MODE OS-STEP TM-INPUT-INTERRUPTP
                      TM-OUTPUT-INTERRUPTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-STEP)

(PROVE-LEMMA GOOD-OS-OS-PROCESSOR
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (OS-PROCESSOR OS ORACLE)))
             ((ENABLE OS-PROCESSOR GOOD-OS-OS-STEP GOOD-OS-TM-POST-INTERRUPT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-OS-PROCESSOR)

(DEFN
    TIMED-TM-STEP
    (TM)
    (IF (TM-INPUT-INTERRUPTP TM)
        (TM-PROCESSOR (TM-EXECUTE-INPUT-INTERRUPT TM)
                      (OS-TIME-FOR-INPUT-INTERRUPT-HANDLER TM))
        (IF (TM-OUTPUT-INTERRUPTP TM)
            (TM-PROCESSOR (TM-EXECUTE-OUTPUT-INTERRUPT TM)
                          (OS-TIME-FOR-OUTPUT-INTERRUPT-HANDLER TM))
            (IF (TM-WAITING TM)
                TM
                (IF (TM-ERRORP TM)
                    (TM-PROCESSOR (TM-EXECUTE-ERROR-INTERRUPT TM)
                                  (OS-TIME-FOR-ERROR-HANDLER TM))
                    (IF (TM-CLOCK-INTERRUPTP TM)
                        (TM-PROCESSOR (TM-EXECUTE-CLOCK-INTERRUPT TM)
                                      (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER TM))
                        (IF (TM-SVC-INTERRUPTP TM)
                            (TM-PROCESSOR (TM-EXECUTE-SVC-INTERRUPT TM)
                                          (OS-TIME-FOR-SVC-HANDLER TM))
                            (TM-FETCH-EXECUTE TM)))))))
    NIL)

(DEFN TIMED-TM-PROCESSOR
    (TM ORACLE)
    (IF (LISTP ORACLE)
        (TIMED-TM-PROCESSOR (TIMED-TM-STEP (TM-POST-INTERRUPT (CAR ORACLE) TM))
                            (CDR ORACLE))
        TM)
    NIL)

(DEFN OS-ORACLE-STEP
      (EVENT OS)
      (IF (TM-INPUT-INTERRUPTP OS)
          (CONS EVENT
                (OS-TIME-FOR-INPUT-INTERRUPT-HANDLER OS))
          (IF (TM-OUTPUT-INTERRUPTP OS)
              (CONS EVENT
                    (OS-TIME-FOR-OUTPUT-INTERRUPT-HANDLER OS))
              (IF (TM-WAITING OS)
                  (CONS EVENT 'NIL)
                  (IF (TM-ERRORP OS)
                      (CONS EVENT
                            (OS-TIME-FOR-ERROR-HANDLER OS))
                      (IF (TM-CLOCK-INTERRUPTP OS)
                          (CONS EVENT
                                (OS-TIME-FOR-CLOCK-INTERRUPT-HANDLER OS))
                          (IF (TM-SVC-INTERRUPTP OS)
                              (CONS EVENT
                                    (OS-TIME-FOR-SVC-HANDLER OS))
                              (CONS EVENT 'NIL)))))))
      NIL)

(DEFN OS-ORACLE
     (OS ORACLE)
     (IF (LISTP ORACLE)
         (APPEND (OS-ORACLE-STEP (CAR ORACLE)
                                 (TM-POST-INTERRUPT (CAR ORACLE) OS))
                 (OS-ORACLE (TIMED-TM-STEP (TM-POST-INTERRUPT (CAR ORACLE) OS))
                            (CDR ORACLE)))
         ORACLE)
     NIL)

(PROVE-LEMMA TM-PROCESSOR-ORACLE-DISTRIBUTES
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM (APPEND A B))
                    (TM-PROCESSOR (TM-PROCESSOR TM A) B))
             ((ENABLE APPEND TM-PROCESSOR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PROCESSOR-ORACLE-DISTRIBUTES)

(PROVE-LEMMA TM-PROCESSOR-IMPLEMENTS-TIMED-TM-STEP
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM
                                  (OS-ORACLE-STEP X
                                                  (TM-POST-INTERRUPT X TM)))
                    (TIMED-TM-STEP (TM-POST-INTERRUPT X TM)))
             ((ENABLE TM-PROCESSOR TM-STEP OS-ORACLE-STEP TIMED-TM-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-PROCESSOR-IMPLEMENTS-TIMED-TM-STEP)

(PROVE-LEMMA TM-IMPLEMENTS-TIMED-TM
             (REWRITE)
             (EQUAL (TM-PROCESSOR TM
                                  (OS-ORACLE TM ORACLE))
                    (TIMED-TM-PROCESSOR TM ORACLE))
             ((ENABLE TM-PROCESSOR TM-PROCESSOR-IMPLEMENTS-TIMED-TM-STEP
                      TM-PROCESSOR-ORACLE-DISTRIBUTES OS-ORACLE
                      TIMED-TM-PROCESSOR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IMPLEMENTS-TIMED-TM)

(DEFN
     BTIMED-TM-PROCESSOR
     (TM ORACLE)
     (IF (LISTP ORACLE)
         (TIMED-TM-STEP (TM-POST-INTERRUPT (CAR ORACLE)
                                           (BTIMED-TM-PROCESSOR TM
                                                                (CDR ORACLE))))
         TM)
     NIL)

(PROVE-LEMMA TIMED-TM-IMPLEMENTS-BTIMED-TM
             (REWRITE)
             (EQUAL (TIMED-TM-PROCESSOR TM ORACLE)
                    (BTIMED-TM-PROCESSOR TM
                                         (REVERSE ORACLE)))
             ((ENABLE APPEND BTIMED-TM-PROCESSOR REVERSE TIMED-TM-PROCESSOR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMED-TM-IMPLEMENTS-BTIMED-TM)

(DEFN BOS-PROCESSOR
      (OS ORACLE)
      (IF (LISTP ORACLE)
          (OS-STEP (TM-POST-INTERRUPT (CAR ORACLE)
                                      (BOS-PROCESSOR OS (CDR ORACLE))))
          OS)
      NIL)

(PROVE-LEMMA BOS-IMPLEMENTS-OS
             (REWRITE)
             (EQUAL (BOS-PROCESSOR OS (REVERSE ORACLE))
                    (OS-PROCESSOR OS ORACLE))
             ((ENABLE APPEND BOS-PROCESSOR OS-PROCESSOR REVERSE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE BOS-IMPLEMENTS-OS)

(PROVE-LEMMA TIMED-TM-STEP-IMPLEMENTS-OS-STEP
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TIMED-TM-STEP OS)
                             (OS-STEP OS)))
             ((ENABLE EQUIVALENCE-OF-CLOCK-INTERRUPT-EXPRESSIONS
                      EQUIVALENCE-OF-ERROR-INTERRUPT-EXPRESSIONS
                      EQUIVALENCE-OF-INPUT-INTERRUPT-EXPRESSIONS
                      EQUIVALENCE-OF-OUTPUT-INTERRUPT-EXPRESSIONS
                      EQUIVALENCE-OF-SVC-INTERRUPT-EXPRESSIONS
                      OS-NOT-IN-SUPERVISOR-MODE OS-STEP TM-INPUT-INTERRUPTP
                      TM-OUTPUT-INTERRUPTP TRACE-CLOCK-INTERRUPT-HANDLER
                      TRACE-INPUT-INTERRUPT-HANDLER TRACE-OS-ERROR-HANDLER
                      TRACE-OUTPUT-INTERRUPT-HANDLER
                      TRACE-SVC-INTERRUPT-HANDLER TIMED-TM-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TIMED-TM-STEP-IMPLEMENTS-OS-STEP)

(PROVE-LEMMA GOOD-OS-BOS-PROCESSOR
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (BOS-PROCESSOR OS ORACLE)))
             ((ENABLE BOS-PROCESSOR GOOD-OS-OS-STEP GOOD-OS-TM-POST-INTERRUPT)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-BOS-PROCESSOR)

(PROVE-LEMMA GOOD-OS-TIMED-TM-STEP
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (TIMED-TM-STEP OS)))
             ((ENABLE GOOD-OS-OS-STEP TIMED-TM-STEP-IMPLEMENTS-OS-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-TIMED-TM-STEP)

(PROVE-LEMMA GOOD-OS-BTIMED-TM-PROCESSOR
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (GOOD-OS (BTIMED-TM-PROCESSOR OS ORACLE)))
             ((ENABLE BTIMED-TM-PROCESSOR GOOD-OS-TM-POST-INTERRUPT
                      GOOD-OS-TIMED-TM-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GOOD-OS-BTIMED-TM-PROCESSOR)

(PROVE-LEMMA BTIMED-TM-IMPLEMENTS-BOS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (BTIMED-TM-PROCESSOR OS ORACLE)
                             (BOS-PROCESSOR OS ORACLE)))
             ((ENABLE BOS-PROCESSOR BTIMED-TM-PROCESSOR GOOD-OS-BOS-PROCESSOR
                      GOOD-OS-TM-POST-INTERRUPT
                      TIMED-TM-STEP-IMPLEMENTS-OS-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE BTIMED-TM-IMPLEMENTS-BOS)

(PROVE-LEMMA TM-IMPLEMENTS-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (TM-PROCESSOR OS
                                           (OS-ORACLE OS ORACLE))
                             (OS-PROCESSOR OS ORACLE)))
             ((ENABLE BOS-IMPLEMENTS-OS BTIMED-TM-IMPLEMENTS-BOS
                      TM-IMPLEMENTS-TIMED-TM TIMED-TM-IMPLEMENTS-BTIMED-TM)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IMPLEMENTS-OS)

(PROVE-LEMMA MAPUP-BASE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
           GETSEG-TM-MEMORY-OS-CLOCK-INTERRUPT-HANDLER
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                    (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                   (MAPUP-LIMIT TASKID OS)
                                   (TM-MEMORY (OS-CLOCK-INTERRUPT-HANDLER OS)))
                           (GETSEG (MAPUP-BASE TASKID OS)
                                   (MAPUP-LIMIT TASKID OS)
                                   (TM-MEMORY OS))))
           ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                    MAPUP-LIMIT OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
                    OS-NEW-TASK-TABLE PLUS-EQUAL-0)
            (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                           OS-SEGMENT-LENGTHS GROUND-ZERO)
            (USE (DISJOINT-GETNTH (B '0)
                                  (L '3311)
                                  (I TASKID)
                                  (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                 (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                     (OS OS))
                 (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                      (OS OS)))
            (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
 TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-CLOCK-INTERRUPT-HANDLER OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                OS))
           (CONS
            (TM-PACK-PSW
                        (OS-NEW-CC (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                   OS)
                        (OS-NEW-ERROR (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                      OS)
                        (OS-NEW-SVCFLAG (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                        OS)
                        (OS-NEW-SVCID (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                                      OS))
            'NIL)))))))))))
 ((ENABLE OS-CLOCK-INTERRUPT-HANDLER TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CASE1 NIL
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (EQUAL (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                       (ARRAY-QFIRST (OS-READYQ OS)))))
      (EQUAL (TM-CPU (OS-CLOCK-INTERRUPT-HANDLER OS))
             (GETNTH (OS-CURRENT-TASKID (OS-CLOCK-INTERRUPT-HANDLER OS))
                     (TABLE '9
                            (OS-TASK-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CLOCK-NEW-READYQ
          OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
          OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER PLISTP-TM-CPU
          TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CROCK
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CASE2 NIL
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (NOT (EQUAL (ARRAY-QFIRST (OS-CLOCK-NEW-READYQ OS))
                            (ARRAY-QFIRST (OS-READYQ OS))))))
      (EQUAL (TM-CPU (OS-CLOCK-INTERRUPT-HANDLER OS))
             (GETNTH (OS-CURRENT-TASKID (OS-CLOCK-INTERRUPT-HANDLER OS))
                     (TABLE '9
                            (OS-TASK-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CLOCK-NEW-READYQ OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
          OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER PLISTP-TM-CPU TABLE-PUTSEG
          TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CROCK
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY ACCESS-OS-MEMORY ARRAY-QUEUE-FACTS
                 FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                 OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-CLOCK-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (NOT (TM-WAITING OS)))
      (EQUAL (TM-CPU (OS-CLOCK-INTERRUPT-HANDLER OS))
             (GETNTH (OS-CURRENT-TASKID (OS-CLOCK-INTERRUPT-HANDLER OS))
                     (TABLE '9
                            (OS-TASK-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS))))))
 ((USE (TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CASE1)
       (TM-CPU-OS-CLOCK-INTERRUPT-HANDLER-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
        MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-CLOCK-INTERRUPT-HANDLER OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-CLOCK-INTERRUPT-HANDLER OS-CURRENT-TASKID
                 OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-CLOCK-INTERRUPT-HANDLER
                 PLISTP-TM-CPU TM-CPU-OS-CLOCK-INTERRUPT-HANDLER
                 TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-REGS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-CC-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-ERROR-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-SVCID-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-TASK-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                      GETSEG-TM-MEMORY-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-BASE-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-LIMIT-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-SVCID-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-SVCFLAG-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-ERROR-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-CC-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-REGS-OS-CLOCK-INTERRUPT-HANDLER
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-TASKS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
            MAPUP-OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
            (REWRITE)
            (IMPLIES (GOOD-OS OS)
                     (EQUAL (MAPUP-OS-IBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                            (MAPUP-OS-IBUFFERS OS)))
            ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)
             (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
            MAPUP-OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
            (REWRITE)
            (IMPLIES (GOOD-OS OS)
                     (EQUAL (MAPUP-OS-OBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                            (MAPUP-OS-OBUFFERS OS)))
            ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)
             (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
            MAPUP-OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
            (REWRITE)
            (IMPLIES (GOOD-OS OS)
                     (EQUAL (MAPUP-OS-MBUFFERS (OS-CLOCK-INTERRUPT-HANDLER OS))
                            (MAPUP-OS-MBUFFERS OS)))
            ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)
             (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
      MAPUP-QUEUE-OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS)
                    (NOT (TM-WAITING OS)))
               (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-CLOCK-INTERRUPT-HANDLER OS)))
                      (ENQ (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                           (DEQ (MAPUP-QUEUE (OS-READYQ OS))))))
      ((ENABLE OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER OS-CLOCK-NEW-READYQ
               TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ CORRECTNESS-OF-ARRAY-ENQ
               CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QFIRST
               CORRECTNESS-OF-ARRAY-QEMPTYP)
       (ENABLE-THEORY GOOD-OS-PROPERTIES1 FINITE-NUMBER-QUEUE-COROLLARIES
                      ARRAY-QUEUE-FACTS GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA
      MAPUP-OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER
      (REWRITE)
      (IMPLIES (GOOD-OS OS)
               (EQUAL (TABLE '2
                             (OS-STATUS-TABLE (OS-CLOCK-INTERRUPT-HANDLER OS)))
                      (TABLE '2 (OS-STATUS-TABLE OS))))
      ((ENABLE OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER)
       (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-RWSTATE-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-CLOCK-INTERRUPT-HANDLER OS))
                    '0)
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-CLOCK-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-CLOCK-INTERRUPT-HANDLER OS))
                    '1000)
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-IPORTS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-CLOCK-INTERRUPT-HANDLER OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA TM-OPORTS-OS-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-CLOCK-INTERRUPT-HANDLER OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-CLOCK-INTERRUPT-HANDLER)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA CORRECTNESS-OF-CLOCK-INTERRUPT-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (MAPUP-OS (OS-CLOCK-INTERRUPT-HANDLER OS))
                             (AK-CLOCK-INTERRUPT-HANDLER (MAPUP-OS OS))))
             ((ENABLE MAPUP-OS AK-CLOCK-INTERRUPT-HANDLER AK-DISPATCHER
                      AK-TASKID MAPUP-OS-TASKS-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-OS-MBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-OS-OBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-OS-IBUFFERS-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-QUEUE-OS-READYQ-OS-CLOCK-INTERRUPT-HANDLER
                      MAPUP-OS-STATUS-TABLE-OS-CLOCK-INTERRUPT-HANDLER
                      TM-RWSTATE-OS-CLOCK-INTERRUPT-HANDLER
                      TM-CLOCK-OS-CLOCK-INTERRUPT-HANDLER
                      TM-IPORTS-OS-CLOCK-INTERRUPT-HANDLER
                      TM-OPORTS-OS-CLOCK-INTERRUPT-HANDLER
                      TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
              (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES1 QUEUE-FACTS
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-CLOCK-INTERRUPT-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-ERROR-HANDLER-PATH1 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-ERROR-HANDLER-PATH1 OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS
                             ACCESS-OS-MEMORY GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-ERROR-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-ERROR-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-ERROR-HANDLER-PATH1 PLISTP-TM-CPU
                 TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ
                 TM-WAITING-OS-ERROR-HANDLER-PATH1)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                      GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH1
                      MAPUP-BASE-OS-ERROR-HANDLER-PATH1
                      MAPUP-LIMIT-OS-ERROR-HANDLER-PATH1
                      MAPUP-SVCID-OS-ERROR-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH1
                      MAPUP-ERROR-OS-ERROR-HANDLER-PATH1
                      MAPUP-CC-OS-ERROR-HANDLER-PATH1
                      MAPUP-REGS-OS-ERROR-HANDLER-PATH1 NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-ERROR-HANDLER-PATH1 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-ERROR-HANDLER-PATH1 OS)))
                          (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
          ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                   OS-READYQ-OS-ERROR-HANDLER-PATH1
                   TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
           (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                          GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (EQUAL (TABLE '2
                                 (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH1 OS)))
                          (PUTNTH '(1 0)
                                  (ARRAY-QFIRST (OS-READYQ OS))
                                  (TABLE '2 (OS-STATUS-TABLE OS)))))
          ((ENABLE OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1 OS-UPDATE-STATUS
                   TABLE-PUTSEG TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
           (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                          GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-ERROR-HANDLER-PATH1 OS))
                    '1)
             ((ENABLE OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-ERROR-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-ERROR-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-ERROR-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-ERROR-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA CORRECTNESS-OF-OS-ERROR-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))
                      (EQUAL (MAPUP-OS (OS-ERROR-HANDLER-PATH1 OS))
                             (AK-ERROR-HANDLER (MAPUP-OS OS))))
             ((ENABLE AK-DISPATCHER AK-ERROR-HANDLER AK-TASKID
                      CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                      CORRECTNESS-OF-ARRAY-QFIRST MAPUP-OS
                      MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH1
                      MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH1
                      MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH1
                      MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH1
                      MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH1
                      MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH1
                      TM-CLOCK-OS-ERROR-HANDLER-PATH1
                      TM-IPORTS-OS-ERROR-HANDLER-PATH1
                      TM-OPORTS-OS-ERROR-HANDLER-PATH1
                      TM-RWSTATE-OS-ERROR-HANDLER-PATH1
                      TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
              (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                             GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-ERROR-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-ERROR-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-ERROR-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-ERROR-HANDLER-PATH2 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-ERROR-HANDLER-PATH2 OS-NEW-TASK-TABLE
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-ERROR-HANDLER-PATH2-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-ERROR-HANDLER-PATH2 OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                OS))
           (CONS
            (TM-PACK-PSW
                      (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS)
                      (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS)
                      (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                      OS)
                      (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS))
            'NIL)))))))))))
 ((ENABLE OS-ERROR-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5
          TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-ERROR-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-ERROR-HANDLER-PATH2-CASE1 NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           (ARRAY-QFIRST (OS-READYQ OS)))))
          (EQUAL (TM-CPU (OS-ERROR-HANDLER-PATH2 OS))
                 (GETNTH (OS-CURRENT-TASKID (OS-ERROR-HANDLER-PATH2 OS))
                         (TABLE '9
                                (OS-TASK-TABLE (OS-ERROR-HANDLER-PATH2 OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-ERROR-HANDLER-PATH2
          OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2 PLISTP-TM-CPU
          TM-CPU-OS-ERROR-HANDLER-PATH2-CROCK
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-ERROR-HANDLER-PATH2-CASE2 NIL
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                         (NOT (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                     (ARRAY-QFIRST (OS-READYQ OS)))))))
          (EQUAL (TM-CPU (OS-ERROR-HANDLER-PATH2 OS))
                 (GETNTH (OS-CURRENT-TASKID (OS-ERROR-HANDLER-PATH2 OS))
                         (TABLE '9
                                (OS-TASK-TABLE (OS-ERROR-HANDLER-PATH2 OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-ERROR-HANDLER-PATH2
          OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2 PLISTP-TM-CPU TABLE-PUTSEG
          TM-CPU-OS-ERROR-HANDLER-PATH2-CROCK
          TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES1 OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-ERROR-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
          (EQUAL (TM-CPU (OS-ERROR-HANDLER-PATH2 OS))
                 (GETNTH (OS-CURRENT-TASKID (OS-ERROR-HANDLER-PATH2 OS))
                         (TABLE '9
                                (OS-TASK-TABLE (OS-ERROR-HANDLER-PATH2 OS))))))
 ((USE (TM-CPU-OS-ERROR-HANDLER-PATH2-CASE1)
       (TM-CPU-OS-ERROR-HANDLER-PATH2-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CPU-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CPU TASKID
                                  (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-CPU TASKID OS)))
       ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                LENGTH-OS-TASK-TABLE LENGTH-TM-CPU MAPUP-CPU
                NOT-TM-WAITING-OS-ERROR-HANDLER-PATH2 OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-ERROR-HANDLER-PATH2
                PLISTP-TM-CPU TM-CPU-OS-ERROR-HANDLER-PATH2
                TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
        (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                       GOOD-OS-PROPERTIES1 GROUND-ZERO)
        (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                           (J (ARRAY-QFIRST (OS-READYQ OS)))))
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-REGS-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-REGS TASKID
                                   (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-REGS TASKID OS)))
       ((ENABLE MAPUP-REGS MAPUP-CPU-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CC-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CC TASKID
                                 (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-CC TASKID OS)))
       ((ENABLE MAPUP-CC MAPUP-CPU-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-ERROR-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-ERROR TASKID
                                    (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-ERROR TASKID OS)))
       ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCFLAG TASKID
                                      (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-SVCFLAG TASKID OS)))
       ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCID-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCID TASKID
                                    (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-SVCID TASKID OS)))
       ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASK-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-TASK TASKID
                                   (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-TASK TASKID OS)))
       ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                GETSEG-TM-MEMORY-OS-ERROR-HANDLER-PATH2
                MAPUP-BASE-OS-ERROR-HANDLER-PATH2
                MAPUP-LIMIT-OS-ERROR-HANDLER-PATH2
                MAPUP-SVCID-OS-ERROR-HANDLER-PATH2
                MAPUP-SVCFLAG-OS-ERROR-HANDLER-PATH2
                MAPUP-ERROR-OS-ERROR-HANDLER-PATH2
                MAPUP-CC-OS-ERROR-HANDLER-PATH2
                MAPUP-REGS-OS-ERROR-HANDLER-PATH2 NUMBERP-MAPUP-LIMIT)
        (ENABLE-THEORY GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASKS-OS-ERROR-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (NUMBERP TASKID))))
                (EQUAL (MAPUP-TASKS TASKID
                                    (OS-ERROR-HANDLER-PATH2 OS))
                       (MAPUP-TASKS TASKID OS)))
       ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-ERROR-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS-TASKS (OS-ERROR-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-ERROR-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-ERROR-HANDLER-PATH2 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES1 GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-ERROR-HANDLER-PATH2 OS)))
                          (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
          ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                   OS-READYQ-OS-ERROR-HANDLER-PATH2
                   TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
           (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES1
                          GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (NOT (TM-WAITING OS)))
                   (EQUAL (TABLE '2
                                 (OS-STATUS-TABLE (OS-ERROR-HANDLER-PATH2 OS)))
                          (PUTNTH '(1 0)
                                  (ARRAY-QFIRST (OS-READYQ OS))
                                  (TABLE '2 (OS-STATUS-TABLE OS)))))
          ((ENABLE OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2 OS-UPDATE-STATUS
                   TABLE-PUTSEG TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
           (ENABLE-THEORY EXECUTABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                          GOOD-OS-PROPERTIES1 OS-SEGMENT-LENGTHS GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-ERROR-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-ERROR-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-ERROR-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-ERROR-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-ERROR-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA
          CORRECTNESS-OF-OS-ERROR-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS (OS-ERROR-HANDLER-PATH2 OS))
                          (AK-ERROR-HANDLER (MAPUP-OS OS))))
          ((ENABLE AK-DISPATCHER AK-ERROR-HANDLER AK-TASKID
                   CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                   CORRECTNESS-OF-ARRAY-QFIRST MAPUP-OS
                   MAPUP-OS-IBUFFERS-OS-ERROR-HANDLER-PATH2
                   MAPUP-OS-MBUFFERS-OS-ERROR-HANDLER-PATH2
                   MAPUP-OS-OBUFFERS-OS-ERROR-HANDLER-PATH2
                   MAPUP-OS-STATUS-TABLE-OS-ERROR-HANDLER-PATH2
                   MAPUP-OS-TASKS-OS-ERROR-HANDLER-PATH2
                   MAPUP-QUEUE-OS-READYQ-OS-ERROR-HANDLER-PATH2
                   TM-CLOCK-OS-ERROR-HANDLER-PATH2
                   TM-IPORTS-OS-ERROR-HANDLER-PATH2
                   TM-OPORTS-OS-ERROR-HANDLER-PATH2
                   TM-RWSTATE-OS-ERROR-HANDLER-PATH2
                   TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ)
           (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                          GOOD-OS-PROPERTIES1 GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-ERROR-HANDLER-PATH2)

(PROVE-LEMMA CORRECTNESS-OF-OS-ERROR-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS (OS-ERROR-HANDLER OS))
                             (AK-ERROR-HANDLER (MAPUP-OS OS))))
             ((ENABLE OS-ERROR-HANDLER CORRECTNESS-OF-OS-ERROR-HANDLER-PATH1
                      CORRECTNESS-OF-OS-ERROR-HANDLER-PATH2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-ERROR-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
            GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH1 OS)))
                            (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY OS))))
            ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                     MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH1
                     OS-UPDATE-STATUS PLUS-EQUAL-0)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY OS-SEGMENT-LENGTHS
                            GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES GROUND-ZERO)
             (USE (DISJOINT-GETNTH (B '0)
                                   (L '3311)
                                   (I TASKID)
                                   (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                  (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                      (OS OS))
                  (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                       (OS OS)))
             (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-SVC-SEND-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH1 PLISTP-TM-CPU
                 TM-WAITING-OS-SVC-SEND-HANDLER-PATH1)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                      GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-CC-OS-SVC-SEND-HANDLER-PATH1
                      MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH1 NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH1 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-SEND-HANDLER-PATH1 OS)))
                       (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
       ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                OS-READYQ-OS-SVC-SEND-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                       ARRAY-QUEUE-FACTS GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (TABLE '2
                              (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH1 OS)))
                       (PUTNTH (CONS '2
                                     (CONS (OS-DESTID OS '16) 'NIL))
                               (ARRAY-QFIRST (OS-READYQ OS))
                               (TABLE '2 (OS-STATUS-TABLE OS)))))
       ((ENABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1 PLISTP TABLE-PUTSEG
                OS-UPDATE-STATUS LENGTH PLISTP)
        (ENABLE-THEORY EXECUTABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES
                       FINITE-NUMBER-QUEUE-COROLLARIES TRACE-ARRAY-QUEUE-FACTS
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-SEND-HANDLER-PATH1 OS))
                    '1)
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-SEND-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-SEND-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-SVC-SEND-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-SEND-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-SEND-HANDLER-PATH1 OS))
         (AK-EXECUTE-SEND (OS-MESSAGE OS)
                          (OS-CURRENT-TASKID OS)
                          (OS-DESTID OS '16)
                          (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-SEND AK-DISPATCHER AK-EXECUTE-SEND CORRECTNESS-OF-ARRAY-DEQ
          CORRECTNESS-OF-ARRAY-QEMPTYP CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE
          FINITE-NUMBERP-OS-DESTID LENGTH-OS-MBUFFERS LENGTH-TABLE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH1 OS-CURRENT-MBUFFER
          OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2 OS-CURRENT-TASKID QFULLP2
          TM-CLOCK-OS-SVC-SEND-HANDLER-PATH1
          TM-IPORTS-OS-SVC-SEND-HANDLER-PATH1
          TM-OPORTS-OS-SVC-SEND-HANDLER-PATH1
          TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH1)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
            GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH2 OS)))
                            (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY OS))))
            ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                     MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH2
                     OS-UPDATE-STATUS PLUS-EQUAL-0)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY OS-SEGMENT-LENGTHS
                            GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES GROUND-ZERO)
             (USE (DISJOINT-GETNTH (B '0)
                                   (L '3311)
                                   (I TASKID)
                                   (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                  (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                      (OS OS))
                  (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                       (OS OS)))
             (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-SVC-SEND-HANDLER-PATH2 OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                OS))
           (CONS
            (TM-PACK-PSW
                      (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS)
                      (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS)
                      (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                      OS)
                      (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS))
            'NIL)))))))))))
 ((ENABLE OS-SVC-SEND-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5
          TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CASE1 NIL
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                        (ARRAY-QFIRST (OS-READYQ OS)))))
       (EQUAL (TM-CPU (OS-SVC-SEND-HANDLER-PATH2 OS))
              (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH2 OS))
                      (TABLE '9
                             (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2 PLISTP-TM-CPU
          TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CASE2 NIL
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                      (NOT (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                  (ARRAY-QFIRST (OS-READYQ OS)))))))
       (EQUAL (TM-CPU (OS-SVC-SEND-HANDLER-PATH2 OS))
              (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH2 OS))
                      (TABLE '9
                             (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-SVC-SEND-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2 PLISTP-TM-CPU TABLE-PUTSEG
          TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
       (EQUAL (TM-CPU (OS-SVC-SEND-HANDLER-PATH2 OS))
              (GETNTH (OS-CURRENT-TASKID (OS-SVC-SEND-HANDLER-PATH2 OS))
                      (TABLE '9
                             (OS-TASK-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS))))))
 ((USE (TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CASE1)
       (TM-CPU-OS-SVC-SEND-HANDLER-PATH2-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CPU TASKID
                                  (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-CPU TASKID OS)))
       ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                LENGTH-TM-CPU MAPUP-CPU
                NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH2 OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH2
                PLISTP-TM-CPU TM-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                       GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                           (J (ARRAY-QFIRST (OS-READYQ OS)))))
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-REGS TASKID
                                   (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-REGS TASKID OS)))
       ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CC-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CC TASKID
                                 (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-CC TASKID OS)))
       ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-ERROR TASKID
                                    (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-ERROR TASKID OS)))
       ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCFLAG TASKID
                                      (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-SVCFLAG TASKID OS)))
       ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCID TASKID
                                    (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-SVCID TASKID OS)))
       ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-TASK TASKID
                                   (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-TASK TASKID OS)))
       ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-CC-OS-SVC-SEND-HANDLER-PATH2
                MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH2 NUMBERP-MAPUP-LIMIT)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (NUMBERP TASKID))))
                (EQUAL (MAPUP-TASKS TASKID
                                    (OS-SVC-SEND-HANDLER-PATH2 OS))
                       (MAPUP-TASKS TASKID OS)))
       ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH2 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-SEND-HANDLER-PATH2 OS)))
                       (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
       ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                OS-READYQ-OS-SVC-SEND-HANDLER-PATH2)
        (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                       ARRAY-QUEUE-FACTS GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (TABLE '2
                              (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH2 OS)))
                       (PUTNTH (CONS '2
                                     (CONS (OS-DESTID OS '16) 'NIL))
                               (ARRAY-QFIRST (OS-READYQ OS))
                               (TABLE '2 (OS-STATUS-TABLE OS)))))
       ((ENABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2 PLISTP TABLE-PUTSEG
                OS-UPDATE-STATUS LENGTH PLISTP)
        (ENABLE-THEORY EXECUTABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES
                       FINITE-NUMBER-QUEUE-COROLLARIES TRACE-ARRAY-QUEUE-FACTS
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-SEND-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-SEND-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-SEND-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-SEND-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-SVC-SEND-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '0)
                  (AND (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-SEND-HANDLER-PATH2 OS))
         (AK-EXECUTE-SEND (OS-MESSAGE OS)
                          (OS-CURRENT-TASKID OS)
                          (OS-DESTID OS '16)
                          (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-SEND AK-DISPATCHER AK-EXECUTE-SEND CORRECTNESS-OF-ARRAY-DEQ
          CORRECTNESS-OF-ARRAY-QEMPTYP CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE
          FINITE-NUMBERP-OS-DESTID LENGTH-OS-MBUFFERS LENGTH-TABLE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH2 OS-CURRENT-MBUFFER
          OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2 OS-CURRENT-TASKID QFULLP2
          TM-CLOCK-OS-SVC-SEND-HANDLER-PATH2
          TM-IPORTS-OS-SVC-SEND-HANDLER-PATH2
          TM-OPORTS-OS-SVC-SEND-HANDLER-PATH2
          TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH2)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
            GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH3
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH3 OS)))
                            (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY OS))))
            ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                     MAPUP-LIMIT OS-MBUFFERS-WITH-ENQUEUED-MESSAGE
                     OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH3
                     OS-UPDATE-STATUS PLUS-EQUAL-0)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                            OS-SEGMENT-LENGTHS GROUND-ZERO)
             (USE (DISJOINT-GETNTH (B '0)
                                   (L '3311)
                                   (I TASKID)
                                   (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                  (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                      (OS OS))
                  (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                       (OS OS)))
             (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-CPU-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-CPU (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                                  (TM-ERROR OS)
                                                  '0
                                                  (TM-SVCID OS))
                                     '8
                                     (TM-CPU OS))))
             ((ENABLE OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1
                      OS-SVC-SEND-HANDLER-PATH3 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3
                      TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
      ARRAY-QFIRST-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS)
                    (AND (NOT (TM-WAITING OS))
                         (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
               (EQUAL (ARRAY-QFIRST (OS-READYQ (OS-SVC-SEND-HANDLER-PATH3 OS)))
                      (ARRAY-QFIRST (OS-READYQ OS))))
      ((ENABLE ARRAY-QFIRST-ARRAY-ENQ OS-READYQ-OS-SVC-SEND-HANDLER-PATH3)
       (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                      GROUND-ZERO)
       (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE1
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (AND (NOT (TM-WAITING OS))
                   (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
         (EQUAL (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                           (OS-SVC-SEND-HANDLER-PATH3 OS))
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS))))
 ((ENABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
          GETNTH-TM-REGLENGTH-TM-CPU MAPUP-CC MAPUP-CPU MAPUP-ERROR
          MAPUP-SVCID NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH3
          OS-CURRENT-TASKID TM-CPU-OS-SVC-SEND-HANDLER-PATH3
          TM-UNPACK-CC-TM-PACK-PSW TM-UNPACK-ERROR-TM-PACK-PSW
          TM-UNPACK-SVCID-TM-PACK-PSW)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                     (AND (NUMBERP TASKID)
                          (AND (LESSP TASKID '16)
                               (NOT (EQUAL TASKID
                                           (ARRAY-QFIRST (OS-READYQ OS)))))))))
      (EQUAL (MAPUP-CPU TASKID
                        (OS-SVC-SEND-HANDLER-PATH3 OS))
             (MAPUP-CPU TASKID OS)))
 ((ENABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
          COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
          LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH3
          OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH3)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                         (AND (NUMBERP TASKID)
                              (LESSP TASKID '16)))))
          (EQUAL (MAPUP-CPU TASKID
                            (OS-SVC-SEND-HANDLER-PATH3 OS))
                 (IF (EQUAL TASKID
                            (ARRAY-QFIRST (OS-READYQ OS)))
                     (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                          (MAPUP-ERROR TASKID OS)
                                          '0
                                          (MAPUP-SVCID TASKID OS))
                             '8
                             (MAPUP-CPU TASKID OS))
                     (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE2 (OS OS)
                                              (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTNTH
                      LENGTH-MAPUP-CPU GETSEG-BEFORE-PUTNTH
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-SVCFLAG
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3
                      TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCFLAG
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH3 MAPUP-ERROR
                      MAPUP-SVCFLAG MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 (TM-SET-SVCFLAG '0
                                                 (MAPUP-TASK TASKID OS))
                                 (MAPUP-TASK TASKID OS))))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE OS-STORE-MESSAGE TM-STORE
                      REAL-ADDR-SOURCE REAL-ADDR-NUM TM-STORE-IN-REGMEM
                      TM-SET-REGS GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-CC-OS-SVC-SEND-HANDLER-PATH3
                      MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH3 NUMBERP-MAPUP-LIMIT
                      TM-SET-SVCFLAG)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                                 TASKID)))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                 (AND (NUMBERP TASKID)
                      (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                 TASKID)
                          '*1*FALSE
                          '*1*TRUE)))))
  (EQUAL
      (MAPUP-TASKS TASKID
                   (OS-SVC-SEND-HANDLER-PATH3 OS))
      (PUTNTH (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS)))
              (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                          TASKID)
              (MAPUP-TASKS TASKID OS))))
 ((ENABLE MAPUP-TASKS MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE1
          OPEN-UP-GETNTH1 OPEN-UP-PUTNTH1 SUB1-DIFFERENCE
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-PUTNTH-ON-ZERO DIFFERENCE-X-X
          GETNTH-MAPUP-TASKS-COROLLARY2 PUTNTH-INTO-NIL
          MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH3)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-SEND-HANDLER-PATH3 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-SEND-HANDLER-PATH3 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
  MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (AND (NOT (TM-WAITING OS))
                     (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
           (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH3 OS))
                  (PUTNTH (TM-SET-SVCFLAG '0
                                          (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                                  (MAPUP-OS-TASKS OS)))
                          (ARRAY-QFIRST (OS-READYQ OS))
                          (MAPUP-OS-TASKS OS))))
  ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP-REMAINDER
           MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH3-CASE2)
   (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (NOT (TM-WAITING OS))
             (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                            (OS-STATUS-TABLE OS))
                    '3)))
   (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH3 OS))
          (PUTNTH (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))
                  (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                  (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT
          FINITE-NUMBERP-OS-DESTID CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (USE
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))))
        (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
               (ENQ2 (TM-R3 OS)
                     (ARRAY-QFIRST (OS-READYQ OS))
                     (OS-DESTID OS '16)
                     (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          CORRECTNESS-OF-ARRAY-ENQ ENQ2 GETNTH-GETSEG GETNTH-MAPUP-QUEUE-LIST
          GETNTH-TABLE GETNTH2 LENGTH-ARRAY-ENQ LENGTH-MAPUP-QUEUE-LIST
          LENGTH-OS-MBUFFERS LENGTH-TABLE OS-MBUFFERS-ADDRESS-FACTS3
          OS-MBUFFERS-ADDRESS-FACTS3 LESSP-REMAINDER2 MAPUP-OS-MBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-DESTID OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          OS-MBUFFERS-WITH-ENQUEUED-MESSAGE PLISTP-ARRAY-ENQ PUTNTH2
          QUOTIENT-PLUS-TIMES-REMAINDER REMAINDER-PLUS-TIMES-REMAINDER
          REWRITE-OS-MBUFFER-ADDRESS TABLE-PUTNTH TABLE-PUTSEG TM-R2 TM-R3)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-CURRENT-TASKID OS))
                                             (DID (OS-DESTID OS '16))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))))
        (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH3 OS))
               (ENQ2 (TM-R3 OS)
                     (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                     (OS-DESTID OS '16)
                     (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                   (OS-STATUS-TABLE OS))
                           '3)))
          (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-SEND-HANDLER-PATH3 OS)))
                 (ENQ (OS-DESTID OS '16)
                      (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ CORRECTNESS-OF-ARRAY-QEMPTYP
          FINITE-NUMBERP-OS-DESTID OS-READYQ-OS-SVC-SEND-HANDLER-PATH3)
  (USE
   (OS-WAITING-TO-RECEIVEP-IMPLIES-READYQ-NOT-FULL
                                                 (OS OS)
                                                 (DESTID (OS-DESTID OS '16))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 ARRAY-QUEUE-FACTS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (TABLE '2
                              (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH3 OS)))
                       (PUTNTH '(0 0)
                               (OS-DESTID OS '16)
                               (TABLE '2 (OS-STATUS-TABLE OS)))))
       ((ENABLE LENGTH COMMUTATIVITY-OF-PLUS FINITE-NUMBERP-OS-DESTID
                LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS
                OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3 OS-UPDATE-STATUS
                PLISTP TABLE-PUTSEG)
        (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-SEND-HANDLER-PATH3 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-SEND-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH3 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA
 AK-WAITING-TO-RECEIVEP-MAPUP-OS
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (AND (NOT (TM-ERRORP OS))
                     (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS))))))
      (AK-WAITING-TO-RECEIVEP (OS-CURRENT-TASKID OS)
                              (OS-DESTID OS '16)
                              (MAPUP-OS OS)))
 ((ENABLE AK-WAITING-TO-RECEIVEP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP-OS-DESTID GETNTH-GETSEG GETNTH-TABLE
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS MAPUP-OS
          PLUS-0-ARG1)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE AK-WAITING-TO-RECEIVEP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '0)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))
                  (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                      (OS-STATUS-TABLE OS))
                              '3)
                       (EQUAL (GETNTH (PLUS '1
                                            (TIMES '2 (OS-DESTID OS '16)))
                                      (OS-STATUS-TABLE OS))
                              (OS-CURRENT-TASKID OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-SEND-HANDLER-PATH3 OS))
         (AK-EXECUTE-SEND (OS-MESSAGE OS)
                          (OS-CURRENT-TASKID OS)
                          (OS-DESTID OS '16)
                          (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-SEND AK-EXECUTE-SEND-TO-BUFFER
          CORRECTNESS-OF-ARRAY-QEMPTYP CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE
          FINITE-NUMBERP-OS-DESTID LENGTH-OS-MBUFFERS LENGTH-TABLE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH3 OS-CURRENT-MBUFFER
          OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2 OS-CURRENT-TASKID OS-MESSAGE
          QFULLP2 TM-CLOCK-OS-SVC-SEND-HANDLER-PATH3
          TM-IPORTS-OS-SVC-SEND-HANDLER-PATH3
          TM-OPORTS-OS-SVC-SEND-HANDLER-PATH3
          TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH3)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
       (AK-WAITING-TO-RECEIVEP-MAPUP-OS (OS OS)))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
            GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                     (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY (OS-SVC-SEND-HANDLER-PATH4 OS)))
                            (GETSEG (MAPUP-BASE TASKID OS)
                                    (MAPUP-LIMIT TASKID OS)
                                    (TM-MEMORY OS))))
            ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO
                     OS-MBUFFERS-WITH-ENQUEUED-MESSAGE LENGTH-TABLE MAPUP-BASE
                     MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-SEND-HANDLER-PATH4
                     PLUS-EQUAL-0)
             (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY OS-SEGMENT-LENGTHS
                            GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES GROUND-ZERO)
             (USE (DISJOINT-GETNTH (B '0)
                                   (L '3311)
                                   (I TASKID)
                                   (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                  (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                      (OS OS))
                  (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                       (OS OS)))
             (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-CPU-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-CPU (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                                  (TM-ERROR OS)
                                                  '0
                                                  (TM-SVCID OS))
                                     '8
                                     (TM-CPU OS))))
             ((ENABLE OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1
                      OS-SVC-SEND-HANDLER-PATH4 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3
                      TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE1
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                           (OS-SVC-SEND-HANDLER-PATH4 OS))
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS))))
 ((ENABLE GETNTH-TM-REGLENGTH-TM-CPU MAPUP-CC MAPUP-CPU MAPUP-ERROR
          MAPUP-SVCID NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH4
          OS-CURRENT-TASKID OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
          TM-CPU-OS-SVC-SEND-HANDLER-PATH4 TM-UNPACK-CC-TM-PACK-PSW
          TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-SVCID-TM-PACK-PSW)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
   MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE2
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (AND (NUMBERP TASKID)
                           (AND (LESSP TASKID '16)
                                (NOT (EQUAL TASKID
                                            (ARRAY-QFIRST (OS-READYQ OS))))))))
            (EQUAL (MAPUP-CPU TASKID
                              (OS-SVC-SEND-HANDLER-PATH4 OS))
                   (MAPUP-CPU TASKID OS)))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
            LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-SEND-HANDLER-PATH4
            OS-CURRENT-TASKID OS-NEW-TASK-TABLE
            OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
            OS-TASK-TABLE-OS-SVC-SEND-HANDLER-PATH4)
    (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                   GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
    (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                       (J (ARRAY-QFIRST (OS-READYQ OS)))))
    (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (NUMBERP TASKID)
                         (LESSP TASKID '16))))
          (EQUAL (MAPUP-CPU TASKID
                            (OS-SVC-SEND-HANDLER-PATH4 OS))
                 (IF (EQUAL TASKID
                            (ARRAY-QFIRST (OS-READYQ OS)))
                     (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                          (MAPUP-ERROR TASKID OS)
                                          '0
                                          (MAPUP-SVCID TASKID OS))
                             '8
                             (MAPUP-CPU TASKID OS))
                     (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE2 (OS OS)
                                              (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE GETSEG-BEFORE-PUTNTH MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4 MAPUP-ERROR
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4 MAPUP-ERROR
                      MAPUP-SVCFLAG TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-SEND-HANDLER-PATH4 MAPUP-ERROR
                      MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 (TM-SET-SVCFLAG '0
                                                 (MAPUP-TASK TASKID OS))
                                 (MAPUP-TASK TASKID OS))))
             ((ENABLE GETSEG-TM-MEMORY-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-ADDRESS-SPACE MAPUP-BASE-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-CC-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-ERROR-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-LIMIT-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-REGS-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-SVC-SEND-HANDLER-PATH4
                      MAPUP-SVCID-OS-SVC-SEND-HANDLER-PATH4 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT TM-SET-SVCFLAG)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                            TASKID)
                     '*1*FALSE
                     '*1*TRUE))))
  (EQUAL
      (MAPUP-TASKS TASKID
                   (OS-SVC-SEND-HANDLER-PATH4 OS))
      (PUTNTH (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS)))
              (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                          TASKID)
              (MAPUP-TASKS TASKID OS))))
 ((ENABLE DIFFERENCE-X-X GETNTH-MAPUP-TASKS-COROLLARY2
          MAPUP-TASK-OS-SVC-SEND-HANDLER-PATH4 MAPUP-TASKS
          MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE1 OPEN-UP-GETNTH-ON-ZERO
          OPEN-UP-GETNTH1 OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1
          SUB1-DIFFERENCE)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-SEND-HANDLER-PATH4 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-SEND-HANDLER-PATH4 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
  MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH4 OS))
                  (PUTNTH (TM-SET-SVCFLAG '0
                                          (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                                  (MAPUP-OS-TASKS OS)))
                          (ARRAY-QFIRST (OS-READYQ OS))
                          (MAPUP-OS-TASKS OS))))
  ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP-REMAINDER
           MAPUP-TASKS-OS-SVC-SEND-HANDLER-PATH4-CASE2)
   (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (EQUAL (MAPUP-OS-TASKS (OS-SVC-SEND-HANDLER-PATH4 OS))
          (PUTNTH (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))
                  (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                  (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))))
        (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
               (ENQ2 (TM-R3 OS)
                     (ARRAY-QFIRST (OS-READYQ OS))
                     (OS-DESTID OS '16)
                     (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          CORRECTNESS-OF-ARRAY-ENQ ENQ2 GETNTH-GETSEG GETNTH-MAPUP-QUEUE-LIST
          GETNTH-TABLE GETNTH2 LENGTH-ARRAY-ENQ LENGTH-MAPUP-QUEUE-LIST
          LENGTH-OS-MBUFFERS LENGTH-TABLE OS-MBUFFERS-ADDRESS-FACTS3
          OS-MBUFFERS-ADDRESS-FACTS3 LESSP-REMAINDER2 MAPUP-OS-MBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-DESTID OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          OS-MBUFFERS-WITH-ENQUEUED-MESSAGE PLISTP-ARRAY-ENQ PUTNTH2
          QUOTIENT-PLUS-TIMES-REMAINDER REMAINDER-PLUS-TIMES-REMAINDER
          REWRITE-OS-MBUFFER-ADDRESS TABLE-PUTNTH TABLE-PUTSEG TM-R2 TM-R3)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-CURRENT-TASKID OS))
                                             (DID (OS-DESTID OS '16))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 FINITE-NUMBER-QUEUE-COROLLARIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                         (OS-DESTID OS '16)
                                                         OS)))))
        (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-SEND-HANDLER-PATH4 OS))
               (ENQ2 (TM-R3 OS)
                     (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                     (OS-DESTID OS '16)
                     (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-SEND-HANDLER-PATH4 OS)))
                       (MAPUP-QUEUE (OS-READYQ OS))))
       ((ENABLE OS-READYQ-OS-SVC-SEND-HANDLER-PATH4)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (NOT (TM-WAITING OS)))
                (EQUAL (TABLE '2
                              (OS-STATUS-TABLE (OS-SVC-SEND-HANDLER-PATH4 OS)))
                       (TABLE '2 (OS-STATUS-TABLE OS))))
       ((ENABLE OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4)
        (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-IPORTS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-OPORTS-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-SEND-HANDLER-PATH4 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-SEND-HANDLER-PATH4 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-SEND-HANDLER-PATH4 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA
 NOT-AK-WAITING-TO-RECEIVEP-MAPUP-OS
 (REWRITE)
 (IMPLIES
  (AND
      (GOOD-OS OS)
      (AND (NOT (TM-WAITING OS))
           (AND (NOT (TM-ERRORP OS))
                (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS)))))))
  (NOT (AK-WAITING-TO-RECEIVEP (OS-CURRENT-TASKID OS)
                               (OS-DESTID OS '16)
                               (MAPUP-OS OS))))
 ((ENABLE AK-WAITING-TO-RECEIVEP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP-OS-DESTID GETNTH-GETSEG GETNTH-TABLE
          LENGTH-OS-STATUS-TABLE OS-STATUS-TABLE-ADDRESS-FACTS MAPUP-OS
          PLUS-0-ARG1)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NOT-AK-WAITING-TO-RECEIVEP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
      (NOT (TM-ERRORP OS))
      (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                  '0)
           (AND (NOT (ARRAY-QFULLP (OS-CURRENT-MBUFFER (OS-CURRENT-TASKID OS)
                                                       (OS-DESTID OS '16)
                                                       OS)))
                (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-DESTID OS '16))
                                         (OS-STATUS-TABLE OS))
                                 '3)
                          (EQUAL (GETNTH (PLUS '1
                                               (TIMES '2 (OS-DESTID OS '16)))
                                         (OS-STATUS-TABLE OS))
                                 (OS-CURRENT-TASKID OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-SEND-HANDLER-PATH4 OS))
         (AK-EXECUTE-SEND (OS-MESSAGE OS)
                          (OS-CURRENT-TASKID OS)
                          (OS-DESTID OS '16)
                          (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-SEND AK-EXECUTE-SEND-TO-BUFFER
          CORRECTNESS-OF-ARRAY-QEMPTYP CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-MBUFFERS-INSTANCE
          FINITE-NUMBERP-OS-DESTID LENGTH-OS-MBUFFERS LENGTH-TABLE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-SVC-SEND-HANDLER-PATH4
          MAPUP-OS-STATUS-TABLE-OS-SVC-SEND-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-SVC-SEND-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-SEND-HANDLER-PATH4 OS-CURRENT-MBUFFER
          OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2 OS-CURRENT-TASKID OS-MESSAGE
          QFULLP2 TM-CLOCK-OS-SVC-SEND-HANDLER-PATH4
          TM-IPORTS-OS-SVC-SEND-HANDLER-PATH4
          TM-OPORTS-OS-SVC-SEND-HANDLER-PATH4
          TM-RWSTATE-OS-SVC-SEND-HANDLER-PATH4)
  (DISABLE PLUS TIMES)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
       (NOT-AK-WAITING-TO-RECEIVEP-MAPUP-OS (OS OS)))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH4)

(PROVE-LEMMA CORRECTNESS-OF-OS-SVC-SEND-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '0))))
                      (EQUAL (MAPUP-OS (OS-SVC-SEND-HANDLER OS))
                             (AK-EXECUTE-SEND (OS-MESSAGE OS)
                                              (OS-CURRENT-TASKID OS)
                                              (OS-DESTID OS '16)
                                              (MAPUP-OS OS))))
             ((ENABLE OS-SVC-SEND-HANDLER
                      CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH1
                      CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH2
                      CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH3
                      CORRECTNESS-OF-OS-SVC-SEND-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-SEND-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
         GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH1
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                  (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                         (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY OS))))
         ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                  MAPUP-LIMIT OS-NEW-TASK-TABLE OS-UPDATE-STATUS
                  OS-SVC-RECEIVE-HANDLER-PATH1 PLUS-EQUAL-0)
          (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES
                         ACCESS-OS-MEMORY OS-SEGMENT-LENGTHS GROUND-ZERO)
          (USE (DISJOINT-GETNTH (B '0)
                                (L '3311)
                                (I TASKID)
                                (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
               (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                   (OS OS))
               (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                    (OS OS)))
          (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1 PLISTP-TM-CPU
                 TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH1)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH1
                      MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH1 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                          (MAPUP-OS-IBUFFERS OS)))
          ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                          (MAPUP-OS-OBUFFERS OS)))
          ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                          (MAPUP-OS-MBUFFERS OS)))
          ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
    MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                    (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
    ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
             OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1)
     (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                    ARRAY-QUEUE-FACTS GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
    MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TABLE '2
                           (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH1 OS)))
                    (PUTNTH (CONS '3
                                  (CONS (OS-SRCID OS '16) 'NIL))
                            (ARRAY-QFIRST (OS-READYQ OS))
                            (TABLE '2 (OS-STATUS-TABLE OS)))))
    ((ENABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1 PLISTP TABLE-PUTSEG
             OS-UPDATE-STATUS LENGTH PLISTP)
     (ENABLE-THEORY EXECUTABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES
                    FINITE-NUMBER-QUEUE-COROLLARIES TRACE-ARRAY-QUEUE-FACTS
                    OS-SEGMENT-LENGTHS GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                    '1)
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-RECEIVE-HANDLER-PATH1 OS))
         (AK-EXECUTE-RECEIVE (OS-SRCID OS '16)
                             (OS-CURRENT-TASKID OS)
                             (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-RECEIVE AK-DISPATCHER AK-EXECUTE-RECEIVE
          CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP-OS-SRCID
          LENGTH-OS-MBUFFERS LENGTH-TABLE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH1
          OS-CURRENT-MBUFFER OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2
          OS-CURRENT-TASKID QEMPTYP2 TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH1
          TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH1
          TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH1
          TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH1)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
         GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH2
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                  (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                         (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY OS))))
         ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                  MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-RECEIVE-HANDLER-PATH2
                  OS-UPDATE-STATUS PLUS-EQUAL-0)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY OS-SEGMENT-LENGTHS
                         GOOD-OS-PROPERTIES1 GOOD-TM-PROPERTIES GROUND-ZERO)
          (USE (DISJOINT-GETNTH (B '0)
                                (L '3311)
                                (I TASKID)
                                (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
               (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                   (OS OS))
               (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                    (OS OS)))
          (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                OS))
           (CONS
            (TM-PACK-PSW
                      (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS)
                      (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS)
                      (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                      OS)
                      (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS))
            'NIL)))))))))))
 ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CASE1 NIL
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                     (ARRAY-QFIRST (OS-READYQ OS)))))
    (EQUAL (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
           (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                   (TABLE '9
                          (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2 PLISTP-TM-CPU
          TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CASE2
 NIL
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                   (NOT (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               (ARRAY-QFIRST (OS-READYQ OS)))))))
    (EQUAL (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
           (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                   (TABLE '9
                          (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
    (EQUAL (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
           (GETNTH (OS-CURRENT-TASKID (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                   (TABLE '9
                          (OS-TASK-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))))))
 ((USE (TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CASE1)
       (TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CPU TASKID
                                  (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-CPU TASKID OS)))
       ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                LENGTH-PUTSEG LENGTH-TM-CPU MAPUP-CPU
                NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH2 OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
                PLISTP-TM-CPU TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                       GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                           (J (ARRAY-QFIRST (OS-READYQ OS)))))
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-REGS TASKID
                                   (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-REGS TASKID OS)))
       ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CC TASKID
                                 (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-CC TASKID OS)))
       ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-ERROR TASKID
                                    (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-ERROR TASKID OS)))
       ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCFLAG TASKID
                                      (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-SVCFLAG TASKID OS)))
       ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCID TASKID
                                    (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-SVCID TASKID OS)))
       ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-TASK TASKID
                                   (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-TASK TASKID OS)))
       ((ENABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-ADDRESS-SPACE MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH2
                MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH2 MAPUP-TASK
                NUMBERP-MAPUP-LIMIT)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (NUMBERP TASKID))))
                (EQUAL (MAPUP-TASKS TASKID
                                    (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                       (MAPUP-TASKS TASKID OS)))
       ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                          (MAPUP-OS-IBUFFERS OS)))
          ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                          (MAPUP-OS-OBUFFERS OS)))
          ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                          (MAPUP-OS-MBUFFERS OS)))
          ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
    MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                    (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
    ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
             OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2)
     (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                    ARRAY-QUEUE-FACTS GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
    MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TABLE '2
                           (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH2 OS)))
                    (PUTNTH (CONS '3
                                  (CONS (OS-SRCID OS '16) 'NIL))
                            (ARRAY-QFIRST (OS-READYQ OS))
                            (TABLE '2 (OS-STATUS-TABLE OS)))))
    ((ENABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2 PLISTP TABLE-PUTSEG
             OS-UPDATE-STATUS LENGTH PLISTP)
     (ENABLE-THEORY EXECUTABLE-THEORY GOOD-TM-PROPERTIES GOOD-OS-PROPERTIES
                    FINITE-NUMBER-QUEUE-COROLLARIES TRACE-ARRAY-QUEUE-FACTS
                    OS-SEGMENT-LENGTHS GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '1)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-RECEIVE-HANDLER-PATH2 OS))
         (AK-EXECUTE-RECEIVE (OS-SRCID OS '16)
                             (OS-CURRENT-TASKID OS)
                             (MAPUP-OS OS))))
 ((ENABLE MAPUP-OS AK-EXECUTE-RECEIVE AK-DISPATCHER AK-TASKID AK-BLOCK-RECEIVE
          OS-CURRENT-TASKID OS-CURRENT-MBUFFER QEMPTYP2
          MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH2
          MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH2
          TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH2 CORRECTNESS-OF-ARRAY-DEQ
          CORRECTNESS-OF-ARRAY-QEMPTYP CORRECTNESS-OF-ARRAY-QFIRST
          LENGTH-TABLE LENGTH-OS-MBUFFERS FINITE-NUMBERP-OS-SRCID
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
         GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH3
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                  (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                         (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY OS))))
         ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                  MAPUP-LIMIT OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
                  OS-SVC-RECEIVE-HANDLER-PATH3
                  OS-TASK-TABLE-WITH-DELIVERED-MESSAGE OS-UPDATE-STATUS
                  PLUS-EQUAL-0)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (USE (DISJOINT-GETNTH (B '0)
                                (L '3311)
                                (I TASKID)
                                (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
               (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                   (OS OS))
               (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                    (OS OS)))
          (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                            (TM-ERROR OS)
                                            '0
                                            (TM-SVCID OS))
                               '8
                               (TM-CPU OS)))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
          OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1 OS-CURRENT-MBUFFER
          OS-SVC-RECEIVE-HANDLER-PATH3 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
   ARRAY-QFIRST-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
            (EQUAL (ARRAY-QFIRST (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                   (ARRAY-QFIRST (OS-READYQ OS))))
   ((ENABLE ARRAY-QFIRST-ARRAY-ENQ OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3)
    (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                   GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
  (EQUAL
        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                   (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
        (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                  (OS-CURRENT-TASKID OS)
                                                  OS))
                '3
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS)))))
 ((ENABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
          GETNTH-TM-REGLENGTH-TM-CPU MAPUP-CC MAPUP-CPU MAPUP-ERROR
          MAPUP-SVCID NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-CURRENT-TASKID TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-UNPACK-CC-TM-PACK-PSW TM-UNPACK-ERROR-TM-PACK-PSW
          TM-UNPACK-SVCID-TM-PACK-PSW)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (AND (NOT (TM-WAITING OS))
                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                     (AND (NUMBERP TASKID)
                          (AND (LESSP TASKID '16)
                               (NOT (EQUAL TASKID
                                           (ARRAY-QFIRST (OS-READYQ OS)))))))))
      (EQUAL (MAPUP-CPU TASKID
                        (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
             (MAPUP-CPU TASKID OS)))
 ((ENABLE ARRAY-QFIRST-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
          COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
          LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-CURRENT-TASKID OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
          PUTNTH-PUTSEG-COINCIDENCE-INVERSE)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                   (AND (NUMBERP TASKID)
                        (LESSP TASKID '16)))))
    (EQUAL (MAPUP-CPU TASKID
                      (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                            (MAPUP-ERROR TASKID OS)
                                            '0
                                            (MAPUP-SVCID TASKID OS))
                               '8
                               (MAPUP-CPU TASKID OS)))
               (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2 (OS OS)
                                                 (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                   (AND (NUMBERP TASKID)
                        (LESSP TASKID '16)))))
    (EQUAL (MAPUP-REGS TASKID
                       (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (MAPUP-REGS TASKID OS))
               (MAPUP-REGS TASKID OS))))
 ((ENABLE GETSEG-BEFORE-PUTNTH GETSEG-PUTNTH-COINCIDENCE LENGTH-MAPUP-CPU
          LENGTH-PUTNTH MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-ERROR
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-ERROR
                      MAPUP-SVCFLAG TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-ERROR
                      MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                 (AND (NUMBERP TASKID)
                      (LESSP TASKID '16)))))
  (EQUAL
   (MAPUP-TASK TASKID
               (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
   (IF
     (EQUAL TASKID
            (ARRAY-QFIRST (OS-READYQ OS)))
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (MAPUP-TASK TASKID OS)))
     (MAPUP-TASK TASKID OS))))
 ((ENABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT OS-STORE-MESSAGE REAL-ADDR-NUM REAL-ADDR-SOURCE
          TM-SET-REGS TM-SET-SVCFLAG TM-STORE TM-STORE-IN-REGMEM)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                                     (AND (NUMBERP TASKID)
                                          (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                                 TASKID)))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NOT (ARRAY-QFULLP (OS-READYQ OS)))
                 (AND (NUMBERP TASKID)
                      (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                 TASKID)
                          '*1*FALSE
                          '*1*TRUE)))))
  (EQUAL
   (MAPUP-TASKS TASKID
                (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
              (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                (OS-CURRENT-TASKID OS)
                                                OS))
              (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS))))
    (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                TASKID)
    (MAPUP-TASKS TASKID OS))))
 ((ENABLE DIFFERENCE-X-X GETNTH-MAPUP-TASKS-COROLLARY2
          MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH3 MAPUP-TASKS
          MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE1
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-GETNTH1 OPEN-UP-PUTNTH-ON-ZERO
          OPEN-UP-PUTNTH1 SUB1-DIFFERENCE)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (NOT (ARRAY-QFULLP (OS-READYQ OS)))))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
   (PUTNTH
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (MAPUP-OS-TASKS OS))))
     (ARRAY-QFIRST (OS-READYQ OS))
     (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-CASE2)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                           (OS-STATUS-TABLE OS))
                   '2)))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
                  (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                    (OS-CURRENT-TASKID OS)
                                                    OS))
                  (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS))))
    (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
    (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT
          FINITE-NUMBERP-OS-SRCID CORRECTNESS-OF-ARRAY-QFIRST)
  (USE
     (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                  (DESTID (OS-SRCID OS '16))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                          (MAPUP-OS-IBUFFERS OS)))
          ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                          (MAPUP-OS-OBUFFERS OS)))
          ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
              (DEQ2 (OS-SRCID OS '16)
                    (ARRAY-QFIRST (OS-READYQ OS))
                    (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          CORRECTNESS-OF-ARRAY-DEQ DEQ2 GETNTH-GETSEG GETNTH-MAPUP-QUEUE-LIST
          GETNTH-TABLE GETNTH2 LENGTH-MAPUP-QUEUE-LIST LENGTH-OS-MBUFFERS
          LENGTH-TABLE LESSP-REMAINDER2 MAPUP-OS-MBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-MBUFFERS-ADDRESS-FACTS1 OS-MBUFFERS-ADDRESS-FACTS3
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS-SRCID PUTNTH2
          QUOTIENT-PLUS-TIMES REMAINDER-PLUS-TIMES-2
          REWRITE-OS-MBUFFER-ADDRESS1 TABLE-PUTNTH TABLE-PUTSEG TM-R2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-SRCID OS '16))
                                             (DID (OS-CURRENT-TASKID OS))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
              (DEQ2 (OS-SRCID OS '16)
                    (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                    (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                   (OS-STATUS-TABLE OS))
                           '2)))
          (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                 (ENQ (OS-SRCID OS '16)
                      (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ CORRECTNESS-OF-ARRAY-QEMPTYP
          FINITE-NUMBERP-OS-SRCID OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3)
  (USE
     (OS-WAITING-TO-SENDP-IMPLIES-READYQ-NOT-FULL (OS OS)
                                                  (DESTID (OS-SRCID OS '16))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 ARRAY-QUEUE-FACTS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
    MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TABLE '2
                           (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH3 OS)))
                    (PUTNTH '(0 0)
                            (OS-SRCID OS '16)
                            (TABLE '2 (OS-STATUS-TABLE OS)))))
    ((ENABLE COMMUTATIVITY-OF-PLUS LENGTH LENGTH-OS-STATUS-TABLE
             FINITE-NUMBERP-OS-SRCID OS-STATUS-TABLE-ADDRESS-FACTS
             OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3 OS-UPDATE-STATUS
             PLISTP TABLE-PUTSEG)
     (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH3 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA
 AK-WAITING-TO-SENDP-MAPUP-OS
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (AND (NOT (TM-ERRORP OS))
                      (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS))))))
       (AK-WAITING-TO-SENDP (OS-SRCID OS '16)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS)))
 ((ENABLE AK-WAITING-TO-SENDP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-STATUS-TABLE
          FINITE-NUMBERP-OS-SRCID MAPUP-OS OS-STATUS-TABLE-ADDRESS-FACTS
          PLUS-0-ARG1)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE AK-WAITING-TO-SENDP-MAPUP-OS)

(PROVE-LEMMA TM-SET-SVCFLAG-COMMUTES-WITH-OS-STORE-MESSAGE
             (REWRITE)
             (EQUAL (OS-STORE-MESSAGE MSG
                                      (TM-SET-SVCFLAG FLAG TM))
                    (TM-SET-SVCFLAG FLAG
                                    (OS-STORE-MESSAGE MSG TM)))
             ((ENABLE OS-STORE-MESSAGE TM-SET-SVCFLAG TM-STORE
                      TM-STORE-IN-REGMEM TM-STORE-IN-MEMORY TM-SET-REGS
                      TM-SET-MEMORY)
              (ENABLE-THEORY EXECUTABLE-FNS TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-SET-SVCFLAG-COMMUTES-WITH-OS-STORE-MESSAGE)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                     (OS-STATUS-TABLE OS))
                             '2)
                      (EQUAL (GETNTH (PLUS '1
                                           (TIMES '2 (OS-SRCID OS '16)))
                                     (OS-STATUS-TABLE OS))
                             (OS-CURRENT-TASKID OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-RECEIVE-HANDLER-PATH3 OS))
         (AK-EXECUTE-RECEIVE (OS-SRCID OS '16)
                             (OS-CURRENT-TASKID OS)
                             (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-RECEIVE AK-EXECUTE-RECEIVE-FROM-BUFFER
          AK-STORE-MESSAGE CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP-OS-SRCID
          GETNTH-PUTNTH-COINCIDENCE LENGTH-MAPUP-OS-TASKS LENGTH-OS-MBUFFERS
          LENGTH-TABLE MAPUP-OS MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH3
          OS-CURRENT-MBUFFER OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2
          OS-CURRENT-TASKID QEMPTYP2 QFIRST2
          TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH3
          TM-SET-SVCFLAG-COMMUTES-WITH-OS-STORE-MESSAGE)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (AK-WAITING-TO-SENDP-MAPUP-OS (OS OS))
   (PUTNTH-COINCIDENCE
    (I (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (J (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (A (OS-STORE-MESSAGE (QFIRST (GETNTH2 (OS-SRCID OS '16)
                                          (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-MBUFFERS OS)))
                         (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                 (MAPUP-OS-TASKS OS))))
    (B
     (TM-SET-SVCFLAG '0
       (OS-STORE-MESSAGE (QFIRST (GETNTH2 (OS-SRCID OS '16)
                                          (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-MBUFFERS OS)))
                         (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                 (MAPUP-OS-TASKS OS)))))
    (L (MAPUP-OS-TASKS OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES QUEUE-FACTS
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
         GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH4
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                  (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                         (GETSEG (MAPUP-BASE TASKID OS)
                                 (MAPUP-LIMIT TASKID OS)
                                 (TM-MEMORY OS))))
         ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                  MAPUP-LIMIT OS-MBUFFERS-WITH-DEQUEUED-MESSAGE
                  OS-SVC-RECEIVE-HANDLER-PATH4
                  OS-TASK-TABLE-WITH-DELIVERED-MESSAGE PLUS-EQUAL-0)
          (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                         OS-SEGMENT-LENGTHS GROUND-ZERO)
          (USE (DISJOINT-GETNTH (B '0)
                                (L '3311)
                                (I TASKID)
                                (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
               (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                   (OS OS))
               (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                    (OS OS)))
          (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (TM-CPU (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                            (TM-ERROR OS)
                                            '0
                                            (TM-SVCID OS))
                               '8
                               (TM-CPU OS)))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE GETNTH-PUTNTH-NON-INTERFERENCE
          OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1 OS-CURRENT-MBUFFER
          OS-SVC-RECEIVE-HANDLER-PATH4 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                   (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
        (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                  (OS-CURRENT-TASKID OS)
                                                  OS))
                '3
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS)))))
 ((ENABLE GETNTH-TM-REGLENGTH-TM-CPU MAPUP-CC MAPUP-CPU MAPUP-ERROR
          MAPUP-SVCID NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-CURRENT-TASKID OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-CPU-OS-SVC-RECEIVE-HANDLER-PATH4 TM-UNPACK-CC-TM-PACK-PSW
          TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-SVCID-TM-PACK-PSW)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
   MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (AND (NUMBERP TASKID)
                           (AND (LESSP TASKID '16)
                                (NOT (EQUAL TASKID
                                            (ARRAY-QFIRST (OS-READYQ OS))))))))
            (EQUAL (MAPUP-CPU TASKID
                              (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                   (MAPUP-CPU TASKID OS)))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
            LENGTH-TM-CPU MAPUP-CPU
            NOT-TM-WAITING-OS-SVC-RECEIVE-HANDLER-PATH4 OS-CURRENT-TASKID
            OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
            OS-TASK-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
            OS-TASK-TABLE-WITH-DELIVERED-MESSAGE
            PUTNTH-PUTSEG-COINCIDENCE-INVERSE)
    (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                   GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
    (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                       (J (ARRAY-QFIRST (OS-READYQ OS)))))
    (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NUMBERP TASKID)
                   (LESSP TASKID '16))))
    (EQUAL (MAPUP-CPU TASKID
                      (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                            (MAPUP-ERROR TASKID OS)
                                            '0
                                            (MAPUP-SVCID TASKID OS))
                               '8
                               (MAPUP-CPU TASKID OS)))
               (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2 (OS OS)
                                                 (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NUMBERP TASKID)
                   (LESSP TASKID '16))))
    (EQUAL (MAPUP-REGS TASKID
                       (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (MAPUP-REGS TASKID OS))
               (MAPUP-REGS TASKID OS))))
 ((ENABLE GETSEG-BEFORE-PUTNTH GETSEG-PUTNTH-COINCIDENCE LENGTH-MAPUP-CPU
          LENGTH-PUTNTH MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-ERROR
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-ERROR
                      MAPUP-SVCFLAG TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-ERROR
                      MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))
  (EQUAL
   (MAPUP-TASK TASKID
               (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
   (IF
     (EQUAL TASKID
            (ARRAY-QFIRST (OS-READYQ OS)))
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (MAPUP-TASK TASKID OS)))
     (MAPUP-TASK TASKID OS))))
 ((ENABLE GETSEG-TM-MEMORY-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-CC-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-ERROR-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-LIMIT-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-REGS-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-SVCFLAG-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-SVCID-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT OS-STORE-MESSAGE REAL-ADDR-NUM REAL-ADDR-SOURCE
          TM-SET-REGS TM-SET-SVCFLAG TM-STORE TM-STORE-IN-REGMEM)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                            TASKID)
                     '*1*FALSE
                     '*1*TRUE))))
  (EQUAL
   (MAPUP-TASKS TASKID
                (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
              (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                (OS-CURRENT-TASKID OS)
                                                OS))
              (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS))))
    (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                TASKID)
    (MAPUP-TASKS TASKID OS))))
 ((ENABLE DIFFERENCE-X-X GETNTH-MAPUP-TASKS-COROLLARY2
          MAPUP-TASK-OS-SVC-RECEIVE-HANDLER-PATH4 MAPUP-TASKS
          MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE1
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-GETNTH1 OPEN-UP-PUTNTH-ON-ZERO
          OPEN-UP-PUTNTH1 SUB1-DIFFERENCE)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
   (PUTNTH
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (MAPUP-OS-TASKS OS))))
     (ARRAY-QFIRST (OS-READYQ OS))
     (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-CASE2)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
                  (ARRAY-QFIRST (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                    (OS-CURRENT-TASKID OS)
                                                    OS))
                  (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS))))
    (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
    (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
          MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                          (MAPUP-OS-IBUFFERS OS)))
          ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (GOOD-OS OS)
                   (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                          (MAPUP-OS-OBUFFERS OS)))
          ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)
           (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
              (DEQ2 (OS-SRCID OS '16)
                    (ARRAY-QFIRST (OS-READYQ OS))
                    (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          CORRECTNESS-OF-ARRAY-DEQ DEQ2 GETNTH-GETSEG GETNTH-MAPUP-QUEUE-LIST
          GETNTH-TABLE GETNTH2 LENGTH-MAPUP-QUEUE-LIST LENGTH-OS-MBUFFERS
          LENGTH-TABLE LESSP-REMAINDER2 MAPUP-OS-MBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-MBUFFER OS-CURRENT-TASKID
          OS-MBUFFERS-ADDRESS-FACTS1 OS-MBUFFERS-ADDRESS-FACTS3
          OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-MBUFFERS-WITH-DEQUEUED-MESSAGE OS-SRCID PUTNTH2
          QUOTIENT-PLUS-TIMES REMAINDER-PLUS-TIMES-2
          REWRITE-OS-MBUFFER-ADDRESS1 TABLE-PUTNTH TABLE-PUTSEG TM-R2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-MBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
       (FINITE-NUMBER-QUEUEP-CURRENT-MBUFFER (OS OS)
                                             (SID (OS-SRCID OS '16))
                                             (DID (OS-CURRENT-TASKID OS))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
              (DEQ2 (OS-SRCID OS '16)
                    (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                    (MAPUP-OS-MBUFFERS OS))))
 ((ENABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
    MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                    (MAPUP-QUEUE (OS-READYQ OS))))
    ((ENABLE OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4)
     (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
    MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TABLE '2
                           (OS-STATUS-TABLE (OS-SVC-RECEIVE-HANDLER-PATH4 OS)))
                    (TABLE '2 (OS-STATUS-TABLE OS))))
    ((ENABLE OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)
     (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
     (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-RECEIVE-HANDLER-PATH4 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA
 NOT-AK-WAITING-TO-SENDP-MAPUP-OS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NOT (TM-ERRORP OS))
                 (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS)))))))
  (NOT (AK-WAITING-TO-SENDP (OS-SRCID OS '16)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS))))
 ((ENABLE AK-WAITING-TO-SENDP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          GETNTH-GETSEG GETNTH-TABLE LENGTH-OS-STATUS-TABLE
          FINITE-NUMBERP-OS-SRCID MAPUP-OS OS-STATUS-TABLE-ADDRESS-FACTS
          PLUS-0-ARG1)
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NOT-AK-WAITING-TO-SENDP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (NOT (TM-ERRORP OS))
       (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                   '1)
            (AND (NOT (ARRAY-QEMPTYP (OS-CURRENT-MBUFFER (OS-SRCID OS '16)
                                                         (OS-CURRENT-TASKID OS)
                                                         OS)))
                 (NOT (AND (EQUAL (GETNTH (TIMES '2 (OS-SRCID OS '16))
                                          (OS-STATUS-TABLE OS))
                                  '2)
                           (EQUAL (GETNTH (PLUS '1
                                                (TIMES '2 (OS-SRCID OS '16)))
                                          (OS-STATUS-TABLE OS))
                                  (OS-CURRENT-TASKID OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-RECEIVE-HANDLER-PATH4 OS))
         (AK-EXECUTE-RECEIVE (OS-SRCID OS '16)
                             (OS-CURRENT-TASKID OS)
                             (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-RECEIVE AK-EXECUTE-RECEIVE-FROM-BUFFER
          AK-STORE-MESSAGE CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP-OS-SRCID
          GETNTH-PUTNTH-COINCIDENCE LENGTH-MAPUP-OS-TASKS LENGTH-OS-MBUFFERS
          LENGTH-TABLE MAPUP-OS MAPUP-OS-IBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-OS-STATUS-TABLE-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-SVC-RECEIVE-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH2-OS-MBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-RECEIVE-HANDLER-PATH4
          OS-CURRENT-MBUFFER OS-CURRENT-MBUFFER-REWRITE-TO-GETNTH2
          OS-CURRENT-TASKID QEMPTYP2 QFIRST2
          TM-CLOCK-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-IPORTS-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-OPORTS-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-RWSTATE-OS-SVC-RECEIVE-HANDLER-PATH4
          TM-SET-SVCFLAG-COMMUTES-WITH-OS-STORE-MESSAGE)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-TABLEP-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (NOT-AK-WAITING-TO-SENDP-MAPUP-OS (OS OS))
   (PUTNTH-COINCIDENCE
    (I (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (J (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (A (OS-STORE-MESSAGE (QFIRST (GETNTH2 (OS-SRCID OS '16)
                                          (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-MBUFFERS OS)))
                         (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                 (MAPUP-OS-TASKS OS))))
    (B
     (TM-SET-SVCFLAG '0
       (OS-STORE-MESSAGE (QFIRST (GETNTH2 (OS-SRCID OS '16)
                                          (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-MBUFFERS OS)))
                         (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                 (MAPUP-OS-TASKS OS)))))
    (L (MAPUP-OS-TASKS OS))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH4)

(PROVE-LEMMA CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '1))))
                      (EQUAL (MAPUP-OS (OS-SVC-RECEIVE-HANDLER OS))
                             (AK-EXECUTE-RECEIVE (OS-SRCID OS '16)
                                                 (OS-CURRENT-TASKID OS)
                                                 (MAPUP-OS OS))))
             ((ENABLE OS-SVC-RECEIVE-HANDLER
                      CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH1
                      CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH2
                      CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH3
                      CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH1 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH1
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-SVC-TYI-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH1 PLISTP-TM-CPU
                 TM-WAITING-OS-SVC-TYI-HANDLER-PATH1)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                      GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-CC-OS-SVC-TYI-HANDLER-PATH1
                      MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH1 NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH1 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYI-HANDLER-PATH1 OS)))
                        (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
        ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                 OS-READYQ-OS-SVC-TYI-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH1 OS)))
                        (PUTNTH '(5 0)
                                (ARRAY-QFIRST (OS-READYQ OS))
                                (TABLE '2 (OS-STATUS-TABLE OS)))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1 PLISTP TABLE-PUTSEG
                 OS-UPDATE-STATUS LENGTH PLISTP)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES
                        FINITE-NUMBER-QUEUE-COROLLARIES OS-SEGMENT-LENGTHS
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-TYI-HANDLER-PATH1 OS))
                    '1)
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYI-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYI-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYI-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYI-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYI-HANDLER-PATH1 OS))
         (AK-EXECUTE-INPUT (OS-CURRENT-TASKID OS)
                           (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-INPUT AK-DISPATCHER AK-EXECUTE-INPUT
          CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH1 OS-CURRENT-IBUFFER
          OS-CURRENT-TASKID TM-CLOCK-OS-SVC-TYI-HANDLER-PATH1
          TM-IPORTS-OS-SVC-TYI-HANDLER-PATH1
          TM-OPORTS-OS-SVC-TYI-HANDLER-PATH1
          TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH1)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
                              (QUEUE (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH2 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-TYI-HANDLER-PATH2
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-SVC-TYI-HANDLER-PATH2 OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                OS))
           (CONS
            (TM-PACK-PSW
                      (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS)
                      (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS)
                      (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                      OS)
                      (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS))
            'NIL)))))))))))
 ((ENABLE OS-SVC-TYI-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5
          TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CASE1 NIL
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         (ARRAY-QFIRST (OS-READYQ OS)))))
        (EQUAL (TM-CPU (OS-SVC-TYI-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2 PLISTP-TM-CPU
          TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CASE2 NIL
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                       (NOT (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                   (ARRAY-QFIRST (OS-READYQ OS)))))))
        (EQUAL (TM-CPU (OS-SVC-TYI-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-SVC-TYI-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2 PLISTP-TM-CPU TABLE-PUTSEG
          TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
        (EQUAL (TM-CPU (OS-SVC-TYI-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS))))))
 ((USE (TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CASE1)
       (TM-CPU-OS-SVC-TYI-HANDLER-PATH2-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CPU TASKID
                                  (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-CPU TASKID OS)))
       ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                LENGTH-TM-CPU MAPUP-CPU
                NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH2 OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH2
                PLISTP-TM-CPU TM-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                       GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                           (J (ARRAY-QFIRST (OS-READYQ OS)))))
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-REGS TASKID
                                   (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-REGS TASKID OS)))
       ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CC-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CC TASKID
                                 (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-CC TASKID OS)))
       ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-ERROR TASKID
                                    (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-ERROR TASKID OS)))
       ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCFLAG TASKID
                                      (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-SVCFLAG TASKID OS)))
       ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCID TASKID
                                    (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-SVCID TASKID OS)))
       ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-TASK TASKID
                                   (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-TASK TASKID OS)))
       ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-CC-OS-SVC-TYI-HANDLER-PATH2
                MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH2 NUMBERP-MAPUP-LIMIT)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (NUMBERP TASKID))))
                (EQUAL (MAPUP-TASKS TASKID
                                    (OS-SVC-TYI-HANDLER-PATH2 OS))
                       (MAPUP-TASKS TASKID OS)))
       ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYI-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH2 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYI-HANDLER-PATH2 OS)))
                        (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
        ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                 OS-READYQ-OS-SVC-TYI-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH2 OS)))
                        (PUTNTH '(5 0)
                                (ARRAY-QFIRST (OS-READYQ OS))
                                (TABLE '2 (OS-STATUS-TABLE OS)))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2 PLISTP TABLE-PUTSEG
                 OS-UPDATE-STATUS LENGTH PLISTP)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES
                        FINITE-NUMBER-QUEUE-COROLLARIES OS-SEGMENT-LENGTHS
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYI-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYI-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYI-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-TYI-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-SVC-TYI-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (AND (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                      (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYI-HANDLER-PATH2 OS))
         (AK-EXECUTE-INPUT (OS-CURRENT-TASKID OS)
                           (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-INPUT AK-DISPATCHER AK-EXECUTE-INPUT
          CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH2 OS-CURRENT-IBUFFER
          OS-CURRENT-TASKID TM-CLOCK-OS-SVC-TYI-HANDLER-PATH2
          TM-IPORTS-OS-SVC-TYI-HANDLER-PATH2
          TM-OPORTS-OS-SVC-TYI-HANDLER-PATH2
          TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH2)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
                              (QUEUE (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYI-HANDLER-PATH3 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-IBUFFERS-WITH-DEQUEUED-CHARACTER
                      OS-SVC-TYI-HANDLER-PATH3
                      OS-TASK-TABLE-WITH-DELIVERED-CHARACTER PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 TM-CPU-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (NOT (TM-WAITING OS)))
        (EQUAL (TM-CPU (OS-SVC-TYI-HANDLER-PATH3 OS))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                            (TM-ERROR OS)
                                            '0
                                            (TM-SVCID OS))
                               '8
                               (TM-CPU OS)))))
 ((ENABLE OS-SVC-TYI-HANDLER-PATH3 GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 OPEN-UP-PUTNTH-ON-ZERO OPEN-UP-PUTNTH1
          OS-CURRENT-IBUFFER)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                   (OS-SVC-TYI-HANDLER-PATH3 OS))
        (PUTNTH (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                  OS))
                '3
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS)))))
 ((ENABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH3 GETNTH-TM-REGLENGTH-TM-CPU
          MAPUP-CC MAPUP-CPU MAPUP-ERROR MAPUP-SVCID
          NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH3 OS-CURRENT-TASKID
          TM-CPU-OS-SVC-TYI-HANDLER-PATH3 TM-UNPACK-CC-TM-PACK-PSW
          TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-SVCID-TM-PACK-PSW)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
   MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE2
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (AND (NUMBERP TASKID)
                           (AND (LESSP TASKID '16)
                                (NOT (EQUAL TASKID
                                            (ARRAY-QFIRST (OS-READYQ OS))))))))
            (EQUAL (MAPUP-CPU TASKID
                              (OS-SVC-TYI-HANDLER-PATH3 OS))
                   (MAPUP-CPU TASKID OS)))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
            LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-TYI-HANDLER-PATH3
            OS-CURRENT-TASKID OS-READYQ-OS-SVC-TYI-HANDLER-PATH3
            OS-TASK-TABLE-OS-SVC-TYI-HANDLER-PATH3
            OS-TASK-TABLE-WITH-DELIVERED-CHARACTER
            PUTNTH-PUTSEG-COINCIDENCE-INVERSE)
    (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                   GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
    (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                       (J (ARRAY-QFIRST (OS-READYQ OS)))))
    (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NUMBERP TASKID)
                   (LESSP TASKID '16))))
    (EQUAL (MAPUP-CPU TASKID
                      (OS-SVC-TYI-HANDLER-PATH3 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                            (MAPUP-ERROR TASKID OS)
                                            '0
                                            (MAPUP-SVCID TASKID OS))
                               '8
                               (MAPUP-CPU TASKID OS)))
               (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE2 (OS OS)
                                             (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
    (AND (GOOD-OS OS)
         (AND (NOT (TM-WAITING OS))
              (AND (NUMBERP TASKID)
                   (LESSP TASKID '16))))
    (EQUAL (MAPUP-REGS TASKID
                       (OS-SVC-TYI-HANDLER-PATH3 OS))
           (IF (EQUAL TASKID
                      (ARRAY-QFIRST (OS-READYQ OS)))
               (PUTNTH (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       '3
                       (MAPUP-REGS TASKID OS))
               (MAPUP-REGS TASKID OS))))
 ((ENABLE MAPUP-REGS GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTNTH LENGTH-MAPUP-CPU
          GETSEG-BEFORE-PUTNTH MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-SVCFLAG
                      MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3
                      TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCFLAG
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYI-HANDLER-PATH3 MAPUP-ERROR
                      MAPUP-SVCFLAG MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))
  (EQUAL
   (MAPUP-TASK TASKID
               (OS-SVC-TYI-HANDLER-PATH3 OS))
   (IF
     (EQUAL TASKID
            (ARRAY-QFIRST (OS-READYQ OS)))
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (MAPUP-TASK TASKID OS)))
     (MAPUP-TASK TASKID OS))))
 ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE OS-STORE-MESSAGE TM-STORE
          REAL-ADDR-SOURCE REAL-ADDR-NUM TM-STORE-IN-REGMEM TM-SET-REGS
          GETSEG-TM-MEMORY-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-BASE-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-LIMIT-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-SVCID-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-SVCFLAG-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-ERROR-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-CC-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-REGS-OS-SVC-TYI-HANDLER-PATH3 NUMBERP-MAPUP-LIMIT
          TM-SET-SVCFLAG)
  (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                            TASKID)
                     '*1*FALSE
                     '*1*TRUE))))
  (EQUAL
   (MAPUP-TASKS TASKID
                (OS-SVC-TYI-HANDLER-PATH3 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
              (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                OS))
              (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS))))
    (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                TASKID)
    (MAPUP-TASKS TASKID OS))))
 ((ENABLE MAPUP-TASKS MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE1
          OPEN-UP-GETNTH1 OPEN-UP-PUTNTH1 SUB1-DIFFERENCE
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-PUTNTH-ON-ZERO DIFFERENCE-X-X
          GETNTH-MAPUP-TASKS-COROLLARY2 PUTNTH-INTO-NIL
          MAPUP-TASK-OS-SVC-TYI-HANDLER-PATH3)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-TYI-HANDLER-PATH3 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-TYI-HANDLER-PATH3 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3-SUPPORT
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-TYI-HANDLER-PATH3 OS))
   (PUTNTH
     (OS-STORE-MESSAGE (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (TM-SET-SVCFLAG '0
                                       (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                               (MAPUP-OS-TASKS OS))))
     (ARRAY-QFIRST (OS-READYQ OS))
     (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP-REMAINDER
          MAPUP-TASKS-OS-SVC-TYI-HANDLER-PATH3-CASE2)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS-TASKS (OS-SVC-TYI-HANDLER-PATH3 OS))
   (PUTNTH
    (OS-STORE-MESSAGE
                  (ARRAY-QFIRST (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                    OS))
                  (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS))))
    (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
    (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
       (AND (GOOD-OS OS)
            (AND (NOT (TM-WAITING OS))
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
       (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
              (DEQ-ITH-BUFFER (OS-CURRENT-TASKID OS)
                              (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-DEQ DEQ-ITH-BUFFER
          LENGTH-ARRAY-DEQ LENGTH-GETNTH-TABLE LENGTH-OS-IBUFFERS
          MAPUP-OS-IBUFFERS MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-IBUFFER OS-CURRENT-TASKID
          OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          OS-IBUFFERS-WITH-DEQUEUED-CHARACTER PLISTP-ARRAY-DEQ
          PLISTP-GETNTH-TABLE TABLE-PUTSEG)
  (USE (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYI-HANDLER-PATH3 OS)))
                        (MAPUP-QUEUE (OS-READYQ OS))))
        ((ENABLE OS-READYQ-OS-SVC-TYI-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYI-HANDLER-PATH3 OS)))
                        (TABLE '2 (OS-STATUS-TABLE OS))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYI-HANDLER-PATH3 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-TYI-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-TYI-HANDLER-PATH3 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (NOT (TM-ERRORP OS))
            (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                        '3)
                 (NOT (ARRAY-QEMPTYP (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYI-HANDLER-PATH3 OS))
         (AK-EXECUTE-INPUT (OS-CURRENT-TASKID OS)
                           (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-INPUT AK-EXECUTE-INPUT-FROM-BUFFER
          AK-STORE-MESSAGE CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST DEQ-ITH-BUFFER GETNTH-PUTNTH-COINCIDENCE
          LENGTH-MAPUP-OS-TASKS MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-SVC-TYI-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYI-HANDLER-PATH3 OS-CURRENT-IBUFFER
          OS-CURRENT-TASKID TM-CLOCK-OS-SVC-TYI-HANDLER-PATH3
          TM-IPORTS-OS-SVC-TYI-HANDLER-PATH3
          TM-OPORTS-OS-SVC-TYI-HANDLER-PATH3
          TM-RWSTATE-OS-SVC-TYI-HANDLER-PATH3
          TM-SET-SVCFLAG-COMMUTES-WITH-OS-STORE-MESSAGE)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER (ID (OS-CURRENT-TASKID OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
                              (QUEUE (OS-CURRENT-IBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (PUTNTH-COINCIDENCE
    (I (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (J (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
    (A (OS-STORE-MESSAGE (QFIRST (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                         (MAPUP-OS-IBUFFERS OS)))
                         (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                 (MAPUP-OS-TASKS OS))))
    (B
     (TM-SET-SVCFLAG '0
        (OS-STORE-MESSAGE (QFIRST (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-IBUFFERS OS)))
                          (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                  (MAPUP-OS-TASKS OS)))))
    (L (MAPUP-OS-TASKS OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH3)

(PROVE-LEMMA CORRECTNESS-OF-OS-SVC-TYI-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '3))))
                      (EQUAL (MAPUP-OS (OS-SVC-TYI-HANDLER OS))
                             (AK-EXECUTE-INPUT (OS-CURRENT-TASKID OS)
                                               (MAPUP-OS OS))))
             ((ENABLE OS-SVC-TYI-HANDLER
                      CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH1
                      CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH2
                      CORRECTNESS-OF-OS-SVC-TYI-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYI-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH1 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH1
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (NUMBERP TASKID)
                                (LESSP TASKID '16))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-SVC-TYO-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                 LENGTH-TM-CPU MAPUP-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH1 PLISTP-TM-CPU
                 TM-WAITING-OS-SVC-TYO-HANDLER-PATH1)
         (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                        GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-SVCFLAG TASKID OS)))
             ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                      GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-CC-OS-SVC-TYO-HANDLER-PATH1
                      MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH1 NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-OS-TASKS OS)))
             ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH1 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYO-HANDLER-PATH1 OS)))
                        (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
        ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                 OS-READYQ-OS-SVC-TYO-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH1 OS)))
                        (PUTNTH '(4 0)
                                (ARRAY-QFIRST (OS-READYQ OS))
                                (TABLE '2 (OS-STATUS-TABLE OS)))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1 PLISTP TABLE-PUTSEG
                 OS-UPDATE-STATUS LENGTH PLISTP)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES
                        FINITE-NUMBER-QUEUE-COROLLARIES OS-SEGMENT-LENGTHS
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-TYO-HANDLER-PATH1 OS))
                    '1)
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYO-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYO-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYO-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYO-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA
            MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS) (LESSP ID '16))
                     (EQUAL (MAPUP-QUEUE (GETNTH ID
                                                 (TABLE '8 (OS-OBUFFERS OS))))
                            (GETNTH ID (MAPUP-OS-OBUFFERS OS))))
            ((ENABLE MAPUP-OS-OBUFFERS LENGTH-TABLE LENGTH-OS-OBUFFERS)
             (USE (MAPUP-QUEUE-GETNTH (L (TABLE '8 (OS-OBUFFERS OS)))
                                      (CAPACITY '4)
                                      (LUB '65536)))
             (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-GETNTH-FOR-OBUFFERS)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (EQUAL '4 (GETNTH '3 QUEUE)))
                      (EQUAL (ARRAY-QFULLP QUEUE)
                             (QFULLP (MAPUP-QUEUE QUEUE) '4)))
             ((USE (CORRECTNESS-OF-ARRAY-QFULLP (QUEUE QUEUE)
                                                (MAX '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYO-HANDLER-PATH1 OS))
         (AK-EXECUTE-OUTPUT (OS-MESSAGE OS)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-OUTPUT AK-DISPATCHER AK-EXECUTE-OUTPUT
          CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH1 OS-CURRENT-OBUFFER
          OS-CURRENT-TASKID TM-CLOCK-OS-SVC-TYO-HANDLER-PATH1
          TM-IPORTS-OS-SVC-TYO-HANDLER-PATH1
          TM-OPORTS-OS-SVC-TYO-HANDLER-PATH1
          TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH1)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
                              (QUEUE (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH2 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-NEW-TASK-TABLE OS-SVC-TYO-HANDLER-PATH2
                      OS-UPDATE-STATUS PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CROCK
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (NOT (TM-WAITING OS)))
  (EQUAL
   (TM-CPU (OS-SVC-TYO-HANDLER-PATH2 OS))
   (CONS
    (GETNTH '0
            (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         OS))
    (CONS
     (GETNTH '1
             (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                          OS))
     (CONS
      (GETNTH '2
              (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                           OS))
      (CONS
       (GETNTH '3
               (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                            OS))
       (CONS
        (GETNTH '4
                (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                             OS))
        (CONS
         (GETNTH '5
                 (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                              OS))
         (CONS
          (GETNTH '6
                  (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                               OS))
          (CONS
           (GETNTH '7
                   (OS-NEW-REGS (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                OS))
           (CONS
            (TM-PACK-PSW
                      (OS-NEW-CC (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                 OS)
                      (OS-NEW-ERROR (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS)
                      (OS-NEW-SVCFLAG (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                      OS)
                      (OS-NEW-SVCID (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                    OS))
            'NIL)))))))))))
 ((ENABLE OS-SVC-TYO-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4 TM-R5
          TM-R6 TM-R7)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CASE1 NIL
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                         (ARRAY-QFIRST (OS-READYQ OS)))))
        (EQUAL (TM-CPU (OS-SVC-TYO-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))))))
 ((ENABLE COMMUTATIVITY-OF-TIMES CONTRACT-CPU DIFFERENCE-X-X GETNTH-GETSEG
          GETNTH-TABLE GOOD-CPU-TM-CPU LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2 PLISTP-TM-CPU
          TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CASE2 NIL
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                       (NOT (EQUAL (ARRAY-QFIRST (ARRAY-DEQ (OS-READYQ OS)))
                                   (ARRAY-QFIRST (OS-READYQ OS)))))))
        (EQUAL (TM-CPU (OS-SVC-TYO-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))))))
 ((ENABLE CONTRACT-CPU GETNTH-GETSEG GOOD-CPU-GETNTH LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-SVC-TYO-HANDLER-PATH2
          OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2 PLISTP-TM-CPU TABLE-PUTSEG
          TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-OS-PROPERTIES OS-NEW-CPU OS-SEGMENT-LENGTHS GROUND-ZERO)
  (DISABLE PLUS TIMES)
  (DISABLE-THEORY T)))

(PROVE-LEMMA TM-CPU-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
        (EQUAL (TM-CPU (OS-SVC-TYO-HANDLER-PATH2 OS))
               (GETNTH (OS-CURRENT-TASKID (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (TABLE '9
                              (OS-TASK-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS))))))
 ((USE (TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CASE1)
       (TM-CPU-OS-SVC-TYO-HANDLER-PATH2-CASE2))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CPU TASKID
                                  (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-CPU TASKID OS)))
       ((ENABLE COMMUTATIVITY-OF-TIMES DIFFERENCE-X-X GETNTH-TABLE
                LENGTH-TM-CPU MAPUP-CPU
                NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH2 OS-CURRENT-TASKID
                OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH2
                PLISTP-TM-CPU TM-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                       GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                           (J (ARRAY-QFIRST (OS-READYQ OS)))))
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-REGS TASKID
                                   (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-REGS TASKID OS)))
       ((ENABLE MAPUP-REGS MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-CC-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-CC TASKID
                                 (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-CC TASKID OS)))
       ((ENABLE MAPUP-CC MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-ERROR TASKID
                                    (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-ERROR TASKID OS)))
       ((ENABLE MAPUP-ERROR MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCFLAG TASKID
                                      (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-SVCFLAG TASKID OS)))
       ((ENABLE MAPUP-SVCFLAG MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-SVCID TASKID
                                    (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-SVCID TASKID OS)))
       ((ENABLE MAPUP-SVCID MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16)))))
                (EQUAL (MAPUP-TASK TASKID
                                   (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-TASK TASKID OS)))
       ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE
                GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-CC-OS-SVC-TYO-HANDLER-PATH2
                MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH2 NUMBERP-MAPUP-LIMIT)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS)
                     (AND (NOT (TM-WAITING OS))
                          (AND (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))
                               (NUMBERP TASKID))))
                (EQUAL (MAPUP-TASKS TASKID
                                    (OS-SVC-TYO-HANDLER-PATH2 OS))
                       (MAPUP-TASKS TASKID OS)))
       ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH2)
        (ENABLE-THEORY GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS))))))
                   (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (MAPUP-OS-OBUFFERS OS)))
             ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH2 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYO-HANDLER-PATH2 OS)))
                        (DEQ (MAPUP-QUEUE (OS-READYQ OS)))))
        ((ENABLE CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
                 OS-READYQ-OS-SVC-TYO-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH2 OS)))
                        (PUTNTH '(4 0)
                                (ARRAY-QFIRST (OS-READYQ OS))
                                (TABLE '2 (OS-STATUS-TABLE OS)))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2 PLISTP TABLE-PUTSEG
                 OS-UPDATE-STATUS LENGTH PLISTP)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES
                        FINITE-NUMBER-QUEUE-COROLLARIES OS-SEGMENT-LENGTHS
                        GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYO-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYO-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYO-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-SVC-TYO-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-SVC-TYO-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (NOT (TM-ERRORP OS))
             (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                         '2)
                  (AND (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))
                       (NOT (ARRAY-QEMPTYP (ARRAY-DEQ (OS-READYQ OS)))))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYO-HANDLER-PATH2 OS))
         (AK-EXECUTE-OUTPUT (OS-MESSAGE OS)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS))))
 ((ENABLE AK-BLOCK-OUTPUT AK-DISPATCHER AK-EXECUTE-OUTPUT
          CORRECTNESS-OF-ARRAY-DEQ CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH2 OS-CURRENT-OBUFFER
          OS-CURRENT-TASKID TM-CLOCK-OS-SVC-TYO-HANDLER-PATH2
          TM-IPORTS-OS-SVC-TYO-HANDLER-PATH2
          TM-OPORTS-OS-SVC-TYO-HANDLER-PATH2
          TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH2)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
                              (QUEUE (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH3 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                      MAPUP-LIMIT OS-NEW-TASK-TABLE
                      OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-SVC-TYO-HANDLER-PATH3 OS-TASK-TABLE PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-CPU-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-CPU (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                                  (TM-ERROR OS)
                                                  '0
                                                  (TM-SVCID OS))
                                     '8
                                     (TM-CPU OS))))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3 GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 OPEN-UP-PUTNTH-ON-ZERO
                      OPEN-UP-PUTNTH1 OS-CURRENT-OBUFFER)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE1
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                           (OS-SVC-TYO-HANDLER-PATH3 OS))
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS))))
 ((ENABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH3 GETNTH-TM-REGLENGTH-TM-CPU
          MAPUP-CC MAPUP-CPU MAPUP-ERROR MAPUP-SVCID
          NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH3 OS-CURRENT-TASKID
          TM-CPU-OS-SVC-TYO-HANDLER-PATH3 TM-UNPACK-CC-TM-PACK-PSW
          TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-SVCID-TM-PACK-PSW)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
   MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE2
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (AND (NUMBERP TASKID)
                           (AND (LESSP TASKID '16)
                                (NOT (EQUAL TASKID
                                            (ARRAY-QFIRST (OS-READYQ OS))))))))
            (EQUAL (MAPUP-CPU TASKID
                              (OS-SVC-TYO-HANDLER-PATH3 OS))
                   (MAPUP-CPU TASKID OS)))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
            LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH3
            OS-CURRENT-TASKID OS-NEW-TASK-TABLE
            OS-READYQ-OS-SVC-TYO-HANDLER-PATH3
            OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH3)
    (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                   GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
    (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                       (J (ARRAY-QFIRST (OS-READYQ OS)))))
    (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (NUMBERP TASKID)
                         (LESSP TASKID '16))))
          (EQUAL (MAPUP-CPU TASKID
                            (OS-SVC-TYO-HANDLER-PATH3 OS))
                 (IF (EQUAL TASKID
                            (ARRAY-QFIRST (OS-READYQ OS)))
                     (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                          (MAPUP-ERROR TASKID OS)
                                          '0
                                          (MAPUP-SVCID TASKID OS))
                             '8
                             (MAPUP-CPU TASKID OS))
                     (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE2 (OS OS)
                                             (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTNTH
                      LENGTH-MAPUP-CPU GETSEG-BEFORE-PUTNTH
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-SVCFLAG
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3
                      TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCFLAG
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH3 MAPUP-ERROR
                      MAPUP-SVCFLAG MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 (TM-SET-SVCFLAG '0
                                                 (MAPUP-TASK TASKID OS))
                                 (MAPUP-TASK TASKID OS))))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE OS-STORE-MESSAGE TM-STORE
                      REAL-ADDR-SOURCE REAL-ADDR-NUM TM-STORE-IN-REGMEM
                      TM-SET-REGS GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-CC-OS-SVC-TYO-HANDLER-PATH3
                      MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH3 NUMBERP-MAPUP-LIMIT
                      TM-SET-SVCFLAG)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                            TASKID)
                     '*1*FALSE
                     '*1*TRUE))))
  (EQUAL
      (MAPUP-TASKS TASKID
                   (OS-SVC-TYO-HANDLER-PATH3 OS))
      (PUTNTH (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS)))
              (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                          TASKID)
              (MAPUP-TASKS TASKID OS))))
 ((ENABLE MAPUP-TASKS MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE1
          OPEN-UP-GETNTH1 OPEN-UP-PUTNTH1 SUB1-DIFFERENCE
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-PUTNTH-ON-ZERO DIFFERENCE-X-X
          GETNTH-MAPUP-TASKS-COROLLARY2 PUTNTH-INTO-NIL
          MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH3)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-TYO-HANDLER-PATH3 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-TYO-HANDLER-PATH3 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE2)

(PROVE-LEMMA
  MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3-SUPPORT
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH3 OS))
                  (PUTNTH (TM-SET-SVCFLAG '0
                                          (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                                  (MAPUP-OS-TASKS OS)))
                          (ARRAY-QFIRST (OS-READYQ OS))
                          (MAPUP-OS-TASKS OS))))
  ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP-REMAINDER
           MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH3-CASE2)
   (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH3 OS))
          (PUTNTH (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))
                  (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                  (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
        (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
               (ENQ-ITH-BUFFER (OS-MESSAGE OS)
                               (OS-CURRENT-TASKID OS)
                               (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          LENGTH-ARRAY-ENQ LENGTH-GETNTH-TABLE LENGTH-OS-OBUFFERS
          MAPUP-OS-OBUFFERS MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          OS-MESSAGE OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          OS-OBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ
          PLISTP-GETNTH-TABLE TABLE-PUTSEG TM-R3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYO-HANDLER-PATH3 OS)))
                        (MAPUP-QUEUE (OS-READYQ OS))))
        ((ENABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH3 OS)))
                        (TABLE '2 (OS-STATUS-TABLE OS))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYO-HANDLER-PATH3 OS))
                    (TM-POST-OUTPUT-INTERRUPT (ARRAY-QFIRST (OS-READYQ OS))
                                              (TM-OPORTS OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3 TM-POST-OUTPUT-INTERRUPT)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-TYO-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH3 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                  (TM-OPORTS OS)))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYO-HANDLER-PATH3 OS))
         (AK-EXECUTE-OUTPUT (OS-MESSAGE OS)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-OUTPUT AK-EXECUTE-OUTPUT-TO-BUFFER
          AK-OPORT-IDLEP AK-POST-OUTPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE DEQ-ITH-BUFFER
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH3 OS-MESSAGE
          OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          TM-CLOCK-OS-SVC-TYO-HANDLER-PATH3 TM-IPORTS-OS-SVC-TYO-HANDLER-PATH3
          TM-OPORTS-OS-SVC-TYO-HANDLER-PATH3
          TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH3 TM-R3)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
                              (QUEUE (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT OS-SEGMENT-TABLE-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                      (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY (OS-SVC-TYO-HANDLER-PATH4 OS)))
                             (GETSEG (MAPUP-BASE TASKID OS)
                                     (MAPUP-LIMIT TASKID OS)
                                     (TM-MEMORY OS))))
             ((ENABLE DISJOINT LENGTH-TABLE MAPUP-BASE MAPUP-LIMIT
                      OS-NEW-TASK-TABLE OS-OBUFFERS-WITH-ENQUEUED-CHARACTER
                      OS-SVC-TYO-HANDLER-PATH4 OS-TASK-TABLE PLUS-EQUAL-0)
              (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                             OS-SEGMENT-LENGTHS GROUND-ZERO)
              (USE (DISJOINT-GETNTH (B '0)
                                    (L '3311)
                                    (I TASKID)
                                    (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
                   (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                       (OS OS))
                   (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                        (OS OS)))
              (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-CPU-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-CPU (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (PUTNTH (TM-PACK-PSW (TM-CC OS)
                                                  (TM-ERROR OS)
                                                  '0
                                                  (TM-SVCID OS))
                                     '8
                                     (TM-CPU OS))))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4 GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7 OPEN-UP-PUTNTH-ON-ZERO
                      OPEN-UP-PUTNTH1 OS-CURRENT-OBUFFER)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE1
 (REWRITE)
 (IMPLIES
         (AND (GOOD-OS OS)
              (NOT (TM-WAITING OS)))
         (EQUAL (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                           (OS-SVC-TYO-HANDLER-PATH4 OS))
                (PUTNTH (TM-PACK-PSW (MAPUP-CC (ARRAY-QFIRST (OS-READYQ OS))
                                               OS)
                                     (MAPUP-ERROR (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS)
                                     '0
                                     (MAPUP-SVCID (ARRAY-QFIRST (OS-READYQ OS))
                                                  OS))
                        '8
                        (MAPUP-CPU (ARRAY-QFIRST (OS-READYQ OS))
                                   OS))))
 ((ENABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH4 GETNTH-TM-REGLENGTH-TM-CPU
          MAPUP-CC MAPUP-CPU MAPUP-ERROR MAPUP-SVCID
          NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH4 OS-CURRENT-TASKID
          TM-CPU-OS-SVC-TYO-HANDLER-PATH4 TM-UNPACK-CC-TM-PACK-PSW
          TM-UNPACK-ERROR-TM-PACK-PSW TM-UNPACK-SVCID-TM-PACK-PSW)
  (USE (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GOOD-TM-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
   MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE2
   (REWRITE)
   (IMPLIES (AND (GOOD-OS OS)
                 (AND (NOT (TM-WAITING OS))
                      (AND (NUMBERP TASKID)
                           (AND (LESSP TASKID '16)
                                (NOT (EQUAL TASKID
                                            (ARRAY-QFIRST (OS-READYQ OS))))))))
            (EQUAL (MAPUP-CPU TASKID
                              (OS-SVC-TYO-HANDLER-PATH4 OS))
                   (MAPUP-CPU TASKID OS)))
   ((ENABLE COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES GETNTH-TABLE
            LENGTH-TM-CPU MAPUP-CPU NOT-TM-WAITING-OS-SVC-TYO-HANDLER-PATH4
            OS-CURRENT-TASKID OS-NEW-TASK-TABLE
            OS-READYQ-OS-SVC-TYO-HANDLER-PATH4
            OS-TASK-TABLE-OS-SVC-TYO-HANDLER-PATH4)
    (ENABLE-THEORY ACCESS-OS-MEMORY FINITE-NUMBER-QUEUE-COROLLARIES
                   GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS GROUND-ZERO)
    (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                       (J (ARRAY-QFIRST (OS-READYQ OS)))))
    (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
 MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (AND (NOT (TM-WAITING OS))
                    (AND (NUMBERP TASKID)
                         (LESSP TASKID '16))))
          (EQUAL (MAPUP-CPU TASKID
                            (OS-SVC-TYO-HANDLER-PATH4 OS))
                 (IF (EQUAL TASKID
                            (ARRAY-QFIRST (OS-READYQ OS)))
                     (PUTNTH (TM-PACK-PSW (MAPUP-CC TASKID OS)
                                          (MAPUP-ERROR TASKID OS)
                                          '0
                                          (MAPUP-SVCID TASKID OS))
                             '8
                             (MAPUP-CPU TASKID OS))
                     (MAPUP-CPU TASKID OS))))
 ((USE
   (MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE2 (OS OS)
                                             (TASKID TASKID))
   (MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4-CASE1
                                       (OS OS)
                                       (TASKID (ARRAY-QFIRST (OS-READYQ OS)))))
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-REGS GETSEG-PUTNTH-COINCIDENCE LENGTH-PUTNTH
                      LENGTH-MAPUP-CPU GETSEG-BEFORE-PUTNTH
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4
                      TM-UNPACK-CC-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4
                      TM-UNPACK-ERROR-TM-PACK-PSW)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCFLAG TASKID
                                            (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 '0
                                 (MAPUP-SVCFLAG TASKID OS))))
             ((ENABLE FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-ERROR MAPUP-SVCFLAG
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4
                      TM-UNPACK-SVCFLAG-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE FINITE-NUMBER-LISTP-MAPUP-CPU FINITE-NUMBERP-GETNTH
                      FINITE-NUMBERP-TM-UNPACK-CC
                      FINITE-NUMBERP-TM-UNPACK-ERROR
                      FINITE-NUMBERP-TM-UNPACK-SVCFLAG
                      FINITE-NUMBERP-TM-UNPACK-SVCID GETNTH-PUTNTH-COINCIDENCE
                      GETNTH-PUTNTH-NON-INTERFERENCE LENGTH-MAPUP-CPU MAPUP-CC
                      MAPUP-CPU-OS-SVC-TYO-HANDLER-PATH4 MAPUP-ERROR
                      MAPUP-SVCFLAG MAPUP-SVCID TM-UNPACK-SVCID-TM-PACK-PSW)
              (ENABLE-THEORY EXECUTABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (IF (EQUAL TASKID
                                        (ARRAY-QFIRST (OS-READYQ OS)))
                                 (TM-SET-SVCFLAG '0
                                                 (MAPUP-TASK TASKID OS))
                                 (MAPUP-TASK TASKID OS))))
             ((ENABLE MAPUP-TASK MAPUP-ADDRESS-SPACE OS-STORE-MESSAGE TM-STORE
                      REAL-ADDR-SOURCE REAL-ADDR-NUM TM-STORE-IN-REGMEM
                      TM-SET-REGS GETSEG-TM-MEMORY-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-BASE-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-LIMIT-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-SVCID-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-ERROR-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-CC-OS-SVC-TYO-HANDLER-PATH4
                      MAPUP-REGS-OS-SVC-TYO-HANDLER-PATH4 NUMBERP-MAPUP-LIMIT
                      TM-SET-SVCFLAG)
              (ENABLE-THEORY TM-SHELLS GOOD-OS-PROPERTIES GOOD-TM-PROPERTIES
                             GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                                            TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASKS MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (AND (NUMBERP TASKID)
                 (IF (LESSP (ARRAY-QFIRST (OS-READYQ OS))
                            TASKID)
                     '*1*FALSE
                     '*1*TRUE))))
  (EQUAL
      (MAPUP-TASKS TASKID
                   (OS-SVC-TYO-HANDLER-PATH4 OS))
      (PUTNTH (TM-SET-SVCFLAG '0
                              (GETNTH (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                                                  TASKID)
                                      (MAPUP-TASKS TASKID OS)))
              (DIFFERENCE (ARRAY-QFIRST (OS-READYQ OS))
                          TASKID)
              (MAPUP-TASKS TASKID OS))))
 ((ENABLE MAPUP-TASKS MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE1
          OPEN-UP-GETNTH1 OPEN-UP-PUTNTH1 SUB1-DIFFERENCE
          OPEN-UP-GETNTH-ON-ZERO OPEN-UP-PUTNTH-ON-ZERO DIFFERENCE-X-X
          GETNTH-MAPUP-TASKS-COROLLARY2 PUTNTH-INTO-NIL
          MAPUP-TASK-OS-SVC-TYO-HANDLER-PATH4)
  (EXPAND (MAPUP-TASKS 0
                       (OS-SVC-TYO-HANDLER-PATH4 OS))
          (MAPUP-TASKS (ARRAY-QFIRST (OS-READYQ OS))
                       (OS-SVC-TYO-HANDLER-PATH4 OS)))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE2)

(PROVE-LEMMA
  MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4-SUPPORT
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH4 OS))
                  (PUTNTH (TM-SET-SVCFLAG '0
                                          (GETNTH (ARRAY-QFIRST (OS-READYQ OS))
                                                  (MAPUP-OS-TASKS OS)))
                          (ARRAY-QFIRST (OS-READYQ OS))
                          (MAPUP-OS-TASKS OS))))
  ((ENABLE MAPUP-OS-TASKS FINITE-NUMBERP-REMAINDER
           MAPUP-TASKS-OS-SVC-TYO-HANDLER-PATH4-CASE2)
   (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4-SUPPORT)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (NOT (TM-WAITING OS)))
   (EQUAL (MAPUP-OS-TASKS (OS-SVC-TYO-HANDLER-PATH4 OS))
          (PUTNTH (TM-SET-SVCFLAG '0
                                  (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))
                  (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                  (MAPUP-OS-TASKS OS))))
 ((ENABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4-SUPPORT
          CORRECTNESS-OF-ARRAY-QFIRST)
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-IBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-OS-IBUFFERS OS)))
             ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
        (AND (GOOD-OS OS)
             (AND (NOT (TM-WAITING OS))
                  (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))))
        (EQUAL (MAPUP-OS-OBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
               (ENQ-ITH-BUFFER (OS-MESSAGE OS)
                               (OS-CURRENT-TASKID OS)
                               (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          LENGTH-ARRAY-ENQ LENGTH-GETNTH-TABLE LENGTH-OS-OBUFFERS
          MAPUP-OS-OBUFFERS MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-MESSAGE OS-CURRENT-OBUFFER
          OS-CURRENT-TASKID OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          OS-OBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ
          PLISTP-GETNTH-TABLE TABLE-PUTSEG TM-R3)
  (USE (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS))))
  (ENABLE-THEORY GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS-MBUFFERS (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (MAPUP-OS-MBUFFERS OS)))
             ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-SVC-TYO-HANDLER-PATH4 OS)))
                        (MAPUP-QUEUE (OS-READYQ OS))))
        ((ENABLE OS-READYQ-OS-SVC-TYO-HANDLER-PATH4)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (NOT (TM-WAITING OS)))
                 (EQUAL (TABLE '2
                               (OS-STATUS-TABLE (OS-SVC-TYO-HANDLER-PATH4 OS)))
                        (TABLE '2 (OS-STATUS-TABLE OS))))
        ((ENABLE OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4)
         (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-IPORTS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-OPORTS-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-SVC-TYO-HANDLER-PATH4 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-SVC-TYO-HANDLER-PATH4 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE OS-SVC-TYO-HANDLER-PATH4 TM-WAITING FINITE-NUMBERP)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (NOT (TM-ERRORP OS))
        (AND (EQUAL (REMAINDER (TM-SVCID OS) '4)
                    '2)
             (AND (NOT (ARRAY-QFULLP (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS)))
                  (NOT (TM-OPORT-IDLEP (ARRAY-QFIRST (OS-READYQ OS))
                                       (TM-OPORTS OS))))))))
  (EQUAL (MAPUP-OS (OS-SVC-TYO-HANDLER-PATH4 OS))
         (AK-EXECUTE-OUTPUT (OS-MESSAGE OS)
                            (OS-CURRENT-TASKID OS)
                            (MAPUP-OS OS))))
 ((ENABLE AK-UPDATE-CONTROL AK-EXECUTE-OUTPUT AK-EXECUTE-OUTPUT-TO-BUFFER
          AK-OPORT-IDLEP AK-POST-OUTPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFIRST
          CORRECTNESS-OF-ARRAY-QFULLP-OBUFFERS-INSTANCE DEQ-ITH-BUFFER
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-SVC-TYO-HANDLER-PATH4
          MAPUP-OS-STATUS-TABLE-OS-SVC-TYO-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-SVC-TYO-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-SVC-TYO-HANDLER-PATH4 OS-MESSAGE
          OS-CURRENT-OBUFFER OS-CURRENT-TASKID
          TM-CLOCK-OS-SVC-TYO-HANDLER-PATH4 TM-IPORTS-OS-SVC-TYO-HANDLER-PATH4
          TM-OPORTS-OS-SVC-TYO-HANDLER-PATH4
          TM-RWSTATE-OS-SVC-TYO-HANDLER-PATH4 TM-R3)
  (DISABLE PLUS TIMES)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER (ID (OS-CURRENT-TASKID OS)))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
                              (QUEUE (OS-CURRENT-OBUFFER (OS-CURRENT-TASKID OS)
                                                         OS))))
  (ENABLE-THEORY AK-SHELL GOOD-OS-PROPERTIES FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH4)

(PROVE-LEMMA CORRECTNESS-OF-OS-SVC-TYO-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (NOT (TM-ERRORP OS))
                                     (EQUAL (REMAINDER (TM-SVCID OS) '4)
                                            '2))))
                      (EQUAL (MAPUP-OS (OS-SVC-TYO-HANDLER OS))
                             (AK-EXECUTE-OUTPUT (OS-MESSAGE OS)
                                                (OS-CURRENT-TASKID OS)
                                                (MAPUP-OS OS))))
             ((ENABLE OS-SVC-TYO-HANDLER
                      CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH1
                      CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH2
                      CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH3
                      CORRECTNESS-OF-OS-SVC-TYO-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-SVC-TYO-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                OS-UPDATE-STATUS OS-WAITING-INPUT-HANDLER-PATH1 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1-CROCK
 (REWRITE)
 (EQUAL
  (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH1 OS))
  (CONS
   (GETNTH '0
           (GETSEG '0
                   '8
                   (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                           (TABLE '9 (OS-TASK-TABLE OS)))))
   (CONS
    (GETNTH '1
            (GETSEG '0
                    '8
                    (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TABLE '9 (OS-TASK-TABLE OS)))))
    (CONS
     (GETNTH '2
             (GETSEG '0
                     '8
                     (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TABLE '9 (OS-TASK-TABLE OS)))))
     (CONS
      (GETNTH '3
              (GETSEG '0
                      '8
                      (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                              (TABLE '9 (OS-TASK-TABLE OS)))))
      (CONS
       (GETNTH '4
               (GETSEG '0
                       '8
                       (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                               (TABLE '9 (OS-TASK-TABLE OS)))))
       (CONS
        (GETNTH '5
                (GETSEG '0
                        '8
                        (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                (TABLE '9 (OS-TASK-TABLE OS)))))
        (CONS
         (GETNTH '6
                 (GETSEG '0
                         '8
                         (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                 (TABLE '9 (OS-TASK-TABLE OS)))))
         (CONS
          (GETNTH '7
                  (GETSEG '0
                          '8
                          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '9 (OS-TASK-TABLE OS)))))
          (CONS
           (TM-PACK-PSW
            (TM-UNPACK-CC
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-ERROR
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCFLAG
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCID
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))))
           'NIL))))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 TM-UNPACK-CC TM-UNPACK-ERROR TM-UNPACK-SVCFLAG
          TM-UNPACK-SVCID)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH1 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-CPU FINITE-NUMBERP GETNTH-GETSEG
          GOOD-CPU-GETNTH LENGTH-OS-TASK-TABLE LENGTH-TABLE OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          REWRITE-GETNTH-FROM-TABLE
          TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (TM-WAITING OS)
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                 MAPUP-CPU NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH1
                 OS-CURRENT-TASKID
                 OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
                 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH1
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH1
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH1 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH1)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
   (QREPLACE-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-QREPLACE FINITE-NUMBERP
          LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS OS-IBUFFERS-ADDRESS-FACTS
          MAPUP-OS-IBUFFERS MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-LIST-PUTNTH OS-CURRENT-IBUFFER
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          QREPLACE-ITH-BUFFER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
  MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
           (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                  (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (MAPUP-QUEUE (OS-READYQ OS)))))
  ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  GROUND-ZERO)
   (USE (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH1 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    '0)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    '1000)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH1
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 AK-WAITING-TO-INPUTP-MAPUP-OS
 (REWRITE)
 (IMPLIES
   (AND (GOOD-OS OS)
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)))
   (AK-WAITING-TO-INPUTP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                         (MAPUP-OS OS)))
 ((ENABLE AK-WAITING-TO-INPUTP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE GOOD-TM-OS
          LENGTH-OS-STATUS-TABLE MAPUP-OS PLUS-0-ARG1)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE AK-WAITING-TO-INPUTP-MAPUP-OS)

(PROVE-LEMMA CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE
             (REWRITE)
             (IMPLIES (AND (ARRAY-QUEUEP QUEUE)
                           (EQUAL '4 (GETNTH '3 QUEUE)))
                      (EQUAL (ARRAY-QFULLP QUEUE)
                             (QFULLP (MAPUP-QUEUE QUEUE) '4)))
             ((USE (CORRECTNESS-OF-ARRAY-QFULLP (QUEUE QUEUE)
                                                (MAX '4)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH1 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH1 NOT-QEMPTYP-ENQ
          OS-CURRENT-IBUFFER TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH1
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH1
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH1
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                OS-UPDATE-STATUS OS-WAITING-INPUT-HANDLER-PATH2 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2-CROCK
 (REWRITE)
 (EQUAL
  (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH2 OS))
  (CONS
   (GETNTH '0
           (GETSEG '0
                   '8
                   (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                           (TABLE '9 (OS-TASK-TABLE OS)))))
   (CONS
    (GETNTH '1
            (GETSEG '0
                    '8
                    (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TABLE '9 (OS-TASK-TABLE OS)))))
    (CONS
     (GETNTH '2
             (GETSEG '0
                     '8
                     (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TABLE '9 (OS-TASK-TABLE OS)))))
     (CONS
      (GETNTH '3
              (GETSEG '0
                      '8
                      (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                              (TABLE '9 (OS-TASK-TABLE OS)))))
      (CONS
       (GETNTH '4
               (GETSEG '0
                       '8
                       (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                               (TABLE '9 (OS-TASK-TABLE OS)))))
       (CONS
        (GETNTH '5
                (GETSEG '0
                        '8
                        (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                (TABLE '9 (OS-TASK-TABLE OS)))))
        (CONS
         (GETNTH '6
                 (GETSEG '0
                         '8
                         (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                 (TABLE '9 (OS-TASK-TABLE OS)))))
         (CONS
          (GETNTH '7
                  (GETSEG '0
                          '8
                          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '9 (OS-TASK-TABLE OS)))))
          (CONS
           (TM-PACK-PSW
            (TM-UNPACK-CC
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-ERROR
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCFLAG
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCID
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))))
           'NIL))))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 TM-UNPACK-CC TM-UNPACK-ERROR TM-UNPACK-SVCFLAG
          TM-UNPACK-SVCID)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH2 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-CPU FINITE-NUMBERP GETNTH-GETSEG
          GOOD-CPU-GETNTH LENGTH-OS-TASK-TABLE LENGTH-TABLE OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          REWRITE-GETNTH-FROM-TABLE
          TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (TM-WAITING OS)
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                 MAPUP-CPU NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH2
                 OS-CURRENT-TASKID
                 OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
                 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH2
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH2
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH2 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH2
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH2)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
   (ENQ-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
  MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
           (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                  (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (MAPUP-QUEUE (OS-READYQ OS)))))
  ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  GROUND-ZERO)
   (USE (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH2 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2 PLISTP TABLE-PUTSEG
           OS-UPDATE-STATUS FINITE-NUMBERP LENGTH PLISTP)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES
                  FINITE-NUMBER-QUEUE-COROLLARIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH2
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH2 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH2 NOT-QEMPTYP-ENQ
          OS-CURRENT-IBUFFER TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH2
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH2
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH2
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                OS-UPDATE-STATUS OS-WAITING-INPUT-HANDLER-PATH3 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3-CROCK
 (REWRITE)
 (EQUAL
  (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH3 OS))
  (CONS
   (GETNTH '0
           (GETSEG '0
                   '8
                   (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                           (TABLE '9 (OS-TASK-TABLE OS)))))
   (CONS
    (GETNTH '1
            (GETSEG '0
                    '8
                    (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                            (TABLE '9 (OS-TASK-TABLE OS)))))
    (CONS
     (GETNTH '2
             (GETSEG '0
                     '8
                     (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TABLE '9 (OS-TASK-TABLE OS)))))
     (CONS
      (GETNTH '3
              (GETSEG '0
                      '8
                      (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                              (TABLE '9 (OS-TASK-TABLE OS)))))
      (CONS
       (GETNTH '4
               (GETSEG '0
                       '8
                       (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                               (TABLE '9 (OS-TASK-TABLE OS)))))
       (CONS
        (GETNTH '5
                (GETSEG '0
                        '8
                        (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                (TABLE '9 (OS-TASK-TABLE OS)))))
        (CONS
         (GETNTH '6
                 (GETSEG '0
                         '8
                         (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                 (TABLE '9 (OS-TASK-TABLE OS)))))
         (CONS
          (GETNTH '7
                  (GETSEG '0
                          '8
                          (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                  (TABLE '9 (OS-TASK-TABLE OS)))))
          (CONS
           (TM-PACK-PSW
            (TM-UNPACK-CC
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-ERROR
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCFLAG
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCID
             (GETNTH (PLUS '8
                           (TIMES '9
                                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
                     (OS-TASK-TABLE OS))))
           'NIL))))))))))
 ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 TM-UNPACK-CC TM-UNPACK-ERROR TM-UNPACK-SVCFLAG
          TM-UNPACK-SVCID)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-WAITING-INPUT-HANDLER-PATH3 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-CPU FINITE-NUMBERP GETNTH-GETSEG
          GOOD-CPU-GETNTH LENGTH-OS-TASK-TABLE LENGTH-TABLE OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          REWRITE-GETNTH-FROM-TABLE
          TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (TM-WAITING OS)
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                 MAPUP-CPU NOT-TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH3
                 OS-CURRENT-TASKID
                 OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
                 TM-CPU-OS-WAITING-INPUT-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH3
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH3
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH3 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH3)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
   (ENQ-ITH-BUFFER
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
  MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
           (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                  (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                       (MAPUP-QUEUE (OS-READYQ OS)))))
  ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  GROUND-ZERO)
   (USE (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-WAITING-INPUT-HANDLER-PATH3 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    '0)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    '1000)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH3
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH3 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH3 NOT-QEMPTYP-ENQ
          OS-CURRENT-IBUFFER TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH3
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH3
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH3
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH4 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                OS-WAITING-INPUT-HANDLER-PATH4 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CPU TASKID
                                        (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-CPU TASKID OS)))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                      MAPUP-CPU OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
                      TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH4
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH4 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH4)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
   (QREPLACE-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-QREPLACE FINITE-NUMBERP
          LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          QREPLACE-ITH-BUFFER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                    '1)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH4
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 NOT-AK-WAITING-TO-INPUTP-MAPUP-OS
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (NOT (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (NOT (AK-WAITING-TO-INPUTP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (MAPUP-OS OS))))
 ((ENABLE AK-WAITING-TO-INPUTP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE GOOD-TM-OS
          LENGTH-OS-STATUS-TABLE MAPUP-OS PLUS-0-ARG1)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NOT-AK-WAITING-TO-INPUTP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH4 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH4
          TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH4
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH4
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH4
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH5
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH5 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                OS-WAITING-INPUT-HANDLER-PATH5 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CPU TASKID
                                        (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-CPU TASKID OS)))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                      MAPUP-CPU OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
                      TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH5
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH5 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH5
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH5)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
   (ENQ-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                    '1)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH5
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH5 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH5
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH5
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH5
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH5
          TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH5
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH5
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH5
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH6
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-WAITING-INPUT-HANDLER-PATH6 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                OS-WAITING-INPUT-HANDLER-PATH6 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CPU TASKID
                                        (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-CPU TASKID OS)))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                      MAPUP-CPU OS-TASK-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
                      TM-WAITING-OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH6
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (TM-WAITING OS)
                               (AND (NUMBERP TASKID)
                                    (LESSP TASKID '16))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-CC-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-ERROR-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-LIMIT-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-REGS-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-SVCFLAG-OS-WAITING-INPUT-HANDLER-PATH6
                      MAPUP-SVCID-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-INPUT-HANDLER-PATH6 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH6
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
                    (EQUAL (MAPUP-OS-TASKS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-INPUT-HANDLER-PATH6)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
   (ENQ-ITH-BUFFER
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                    '1)
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
   TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH6
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-WAITING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER-PATH6 OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-UPDATE-IBUFFER AK-WAITING-INPUT-INTERRUPT-HANDLER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          MAPUP-OS-MBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          MAPUP-OS-OBUFFERS-OS-WAITING-INPUT-HANDLER-PATH6
          MAPUP-OS-TASKS-OS-WAITING-INPUT-HANDLER-PATH6
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-WAITING-INPUT-HANDLER-PATH6
          OS-STATUS-TABLE-OS-WAITING-INPUT-HANDLER-PATH6
          TM-CLOCK-OS-WAITING-INPUT-HANDLER-PATH6
          TM-IPORTS-OS-WAITING-INPUT-HANDLER-PATH6
          TM-OPORTS-OS-WAITING-INPUT-HANDLER-PATH6
          TM-RWSTATE-OS-WAITING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
            (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS (OS-WAITING-INPUT-HANDLER OS))
   (AK-WAITING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH1
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH2
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH3
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH4
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH5
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER-PATH6
          OS-WAITING-INPUT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                OS-NEW-TASK-TABLE OS-UPDATE-STATUS
                OS-RUNNING-INPUT-HANDLER-PATH1 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE
          LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CPU TASKID
                    (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-CPU TASKID OS)))
 ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE LENGTH-OS-TASK-TABLE
          LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH1 OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          PLISTP-TM-CPU TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-REGS TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-REGS TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CC TASKID
                   (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-CC TASKID OS)))
 ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-ERROR TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-ERROR TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCFLAG TASKID
                        (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-SVCFLAG TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCID TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-SVCID TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-SVCID)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-TASK TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-TASK TASKID OS)))
 ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (NUMBERP TASKID)))))
  (EQUAL (MAPUP-TASKS TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-TASKS TASKID OS)))
 ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH1 MAPUP-TASKS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
         (MAPUP-OS-TASKS OS)))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
   (QREPLACE-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-QREPLACE FINITE-NUMBERP
          LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          QREPLACE-ITH-BUFFER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
         (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
              (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH1 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH1 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH1
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH1 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH1
          OS-CURRENT-IBUFFER TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH1
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH1)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                OS-NEW-TASK-TABLE OS-UPDATE-STATUS
                OS-RUNNING-INPUT-HANDLER-PATH2 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE
          LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CPU TASKID
                    (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-CPU TASKID OS)))
 ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE LENGTH-OS-TASK-TABLE
          LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH2 OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          PLISTP-TM-CPU TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-REGS TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-REGS TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CC TASKID
                   (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-CC TASKID OS)))
 ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-ERROR TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-ERROR TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCFLAG TASKID
                        (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-SVCFLAG TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCID TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-SVCID TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-SVCID)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-TASK TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-TASK TASKID OS)))
 ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (NUMBERP TASKID)))))
  (EQUAL (MAPUP-TASKS TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-TASKS TASKID OS)))
 ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH2 MAPUP-TASKS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
         (MAPUP-OS-TASKS OS)))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
   (ENQ-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
         (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
              (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH2 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG PLISTP LENGTH)
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH2 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH2
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH2 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH2
          OS-CURRENT-IBUFFER TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH2
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH2)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                OS-NEW-TASK-TABLE OS-UPDATE-STATUS
                OS-RUNNING-INPUT-HANDLER-PATH3 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE
          LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CPU TASKID
                    (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-CPU TASKID OS)))
 ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE LENGTH-OS-TASK-TABLE
          LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
          NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH3 OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          PLISTP-TM-CPU TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-REGS TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-REGS TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CC TASKID
                   (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-CC TASKID OS)))
 ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-ERROR TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-ERROR TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCFLAG TASKID
                        (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-SVCFLAG TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCID TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-SVCID TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-SVCID)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (AND (NUMBERP TASKID)
                  (LESSP TASKID '16))))))
  (EQUAL (MAPUP-TASK TASKID
                     (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-TASK TASKID OS)))
 ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
        (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
        (AND (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5)
             (NUMBERP TASKID)))))
  (EQUAL (MAPUP-TASKS TASKID
                      (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-TASKS TASKID OS)))
 ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH3 MAPUP-TASKS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
         (MAPUP-OS-TASKS OS)))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
   (ENQ-ITH-BUFFER
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND (NOT (TM-WAITING OS))
        (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
             (EQUAL (GETNTH (TIMES '2
                                   (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                            (OS-STATUS-TABLE OS))
                    '5))))
  (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
         (ENQ (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
              (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (OS-WAITING-TO-INPUTP-IMPLIES-READYQ-NOT-FULL
                         (OS OS)
                         (DESTID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
  MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
           (EQUAL (TABLE '2
                         (OS-STATUS-TABLE (OS-RUNNING-INPUT-HANDLER-PATH3 OS)))
                  (PUTNTH '(0 0)
                          (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                          (TABLE '2 (OS-STATUS-TABLE OS)))))
  ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
           OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
   (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                  GROUND-ZERO)
   (USE (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS)))
   (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH3 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH3
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '5)
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH3 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH3
          OS-CURRENT-IBUFFER TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH3
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH3)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH4 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER
                OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH4 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE LENGTH-OS-TASK-TABLE LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE
                 LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH4
                 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4 PLISTP-TM-CPU
                 TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH4)
         (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                        GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH4
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (NOT (TM-WAITING OS))
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH4
                      MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH4 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
   (QREPLACE-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-QREPLACE FINITE-NUMBERP
          LENGTH-ARRAY-QREPLACE LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-IBUFFERS-WITH-QREPLACED-OVERFLOW-CHARACTER PLISTP-ARRAY-QREPLACE
          QREPLACE-ITH-BUFFER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (ARRAY-QFULLP-IMPLIES-NOT-ARRAY-QEMPTYP
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH4 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH4
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH4 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH4
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH4)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH5
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH5 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER
                OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH5 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE LENGTH-OS-TASK-TABLE LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
        MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE
                 LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH5
                 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5 PLISTP-TM-CPU
                 TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH5)
         (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                        GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH5
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (NOT (TM-WAITING OS))
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH5
                      MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH5 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
   (ENQ-ITH-BUFFER
    (TM-OVERFLOW-CHAR
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS))))
    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
    (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-IBUFFERS-WITH-ENQUEUED-OVERFLOW-CHARACTER PLISTP-ARRAY-ENQ
          TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (FINITE-NUMBERP-TM-OVERFLOW-CHAR
            (CHAR (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH5 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH5
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH5
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH5)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH5
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                        (TM-IPORTS OS)))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH5 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH5
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH5
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH5
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH5
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH5)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH5)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
       GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH6
       (REWRITE)
       (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
                (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY (OS-RUNNING-INPUT-HANDLER-PATH6 OS)))
                       (GETSEG (MAPUP-BASE TASKID OS)
                               (MAPUP-LIMIT TASKID OS)
                               (TM-MEMORY OS))))
       ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
                MAPUP-LIMIT OS-IBUFFERS-WITH-ENQUEUED-CHARACTER
                OS-NEW-TASK-TABLE OS-RUNNING-INPUT-HANDLER-PATH6 PLUS-EQUAL-0)
        (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                       OS-SEGMENT-LENGTHS GROUND-ZERO)
        (USE (DISJOINT-GETNTH (B '0)
                              (L '3311)
                              (I TASKID)
                              (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
             (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                 (OS OS))
             (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                  (OS OS)))
        (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
  (EQUAL (TM-CPU (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
         (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                 (TABLE '9
                        (OS-TASK-TABLE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE LENGTH-OS-TASK-TABLE LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
        MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE
                 LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-RUNNING-INPUT-HANDLER-PATH6
                 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6 PLISTP-TM-CPU
                 TABLE-PUTSEG TM-CPU-OS-RUNNING-INPUT-HANDLER-PATH6)
         (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                        GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
            MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH6
            (REWRITE)
            (IMPLIES (AND (GOOD-OS OS)
                          (AND (NOT (TM-WAITING OS))
                               (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                    (AND (NUMBERP TASKID)
                                         (LESSP TASKID '16)))))
                     (EQUAL (MAPUP-SVCFLAG TASKID
                                           (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                            (MAPUP-SVCFLAG TASKID OS)))
            ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-SVCFLAG)
             (ENABLE-THEORY GROUND-ZERO)
             (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-CC-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-ERROR-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-LIMIT-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-REGS-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-SVCFLAG-OS-RUNNING-INPUT-HANDLER-PATH6
                      MAPUP-SVCID-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-RUNNING-INPUT-HANDLER-PATH6 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
           MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))))
                    (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                           (MAPUP-OS-TASKS OS)))
           ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (NOT
     (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))))
  (EQUAL
   (MAPUP-OS-IBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
   (ENQ-ITH-BUFFER
                  (TM-ICHAR (GETNTH (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
                  (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                  (MAPUP-OS-IBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-ENQ ENQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-ARRAY-ENQ LENGTH-OS-IBUFFERS MAPUP-OS-IBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-IBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-IBUFFERS-WITH-ENQUEUED-CHARACTER PLISTP-ARRAY-ENQ TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                              (OS OS)
                              (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))))
   (GOOD-TM-IPORT-GETNTH-PROPERTIES
                             (TM OS)
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
        MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                        (MAPUP-OS-OBUFFERS OS)))
        ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
        MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
        (REWRITE)
        (IMPLIES (GOOD-OS OS)
                 (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                        (MAPUP-OS-MBUFFERS OS)))
        ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-INPUT-HANDLER-PATH6 TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
   TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH6
   (REWRITE)
   (EQUAL (TM-IPORTS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
          (TM-CLEAR-INPUT-INTERRUPT (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (TM-IPORTS OS)))
   ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
    (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
    (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH6
             (REWRITE)
             (EQUAL (TM-OPORTS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
                    (TM-OPORTS OS))
             ((ENABLE OS-RUNNING-INPUT-HANDLER-PATH6)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH6
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '5))
      (AND
       (NOT
        (ARRAY-QFULLP
                (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
       (NOT (TM-IPORT-ERRORP (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                             (TM-IPORTS OS))))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER-PATH6 OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-INPUT-INTERRUPT-HANDLER AK-UPDATE-IBUFFER
          AK-CLEAR-INPUT-INTERRUPT CORRECTNESS-OF-ARRAY-QEMPTYP
          CORRECTNESS-OF-ARRAY-QFULLP-IBUFFERS-INSTANCE FINITE-NUMBERP
          MAPUP-OS MAPUP-OS-IBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          MAPUP-OS-MBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          MAPUP-OS-OBUFFERS-OS-RUNNING-INPUT-HANDLER-PATH6
          MAPUP-OS-TASKS-OS-RUNNING-INPUT-HANDLER-PATH6
          MAPUP-QUEUE-GETNTH-FOR-IBUFFERS OS-CURRENT-IBUFFER
          OS-READYQ-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-STATUS-TABLE-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-CLOCK-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-IPORTS-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-OPORTS-OS-RUNNING-INPUT-HANDLER-PATH6
          TM-RWSTATE-OS-RUNNING-INPUT-HANDLER-PATH6)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-IBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-INPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-INPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-IBUFFERS
         (QUEUE (OS-CURRENT-IBUFFER (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-IBUFFER
                             (ID (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH6)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS))
            (NOT (TM-WAITING OS))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-INPUT-HANDLER OS))
   (AK-RUNNING-INPUT-INTERRUPT-HANDLER
                                    (TM-INTERRUPTING-INPUT-PORT (TM-IPORTS OS))
                                    (MAPUP-OS OS))))
 ((ENABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH1
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH2
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH3
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH4
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH5
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER-PATH6
          OS-RUNNING-INPUT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH1
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-UPDATE-STATUS OS-WAITING-OUTPUT-HANDLER-PATH1
               PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1-CROCK
 (REWRITE)
 (EQUAL
  (TM-CPU (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
  (CONS
   (GETNTH '0
           (GETSEG '0
                   '8
                   (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '9 (OS-TASK-TABLE OS)))))
   (CONS
    (GETNTH '1
            (GETSEG '0
                    '8
                    (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                            (TABLE '9 (OS-TASK-TABLE OS)))))
    (CONS
     (GETNTH '2
             (GETSEG '0
                     '8
                     (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TABLE '9 (OS-TASK-TABLE OS)))))
     (CONS
      (GETNTH '3
              (GETSEG '0
                      '8
                      (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                              (TABLE '9 (OS-TASK-TABLE OS)))))
      (CONS
       (GETNTH '4
               (GETSEG '0
                       '8
                       (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                               (TABLE '9 (OS-TASK-TABLE OS)))))
       (CONS
        (GETNTH '5
                (GETSEG '0
                        '8
                        (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                (TABLE '9 (OS-TASK-TABLE OS)))))
        (CONS
         (GETNTH '6
                 (GETSEG '0
                         '8
                         (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                 (TABLE '9 (OS-TASK-TABLE OS)))))
         (CONS
          (GETNTH '7
                  (GETSEG '0
                          '8
                          (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                  (TABLE '9 (OS-TASK-TABLE OS)))))
          (CONS
           (TM-PACK-PSW
            (TM-UNPACK-CC
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-ERROR
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCFLAG
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCID
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))))
           'NIL))))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 TM-UNPACK-CC TM-UNPACK-ERROR TM-UNPACK-SVCFLAG
          TM-UNPACK-SVCID)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
  (EQUAL
        (TM-CPU (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-CPU FINITE-NUMBERP GETNTH-GETSEG
          GOOD-CPU-GETNTH LENGTH-OS-TASK-TABLE LENGTH-TABLE OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
          REWRITE-GETNTH-FROM-TABLE
          TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
        MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (TM-WAITING OS)
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                 MAPUP-CPU NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH1
                 OS-CURRENT-TASKID
                 OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
                 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH1
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                   (AND (NUMBERP TASKID)
                                        (LESSP TASKID '16)))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH1
                      MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH1 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (TM-WAITING OS)
                             (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
                   (EQUAL (MAPUP-OS-TASKS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-OBUFFERS OS)))
       ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
          (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                 (ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
          (EQUAL (TABLE '2
                        (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS)))
                 (PUTNTH '(0 0)
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (TABLE '2 (OS-STATUS-TABLE OS)))))
 ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    '0)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    '1000)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (EQUAL (TM-OPORTS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
        (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TM-OPORTS OS)))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 AK-WAITING-TO-OUTPUTP-MAPUP-OS
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)))
  (AK-WAITING-TO-OUTPUTP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (MAPUP-OS OS)))
 ((ENABLE AK-WAITING-TO-OUTPUTP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE GOOD-TM-OS
          LENGTH-OS-STATUS-TABLE MAPUP-OS PLUS-0-ARG1)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE AK-WAITING-TO-OUTPUTP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-OUTPUT-HANDLER-PATH1 OS))
   (AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-WAITING-OUTPUT-INTERRUPT-HANDLER
          AK-CLEAR-OUTPUT-INTERRUPT AK-START-OUTPUT
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH1
          NOT-QEMPTYP-ENQ OS-CURRENT-OBUFFER
          TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH1
          TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1
          TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH1
          TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH2
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
               OS-UPDATE-STATUS OS-WAITING-OUTPUT-HANDLER-PATH2 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2-CROCK
 (REWRITE)
 (EQUAL
  (TM-CPU (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
  (CONS
   (GETNTH '0
           (GETSEG '0
                   '8
                   (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                           (TABLE '9 (OS-TASK-TABLE OS)))))
   (CONS
    (GETNTH '1
            (GETSEG '0
                    '8
                    (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                            (TABLE '9 (OS-TASK-TABLE OS)))))
    (CONS
     (GETNTH '2
             (GETSEG '0
                     '8
                     (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                             (TABLE '9 (OS-TASK-TABLE OS)))))
     (CONS
      (GETNTH '3
              (GETSEG '0
                      '8
                      (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                              (TABLE '9 (OS-TASK-TABLE OS)))))
      (CONS
       (GETNTH '4
               (GETSEG '0
                       '8
                       (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                               (TABLE '9 (OS-TASK-TABLE OS)))))
       (CONS
        (GETNTH '5
                (GETSEG '0
                        '8
                        (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                (TABLE '9 (OS-TASK-TABLE OS)))))
        (CONS
         (GETNTH '6
                 (GETSEG '0
                         '8
                         (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                 (TABLE '9 (OS-TASK-TABLE OS)))))
         (CONS
          (GETNTH '7
                  (GETSEG '0
                          '8
                          (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                  (TABLE '9 (OS-TASK-TABLE OS)))))
          (CONS
           (TM-PACK-PSW
            (TM-UNPACK-CC
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-ERROR
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCFLAG
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS)))
            (TM-UNPACK-SVCID
             (GETNTH
                    (PLUS '8
                          (TIMES '9
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))))
                    (OS-TASK-TABLE OS))))
           'NIL))))))))))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
          TM-R5 TM-R6 TM-R7 TM-UNPACK-CC TM-UNPACK-ERROR TM-UNPACK-SVCFLAG
          TM-UNPACK-SVCID)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-WAITING OS)
            (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
  (EQUAL
        (TM-CPU (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ1 CONTRACT-CPU FINITE-NUMBERP GETNTH-GETSEG
          GOOD-CPU-GETNTH LENGTH-OS-TASK-TABLE LENGTH-TABLE OS-CURRENT-TASKID
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
          REWRITE-GETNTH-FROM-TABLE
          TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
        MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (TM-WAITING OS)
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                 MAPUP-CPU NOT-TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH2
                 OS-CURRENT-TASKID
                 OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
                 TM-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2)
         (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH2
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                   (AND (NUMBERP TASKID)
                                        (LESSP TASKID '16)))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH2
                      MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH2 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (TM-WAITING OS)
                             (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
                   (EQUAL (MAPUP-OS-TASKS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
         (DEQ-ITH-BUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-DEQ DEQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-OS-OBUFFERS MAPUP-OS-OBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-OBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
          (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                 (ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                      (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (ARRAY-QEMPTYP-IMPLIES-NOT-ARRAY-QFULLP (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
          (EQUAL (TABLE '2
                        (OS-STATUS-TABLE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS)))
                 (PUTNTH '(0 0)
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (TABLE '2 (OS-STATUS-TABLE OS)))))
 ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    '0)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    '1000)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL
   (TM-OPORTS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
   (TM-START-OUTPUT
                   (QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS-OBUFFERS OS)))
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                   (TM-OPORTS OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP GETNTH-MAPUP-QUEUE-LIST
          LENGTH-OS-OBUFFERS LENGTH-TABLE MAPUP-OS-OBUFFERS OS-CURRENT-OBUFFER
          OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-OUTPUT-HANDLER-PATH2 OS))
   (AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-WAITING-OUTPUT-INTERRUPT-HANDLER
          AK-CLEAR-OUTPUT-INTERRUPT AK-START-OUTPUT
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH2
          NOT-QEMPTYP-ENQ OS-CURRENT-OBUFFER
          TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH2
          TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2
          TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH2
          TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH3
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-WAITING-OUTPUT-HANDLER-PATH3 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CPU TASKID
                                        (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-CPU TASKID OS)))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                      MAPUP-CPU OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
                      TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (AND (NUMBERP TASKID)
                                   (LESSP TASKID '16))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH3
                      MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH3 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
                   (EQUAL (MAPUP-OS-TASKS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-OBUFFERS OS)))
       ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                    '1)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (EQUAL (TM-OPORTS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
        (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TM-OPORTS OS)))
 ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (NOT (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (NOT (AK-WAITING-TO-OUTPUTP (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                              (MAPUP-OS OS))))
 ((ENABLE AK-WAITING-TO-OUTPUTP COMMUTATIVITY-OF-PLUS COMMUTATIVITY-OF-TIMES
          FINITE-NUMBERP GETNTH-GETSEG GETNTH-TABLE GOOD-TM-OS
          LENGTH-OS-STATUS-TABLE MAPUP-OS PLUS-0-ARG1)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE PLUS TIMES)
  (ENABLE-THEORY AK-SHELL GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-OUTPUT-HANDLER-PATH3 OS))
   (AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-WAITING-OUTPUT-INTERRUPT-HANDLER
          AK-CLEAR-OUTPUT-INTERRUPT AK-START-OUTPUT
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS OS-CURRENT-OBUFFER
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH3
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH3
          TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH4
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-WAITING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
               OS-WAITING-OUTPUT-HANDLER-PATH4 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CPU TASKID
                                        (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-CPU TASKID OS)))
             ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-TABLE LENGTH-OS-TASK-TABLE
                      MAPUP-CPU OS-TASK-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
                      TM-WAITING-OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (TM-WAITING OS)
                              (AND (NUMBERP TASKID)
                                   (LESSP TASKID '16))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-CC-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-ERROR-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-LIMIT-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-REGS-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-WAITING-OUTPUT-HANDLER-PATH4
                      MAPUP-SVCID-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (TM-WAITING OS)
                                (NUMBERP TASKID)))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-WAITING-OUTPUT-HANDLER-PATH4 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS) (TM-WAITING OS))
                   (EQUAL (MAPUP-OS-TASKS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (MAPUP-OS-OBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
         (DEQ-ITH-BUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-DEQ DEQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-OS-OBUFFERS MAPUP-OS-OBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-OBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-RWSTATE (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                    '1)
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-WAITING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL
   (TM-OPORTS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
   (TM-START-OUTPUT
                   (QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS-OBUFFERS OS)))
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                   (TM-OPORTS OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP GETNTH-MAPUP-QUEUE-LIST
          LENGTH-OS-OBUFFERS LENGTH-TABLE MAPUP-OS-OBUFFERS OS-CURRENT-OBUFFER
          OS-WAITING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (TM-WAITING OS)
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL
   (MAPUP-OS (OS-WAITING-OUTPUT-HANDLER-PATH4 OS))
   (AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-DISPATCHER AK-WAITING-OUTPUT-INTERRUPT-HANDLER
          AK-CLEAR-OUTPUT-INTERRUPT AK-START-OUTPUT
          CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-WAITING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-WAITING-OUTPUT-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS OS-CURRENT-OBUFFER
          OS-READYQ-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-CLOCK-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-IPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-OPORTS-OS-WAITING-OUTPUT-HANDLER-PATH4
          TM-RWSTATE-OS-WAITING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (TM-WAITING OS)))
  (EQUAL
   (MAPUP-OS (OS-WAITING-OUTPUT-HANDLER OS))
   (AK-WAITING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH1
          CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH2
          CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH3
          CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER-PATH4
          OS-WAITING-OUTPUT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH1
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-NEW-TASK-TABLE OS-UPDATE-STATUS
               OS-RUNNING-OUTPUT-HANDLER-PATH1 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL
        (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE
          LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CPU TASKID
                    (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-CPU TASKID OS)))
 ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE LENGTH-OS-TASK-TABLE
          LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
          NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH1 OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          PLISTP-TM-CPU TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-REGS TASKID
                     (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-REGS TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CC TASKID
                   (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-CC TASKID OS)))
 ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-ERROR TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-ERROR TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCFLAG TASKID
                        (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-SVCFLAG TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCID TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-SVCID TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-SVCID)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-TASK TASKID
                     (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-TASK TASKID OS)))
 ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (NUMBERP TASKID)))))
  (EQUAL (MAPUP-TASKS TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-TASKS TASKID OS)))
 ((ENABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH1 MAPUP-TASKS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
         (MAPUP-OS-TASKS OS)))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-OBUFFERS OS)))
       ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
         (ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
              (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
          (EQUAL (TABLE '2
                        (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS)))
                 (PUTNTH '(0 0)
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (TABLE '2 (OS-STATUS-TABLE OS)))))
 ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-OUTPUT-HANDLER-PATH1
                      TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (EQUAL (TM-OPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
        (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TM-OPORTS OS)))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH1
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-OUTPUT-HANDLER-PATH1 OS))
   (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-CLEAR-OUTPUT-INTERRUPT
          AK-START-OUTPUT CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH1
          OS-CURRENT-OBUFFER TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH1
          TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH1
          TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH1)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH1)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH2
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-NEW-TASK-TABLE
               OS-OBUFFERS-WITH-DEQUEUED-CHARACTER OS-UPDATE-STATUS
               OS-RUNNING-OUTPUT-HANDLER-PATH2 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL
        (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))))))
 ((ENABLE ARRAY-QFIRST-ARRAY-ENQ FINITE-NUMBERP GETNTH-PUTNTH-COINCIDENCE
          LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CPU TASKID
                    (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-CPU TASKID OS)))
 ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
          GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE LENGTH-OS-TASK-TABLE
          LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
          NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH2 OS-CURRENT-TASKID
          OS-NEW-TASK-TABLE OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          PLISTP-TM-CPU TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                     (J (ARRAY-QFIRST (OS-READYQ OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-REGS TASKID
                     (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-REGS TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-REGS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-CC TASKID
                   (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-CC TASKID OS)))
 ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-ERROR TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-ERROR TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-ERROR)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCFLAG TASKID
                        (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-SVCFLAG TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-SVCFLAG)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-SVCID TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-SVCID TASKID OS)))
 ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-SVCID)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (AND (NUMBERP TASKID)
                 (LESSP TASKID '16))))))
  (EQUAL (MAPUP-TASK TASKID
                     (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-TASK TASKID OS)))
 ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-ADDRESS-SPACE
          MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-TASK
          NUMBERP-MAPUP-LIMIT)
  (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (NOT (TM-WAITING OS))
    (AND
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
       (AND (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4)
            (NUMBERP TASKID)))))
  (EQUAL (MAPUP-TASKS TASKID
                      (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-TASKS TASKID OS)))
 ((ENABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH2 MAPUP-TASKS)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (MAPUP-OS-TASKS OS)))
 ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
         (DEQ-ITH-BUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-DEQ DEQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-OS-OBUFFERS MAPUP-OS-OBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-OBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
       (NOT (TM-WAITING OS))
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (EQUAL (GETNTH (TIMES '2
                                  (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                           (OS-STATUS-TABLE OS))
                   '4))))
  (EQUAL (MAPUP-QUEUE (OS-READYQ (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
         (ENQ (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
              (MAPUP-QUEUE (OS-READYQ OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-ENQ OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (OS-WAITING-TO-OUTPUTP-IMPLIES-READYQ-NOT-FULL
                        (OS OS)
                        (DESTID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES (AND (GOOD-OS OS)
               (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
          (EQUAL (TABLE '2
                        (OS-STATUS-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS)))
                 (PUTNTH '(0 0)
                         (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (TABLE '2 (OS-STATUS-TABLE OS)))))
 ((ENABLE FINITE-NUMBERP OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          OS-UPDATE-STATUS PLISTP TABLE-PUTSEG LENGTH PLISTP)
  (ENABLE-THEORY EXECUTABLE-THEORY GOOD-OS-PROPERTIES OS-SEGMENT-LENGTHS
                 GROUND-ZERO)
  (USE (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS)))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-OUTPUT-HANDLER-PATH2
                      TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH2)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL
   (TM-OPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
   (TM-START-OUTPUT
                   (QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS-OBUFFERS OS)))
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                   (TM-OPORTS OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP GETNTH-MAPUP-QUEUE-LIST
          LENGTH-OS-OBUFFERS LENGTH-TABLE MAPUP-OS-OBUFFERS OS-CURRENT-OBUFFER
          OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY TM-SHELLS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH2
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (EQUAL (GETNTH (TIMES '2
                            (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                     (OS-STATUS-TABLE OS))
             '4)
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-OUTPUT-HANDLER-PATH2 OS))
   (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-CLEAR-OUTPUT-INTERRUPT
          AK-START-OUTPUT CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS
          MAPUP-QUEUE-OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH2
          OS-CURRENT-OBUFFER TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH2
          TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH2
          TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH2)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH2)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH3
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-NEW-TASK-TABLE OS-RUNNING-OUTPUT-HANDLER-PATH3
               PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
  (EQUAL
        (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE LENGTH-OS-TASK-TABLE LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
        MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE
                 LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH3
                 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3 PLISTP-TM-CPU
                 TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3)
         (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                        GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH3
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                   (AND (NUMBERP TASKID)
                                        (LESSP TASKID '16)))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH3
                      MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH3 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
                   (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-OBUFFERS OS)))
       ((ENABLE MAPUP-OS-OBUFFERS OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-OUTPUT-HANDLER-PATH3
                      TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (EQUAL (TM-OPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
        (TM-CLEAR-OUTPUT-INTERRUPT (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (TM-OPORTS OS)))
 ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH3
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-OUTPUT-HANDLER-PATH3 OS))
   (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-CLEAR-OUTPUT-INTERRUPT
          AK-START-OUTPUT CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS OS-CURRENT-OBUFFER
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH3
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH3
          TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH3)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH3)

(PROVE-LEMMA MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-BASE TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-BASE TASKID OS)))
             ((ENABLE MAPUP-BASE
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-LIMIT TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-LIMIT TASKID OS)))
             ((ENABLE MAPUP-LIMIT
                      OS-SEGMENT-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
      GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH4
      (REWRITE)
      (IMPLIES (AND (GOOD-OS OS) (LESSP TASKID '16))
               (EQUAL (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS)))
                      (GETSEG (MAPUP-BASE TASKID OS)
                              (MAPUP-LIMIT TASKID OS)
                              (TM-MEMORY OS))))
      ((ENABLE DISJOINT GETSEG-OF-LENGTH-ZERO LENGTH-TABLE MAPUP-BASE
               MAPUP-LIMIT OS-NEW-TASK-TABLE
               OS-OBUFFERS-WITH-DEQUEUED-CHARACTER
               OS-RUNNING-OUTPUT-HANDLER-PATH4 PLUS-EQUAL-0)
       (ENABLE-THEORY TM-SHELLS ACCESS-OS-MEMORY GOOD-OS-PROPERTIES1
                      OS-SEGMENT-LENGTHS GROUND-ZERO)
       (USE (DISJOINT-GETNTH (B '0)
                             (L '3311)
                             (I TASKID)
                             (TABLE (TABLE '2 (OS-SEGMENT-TABLE OS))))
            (NUMBERP-MAPUP-BASE (TASKID TASKID)
                                (OS OS))
            (NUMBERP-MAPUP-LIMIT (TASKID TASKID)
                                 (OS OS)))
       (DISABLE-THEORY T)))

(DISABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4-CROCK
             (REWRITE)
             (EQUAL (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-CPU OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4 TM-CPU TM-R0 TM-R1 TM-R2
                      TM-R3 TM-R4 TM-R5 TM-R6 TM-R7)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4-CROCK)

(PROVE-LEMMA
 TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (NOT (TM-WAITING OS))
            (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
  (EQUAL
        (TM-CPU (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
        (GETNTH (OS-CURRENT-TASKID (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                (TABLE '9
                       (OS-TASK-TABLE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))))))
 ((ENABLE GETNTH-PUTNTH-COINCIDENCE LENGTH-OS-TASK-TABLE LENGTH-TABLE
          LENGTH-TM-CPU OS-CURRENT-TASKID OS-NEW-TASK-TABLE
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4 PLISTP-TM-CPU
          TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4-CROCK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
        MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4
        (REWRITE)
        (IMPLIES (AND (GOOD-OS OS)
                      (AND (NOT (TM-WAITING OS))
                           (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                (AND (NUMBERP TASKID)
                                     (LESSP TASKID '16)))))
                 (EQUAL (MAPUP-CPU TASKID
                                   (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                        (MAPUP-CPU TASKID OS)))
        ((ENABLE COMMUTATIVITY-OF-TIMES GETNTH-PUTNTH-COINCIDENCE
                 GETNTH-PUTNTH-NON-INTERFERENCE GETNTH-TABLE
                 LENGTH-OS-TASK-TABLE LENGTH-TABLE LENGTH-TM-CPU MAPUP-CPU
                 NOT-TM-WAITING-OS-RUNNING-OUTPUT-HANDLER-PATH4
                 OS-CURRENT-TASKID OS-NEW-TASK-TABLE
                 OS-TASK-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4 PLISTP-TM-CPU
                 TABLE-PUTSEG TM-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4)
         (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                        GROUND-ZERO)
         (USE (INTEGER-INEQUALITY-CASESPLIT (I TASKID)
                                            (J (ARRAY-QFIRST (OS-READYQ OS)))))
         (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-REGS TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-REGS TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-REGS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-CC TASKID
                                       (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-CC TASKID OS)))
             ((ENABLE MAPUP-CC MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-ERROR TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-ERROR TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-ERROR)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
           MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH4
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (AND (NOT (TM-WAITING OS))
                              (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                   (AND (NUMBERP TASKID)
                                        (LESSP TASKID '16)))))
                    (EQUAL (MAPUP-SVCFLAG TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                           (MAPUP-SVCFLAG TASKID OS)))
           ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-SVCFLAG)
            (ENABLE-THEORY GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-SVCID TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-SVCID TASKID OS)))
             ((ENABLE MAPUP-CPU-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-SVCID)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (AND (NUMBERP TASKID)
                                          (LESSP TASKID '16)))))
                      (EQUAL (MAPUP-TASK TASKID
                                         (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASK TASKID OS)))
             ((ENABLE GETSEG-TM-MEMORY-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-ADDRESS-SPACE
                      MAPUP-BASE-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-CC-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-ERROR-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-LIMIT-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-REGS-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-SVCFLAG-OS-RUNNING-OUTPUT-HANDLER-PATH4
                      MAPUP-SVCID-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-TASK
                      NUMBERP-MAPUP-LIMIT)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
                                     (NUMBERP TASKID))))
                      (EQUAL (MAPUP-TASKS TASKID
                                          (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (MAPUP-TASKS TASKID OS)))
             ((ENABLE MAPUP-TASK-OS-RUNNING-OUTPUT-HANDLER-PATH4 MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          (REWRITE)
          (IMPLIES (AND (GOOD-OS OS)
                        (AND (NOT (TM-WAITING OS))
                             (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))))
                   (EQUAL (MAPUP-OS-TASKS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                          (MAPUP-OS-TASKS OS)))
          ((ENABLE MAPUP-OS-TASKS MAPUP-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4)
           (ENABLE-THEORY GROUND-ZERO)
           (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-IBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                       (MAPUP-OS-IBUFFERS OS)))
       ((ENABLE MAPUP-OS-IBUFFERS OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL (MAPUP-OS-OBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
         (DEQ-ITH-BUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                         (MAPUP-OS-OBUFFERS OS))))
 ((ENABLE COMMUTATIVITY-OF-PLUS CORRECTNESS-OF-ARRAY-DEQ DEQ-ITH-BUFFER
          FINITE-NUMBERP LENGTH-OS-OBUFFERS MAPUP-OS-OBUFFERS
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS MAPUP-QUEUE-LIST-PUTNTH
          OS-CURRENT-OBUFFER OS-IBUFFERS-ADDRESS-FACTS
          OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-OBUFFERS-WITH-DEQUEUED-CHARACTER TABLE-PUTSEG)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
       MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
       (REWRITE)
       (IMPLIES (GOOD-OS OS)
                (EQUAL (MAPUP-OS-MBUFFERS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                       (MAPUP-OS-MBUFFERS OS)))
       ((ENABLE MAPUP-OS-MBUFFERS OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)
        (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
        (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (IMPLIES (AND (GOOD-TM OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (TM-RWSTATE (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                             (TM-RWSTATE OS)))
             ((ENABLE FINITE-NUMBERP OS-RUNNING-OUTPUT-HANDLER-PATH4
                      TM-WAITING)
              (USE (FINITE-NUMBERP-TM-RWSTATE (TM OS)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-CLOCK (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-CLOCK OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4
             (REWRITE)
             (EQUAL (TM-IPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
                    (TM-IPORTS OS))
             ((ENABLE OS-RUNNING-OUTPUT-HANDLER-PATH4)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (NOT
     (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))
  (EQUAL
   (TM-OPORTS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
   (TM-START-OUTPUT
                   (QFIRST (GETNTH (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS-OBUFFERS OS)))
                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                   (TM-OPORTS OS))))
 ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST FINITE-NUMBERP GETNTH-MAPUP-QUEUE-LIST
          LENGTH-OS-OBUFFERS LENGTH-TABLE MAPUP-OS-OBUFFERS OS-CURRENT-OBUFFER
          OS-RUNNING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY TM-SHELLS FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (OS OS)
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH4
 (REWRITE)
 (IMPLIES
  (AND
   (GOOD-OS OS)
   (AND
    (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
    (AND
     (NOT (TM-WAITING OS))
     (AND
      (NOT (EQUAL (GETNTH (TIMES '2
                                 (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))
                          (OS-STATUS-TABLE OS))
                  '4))
      (NOT
       (ARRAY-QEMPTYP
               (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-OUTPUT-HANDLER-PATH4 OS))
   (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE AK-RUNNING-OUTPUT-INTERRUPT-HANDLER AK-CLEAR-OUTPUT-INTERRUPT
          AK-START-OUTPUT CORRECTNESS-OF-ARRAY-QEMPTYP FINITE-NUMBERP MAPUP-OS
          MAPUP-OS-IBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-MBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-OBUFFERS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          MAPUP-OS-TASKS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          MAPUP-QUEUE-GETNTH-FOR-OBUFFERS OS-CURRENT-OBUFFER
          OS-READYQ-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-STATUS-TABLE-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-CLOCK-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-IPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-OPORTS-OS-RUNNING-OUTPUT-HANDLER-PATH4
          TM-RWSTATE-OS-RUNNING-OUTPUT-HANDLER-PATH4)
  (ENABLE-THEORY AK-SHELL FINITE-NUMBER-QUEUE-COROLLARIES
                 FINITE-NUMBER-QUEUE-COROLLARIES-FOR-OBUFFERS
                 GOOD-OS-PROPERTIES GROUND-ZERO)
  (USE
   (TM-WAITING-IFF-ARRAY-QEMPTYP-OS-READYQ (OS OS))
   (NOT-AK-WAITING-TO-OUTPUTP-MAPUP-OS (OS OS))
   (FINITE-NUMBERP-TM-INTERRUPTING-OUTPUT-PORT (TM OS))
   (ARRAY-QUEUEP-FINITE-NUMBER-QUEUE-COROLLARY-FOR-OBUFFERS
        (QUEUE (OS-CURRENT-OBUFFER (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   OS)))
   (FINITE-NUMBER-QUEUEP-CURRENT-OBUFFER
                            (ID (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS)))))
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH4)

(PROVE-LEMMA
 CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (AND (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS))
            (NOT (TM-WAITING OS))))
  (EQUAL
   (MAPUP-OS (OS-RUNNING-OUTPUT-HANDLER OS))
   (AK-RUNNING-OUTPUT-INTERRUPT-HANDLER
                                   (TM-INTERRUPTING-OUTPUT-PORT (TM-OPORTS OS))
                                   (MAPUP-OS OS))))
 ((ENABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH1
          CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH2
          CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH3
          CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER-PATH4
          OS-RUNNING-OUTPUT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER)

(PROVE-LEMMA
    TM-SVCID-MAPUP-TASK
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TM-SVCID (MAPUP-TASK (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          OS))
                    (TM-SVCID OS)))
    ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST MAPUP-ADDRESS-SPACE MAPUP-CPU
             MAPUP-SVCID MAPUP-TASK OPEN-UP-GETNTH OPEN-UP-GETNTH-ON-ZERO
             OS-CURRENT-TASKID TM-CPU TM-UNPACK-SVCID-TM-PACK-PSW TM-SVCID-TM)
     (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                    GOOD-TM-PROPERTIES GROUND-ZERO)
     (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
     (DISABLE-THEORY T)))

(DISABLE TM-SVCID-MAPUP-TASK)

(PROVE-LEMMA GETNTH-MAPUP-TASKS-COROLLARY
             (REWRITE)
             (IMPLIES (AND (LESSP I '16) (NUMBERP I))
                      (EQUAL (GETNTH I (MAPUP-TASKS '0 OS))
                             (MAPUP-TASK I OS)))
             ((USE (GETNTH-MAPUP-TASKS (I I) (J '0)))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE GETNTH-MAPUP-TASKS-COROLLARY)

(PROVE-LEMMA
     TM-SVCID-MAPUP-OS-TASKS
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-SVCID (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                       (MAPUP-OS-TASKS OS)))
                     (TM-SVCID OS)))
     ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST GETNTH-MAPUP-TASKS-COROLLARY
              MAPUP-OS-TASKS TM-SVCID-MAPUP-TASK)
      (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                     GROUND-ZERO)
      (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
      (DISABLE-THEORY T)))

(DISABLE TM-SVCID-MAPUP-OS-TASKS)

(PROVE-LEMMA
           TM-SVCID-GETNTH-AK-PSTATES
           (REWRITE)
           (IMPLIES (AND (GOOD-OS OS)
                         (NOT (TM-WAITING OS)))
                    (EQUAL (TM-SVCID (GETNTH (QFIRST (AK-READYQ (MAPUP-OS OS)))
                                             (AK-PSTATES (MAPUP-OS OS))))
                           (TM-SVCID OS)))
           ((ENABLE MAPUP-OS TM-SVCID-MAPUP-OS-TASKS)
            (ENABLE-THEORY AK-SHELL GROUND-ZERO)
            (DISABLE-THEORY T)))

(DISABLE TM-SVCID-GETNTH-AK-PSTATES)

(PROVE-LEMMA
     TM-REGS-MAPUP-TASK
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-REGS (MAPUP-TASK (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          OS))
                     (TM-REGS OS)))
     ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST MAPUP-ADDRESS-SPACE MAPUP-CPU
              MAPUP-REGS MAPUP-TASK OS-CURRENT-TASKID TM-REGS-TM)
      (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                     GOOD-TM-PROPERTIES GROUND-ZERO)
      (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
      (DISABLE-THEORY T)))

(DISABLE TM-REGS-MAPUP-TASK)

(PROVE-LEMMA
     TM-REGS-MAPUP-OS-TASKS
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-REGS (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                      (MAPUP-OS-TASKS OS)))
                     (TM-REGS OS)))
     ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST GETNTH-MAPUP-TASKS-COROLLARY
              MAPUP-OS-TASKS TM-REGS-MAPUP-TASK)
      (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                     GROUND-ZERO)
      (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
      (DISABLE-THEORY T)))

(DISABLE TM-REGS-MAPUP-OS-TASKS)

(PROVE-LEMMA
         TM-REGS-GETNTH-AK-PSTATES
         (REWRITE)
         (IMPLIES (AND (GOOD-OS OS)
                       (NOT (TM-WAITING OS)))
                  (AND (EQUAL (TM-R2 (GETNTH (QFIRST (AK-READYQ (MAPUP-OS OS)))
                                             (AK-PSTATES (MAPUP-OS OS))))
                              (TM-R2 OS))
                       (EQUAL (TM-R3 (GETNTH (QFIRST (AK-READYQ (MAPUP-OS OS)))
                                             (AK-PSTATES (MAPUP-OS OS))))
                              (TM-R3 OS))))
         ((ENABLE TM-R2 TM-R3 MAPUP-OS TM-REGS-MAPUP-OS-TASKS AK-PSTATES-AK
                  AK-READYQ-AK)
          (ENABLE-THEORY GROUND-ZERO)
          (DISABLE-THEORY T)))

(DISABLE TM-REGS-GETNTH-AK-PSTATES)

(PROVE-LEMMA AK-READYQ-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-QUEUE (OS-READYQ OS))
                             (AK-READYQ (MAPUP-OS OS))))
             ((ENABLE MAPUP-OS AK-READYQ-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-READYQ-MAPUP-OS)

(PROVE-LEMMA CORRECTNESS-OF-SVC-HANDLER
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (AND (NOT (TM-WAITING OS))
                                (NOT (TM-ERRORP OS))))
                      (EQUAL (MAPUP-OS (OS-SVC-HANDLER OS))
                             (AK-SVC-HANDLER (MAPUP-OS OS))))
             ((ENABLE AK-DESTID AK-MESSAGE AK-READYQ-MAPUP-OS
                      AK-RECEIVE-INSTRUCTIONP AK-SEND-INSTRUCTIONP AK-SRCID
                      AK-SVC-HANDLER AK-TASKID AK-TYO-INSTRUCTIONP
                      CORRECTNESS-OF-ARRAY-QFIRST
                      CORRECTNESS-OF-OS-SVC-RECEIVE-HANDLER
                      CORRECTNESS-OF-OS-SVC-SEND-HANDLER
                      CORRECTNESS-OF-OS-SVC-TYI-HANDLER
                      CORRECTNESS-OF-OS-SVC-TYO-HANDLER OS-CURRENT-TASKID
                      OS-DESTID OS-MESSAGE OS-SRCID OS-SVC-HANDLER
                      REMAINDER-4-EQUALS-3 TM-REGS-GETNTH-AK-PSTATES
                      TM-SVCID-GETNTH-AK-PSTATES)
              (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES
                             GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-SVC-HANDLER)

(PROVE-LEMMA AK-WAITING-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-WAITING (MAPUP-OS OS))
                             (TM-WAITING OS)))
             ((ENABLE AK-WAITING MAPUP-OS TM-WAITING AK-RWSTATE-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-WAITING-MAPUP-OS)

(PROVE-LEMMA AK-IPORTS-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-IPORTS (MAPUP-OS OS))
                             (TM-IPORTS OS)))
             ((ENABLE MAPUP-OS AK-IPORTS-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-IPORTS-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-INPUT-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-INPUT-INTERRUPTP (TM-IPORTS OS)))
  (EQUAL
   (MAPUP-OS (OS-INPUT-INTERRUPT-HANDLER OS))
   (AK-INPUT-INTERRUPT-HANDLER
                         (TM-INTERRUPTING-INPUT-PORT (AK-IPORTS (MAPUP-OS OS)))
                         (MAPUP-OS OS))))
 ((ENABLE AK-INPUT-INTERRUPT-HANDLER AK-IPORTS-MAPUP-OS AK-WAITING-MAPUP-OS
          CORRECTNESS-OF-OS-RUNNING-INPUT-HANDLER
          CORRECTNESS-OF-OS-WAITING-INPUT-HANDLER OS-INPUT-INTERRUPT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-INPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA AK-OPORTS-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-OPORTS (MAPUP-OS OS))
                             (TM-OPORTS OS)))
             ((ENABLE MAPUP-OS AK-OPORTS-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-OPORTS-MAPUP-OS)

(PROVE-LEMMA
 CORRECTNESS-OF-OUTPUT-INTERRUPT-HANDLER
 (REWRITE)
 (IMPLIES
  (AND (GOOD-OS OS)
       (TM-SOME-OUTPUT-INTERRUPTP (TM-OPORTS OS)))
  (EQUAL
   (MAPUP-OS (OS-OUTPUT-INTERRUPT-HANDLER OS))
   (AK-OUTPUT-INTERRUPT-HANDLER
                        (TM-INTERRUPTING-OUTPUT-PORT (AK-OPORTS (MAPUP-OS OS)))
                        (MAPUP-OS OS))))
 ((ENABLE AK-OPORTS-MAPUP-OS AK-OUTPUT-INTERRUPT-HANDLER AK-WAITING-MAPUP-OS
          CORRECTNESS-OF-OS-RUNNING-OUTPUT-HANDLER
          CORRECTNESS-OF-OS-WAITING-OUTPUT-HANDLER OS-OUTPUT-INTERRUPT-HANDLER)
  (ENABLE-THEORY GROUND-ZERO)
  (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OUTPUT-INTERRUPT-HANDLER)

(PROVE-LEMMA
    TM-ERROR-MAPUP-TASK
    (REWRITE)
    (IMPLIES (AND (GOOD-OS OS)
                  (NOT (TM-WAITING OS)))
             (EQUAL (TM-ERROR (MAPUP-TASK (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          OS))
                    (TM-ERROR OS)))
    ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST MAPUP-ADDRESS-SPACE MAPUP-CPU
             MAPUP-ERROR MAPUP-TASK OPEN-UP-GETNTH OPEN-UP-GETNTH-ON-ZERO
             OS-CURRENT-TASKID TM-CPU TM-UNPACK-ERROR-TM-PACK-PSW TM-ERROR-TM)
     (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                    GOOD-TM-PROPERTIES GROUND-ZERO)
     (USE (NUMBERP-MAPUP-LIMIT (TASKID (QFIRST (MAPUP-QUEUE (OS-READYQ OS))))
                               (OS OS))
          (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
     (DISABLE-THEORY T)))

(DISABLE TM-ERROR-MAPUP-TASK)

(PROVE-LEMMA
     TM-ERROR-MAPUP-OS-TASKS
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-ERROR (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                       (MAPUP-OS-TASKS OS)))
                     (TM-ERROR OS)))
     ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST GETNTH-MAPUP-TASKS-COROLLARY
              MAPUP-OS-TASKS TM-ERROR-MAPUP-TASK)
      (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                     GROUND-ZERO)
      (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
      (DISABLE-THEORY T)))

(DISABLE TM-ERROR-MAPUP-OS-TASKS)

(PROVE-LEMMA
  TM-SVCFLAG-MAPUP-TASK
  (REWRITE)
  (IMPLIES (AND (GOOD-OS OS)
                (NOT (TM-WAITING OS)))
           (EQUAL (TM-SVCFLAG (MAPUP-TASK (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          OS))
                  (TM-SVCFLAG OS)))
  ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST MAPUP-ADDRESS-SPACE MAPUP-CPU
           MAPUP-SVCFLAG MAPUP-TASK OPEN-UP-GETNTH OPEN-UP-GETNTH-ON-ZERO
           OS-CURRENT-TASKID TM-CPU TM-UNPACK-SVCFLAG-TM-PACK-PSW
           TM-SVCFLAG-TM)
   (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                  GOOD-TM-PROPERTIES GROUND-ZERO)
   (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
   (DISABLE-THEORY T)))

(DISABLE TM-SVCFLAG-MAPUP-TASK)

(PROVE-LEMMA
     TM-SVCFLAG-MAPUP-OS-TASKS
     (REWRITE)
     (IMPLIES (AND (GOOD-OS OS)
                   (NOT (TM-WAITING OS)))
              (EQUAL (TM-SVCFLAG (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                         (MAPUP-OS-TASKS OS)))
                     (TM-SVCFLAG OS)))
     ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST GETNTH-MAPUP-TASKS-COROLLARY
              MAPUP-OS-TASKS TM-SVCFLAG-MAPUP-TASK)
      (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                     GROUND-ZERO)
      (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
      (DISABLE-THEORY T)))

(DISABLE TM-SVCFLAG-MAPUP-OS-TASKS)

(PROVE-LEMMA NOT-TM-IN-SUPERVISOR-MODE-MAPUP-TASK
             (REWRITE)
             (NOT (TM-IN-SUPERVISOR-MODE (MAPUP-TASK TASKID OS)))
             ((ENABLE MAPUP-TASK TM-IN-SUPERVISOR-MODE-MAPUP-ADDRESS-SPACE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-MAPUP-TASK)

(PROVE-LEMMA
 NOT-TM-IN-SUPERVISOR-MODE-GETNTH-MAPUP-OS-TASKS
 (REWRITE)
 (IMPLIES
      (AND (GOOD-OS OS)
           (NOT (TM-WAITING OS)))
      (NOT (TM-IN-SUPERVISOR-MODE (GETNTH (QFIRST (MAPUP-QUEUE (OS-READYQ OS)))
                                          (MAPUP-OS-TASKS OS)))))
 ((ENABLE CORRECTNESS-OF-ARRAY-QFIRST GETNTH-MAPUP-TASKS-COROLLARY
          MAPUP-OS-TASKS NOT-TM-IN-SUPERVISOR-MODE-MAPUP-TASK)
  (ENABLE-THEORY FINITE-NUMBER-QUEUE-COROLLARIES GOOD-OS-PROPERTIES
                 GROUND-ZERO)
  (USE (ARRAY-QFIRST-FINITE-NUMBER-QUEUE-COROLLARY (QUEUE (OS-READYQ OS))))
  (DISABLE-THEORY T)))

(DISABLE NOT-TM-IN-SUPERVISOR-MODE-GETNTH-MAPUP-OS-TASKS)

(PROVE-LEMMA AK-INPUT-INTERRUPTP-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-INPUT-INTERRUPTP (MAPUP-OS OS))
                             (TM-INPUT-INTERRUPTP OS)))
             ((ENABLE AK-INPUT-INTERRUPTP MAPUP-OS OS-NOT-IN-SUPERVISOR-MODE
                      TM-INPUT-INTERRUPTP AK-IPORTS-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-INPUT-INTERRUPTP-MAPUP-OS)

(PROVE-LEMMA AK-OUTPUT-INTERRUPTP-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-OUTPUT-INTERRUPTP (MAPUP-OS OS))
                             (TM-OUTPUT-INTERRUPTP OS)))
             ((ENABLE AK-OUTPUT-INTERRUPTP MAPUP-OS OS-NOT-IN-SUPERVISOR-MODE
                      TM-OUTPUT-INTERRUPTP AK-OPORTS-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-OUTPUT-INTERRUPTP-MAPUP-OS)

(PROVE-LEMMA AK-ERRORP-MAPUP-OS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (AK-ERRORP (MAPUP-OS OS))
                             (TM-ERRORP OS)))
             ((ENABLE AK-ERRORP AK-TASKID MAPUP-OS TM-ERROR-MAPUP-OS-TASKS
                      TM-ERRORP AK-READYQ-AK AK-PSTATES-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-ERRORP-MAPUP-OS)

(PROVE-LEMMA AK-SVC-INTERRUPTP-MAPUP-OS
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS)
                           (NOT (TM-WAITING OS)))
                      (EQUAL (AK-SVC-INTERRUPTP (MAPUP-OS OS))
                             (TM-SVC-INTERRUPTP OS)))
             ((ENABLE AK-SVC-INTERRUPTP AK-TASKID MAPUP-OS
                      NOT-TM-IN-SUPERVISOR-MODE-GETNTH-MAPUP-OS-TASKS
                      TM-SVC-INTERRUPTP TM-SVCFLAG-MAPUP-OS-TASKS AK-READYQ-AK
                      AK-PSTATES-AK)
              (ENABLE-THEORY GOOD-OS-PROPERTIES GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-SVC-INTERRUPTP-MAPUP-OS)

(PROVE-LEMMA AK-CLOCK-INTERRUPTP-MAPUP-OS
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (AK-CLOCK-INTERRUPTP (MAPUP-OS OS))
                             (TM-CLOCK-INTERRUPTP OS)))
             ((ENABLE AK-CLOCK-INTERRUPTP MAPUP-OS OS-NOT-IN-SUPERVISOR-MODE
                      TM-CLOCK-INTERRUPTP AK-CLOCK-AK)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE AK-CLOCK-INTERRUPTP-MAPUP-OS)

(PROVE-LEMMA OS-STEP-IMPLEMENTS-AK-STEP
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS (OS-STEP OS))
                             (AK-STEP (MAPUP-OS OS))))
             ((ENABLE AK-CLOCK-INTERRUPTP-MAPUP-OS AK-ERRORP-MAPUP-OS
                      AK-INPUT-INTERRUPTP-MAPUP-OS
                      AK-OUTPUT-INTERRUPTP-MAPUP-OS AK-STEP
                      AK-SVC-INTERRUPTP-MAPUP-OS AK-WAITING-MAPUP-OS
                      AK-INTERRUPTING-INPUT-PORT AK-INTERRUPTING-OUTPUT-PORT
                      CORRECTNESS-OF-CLOCK-INTERRUPT-HANDLER
                      CORRECTNESS-OF-INPUT-INTERRUPT-HANDLER
                      CORRECTNESS-OF-OS-ERROR-HANDLER
                      CORRECTNESS-OF-OUTPUT-INTERRUPT-HANDLER
                      CORRECTNESS-OF-SVC-HANDLER
                      CORRECTNESS-OF-TM-FETCH-EXECUTE
                      OS-NOT-IN-SUPERVISOR-MODE OS-STEP TM-INPUT-INTERRUPTP
                      TM-OUTPUT-INTERRUPTP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-STEP-IMPLEMENTS-AK-STEP)

(PROVE-LEMMA MAPUP-CPU-TM-POST-INTERRUPT
             (REWRITE)
             (EQUAL (MAPUP-CPU TASKID
                               (TM-POST-INTERRUPT INTERRUPT OS))
                    (MAPUP-CPU TASKID OS))
             ((ENABLE MAPUP-CPU OS-CURRENT-TASKID OS-READYQ OS-TASK-TABLE
                      TM-CPU TM-POST-INTERRUPT TM-R0 TM-R1 TM-R2 TM-R3 TM-R4
                      TM-R5 TM-R6 TM-R7 TM-SET-IPORTS TM-SET-OPORTS TM-WAITING)
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-CPU-TM-POST-INTERRUPT)

(PROVE-LEMMA MAPUP-TASK-TM-POST-INTERRUPT
             (REWRITE)
             (EQUAL (MAPUP-TASK TASKID
                                (TM-POST-INTERRUPT INTERRUPT OS))
                    (MAPUP-TASK TASKID OS))
             ((ENABLE MAPUP-BASE MAPUP-CC MAPUP-ERROR MAPUP-LIMIT MAPUP-REGS
                      MAPUP-SVCFLAG MAPUP-SVCID MAPUP-TASK OS-SEGMENT-TABLE
                      TM-POST-INTERRUPT TM-SET-IPORTS TM-SET-OPORTS)
              (USE (MAPUP-CPU-TM-POST-INTERRUPT (OS OS)
                                                (TASKID TASKID)))
              (ENABLE-THEORY TM-SHELLS GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASK-TM-POST-INTERRUPT)

(PROVE-LEMMA MAPUP-TASKS-TM-POST-INTERRUPT
             (REWRITE)
             (EQUAL (MAPUP-TASKS TASKID
                                 (TM-POST-INTERRUPT INTERRUPT OS))
                    (MAPUP-TASKS TASKID OS))
             ((ENABLE MAPUP-TASK-TM-POST-INTERRUPT MAPUP-TASKS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-TASKS-TM-POST-INTERRUPT)

(PROVE-LEMMA MAPUP-OS-TM-POST-INTERRUPT
             (REWRITE)
             (EQUAL (MAPUP-OS (TM-POST-INTERRUPT INTERRUPT OS))
                    (AK-POST-INTERRUPT INTERRUPT
                                       (MAPUP-OS OS)))
             ((ENABLE AK-POST-INTERRUPT MAPUP-OS MAPUP-OS-IBUFFERS
                      MAPUP-OS-MBUFFERS MAPUP-OS-OBUFFERS MAPUP-OS-TASKS
                      OS-IBUFFERS OS-MBUFFERS OS-OBUFFERS OS-READYQ
                      OS-STATUS-TABLE TM-POST-INTERRUPT TM-SET-IPORTS
                      TM-SET-OPORTS)
              (USE (MAPUP-TASKS-TM-POST-INTERRUPT (TASKID '0)
                                                  (OS OS)))
              (ENABLE-THEORY TM-SHELLS AK-SHELL GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE MAPUP-OS-TM-POST-INTERRUPT)

(DEFN BAK-PROCESSOR
      (AK ORACLE)
      (IF (LISTP ORACLE)
          (AK-STEP (AK-POST-INTERRUPT (CAR ORACLE)
                                      (BAK-PROCESSOR AK (CDR ORACLE))))
          AK)
      NIL)

(PROVE-LEMMA BAK-IMPLEMENTS-AK
             (REWRITE)
             (EQUAL (BAK-PROCESSOR AK ORACLE)
                    (AK-PROCESSOR AK (REVERSE ORACLE)))
             ((ENABLE AK-PROCESSOR APPEND BAK-PROCESSOR REVERSE)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE BAK-IMPLEMENTS-AK)

(PROVE-LEMMA BOS-IMPLEMENTS-BAK
             (REWRITE)
             (IMPLIES (GOOD-OS OS)
                      (EQUAL (MAPUP-OS (BOS-PROCESSOR OS ORACLE))
                             (BAK-PROCESSOR (MAPUP-OS OS) ORACLE)))
             ((ENABLE BAK-PROCESSOR BOS-PROCESSOR GOOD-OS-BOS-PROCESSOR
                      GOOD-OS-TM-POST-INTERRUPT MAPUP-OS-TM-POST-INTERRUPT
                      OS-STEP-IMPLEMENTS-AK-STEP)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE BOS-IMPLEMENTS-BAK)

(PROVE-LEMMA OS-IMPLEMENTS-AK
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (PLISTP ORACLE))
                      (EQUAL (MAPUP-OS (OS-PROCESSOR OS ORACLE))
                             (AK-PROCESSOR (MAPUP-OS OS) ORACLE)))
             ((ENABLE BAK-IMPLEMENTS-AK BOS-IMPLEMENTS-OS REVERSE-REVERSE)
              (USE (BOS-IMPLEMENTS-BAK (OS OS)
                                       (ORACLE (REVERSE ORACLE))))
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE OS-IMPLEMENTS-AK)

(PROVE-LEMMA CORRECTNESS-OF-OPERATING-SYSTEM
             (REWRITE)
             (IMPLIES (AND (GOOD-OS OS) (PLISTP ORACLE))
                      (EQUAL (MAPUP-OS (TM-PROCESSOR OS
                                                     (OS-ORACLE OS ORACLE)))
                             (AK-PROCESSOR (MAPUP-OS OS) ORACLE)))
             ((ENABLE OS-IMPLEMENTS-AK TM-IMPLEMENTS-OS)
              (ENABLE-THEORY GROUND-ZERO)
              (DISABLE-THEORY T)))

(DISABLE CORRECTNESS-OF-OPERATING-SYSTEM)

(DEFN PROJECT-ITH-TASK
      (I OS)
      (PROJECT I (MAPUP-OS OS))
      NIL)

(PROVE-LEMMA OS-IMPLEMENTS-PARALLEL-TASKS NIL
      (IMPLIES (AND (GOOD-OS OS)
                    (AND (PLISTP ORACLE)
                         (FINITE-NUMBERP I
                                         (LENGTH (AK-PSTATES (MAPUP-OS OS))))))
               (EQUAL (PROJECT-ITH-TASK I
                                        (TM-PROCESSOR OS
                                                      (OS-ORACLE OS ORACLE)))
                      (TASK-PROCESSOR (PROJECT-ITH-TASK I OS)
                                      I
                                      (CONTROL-ORACLE I
                                                      (MAPUP-OS OS)
                                                      ORACLE))))
      ((ENABLE AK-IMPLEMENTS-PARALLEL-TASKS CORRECTNESS-OF-OPERATING-SYSTEM
               GOOD-AK-MAPUP-OS PROJECT-ITH-TASK)
       (ENABLE-THEORY GROUND-ZERO)
       (DISABLE-THEORY T)))